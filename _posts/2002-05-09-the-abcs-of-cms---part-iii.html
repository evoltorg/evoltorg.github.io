---
layout: post
permalink: node/25922
ratings: 4
avgrate: 4.5000
rating: 4.16
categories: [Site Development]
user: Jay Blanchard
real_name: "Jay Blanchard"
user_biog: "<p>A long time code-jockey Jay enjoys music (especially horn bands like Tower of Power, Chicago and Here Come The Mummies), furniture building, physics, motorcycle riding and philosophy. His latest projects include several business-specific web-based tools and widgets.</p>

<p>Jay lives in Central Texas, but has never forgotten his South Louisiana heritage. His daughters, Kaitlyn and Brittany, are his inspiration!</p>"
user_since: 21 Mar 2001
avatar: /images/pictures/picture-9186.jpg
article_count: 6
excerpt: "We'll start up the content management workflow ladder in this installment, and provide plenty of information for the road ahead."
---
<p></p>If you have been participating up until now we have performed a lot of housekeeping duties in setting up our custom Content Management System. In this installment we will start getting to the meat of a CMS, designing for the workflow process. Covered will be article submission, allowing an author to preview and edit his or her own articles, and more workflow theory.</p></p></p><p><h2>Workflow Theory Examined</h2></p><p><p></p>In this model of a content management system (CMS) we are installing a very basic workflow;</p></p></p><p><ul></p><li>An author writes and then submits an article to be considered for publication.</li></p><li>An editor checks/corrects the article for spelling and grammar. The editor may also do fact checking. If the editor determines that the article is not acceptable enough he can route the article back to the author for changes. A time and day may be defined for completion of editing tasks within any given time period.</li></p><li>When the editor has finished with the article he forwards it to an approval source. This person decides if the content is acceptable for publication in appropriate forums (web site, magazine, daily publication, etc.) within the rules established for content on those forums. If the approval source finds the article unacceptable they can route the article back to the author for improvement. Again, some sort of time/day restriction may be applied to approval tasks.</li></p><li>Once approved the article is sent to be scheduled. The scheduler will set the publication date and the date that the article expires.</li></p></ul></p><p><p></p>As you can see, the article goes through many levels of approval prior to publication. This offers assurance that the article represents the subject and the presenter in the best possible light. Depending on the flow for a particular document set, errors have the opportunity to be caught and corrected at multiple levels.</p></p></p><p><p></p>For workflow to operate properly it must be well defined (as in our example above) from the task level to the responsibility level. Assigning proper personnel resources to workflow is critical, perhaps the most critical aspect of content management. If the personnel resources fail to understand and perform their duties as defined by the workflow specifications then having a CMS is like having a nifty toy on Christmas morning... without the batteries. This becomes especially true when the CMS is expanded to handle other content. </p></p></p><p><p></p><strong>An example of this is a product tear sheet.</strong> When a product tear sheet is initially generated there are many hands at work. The copywriter, the photographer, the graphic artist, and others agonize over the most minute of details bringing the tear sheet to life. Rather than fax things, email things and have endless conference calls, it is decided the product tear sheet can reside in the CMS. This does not sound bad until you realize that many people can work on the tear sheet all at the same time. This could create a traffic jam that would ulimately leave the users frustrated and the tear sheet incomplete, at best. This is where a Content Versioning System (CVS) comes in.</p></p></p><p><p></p>A <acronym title="Content Versioning System">CVS</acronym> allows people who are working on a particular document to 'check-out' the document, just as you would check-out a book at your local library. During the check-out period the document is unavailable to others. When the document is 'checked-in' it becomes available to others who are working on the same document, and information about what has been done to that document is available (usually in a log associated with the document) to the person(s) working on it. Everybody participating in the document process knows then what has been done to the document, when it was done, and any other information that might be relevant to the document. A full explanation of CVS is beyond the scope of this series but there are many good resources available online and in bookstores.</p></p></p><p><h2>Specifying Workflow</h2></p><p><p></p>Each element in a CMS, such as the article being worked with in this model, may have a different workflow scheme. This could involve different levels of approval or different personnel resources.</p></p><p></p>For instance, say there is a daily announcements section on the front page of your Intranet site. The workflow could be;</p></p></p><p><ul></p><li>Announcement Submitted</li></p><li>Announcement is reviewed, edited, and scheduled for publication by one person assigned the task. The task must be completed by 7:45am EST, Monday - Friday.</li></p></li></p></ul></p><p><p></p>As the CMS developer it your responsibility to know the definition of each CMS element and the workflow associated with it. You may have to interact with various departments and personnel for each element. However, by knowing the workflow process for each element within the CMS your job as a developer is much easier. What do you need to know for each element?</p></p></p><p><ol></p><li>Who are the potential authors?</li></p><li>Once an element is submitted who should it go to for editing and/or approval?</li></p><li>Once approved, who has the responsibility to schedule the release of this element to the appropriate forum?</li></p></ol></p><p><p></p>Consider the following graphic and determine the number of elements and workflows.</p></p></p><p><!--insert workflow graphic here--></p><p><img src="images/9186/jay_workflow2.gif" border="0"></p><p></p><p></p>You can create a workflow design/management tool within the CMS that allows an end-user to specify workflows for various elements. This is a complex development chore, beyond the scope of this series, that can pay off in the most satisfying way when it is correctly designed. Usually this kind of functionality is found only in the most expensive of the retail systems, but should be considered in any content management system.</p></p></p><p><h2>Article Submission</h2></p><p><p>Here is the form for submitting an article, <code>subart.php</code>;</p></p><p><pre></p>&lt;? session_start(); ?&gt;</p>&lt;?</p>//connect to and select database</p>if(!($dbconnect = mysql_pconnect("127.0.0.1", "cms_user", "cms_password"))){</p>	print("Failed to connect to database!</p>");</p>	exit();</p>	}</p>if(!mysql_select_db("cms", $dbconnect)){</p>	print("Failed to select database!</p>");</p>	exit();</p>	}</p><p>//query to get navigation from database</p>$qnav = "SELECT URL ";</p>$qnav .= "FROM tblNavigation ";</p>$qnav .= "WHERE accesslevel = '$level' ";</p><p>if(!($dbnav = mysql_query($qnav, $dbconnect))){</p>	print("MySQL reports: " . mysql_error() . "</p>");</p>	exit();</p>	}</p><p>//query to get available editors</p>$qedit = "SELECT name ";</p>$qedit .= "FROM tblUser ";</p>$qedit .= "WHERE accesslevel = 'editor' ";</p><p>if(!($dbedit = mysql_query($qedit, $dbconnect))){</p>	print("MySQL reports: " . mysql_error() . "</p>");</p>	exit();</p>	}</p>?&gt;</p><p>&lt;html&gt;</p>&lt;head&gt;</p>&lt;title&gt;CMS&lt;/title&gt;</p>&lt;LINK REL="StyleSheet" HREF="cms.css" type="text/css"&gt;</p>&lt;/head&gt;</p>&lt;body&gt;</p><p>&lt;div class="left"&gt;</p>&lt;?</p>// list the nav links for this type of user</p><p>while($dbrow = mysql_fetch_object($dbnav)){</p>	print($dbrow->URL . "&lt;br&gt;</p>");</p>	}</p>?&gt;</p>&lt;/div&gt;</p><p>&lt;div class="right"&gt;</p><p>&lt;h1&gt;Submit An Article&lt;/h1&gt;</p><p>&lt;form action="cmssubmit.php" method="POST"&gt;</p>&lt;table cellpadding="3" cellspacing="0" border="1"&gt;</p>&lt;tr&gt;</p>&lt;td&gt;Article Title&lt;/td&gt;</p>&lt;td&gt;&lt;input type="text" name="title" size="64" maxlength="64"&gt;&lt;/td&gt;</p>&lt;/tr&gt;</p>&lt;tr&gt;</p>&lt;td&gt;Author email&lt;/td&gt;</p>&lt;td&gt;&lt? print($emailid) ?&gt;&lt;/td&gt;</p>&lt;/tr&gt;</p>&lt;tr&gt;</p>&lt;td&gt;Article Teaser&lt;/td&gt;</p>&lt;td&gt;&lt;textarea name="teaser" cols="50" rows="3" wrap="virtual" maxlength="255"&gt;&lt;/textarea&gt;&lt;/td&gt;</p>&lt;/tr&gt;</p>&lt;tr&gt;</p>&lt;td&gt;Article Body&lt;/td&gt;</p>&lt;td&gt;&lt;textarea name="body" cols="50" rows="25" wrap="virtual"&gt;&lt;/textarea&gt;&lt;/td&gt;</p>&lt;/tr&gt;</p>&lt;tr&gt;</p>&lt;td&gt;Editor&lt;/td&gt;</p>&lt;td&gt;</p>&lt;select name="editor"&gt;</p>&lt;option&gt;---Select Editor---&lt;/option&gt;</p>&lt;?</p><p>//list the editors available</p><p>while($dbrow = mysql_fetch_object($dbedit)){</p>	print("&lt;option&gt;" . $dbrow->name . "&lt;/option&gt;</p>");</p>	}</p>?&gt;</p>&lt;/select&gt;</p>&lt;/td&gt;</p>&lt;/tr&gt;</p>&lt;tr&gt;</p>&lt;td&gt;Date Submitted&lt;br&gt;Format - YYYY-MM-DD&lt;/td&gt;</p>&lt;td&gt;&lt;input type="text" name="submitted" size="10" maxlength="10"&gt;&lt;/td&gt;</p>&lt;/tr&gt;</p>&lt;tr&gt;</p>&lt;td&gt;&lt;/td&gt;</p>&lt;td&gt;&lt;INPUT type="submit" name="action" value="Save"&gt;&nbsp;&lt;INPUT type="submit" name="action" value="Submit Article"&gt;&nbsp;&lt;INPUT type="reset"&gt;&lt;/td&gt;</p>&lt;/tr&gt;</p>&lt;/table&gt;</p>&lt;/form&gt;</p>&lt;/div&gt;</p>&lt;/body&gt;</p>&lt;/html&gt;</p></pre></p><p><p></p>As in the page listing this author's articles (<code>myart.php</code>) the code in the <code>&lt;div class="left"&gt;</code> prints out the navigation links for available for authors. We will be adding to this as the CMS is developed and other users, such as editors, approvers, and schedulers become users of the system.</p></p></p><p><p></p>Just after the comment <code>"//list the editors available"</code>, the PHP code will create a drop down option in the form, allowing the author to choose his editor. While we have taken a rather loose approach in this series, you may want the editor to be chosen automatically for each author in other situations. If that is the case you will have to modify your users table, adding a column to contain editor information for each author. In the case of the announcement example above you could just hard code the information in the page where announcements are submitted or have a specially designated access level for certain types of editing/approving chores (i.e. EditorA, EditorB, etc. ).</p></p></p><p><p></p>You'll also note that there are three buttons for form actions, 'Save', 'Submit Article', and 'Reset'. This is different from most form handling via a web-interface, but the result allows an efficient way to use the workflow process. If the author needs to perform editing on his or her article, or maybe has not quite put the finishing touches on it, the 'Save' button allows the article to be sent to the database with no notification (as you will see in the script that processes the submission) to an editor. The author will then be able to return to the article at a later time to perform whatever changes that they need to perform. The 'Submit Article' button send the article to the database and notifies and editor. Of course, the 'Reset' button clears the form.</p></p></p><p><p></p>Here is the script that processes article submission, cmssubart.php;</p></p></p><p><pre></p>&lt;? session_start(); ?&gt;</p>&lt;?</p>//connect to and select database</p>if(!($dbconnect = mysql_pconnect("127.0.0.1", "cms_user", "cms_password"))){</p>	print("Failed to connect to database!</p>");</p>	exit();</p>	}</p><p>if(!mysql_select_db("cms", $dbconnect)){</p>	print("Failed to select database!</p>");</p>	exit();</p>	}</p><p>// perform action based on which button was pushed on submit form</p>switch($action)</p>{</p>	case "Save":</p>	// query to insert saved elements only</p>	$qsave = "INSERT INTO tblArticle(title, teaser, body, author) ";</p>	$qsave .= "VALUES('$title', '$teaser', '$body', '$emailid') ";</p><p>	if(!($dbsave = mysql_query($qsave, $dbconnect))){</p>	print("MySQL reports: " . mysql_error() . "&lt;br&gt;</p>");</p>	exit();</p>	}	</p><p>	break;</p><p>	case "Submit Article":</p>	//query to submit article</p>	$qsubmit = "INSERT INTO tblArticle(title, teaser, body, author, editor, submitted) ";</p>	$qsubmit .= "VALUES('$title', '$teaser', '$body', '$emailid', '$editor', '$submitted') ";</p><p>	if(!($dbsubmit = mysql_query($qsubmit, $dbconnect))){</p>	print("MySQL reports: " . mysql_error() . "&lt;br&gt;</p>");</p>	exit();</p>	}</p><p>	//select editor information and send an email</p>	$qeditor = "SELECT email ";</p>	$qeditor .= "FROM tblUser ";</p>	$qeditor .= "WHERE name = '$editor' ";</p><p>	if(!($dbeditor = mysql_query($qeditor, $dbconnect))){</p>	print("MySQL reports: " . mysql_error() . "&lt;br&gt;</p>");</p>	exit();</p>	}</p><p>	//message to editor</p>	$dbeditor = mysql_fetch_object($dbeditor);</p>	$messeditor = "$author has submitted an article, $title, for editing.</p>";</p>	$messeditor .= "Please review this article at your earliest convenience.</p><p>";</p><p>	mail("$dbeditor->email", "CMS Article Submission", $messeditor, "From: CMS System");</p><p>	break;</p>}</p>header("Location: myart.php"); exit; 	</p>?&gt;</p></pre></p><p><p></p>The path for the content can be selected by using multiple buttons in the form; (leaving out the 'Reset' button)<br><br></p><code>&lt;INPUT type="submit" name="action" value="Save"&gt;&nbsp;&lt;INPUT type="submit" name="action" value="Submit Article"&gt;&nbsp;</code><br><br></p>Each button has the name 'action', and the value of the action is the 'value' of each button. Within the PHP script that processes the article submission the value of the variable <code>$action</code> is the value of the button pushed. By using;<br><br></p><code>switch($action){}</code><br><br></p>(which is similar to ASP's <code>SELECT CASE</code>) we can select what should be done with the article. This gives you the opportunity to specify multiple actions for any given form, you are only limited by the amount of action buttons you can create. A word of caution is in order here, you must provide adequate training, along with a help system or other clues so that users of the CMS understand what each action perfroms.</p></p></p><p><p></p>If the author chooses an editor, includes a submission date, and clicks the 'Submit Article' button he or she will no longer have the opportunity to edit the article (unless the article is 'sent back' to them from someone higher up the workflow ladder). The article will show up on their 'My Articles' page, from where they will be able to preview / review the article.</p></p></p><p><h2>An Author Edits</h2></p><p><h3>Doing Reviews</h3></p><p></p>The author can submit articles, now he or she needs to be able to edit articles which have not been submitted to an editor. To enable this action we are going to modify our original myart.php, placing a link next to the articles where editing is allowed. Articles needing editing will be the first to be listed, while articles already forwarded to editing will only be available for review. (You can just replace the old myart.php with the following code.)</p></p></p><p><pre></p>&lt;? session_start(); ?&gt;</p>&lt;?</p><p></p>//connect to and select database</p>if(!($dbconnect = mysql_pconnect("127.0.0.1", "cms_user", "cms_password"))){</p>	print("Failed to connect to database!</p>");</p>	exit();</p>	}</p>if(!mysql_select_db("cms", $dbconnect)){</p>	print("Failed to select database!</p>");</p>	exit();</p>	}</p><p>//query to get navigation from database</p>$qnav = "SELECT URL ";</p>$qnav .= "FROM tblNavigation ";</p>$qnav .= "WHERE accesslevel = '$level' ";</p><p>if(!($dbnav = mysql_query($qnav, $dbconnect))){</p>	print("MySQL reports: " . mysql_error() . "</p>");</p>	exit();</p>	}</p><p>//query to get article information</p>$qart = "SELECT a.ID, a.title, a.publish, a.editor, u.name ";</p>$qart .= "FROM tblArticle a, tblUser u ";</p>$qart .= "WHERE u.email = '$emailid' ";</p>$qart .= "AND a.author = u.email ";</p>$qart .= "ORDER BY a.editor ";</p><p>if(!($dbart = mysql_query($qart, $dbconnect))){</p>	print("MySQL reports: " . mysql_error() . "</p>");</p>	exit();</p>	}</p><p>?></p>&lt;html&gt;</p>&lt;head&gt;</p>&lt;title&gt;CMS&lt;/title&gt;</p>&lt;LINK REL="StyleSheet" HREF="cms.css" type="text/css"&gt;</p>&lt;/head&gt;</p>&lt;body&gt;</p><p>&lt;div class="left"&gt;</p>&lt;?</p>while($dbrow = mysql_fetch_object($dbnav)){</p>	print($dbrow->URL . "&lt;br&gt;</p>");</p>	}</p>?></p>&lt;/div&gt;</p><p>&lt;div class="right"&gt;</p>&lt;?</p>$dbartrow = mysql_fetch_object($dbart);</p><p>if($dbartrow->ID == ""){</p>	//if there are no articles for this author</p>	print("You have not placed any articles in the Content Management System");</p>	}</p>else </p>	{</p>	//print article links for this author</p>	mysql_data_seek($dbart, 0);</p>	print("&lt;h3&gt;Welcome " . $dbartrow->name . "&lt;/h3&gt;</p>");</p><p>	while($dbartrow = mysql_fetch_object($dbart)){</p>		//if there is an editor print only a link to the article preview</p>		if($dbartrow->editor != ""){</p>			print("&lt;a href=\"artprvw.php?aid=" . $dbartrow->ID . "\"&gt;" . $dbartrow->title . "&lt;/a>&lt;br&gt;</p>");</p>			}</p>		else</p>			{</p>			print("&lt;a href=\"artprvw.php?aid=" . $dbartrow->ID . "\"&gt;" . $dbartrow->title . "&lt;/a&gt; ( &lt;a href=\"authed.php?aid=" . $dbartrow->ID . "\"&gt;Edit&lt;/a&gt; )&lt;br&gt;</p>");</p>			}</p>		}</p>	}</p>?&gt;</p>&lt;/div&gt;</p>&lt;/body&gt;</p>&lt;/html&gt;</p></pre></p><p><p></p>This line of code, <code>if($dbartrow->editor != "")</code>, tests for the existence of an editor in the record and prints out the links accordingly. If an editor exists then a link to the article preview is printed. If no editor exists for this article then the article preview link is printed, along with a link to a page where the author can edit their own article.</p></p></p><p><p></p>The following code block is for an author to preview an article (artprvw.php); </p></p></p><p><pre></p>&lt;? session_start(); ?&gt;</p>&lt;?</p>//connect to and select database</p>if(!($dbconnect = mysql_pconnect("127.0.0.1", "cms_user", "cms_password"))){</p>	print("Failed to connect to database!</p>");</p>	exit();</p>	}</p>if(!mysql_select_db("cms", $dbconnect)){</p>	print("Failed to select database!</p>");</p>	exit();</p>	}</p><p>//query to get navigation from database</p>$qnav = "SELECT URL ";</p>$qnav .= "FROM tblNavigation ";</p>$qnav .= "WHERE accesslevel = '$level' ";</p><p>if(!($dbnav = mysql_query($qnav, $dbconnect))){</p>	print("MySQL reports: " . mysql_error() . "</p>");</p>	exit();</p>	}</p><p>//get article information from database</p>$qart = "SELECT a.ID, a.title, a.teaser, a.body ";</p>$qart .= "FROM tblArticle a ";</p>$qart .= "WHERE a.ID = $aid ";</p><p>if(!($dbart = mysql_query($qart, $dbconnect))){</p>	print("MySQL reports: " . mysql_error() . "</p>");</p>	exit();</p>	}</p><p>//place database items in variables for easier manipulation</p>$dbartrow = mysql_fetch_object($dbart);</p>$atitle = $dbartrow->title;</p>$ateaser = $dbartrow->teaser;</p>$abody = $dbartrow->body;</p><p>?></p>&lt;html&gt;</p>&lt;head&gt;</p>&lt;title&gt;CMS Article Preview&lt;/title&gt;</p>&lt;LINK REL="StyleSheet" HREF="cms.css" type="text/css"&gt;</p>&lt;/head&gt;</p>&lt;body&gt;</p><p>&lt;div class="left"&gt;</p>&lt;?</p>while($dbrow = mysql_fetch_object($dbnav)){</p>	print($dbrow->URL . "&lt;br&gt;</p>");</p>	}</p>?></p>&lt;/div&gt;</p><p>&lt;div class="right"&gt;</p>&lt;?</p>print("&lt;h2&gt;" . $atitle . "&lt;/h2&gt;</p>");</p>print("&lt;p&gt;" . $ateaser . "&lt;/p&gt;</p>");</p>//place proper HTML paragraph mark up in body</p>print("&lt;p&gt;</p>" . ereg_replace(chr(10).chr(13), "&lt;/p&gt;</p>&lt;p&gt;", $abody) . "</p>&lt;/p&gt;</p>");</p>?&gt;</p>&lt;/div&gt;</p>&lt;/body&gt;</p>&lt;/html&gt;</p></pre></p><p><p></p>This will display the article as it is selected from 'My Articles' so that the author may preview the work as it might appear on a web site. You can use the same techniques to display the article on a web site or Intranet site, just build a template that extracts the relevant information from the database and displays it in a readable form. You may also want to include things like the author's name and email address, and date published.</p></p></p><p><p></p>One of the more interesting aspects of the code for previewing the article is;</p></p></p><p></p><code>print("&lt;p&gt;</p>" . ereg_replace(chr(10).chr(13), "&lt;/p&gt;</p>&lt;p&gt;", $abody) . "</p>&lt;/p&gt;</p>");</code></p></p></p><p></p>This line of code prints out the body of the article with the proper HTML paragraph mark-up. It prints an opening paragraph tag, followed by a new line. Then the PHP function <code>ereg_replace()</code> replaces each linefeed (<code>char(10)</code>) and carriage return (<code>char(13)</code>) combination with a closing, and then opening paragraph tag. When the article is entered into the CMS an author will generally hit enter twice at the end of the paragraph, which gives the linefeed carriage return combination. We close the line of code by printing out a closing paragraph tag. Why do we do this? Two reasons:</p></p></p><ol></p><li>Since the data in the database contains no mark-up of any kind it makes it easier to output the data to multiple formats.</li></p><li>Users do not have to be taught mark-up, saving time and easing their ability to use the system</li></p></ol></p><p><p></p><strong>Note:</strong> In the model being presented here we are not doing anything to prevent mark-up from being entered with the data in the database. If you desire to block mark-up you will have to catch and remove it during the article submission process.</p></p></p><p><p></p>Our output will look like this;</p></p></p><p></p>&lt;p&gt;<br></p>This is a paragraph.<br></p>&lt;/p&gt;<br></p>&lt;p&gt;<br></p>This is another paragraph.<br></p>&lt;/p&gt;</p></p></p><p><h3>Changing Things</h3></p><p><p></p>Giving authors the opportunity to save articles in the database without sending them through the workflow process until they are ready offers a big advantage for many situations. As you might imagine, working on an article can be a lengthy process, full of edits, and ravaged with changes. While many would fire up their favorite word processor or text editor, with a plan to cut-n-paste the article into the CMS later, there are many who would prefer to work with the article directly in the environment that it is destined for. Given that, here is the code for authed.php;</p></p></p><p><pre></p>&lt;? session_start(); ?&gt;</p>&lt;?</p>//connect to and select database</p>if(!($dbconnect = mysql_pconnect("127.0.0.1", "cms_user", "cms_password"))){</p>	print("Failed to connect to database!</p>");</p>	exit();</p>	}</p>if(!mysql_select_db("cms", $dbconnect)){</p>	print("Failed to select database!</p>");</p>	exit();</p>	}</p><p>//query to get navigation from database</p>$qnav = "SELECT URL ";</p>$qnav .= "FROM tblNavigation ";</p>$qnav .= "WHERE accesslevel = '$level' ";</p><p>if(!($dbnav = mysql_query($qnav, $dbconnect))){</p>	print("MySQL reports: " . mysql_error() . "</p>");</p>	exit();</p>	}</p><p>//query to get available editors</p>$qedit = "SELECT name ";</p>$qedit .= "FROM tblUser ";</p>$qedit .= "WHERE accesslevel = 'editor' ";</p><p>if(!($dbedit = mysql_query($qedit, $dbconnect))){</p>	print("MySQL reports: " . mysql_error() . "</p>");</p>	exit();</p>	}</p><p>//query to get article information</p>$qart = "SELECT a.ID, a.title, a.teaser, a.body ";</p>$qart .= "FROM tblArticle a ";</p>$qart .= "WHERE a.ID = $aid ";</p><p>if(!($dbart = mysql_query($qart, $dbconnect))){</p>	print("MySQL reports: " . mysql_error() . "</p>");</p>	exit();</p>	}</p><p>//place database items in variables for easier manipulation</p>$dbartrow = mysql_fetch_object($dbart);</p>$atitle = $dbartrow->title;</p>$ateaser = $dbartrow->teaser;</p>$abody = $dbartrow->body;</p><p>?&gt;</p>&lt;html&gt;</p>&lt;head&gt;</p>&lt;title&gt;CMS&lt;/title&gt;</p>&lt;LINK REL="StyleSheet" HREF="cms.css" type="text/css"&gt;</p>&lt;/head&gt;</p>&lt;body&gt;</p><p>&lt;div class="left"&gt;</p>&lt;?</p>// list the nav links for this type of user</p><p>while($dbrow = mysql_fetch_object($dbnav)){</p>	print($dbrow->URL . "&lt;br&gt;</p>");</p>	}</p>?&gt;</p>&lt;/div&gt;</p><p>&lt;div class="right"&gt;</p><p>&lt;h1&gt;Edit An Article&lt;/h1&gt;</p><p>&lt;form action="cmsauthed.php" method="POST"&gt;</p>&lt;table cellpadding="3" cellspacing="0" border="1"&gt;</p>&lt;tr&gt;</p>&lt;td&gt;Article Title&lt;/td&gt;</p>&lt;td&gt;</p>&lt;input type="hidden" name="aid" value="&lt;? print($aid) ; ?&gt;"&gt;</p>&lt;input type="text" name="title" size="64" maxlength="64" value="&lt;? print($atitle); ?&gt;"&gt;&lt;/td&gt;</p>&lt;/tr&gt;</p>&lt;tr&gt;</p>&lt;td&gt;Author email&lt;/td&gt;</p>&lt;td&gt;&lt;? print($emailid) ?&gt;&lt;/td&gt;</p>&lt;/tr&gt;</p>&lt;tr&gt;</p>&lt;td&gt;Article Teaser&lt;/td&gt;</p>&lt;td&gt;&lt;textarea name="teaser" cols="50" rows="3" wrap="virtual" maxlength="255"&gt;&lt;? print($ateaser); ?&gt;&lt;/textarea&gt;&lt;/td&gt;</p>&lt;/tr&gt;</p>&lt;tr&gt;</p>&lt;td&gt;Article Body&lt;/td&gt;</p>&lt;td&gt;&lt;textarea name="body" cols="50" rows="25" wrap="virtual"&gt;&lt;? print($abody); ?&gt;&lt;/textarea&gt;&lt;/td&gt;</p>&lt;/tr&gt;</p>&lt;tr&gt;</p>&lt;td&gt;Editor&lt;/td&gt;</p>&lt;td&gt;</p>&lt;select name="editor"&gt;</p>&lt;option&gt;---Select Editor---&lt;/option&gt;</p>&lt;?</p><p>//list the editors available</p><p>while($dbrow = mysql_fetch_object($dbedit)){</p>	print("&lt;option&gt;" . $dbrow->name . "&lt;/option&gt;</p>");</p>	}</p>?&gt;</p>&lt;/select&gt;</p>&lt;/td&gt;</p>&lt;/tr&gt;</p>&lt;tr&gt;</p>&lt;td&gt;Date Submitted&lt;br&gt;Format - YYYY-MM-DD&lt;/td&gt;</p>&lt;td&gt;&lt;input type="text" name="submitted" size="10" maxlength="10"&gt;&lt;/td&gt;</p>&lt;/tr&gt;</p>&lt;tr&gt;</p>&lt;td&gt;&lt;/td&gt;</p>&lt;td&gt;&lt;INPUT type="submit" name="action" value="Save"&gt; &lt;INPUT type="submit" name="action" value="Submit Article"&gt; &lt;INPUT type="reset"&gt;&lt;/td&gt;</p>&lt;/tr&gt;</p>&lt;/table&gt;</p>&lt;/form&gt;</p>&lt;/div&gt;</p>&lt;/body&gt;</p>&lt;/html&gt;</p></pre></p><p><p></p>Note that we have given the author the options (again) to save or submit the article. If the author chooses to save the article it will still be available in the list of articles that he or she can edit themselves. Submitting the article starts it forward through the workflow process.</p></p></p><p><p></p>To process this code we are going to borrow the code we used originally for submitting articles with small modifications to the SQL queries. It will be called cmsauthed.php;</p></p></p><p><pre></p>&lt;? session_start(); ?&gt;</p>&lt;?</p>//connect to and select database</p>if(!($dbconnect = mysql_pconnect("127.0.0.1", "cms_user", "cms_password"))){</p>	print("Failed to connect to database!</p>");</p>	exit();</p>	}</p><p>if(!mysql_select_db("cms", $dbconnect)){</p>	print("Failed to select database!</p>");</p>	exit();</p>	}</p><p>// perform action based on which button was pushed on submit form</p>switch($action)</p>{</p>	case "Save":</p>	// query to insert saved elements only</p>	$qsave = "UPDATE tblArticle ";</p>	$qsave .= "SET title = '$title', ";</p>	$qsave .= "teaser = '$teaser', ";</p>	$qsave .= "body = '$body', ";</p>	$qsave .= "author = '$emailid' ";</p>	$qsave .= "WHERE ID = '$aid' ";</p><p>	if(!($dbsave = mysql_query($qsave, $dbconnect))){</p>	print("MySQL reports: " . mysql_error() . "&lt;br&gt;</p>");</p>	exit();</p>	}	</p><p>	break;</p><p>	case "Submit Article":</p>	//query to submit article</p>	$qsubmit = "UPDATE tblArticle ";</p>	$qsubmit .= "SET title = '$title', ";</p>	$qsubmit .= "teaser = '$teaser', ";</p>	$qsubmit .= "body = '$body', ";</p>	$qsubmit .= "author = '$emailid', ";</p>	$qsubmit .= "editor = '$editor', ";</p>	$qsubmit .= "submitted = '$submitted' ";</p>	$qsubmit .= "WHERE ID = '$aid' ";</p><p>	if(!($dbsubmit = mysql_query($qsubmit, $dbconnect))){</p>	print("MySQL reports: " . mysql_error() . "&lt;br&gt;</p>");</p>	exit();</p>	}</p><p>	//select editor information and send an email</p>	$qeditor = "SELECT email ";</p>	$qeditor .= "FROM tblUser ";</p>	$qeditor .= "WHERE name = '$editor' ";</p>	$qeditor .= "AND accesslevel = 'editor' ";</p><p>	if(!($dbeditor = mysql_query($qeditor, $dbconnect))){</p>	print("MySQL reports this: " . mysql_error() . "&lt;br&gt;</p>");</p>	exit();</p>	}</p><p>	//message to editor</p>	$dbeditor = mysql_fetch_object($dbeditor);</p>	$messeditor = "$author has submitted an article, $title, for editing.</p>";</p>	$messeditor .= "Please review this article at your earliest convenience.</p><p>";</p><p>	//mail("$dbeditor->email", "CMS Article Submission", $messeditor, "From: CMS System");</p><p>	break;</p>}</p>header("Location: myart.php"); exit; 	</p>?&gt;</p></pre></p><p><p></p>Instead of performing INSERT's during this process we perform UPDATE's of the information already contained in the database. The path that the article takes is the same as before, depending on the button clicked during the submission process. This multi-button functionality gives the CMS a lot of flexibility.</p></p></p><h2>Next On The Menu</h2></p><p><p></p>This portion of the series should have provided you with a lot of information if you're going to be building a custom CMS in the near future.</p></p></p><p></p>Now that the author can submit an article, preview it, and edit it, it is time to take the next step in the path along our workflow model, having an editor review the article. We will give the editor the ability to preview and edit the article, as well as giving him or her the ability to return the article to the author should that be necessary.</p></p>