---
layout: post
permalink: node/14332
---
<p>\nEver find yourself counting down the days until an event? A visit from an out-of-town friend? A trip to Chile? An\nupcoming evoltageddon? I know I do this quite often. I used to spend a lot of time staring at the Windows calendar,\ncounting days. Then  I got bored one rainy day...\n</p></p><p><p>\nThe easiest way I found to write a countdown script was to break down time into the smallest unit needed. For this\nscript, seconds will do just fine (it's more fun to watch seconds decrement than it is to watch minutes do the same). If\nyou want to use milliseconds, well, it's your CPU.\n</p></p><p><p>\nThe script involves two parts: one on the server side, and one on the client side (the entire thing could be\nclient side, but it's much simpler to rely on a single clock than it is to rely on X clocks on client computers). Here's\nthe basic rundown of what we have to do to create this countdown script:\n</p></p><p><p>\n<ul>\n<li>Determine the relation between your time and the time on your server</li>\n</ul>\n</p></p><p><h4>On the server side...</h4></p><p><p>\n<ul>\n<li>Get the current server time in a variable</li>\n<li>Store the &quot;zero time&quot; (the time at which the countdown should be zero <strong>based on on your server's clock!!!</strong>) in a variable</li>\n<li>Find the difference, in seconds, between the current time and zero time (we'll call this iSecondsLeft for this article).</li>\n<li>Set a variable to hold the remaining days. This value can be found by taking the whole integer portion <em>only</em> of the quotient of iSecondsLeft divided by 86,400 (60 seconds * 60 minutes * 24 hours)</li>\n<li>Reassign iSecondsLeft to the result of iSecondsLeft modulus 86,400 <span id="footnote">*</span></li>\n<li>Set a variable to hold the remaining hours. This value can be found by taking the whole integer portion only of the quotient of iSecondsLeft divided by 3,600 (60 seconds * 60 minutes).</li>\n<li>Reassign iSecondsLeft to the result of iSecondsLeft modulus 3,600 <span id="footnote">*</span></li>\n<li>Set a variable to hold the remaining minutes. This value can be found by taking the whole integer portion only of the quotient of iSecondsLeft divided by 60 (60 seconds).</li>\n<li>Reassign iSecondsLeft to the result of iSecondsLeft modulus 60 <span id="footnote">*</span></li>\n<li>You now have variables holding the remaining time broken down into days, hours, and seconds until the event.</li>\n<li>Create text form fields (or other containers that may not degrade as well) and write the variables to the value attribute of each field.</li>\n</ul>\n</p></p><p><p>\n<span id="footnote">*</span> If you don't have the modulus operator available to you, you can achieve the same effect by\nusing multiplication and subtraction. For instance, if you needed to calculate iSecondsLeft modulus 86,400 without using the\nmodulus operator, you could use: iSecondsLeft - (numberOfDays * 86,400) and you will get the same value.\n</p></p><p><p>\nNow, at this point, you have enough to simply write out the remaining time. However, one second later this value will\nbe inaccurate. You could refresh the screen every second, but then you're putting unnecessary strain on the server. The\nsolution involves a balance between server and client. So, we need some scripting on the client:\n</p></p><p><h4>On the client-side...</h4></p><p><p>\n<ul>\n<li>Add the function <code>decrement()</code> to the <code>onLoad</code> event handler of the <code>&lt;body&gt;</code> element\n<li>In the function <code>decrement()</code>, first check an iterations counter. If the counter is greater than 300 (or some other value determined by you), refresh the page. This ensures that the script is synched with the server clock every 300 seconds\n<li>If the iterations counter is below 300, decrement the seconds, taking into account the possibility that seconds are already at 0, in which case minutes have to be decremented and seconds set to 59, unless minutes are also at 0, in which case hours must be decremented and minutes have to be set to 59 and seconds have to be set to 59, and so on. \n<li>Finally, increment the iterations counter and set a timer to recall the function in one second (in JavaScript, you would do this by calling:<br><code>setTimeout(&quot;decrement();&quot;,&nbsp;1000);</code>).\n</ul>\n</p></p><p><p>\nThat's the basics. Below is an example implementation of the above idea. It is written in ASP and client-side\nJavaScript.\n</p></p><p><p>\n<pre>\n&lt;%@EnableSessionState = False%&gt;\n&lt;%\nResponse.Expires = 0</p><p>currentTime = Now()</p><p>destinationTime = CDate(&quot;8/15/2003 14:00:00&quot;)</p><p>iTotalSeconds = DateDiff(&quot;s&quot;, currentTime, destinationTime)</p><p>iSecondsLeft = iTotalSeconds</p><p>days = Fix(iSecondsLeft / (60 * 60 * 24))\niSecondsLeft = iSecondsLeft mod (60 * 60 * 24)</p><p>hours = Fix(iSecondsLeft/(60 * 60))\niSecondsLeft = iSecondsLeft mod (60 * 60)</p><p>minutes = Fix(iSecondsLeft / (60))\niSecondsLeft = iSecondsLeft mod 60</p><p>seconds = iSecondsLeft</p><p>%&gt;</p><p>&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01\nTransitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;</p><p>&lt;html&gt;&lt;head&gt;\n&lt;script language=&quot;JavaScript&quot; type=&quot;text/javascript&quot;&gt;\n&lt;!-- hide from older browsers</p><p>iterations = 0;</p><p>function decrement()\n{\n	\nif (iterations &gt; 300)\n{\n	window.location = '&lt;%Response.Write Request.ServerVariables(&quot;SCRIPT_NAME&quot;)%&gt;';\n}</p><p>sec = (document.fooform.sec.value)-0;\nmin = (document.fooform.min.value)-0;\nhrs = (document.fooform.hrs.value)-0;\nday = (document.fooform.day.value)-0;</p><p>// check first to see if there is any time left at all\n// this is done by adding the time units and testing \n// its value\nif ((sec+min+hrs+day) &gt; 0)\n{</p><p>\nif (sec &gt; 0)\n	document.fooform.sec.value = (sec-1);\nelse\n{\n	if (min &gt; 0 )\n		document.fooform.min.value = min-1;\n	else\n	{\n		if (hrs &gt; 0)\n			document.fooform.hrs.value = hrs-1;\n		else\n		{\n			if (day &gt; 0)\n				document.fooform.day.value = day-1;\n			else\n				document.fooform.day.value = 0;\n			\n			document.fooform.hrs.value = 23\n		}\n		\n		document.fooform.min.value = 59\n	}\n	\n	document.fooform.sec.value = 59;\n}</p><p>setTimeout(&quot;decrement();&quot;, 1000);</p><p>}\nelse\n{\n	document.fooform.sec.style.color = &quot;#cc0000&quot;;\n	document.fooform.min.style.color = &quot;#cc0000&quot;;\n	document.fooform.hrs.style.color = &quot;#cc0000&quot;;\n	document.fooform.day.style.color = &quot;#cc0000&quot;;\n	\n	alert(&quot;Evolt has taken over the world!&quot;);\n}</p><p>iterations++;\n}</p><p>// --&gt;\n&lt;/script&gt;\n&lt;style type=&quot;text/css&quot;&gt;\nINPUT {\n	font-family:  Verdana, Arial, Helvetica, sans-serif;\n	font-size: 13px;\n	width: 28px;\n	border: none;\n	text-align: right;\n	background-color: #3399ff;\n	color: #003399;\n	font-weight: bold;\n}</p><p>BODY {\n	font-family:  Verdana, Arial, Helvetica, sans-serif;\n	font-size: 13px;\n	background-color: #3399ff;\n	color: #003399;\n}</p><p>P {\n	width: 600px;\n	text-align: center;\n}\n&lt;/style&gt;\n&lt;title&gt;Evolt's World Domination Timeline&lt;/title&gt;\n&lt;/head&gt;</p><p>&lt;body onLoad=&quot;decrement();&quot;&gt;\n&lt;form name=&quot;fooform&quot; id=&quot;fooform&quot; action=&quot;&lt;%Response.Write\nRequest.ServerVariables(&quot;SCRIPT_NAME&quot;)%&gt;&quot;&gt;</p><p>&lt;p&gt;&lt;a href=&quot;http://evolt.org/&quot;&gt;&lt;img\nsrc=&quot;/evolt/evolt_logo.gif&quot; border=&quot;0&quot; alt=&quot;Evolt.org\nlogo&quot; longdesc=&quot;http://evolt.org/evolt_images&quot;&gt;&lt;/a&gt;&lt;/p&gt;</p><p>&lt;p style=&quot;padding-top: 30px;&quot;&gt;Assuming no one &lt;a\nhref=&quot;http://www.cia.gov/&quot; target=&quot;_new&quot;&gt;important&lt;/a&gt; gets tipped off, Evolt's world\ndomination plan will have been executed in</p><p>&lt;%\nResponse.Write	_\n  &quot;&lt;input type=&quot;&quot;text&quot;&quot; name=&quot;&quot;day&quot;&quot; value=&quot;&quot;&quot; &amp; days &amp;\n&quot;&quot;&quot;&gt; days, &quot; _\n& &quot;&lt;input type=&quot;&quot;text&quot;&quot; name=&quot;&quot;hrs&quot;&quot; value=&quot;&quot;&quot; &amp; hours &amp;\n&quot;&quot;&quot;&gt; hours, &quot; _\n&amp; &quot;&lt;input type=&quot;&quot;text&quot;&quot; name=&quot;&quot;min&quot;&quot; value=&quot;&quot;&quot; &amp; minutes\n&amp; &quot;&quot;&quot;&gt; minutes, and &quot; _\n&amp; &quot;&lt;input type=&quot;&quot;text&quot;&quot; name=&quot;&quot;sec&quot;&quot; value=&quot;&quot;&quot; &amp; seconds\n&amp; &quot;&quot;&quot;&gt; seconds.&quot;\n%&gt;</p><p>&lt;/p&gt;</p><p>&lt;p&gt;\nA note to those important people: &lt;strong&gt;I'm just kidding&lt;/strong&gt;.\n&lt;/p&gt;\n&lt;/form&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</pre>\n</p>