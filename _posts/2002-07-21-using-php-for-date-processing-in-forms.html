---
layout: post
permalink: Using_PHP_for_Date_Processing_in_Forms
---
<ul>\n	<li><a href="/Using_PHP_for_Date_Processing_in_Forms#introduction">Introduction</a></li>\n	<li><a href="/Using_PHP_for_Date_Processing_in_Forms#selecting">Selecting Dates and Times</a></li>\n	<li><a href="/Using_PHP_for_Date_Processing_in_Forms#using">Using The WriteDateSelect() Function</a></li>\n	<li><a href="/Using_PHP_for_Date_Processing_in_Forms#retrieving">Retrieving the Submitted Date</a></li>\n	<li><a href="/Using_PHP_for_Date_Processing_in_Forms#retaining">Retaining Previous Values</a></li>\n	<li><a href="/Using_PHP_for_Date_Processing_in_Forms#downloading">Downloading the Code</a></li>\n</ul></p><p><h2><a name="#introduction"></a>Introduction</h2></p><p><p>\nOne of the most time-consuming tasks of any web application developer is dealing with forms.  Not only must you decide what information to place onto the form and design the HTML for it, but you also must validate the submitted form data and process it.  Fortunately, server-side scripting languages such as <a href="http://learn.perl.org/">Perl</a> and <a href="http://www.php.net/">PHP</a> have made our lives much easier, as we can use them to handle repetitive tasks rather than placing the work on ourselves.  In this article, we'll take a look at a common task for applications such as calendars and appointment books: handling dates and times.          \n</p></p><p><h2><a name="#selecting"></a>Selecting Dates and Times</h2></p><p><p>\nThe easiest way for a developer to deal with dates and times is to have the user enter them in a text field as a specific format such as &quot;yyyy-mm-dd,&quot; and use PHP's <a href="http://www.php.net/manual/en/function.strtotime.php">strtotime()</a> function on them.  As all user interface developers should know though, users have a habit of <strong>not</strong> doing what you tell them to do. They might enter in an invalid date without realizing it, or they might mix up the syntax and type &quot;mm-dd-yy&quot; as U.S. users are prone to doing.  In order to alleviate the possibility of errors, the &lt;select&gt; element can be used to limit input to specific ranges and ensure proper formats.          \n</p></p><p><p>\nBy replacing a text field such as\n</p>\n<p>\nEnter Date (ex: 2002-06-07): <input type="text" size="12" maxlength="12" name="PostedDate" /> \n</p>\n<p>\nwith the select fields\n</p>\n<p>\nDate (Year-Month-Day): <select name="Year">\n						<option >2000</option>\n									<option >2001</option>\n									<option >2002</option>\n									</select>-\n						<select name="Month">\n							<option >1</option>\n									<option >2</option>\n									<option >3</option>\n									<option >4</option>\n									<option >5</option>\n									<option >6</option>\n									<option >7</option>\n									<option >8</option>\n									<option >9</option>\n									<option >10</option>\n									<option >11</option>\n									<option >12</option>\n									</select>-\n						<select name="Day">\n							<option >1</option>\n									<option >2</option>\n									<option >3</option>\n									<option >4</option>\n									<option >5</option>\n									<option >6</option>\n									<option >7</option>\n									<option >8</option>\n									<option >9</option>\n									<option >10</option>\n									<option >11</option>\n									<option >12</option>\n									<option >13</option>\n									<option >14</option>\n									<option >15</option>\n									<option >16</option>\n									<option >17</option>\n									<option >18</option>\n									<option >19</option>\n									<option >20</option>\n									<option >21</option>\n									<option >22</option>\n									<option >23</option>\n									<option >24</option>\n									<option >25</option>\n									<option >26</option>\n									<option >27</option>\n									<option >28</option>\n									<option >29</option>\n									<option >30</option>\n									<option >31</option>\n									</select>\n							</p>\n<p>\nYou can ensure that the input will be in the correct format and within the range that you specified.\n</p></p><p><p>\nOf course, it can become a real hassle to write out the various &lt;select&gt; and &lt;option&gt; tags every time you want to use a date field in a form, so why not have PHP do it for you?  The following function will write out a select date field for you given a prefix for the fields, the method of the form, the beginning year of the range, and the ending year of the range. \n</p></p><p><pre>function WriteDateSelect($BeginYear = 0, \n                         $EndYear = 0, \n                         $IsPosted = true,\n                         $Prefix = '')\n{\n  if (! $BeginYear)\n  {\n    $BeginYear = date('Y');\n  }\n		\n  if (! $EndYear)\n  {\n    $EndYear = $BeginYear;\n  }\n	\n  $Year = $IsPosted \n          ? (int) $_POST[$Prefix . 'Year']\n          : (int) $_GET[$Prefix . 'Year'];\n  $Month = $IsPosted \n          ? (int) $_POST[$Prefix . 'Month']\n          : (int) $_GET[$Prefix . 'Month'];\n  $Day = $IsPosted \n          ? (int) $_POST[$Prefix . 'Day']\n          : (int) $_GET[$Prefix . 'Day'];\n	\n  echo '<select name="', $Prefix, 'Year">\n         ';\n	\n  for ($i = $BeginYear; $i <= $EndYear; $i++)\n  {\n    echo '<option ';\n		\n    if ($i == $Year)\n      echo 'selected="yes"';\n			\n    echo '>', $i, '</option>\n         ';\n  }\n	\n  echo '</select>-\n        <select name="', $Prefix, 'Month">\n          ';	</p><p>  for ($i = 1; $i <= 12; $i++)\n  {\n    echo '<option ';\n		\n    if ($i == $Month)\n      echo 'selected="yes"';\n			\n    echo '>', $i, '</option>\n         ';\n  }</p><p>  echo '</select>-\n        <select name="', $Prefix, 'Day">\n          ';	</p><p>  for ($i = 1; $i <= 31; $i++)\n  {\n    echo '<option ';\n		\n    if ($i == $Day)\n      echo 'selected="yes"';\n			\n    echo '>', $i, '</option>\n         ';\n  }</p><p>  echo '</select>\n       ';\n  return;\n}\n</pre>\n<p>\nAs it stands, you can call the function in the middle of your form like\n</p>\n<code>\n&lt;?php WriteDateSelect(2000, 2002); ?&gt;\n</code>\n<p>\nand it will generate the field <select name="Year">\n						<option >2000</option>\n									<option >2001</option>\n									<option >2002</option>\n									</select>-\n						<select name="Month">\n							<option >1</option>\n									<option >2</option>\n									<option >3</option>\n									<option >4</option>\n									<option >5</option>\n									<option >6</option>\n									<option >7</option>\n									<option >8</option>\n									<option >9</option>\n									<option >10</option>\n									<option >11</option>\n									<option >12</option>\n									</select>-\n						<select name="Day">\n							<option >1</option>\n									<option >2</option>\n									<option >3</option>\n									<option >4</option>\n									<option >5</option>\n									<option >6</option>\n									<option >7</option>\n									<option >8</option>\n									<option >9</option>\n									<option >10</option>\n									<option >11</option>\n									<option >12</option>\n									<option >13</option>\n									<option >14</option>\n									<option >15</option>\n									<option >16</option>\n									<option >17</option>\n									<option >18</option>\n									<option >19</option>\n									<option >20</option>\n									<option >21</option>\n									<option >22</option>\n									<option >23</option>\n									<option >24</option>\n									<option >25</option>\n									<option >26</option>\n									<option >27</option>\n									<option >28</option>\n									<option >29</option>\n									<option >30</option>\n									<option >31</option>\n									</select>\n							, which will make date development in forms substantially easier.  A similar function can easily be written to obtain the time of day from the user, but as for right now, let's take a look through this function and see how it operates. \n</p></p><p><h2><a name="#using"></a>Using The WriteDateSelect() Function</h2></p><p><p>\nThere are four arguments to be passed into the function: $BeginYear, $EndYear, $IsPosted, and $Prefix.  There are default parameters for all of them, so you could literally call the function without any arguments at all like <code>WriteDateSelect()</code>, and it would produce the default field allowing the user to choose the current year only.  Otherwise, you'll need to actually specify values in the function call.  If you leave out the\n</p></p><p><ul class="Spread">\n	<li>\n$BeginYear and $EndYear are pretty self-explanatory, as they are the beginning and end years of the year select element.  Thus, if you wanted the user to be able to select years ranging from 1995 to 2005, you would call the function as <code>WriteDateSelect(1995, 2005);</code>.  If you leave $BeginYear blank, the function will assume the beginning and ending years to be the current year, and if you leave $EndYear blank, the function will assume that the ending year is the same as the beginning year.\n	</li>\n	<li>\n$IsPosted is a boolean value specifying whether you are using the POST method or the GET method for the form.  The default is POST, but if you are using GET, you'll need to set this parameter to false.         \n	</li>\n	<li>\n<p>\n$Prefix is used only when you have multiple date field on a simple form, such as a calendar event where you need the user to enter a beginning date and an ending date.  If you have two form elements with the same name, the value of the latter one will replace the value of the earlier one when the form is submitted, meaning that there would be no way for you to know what the user entered in for the first field.  $Prefix solves this problem by appending the specified string to the beginning of the select fields names, thus if you wanted to have a beginning date and an ending date, you would make two calls with different prefixes, and your form would now be able to distinguish the dates upon submission.\n</p>\n	<p>\n		Specifying two date fields in one form using the code<br />\n		<code>WriteDateSelect(1995, 2005, true, 'Begin');</code> and<br /> \n		<code>WriteDateSelect(1995, 2005, true, 'End');</code>\n	</p>\n	<p>\n		Beginning Date: <select name="BeginYear">\n						<option >1995</option>\n									<option >1996</option>\n									<option >1997</option>\n									<option >1998</option>\n									<option >1999</option>\n									<option >2000</option>\n									<option >2001</option>\n									<option >2002</option>\n									<option >2003</option>\n									<option >2004</option>\n									<option >2005</option>\n									</select>-\n						<select name="BeginMonth">\n							<option >1</option>\n									<option >2</option>\n									<option >3</option>\n									<option >4</option>\n									<option >5</option>\n									<option >6</option>\n									<option >7</option>\n									<option >8</option>\n									<option >9</option>\n									<option >10</option>\n									<option >11</option>\n									<option >12</option>\n									</select>-\n						<select name="BeginDay">\n							<option >1</option>\n									<option >2</option>\n									<option >3</option>\n									<option >4</option>\n									<option >5</option>\n									<option >6</option>\n									<option >7</option>\n									<option >8</option>\n									<option >9</option>\n									<option >10</option>\n									<option >11</option>\n									<option >12</option>\n									<option >13</option>\n									<option >14</option>\n									<option >15</option>\n									<option >16</option>\n									<option >17</option>\n									<option >18</option>\n									<option >19</option>\n									<option >20</option>\n									<option >21</option>\n									<option >22</option>\n									<option >23</option>\n									<option >24</option>\n									<option >25</option>\n									<option >26</option>\n									<option >27</option>\n									<option >28</option>\n									<option >29</option>\n									<option >30</option>\n									<option >31</option>\n									</select>\n							<br />\n		Ending Date: <select name="EndYear">\n						<option >1995</option>\n									<option >1996</option>\n									<option >1997</option>\n									<option >1998</option>\n									<option >1999</option>\n									<option >2000</option>\n									<option >2001</option>\n									<option >2002</option>\n									<option >2003</option>\n									<option >2004</option>\n									<option >2005</option>\n									</select>-\n						<select name="EndMonth">\n							<option >1</option>\n									<option >2</option>\n									<option >3</option>\n									<option >4</option>\n									<option >5</option>\n									<option >6</option>\n									<option >7</option>\n									<option >8</option>\n									<option >9</option>\n									<option >10</option>\n									<option >11</option>\n									<option >12</option>\n									</select>-\n						<select name="EndDay">\n							<option >1</option>\n									<option >2</option>\n									<option >3</option>\n									<option >4</option>\n									<option >5</option>\n									<option >6</option>\n									<option >7</option>\n									<option >8</option>\n									<option >9</option>\n									<option >10</option>\n									<option >11</option>\n									<option >12</option>\n									<option >13</option>\n									<option >14</option>\n									<option >15</option>\n									<option >16</option>\n									<option >17</option>\n									<option >18</option>\n									<option >19</option>\n									<option >20</option>\n									<option >21</option>\n									<option >22</option>\n									<option >23</option>\n									<option >24</option>\n									<option >25</option>\n									<option >26</option>\n									<option >27</option>\n									<option >28</option>\n									<option >29</option>\n									<option >30</option>\n									<option >31</option>\n									</select>\n								</p>\n	</li>\n</ul></p><p><h2><a name="#retrieving"></a>Retrieving the Submitted Date</h2></p><p><p>\nSo now you can easily place date select fields into forms and guarantee that the user will have to choose from a predetermined range of values.  However, that's only half of the work that we need to do, since we also need to process the information after the form is submitted.  In order to do so, we'll introduce another utility function: <code>GetDateSelectString()</code>.\n</p></p><p><pre>function GetDateSelectString($IsPosted = true,\n                             $Prefix = '')\n{\n  if ($IsPosted)\n  {\n    return (int) $_POST[$Prefix . 'Year']\n           . '-' . (int) $_POST[$Prefix . 'Month']\n           . '-' . (int) $_POST[$Prefix . 'Day'];\n  }</p><p>  return (int) $_GET[$Prefix . 'Year']\n         . '-' . (int) $_GET[$Prefix . 'Month']\n         . '-' . (int) $_GET[$Prefix . 'Day'];\n}\n</pre></p><p><p>\nAs you can see, all this function does is to take the values in the POST or GET array, cast them to int to prevent any SQL injections, and then concatenate them together with dashes in between.  Thus, if the user selected 2002 for the year, 5 for the month, and 12 for the day, this function will return the string &quot;2002-5-12&quot;. This string can be used directly in a MySQL query statement such as\n</p>\n<p>\n<code>      \n$PostedDate = GetDateSelectString();<br />\nmysql_query("SELECT * FROM Table WHERE LastDate = '$PostedDate'");\n</code>\n<p>\nsince MySQL natively understands the &quot;yyyy-mm-dd&quot; syntax, or the string could be converted to a PHP timestamp via the strtotime() function if you require further processing.   \n</p></p><p><h2><a name="#retaining"></a>Retaining Previous Values</h2></p><p><p>\nIf you glance through the code for the <code>WriteDateSelect()</code> function above, you might notice the lines which say  \n</p></p><p><p>\n<code>\n$Year = $IsPosted<br />\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;? (int) $_POST[$Prefix . 'Year']<br />\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: (int) $_GET[$Prefix . 'Year'];\n</code>\n</p></p><p><p>\nand\n</p></p><p><p>\n<code>\nif ($i == $Year)<br />\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo 'selected=&quot;yes&quot;';\n</code>				\n</p></p><p><p>	\nThe reason why these lines of code exist is that it's fairly common for a user to take more than one try to fill out a form correctly.  Although you could use JavaScript to pre-validate the form client-side, that is not an guarantee that the data will be correct, as the user agent could not support JavaScript or have JavaScript disabled.  Therefore, server-side validation is always needed for absolute assurance.  The most common design is to have both the code which writes out the form and the code which validates and processes the form in the same script.  In that way, if the user fails to complete a portion of the form, then the script writes out the form again for the user to make corrections.\n</p>						 </p><p><p>\nOf course, the problem with this approach is that the form won't retain the previous data unless you explicitly write out the values which the user entered beforehand.  That is exactly what these lines of code do: get the values of the elements from the $_POST or $_GET arrays, and then write out a selected attribute if the present option value matches that of the previous value.  Thus, your users won't have to reselect the dates again, they will be happier, and you will be happier.  \n</p></p><p><h2>Downloading the Code</h2></p><p><p>\nThe code which I use in production is a bit different than the code posted here, as it has been organized into classes and some of the options have been moved into class variables.  If you think that you would find it useful though, you can download it by <a href="http://www.jacksonyee.com/">going to my website</a> and going to the section Downloads -&gt; Jackson's Programs.  I'm not posting a direct link because I may restructure the site in the future, but it will always be located in that section.\n</p>