---
layout: post
permalink: node/30655
ratings: 6
avgrate: 3.5000
rating: 3.68
categories: [Code]
user: ppk
real_name: "Peter-Paul Koch"
user_biog: "<p>Peter-Paul Koch is a freelance browser expert and JavaScript guru living in Amsterdam, the Netherlands. He has been an Internet professional only since 1998, so he\'s definitely second generation.</p>

<p>His personal site is  <a href=\"http://www.quirksmode.org\" rel=\"nofollow\"
	title=\"For all your browser quirks\">www.quirksmode.org</a>. It includes the W3C DOM Compatibility Tables, currently the best resource on the Internet for this subject. Because of this research, he has been asked to co-edited chapters 17 to 19 of Flanagan\'s \"JavaScript, the Definitive Guide\", O\'Reilly, 4th edition.</p>

<p>He is an administrator of the
<a href=\"http://www.quirksmode.org/dom/list.html\" rel=\"nofollow\"
	title=\"For studying the JavaScript implementation of the W3C DOM.\">WDF-DOM</a> mailing list, that counts most international JavaScript gurus among its members.</p>

<p>He has written the \"<a href=\"http://www.digital-web.com/columns/keepitsimple\" rel=\"nofollow\"
        >Keep it Simple</a>\" column on Digital Web Magazine, as well as articles on <a href=\"http://alistapart.com/authors/k/peterpaulkoch\" rel=\"nofollow\">A List Apart</a>, <a href=\"http://developer.apple.com/internet/webcontent/bestwebdev.html\" rel=\"nofollow\">Apple Developer Connection</a>, and <a href=\"http://www.oreillynet.com/pub/a/javascript/synd/2002/11/15/css_pitfalls.html\" rel=\"nofollow\">O\'Reilly\'s Web Dev Center</a>, in addition to Evolt.</p>"
user_since: 12 Sep 1999
avatar: /images/pictures/picture-380.jpg
article_count: 8
excerpt: "When using a doctype that switches Explorer 6 to Compatibility Mode, several properties of</p>document.body are reassigned to document.documentElement.</p>Unfortunately I can find no overall theoretical model that explains what the  effect of a</p>doctype switch is. Maybe you can?"
---
<p>Six months ago</p><a href="http://www.geocities.com/Area51/Realm/8655/HTMLJavascriptCSS/DUWindowsNS6.html"</p>	target="_blank" title="To Dr. Unclear's Netscape 6 tests">a reader</a> of my site alerted me to an important bit of data: when using</p>a doctype that switches Explorer 6 to Compatibility Mode, several properties of</p><code>document.body</code> are reassigned to <code>document.documentElement</code>. This</p>information enabled me to get</p><a href="http://www.xs4all.nl/~ppk/js/index.html?fixedmenu.html"</p>	target="_blank" title="Sticky Menu script">one of my scripts</a></p>working in Explorer 6 with a doctype.</p></p><p><p>At first I thought that <em>all</em> properties of <code>document.body</code> were</p>reassigned to <code>document.documentElement</code>, but this turned out not to be the case.</p>Because the data confused me and because I had other things to do, I only</p>skimmed through the W3C Recommendations and Flanagan's "JavaScript, the Definitive Guide"</p>to get a theoretical overview. I postponed the necessary browser tests, because they were</p>likely to be complex and time-consuming.</p></p><p><h3>Theory</h3></p><p><p>The overall picture that emerged was as follows:</p></p><p><ul></p><li><code>document.documentElement</code> has been</p><a href="http://www.w3.org/TR/1998/REC-DOM-Level-1-19981001/level-one-core.html#i-Document"</p>	target="_blank">standardized</a> by W3C as a kind of shortcut to the HTML element, the</p>highest element in the DOM tree of any (X)HTML page. W3C has not defined any properties</p>for this element.</li></p><li><code>document.body</code> has been added by Microsoft. Originally it was a convenience</p>object that had several properties with information about the current state of the browser</p>window and the document in it. Microsoft defined lots of properties, the most important of</p>which are <code>clientWidth</code> and <code>clientHeight</code> which store the current</p>size of the browser window. It also has properties</p>like <code>document.body.text</code>, accessing the old TEXT attribute. It thus (also) refers</p>to the BODY element.</li></p></ul></p><p><p>Netscape 6, Explorer 5 and Konqueror have adopted <code>documentElement</code> as part</p>of their W3C DOM support. <code>body</code> was originally Explorer-only, but more recently</p>both Netscape 6 and Opera 6 have started supporting it (Konqueror not tested).</p></p><p><p>So <code>documentElement</code> refers to the outermost box in a document, the HTML element,</p>while <code>body</code> refers to its only child box: the BODY element. Through their properties</p>we can read out information about the two most important elements.</p></p><p><pre></p>--------------</p>     HTML     </p> ------------ </p>     BODY     </p>              </p>              </p>              </p>              </p> ------------ </p>--------------</p></pre></p><p><p>Unfortunately my tests have proven this theoretical model to be <b>unfounded</b> when applied</p>to properties like <code>clientWidth</code> and <code>offsetHeight</code>.</p></p><p><p>Besides there is a third box that needs to be measured: the browser window itself. It is frequently</p>far smaller than the HTML document it contains. The theoretical model described above doesn't leave</p>any room for the window dimensions; nonetheless they are present.</p></p><p><h3>No standards</h3></p><p><p>What we want is to read out interesting information about the entire HTML page and the browser</p>window. One of the problems is that the properties that contain this information are not standardized.</p>In the W3C DOM, to read out the total height of the HTML document you'd have to do</p></p><p><pre></p>document.defaultView.getComputedStyle(document.documentElement,null).getPropertyValue("height")</p></pre></p><p><p>Apart from the syntax being way too complicated, this only works in Mozilla. It's even worse</p>if you want to know the window width and height or the scrolling offset: there is no official</p>W3C way to read out this information. (<em>Should</em> there be one? At the moment I don't</p>think so. But feel free to disagree.)</p></p><p><p>Fortunately the browser vendors have created their own properties: Netscape 4 and up supports <code>window.innerWidth/<wbr>Height</code></p>and Explorer 4 and up supports <code>document.body.clientWidth/<wbr>Height</code>. All this works fine, though without</p>the blessing of W3C.</p></p><p><h3>Doctype switching</h3></p><p><p>When Explorer 6 added the possibility of entering strict standards compliance mode by using</p><a href="http://msdn.microsoft.com/library/en-us/dnie60/html/cssenhancements.asp?frame=true#cssenhancements_topic2"</p>      title="To the MSDN explanation of doctype switching. This link works at the moment of writing, but no doubt in a few months this page wil lhave been moved"</p>	target="_blank">certain doctypes</a>, it turned out that using these doctypes also influenced</p>the value of some of these properties. As far as I know this happens only in Explorer 6 on Windows, I haven't</p>yet found a trace of doctype-switching effects on JavaScript properties</p>in Mozilla and Explorer on Mac. (But I stand ready to be corrected)</p></p><p><p>So what exactly happens? I wondered for six months, then finally found the time to do some browser</p>tests.</p></p><p><h3>The experiment</h3></p><p><p>So I set up an experiment. I researched four property pairs, all of which may be properties of</p><code>document.body</code> and <code>document.documentElement</code>. The pairs are:</p></p><p><ol></p><li>clientWidth, clientHeight</li></p><li>offsetWidth, offsetHeight</li></p><li>scrollWidth, scrollHeight</li></p><li>scrollTop, scrollLeft</li></p></ol></p><p><p>I created two test pages which print out the values of these properties. They are exactly the</p>same, except that I added the doctype</p></p><p><pre></p>&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"&gt;</p></pre></p><p><p>to one of them. It causes Explorer 6 to enter compatibility mode.</p>I chose this doctype more or less randomly. For the moment I assume that all doctypes in Microsoft's</p>list cause the same compatibility mode. (Here, too, I stand ready to be</p>corrected in case anyone has noticed a difference).</p></p><p><p>View the test pages for yourself, if you like.</p></p><p><ul></p><li><a href="http://www.xs4all.nl/~ppk/js/doctype_on.html"</p>	target="_blank">Test page with doctype</a></li></p><li><a href="http://www.xs4all.nl/~ppk/js/doctype_off.html"</p>	target="_blank">Test page without doctype</a></li></p></ul></p><p><p>I tested the various properties in several browsers: Explorer 5.0 and 6.0 on Windows, Explorer</p>5.0 on Mac OS 9 and 5.1 on OS X, and Mozilla 1.0 final. I also studied Opera 6, which doesn't</p>support <code>documentElement</code> at all.<br></p>There were no differences between both</p>Mac Explorers, only very slight differences between the Windows Explorers on the no-doctype page.</p></p><p><p>The actual testing consisted of carefully measuring the various widths and heights and finding</p>out which properties contained these numbers.</p></p><p><h3>No general rules</h3></p><p><p>I'd hoped to find some general rules for dealing with <code>document.body</code>,</p><code>document.documentElement</code> and doctype switching. Unfortunately the conclusion must be</p>that there are considerable differences between <code>body</code> and <code>documentElement</code></p>and that a lot happens in Explorer 6 when switching between quirks and standards mode,</p>but that it is impossible to formulate a general theory.</p></p><p><p>See the <a href="http://www.xs4all.nl/~ppk/js/index.html?doctypes.html"</p>	target="_blank">table of research results</a> and try to make sense of it. I can't. If you</p>do find a general rule, please note it in a comment below.</p></p><p><p>One rule concerning Explorer 6 in Strict mode has been made clear by Michael van Ouwekerk of</p><a href="http://www.13thparallel.net" target="_blank">13th Parallel</a>. He wrote:</p></p><p><quote></p>From what I've gathered so far, IE6 in Strict mode always makes the html</p>element as big as the viewport. The styles given by currentStyle are width:</p>auto, height: auto, overflow: scroll. The offsetWidth and offsetHeight are</p>always equal to the viewport's width and height. When there is a lot of</p>content, the overflow: scroll takes care of that.</p></quote></p><p><p>This seems to explain the values I found, so I think he's right.</p></p><p><p>A few more interesting points:</p></p><p><ul></p><li>Above I said <code>document.body</code> is supposed to represent the BODY element, while</p><code>document.documentElement</code> should represent the HTML element. This turned out only to be</p>the case with the <code>offset</code> properties in Mozilla and the <code>scrollWidth/Height</code> properties</p>in Explorer 6 in standards compliance mode. Otherwise this theory has little to do with practice.</li></p><li>Explorer 5 on Mac and Opera 6 are inconsistent in their use of the <code>offset</code> properties. While</p><code>offsetHeight</code> gives the height of the entire HTML document (as it does in most</p>other browsers), <code>offsetWidth</code> gives the width of the <em>window</em>, not of the</p>HTML document.</li></p><li>The only reliable property pair is <code>scrollTop/Left</code>: it always gives the amount</p>of pixels the page has scrolled. Unfortunately this information is highly doctype-sensitive:</p>in standards compliance mode in Explorer 6 these properties belong to <code>documentElement</code>,</p>while in quirks mode they belong to <code>body</code>, just like in all other browsers. In Explorer 5.0</p>on Windows these properties were assigned to both <code>body</code> and <code>documentElement</code>.</p>I wish Explorer 6 had done the same regardless of doctype, it would spare me the need to rewrite</p>scripts.</li></p><li>I have been unable to find out what function the <code>scrollLeft/Top</code> property pair</p>has in Opera 6. The values simply don't make sense.</li></p></ul></p><p><h3>Practice</h3></p><p><p>So how do you write cross-browser scripts that avoid all these complications?</p>Here are some examples that survive using a doctype that switches Explorer 6 to compatibility</p>mode:</p></p><p><h4>Scrolling offset</h4></p><p><p>The scrolling offset of the page is reflected in <code>document.body.scrollTop/Left</code>,</p>except when you use a doctype in Explorer 6, then it is reflected in</p><code>document.documentElement.scrollTop/Left</code>. Opera is unreliable here. Fortunately the</p>old Netscape properties <code>window.pageXOffset/pageYOffset</code> still work in all Netscapes</p>and Opera. So the script would become:</p></p><p><pre></p>if (window.pageYOffset)</p>{</p>	  pos = window.pageYOffset</p>}</p>else if (document.documentElement && document.documentElement.scrollTop)</p>{</p>	pos = document.documentElement.scrollTop</p>}</p>else if (document.body)</p>{</p>	  pos = document.body.scrollTop</p>}</p></pre></p><p><p>and <code>pos</code> contains the vertical scrolling offset.</p></p><p><h4>Window dimensions</h4></p><p><p>The window dimensions are reflected in <code>document.body.clientWidth/Height</code>,</p>except when you use a doctype in Explorer 6, then they are reflected in</p><code>document.documentElement.clientWidth/Height</code>. Opera is unreliable here, the window</p>height is never less than the height of the HTML document. Fortunately the</p>old Netscape properties <code>window.innerWidth/Height</code> still work in all Netscapes</p>and Opera. So the script would become:</p></p><p><pre></p>if (window.innerWidth)</p>{</p>	theWidth = window.innerWidth</p>}</p>else if (document.documentElement && document.documentElement.clientWidth)</p>{</p>	theWidth = document.documentElement.clientWidth</p>}</p>else if (document.body)</p>{</p>	theWidth = document.body.clientWidth</p>}</p></pre></p><p><p>and <code>theWidth</code> contains the width of the window. Note that the clientWidth is always</p>the width <em>excluding the scrollbars</em>. Generally (but not always),</p><code>offsetWidth/Height</code> gives access to the window width <em>including the scrollbars</em>.</p></p><p><h3>Conclusion</h3></p><p><p>The conclusion must be that the implementation of the <code>body/documentElement</code></p>properties in the various browsers, with and without doctypes, is very complicated. I can find no overall</p>theoretical model that explains what the four property pairs are for and what the effect of a</p>doctype switch is.</p></p><p><p>I hope my <a href="http://www.xs4all.nl/~ppk/js/index.html?doctypes.html"</p>	target="_blank">table of research results</a> will allow people to formulate theories. If you think you understand the behaviour of a certain browser (or, better yet, all browsers), please leave a comment below.</p>