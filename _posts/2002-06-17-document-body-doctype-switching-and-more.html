---
layout: post
permalink: node/30655
---
<p>Six months ago\n<a href="http://www.geocities.com/Area51/Realm/8655/HTMLJavascriptCSS/DUWindowsNS6.html"\n	target="_blank" title="To Dr. Unclear's Netscape 6 tests">a reader</a> of my site alerted me to an important bit of data: when using\na doctype that switches Explorer 6 to Compatibility Mode, several properties of\n<code>document.body</code> are reassigned to <code>document.documentElement</code>. This\ninformation enabled me to get\n<a href="http://www.xs4all.nl/~ppk/js/index.html?fixedmenu.html"\n	target="_blank" title="Sticky Menu script">one of my scripts</a>\nworking in Explorer 6 with a doctype.</p></p><p><p>At first I thought that <em>all</em> properties of <code>document.body</code> were\nreassigned to <code>document.documentElement</code>, but this turned out not to be the case.\nBecause the data confused me and because I had other things to do, I only\nskimmed through the W3C Recommendations and Flanagan's "JavaScript, the Definitive Guide"\nto get a theoretical overview. I postponed the necessary browser tests, because they were\nlikely to be complex and time-consuming.</p></p><p><h3>Theory</h3></p><p><p>The overall picture that emerged was as follows:</p></p><p><ul>\n<li><code>document.documentElement</code> has been\n<a href="http://www.w3.org/TR/1998/REC-DOM-Level-1-19981001/level-one-core.html#i-Document"\n	target="_blank">standardized</a> by W3C as a kind of shortcut to the HTML element, the\nhighest element in the DOM tree of any (X)HTML page. W3C has not defined any properties\nfor this element.</li>\n<li><code>document.body</code> has been added by Microsoft. Originally it was a convenience\nobject that had several properties with information about the current state of the browser\nwindow and the document in it. Microsoft defined lots of properties, the most important of\nwhich are <code>clientWidth</code> and <code>clientHeight</code> which store the current\nsize of the browser window. It also has properties\nlike <code>document.body.text</code>, accessing the old TEXT attribute. It thus (also) refers\nto the BODY element.</li>\n</ul></p><p><p>Netscape 6, Explorer 5 and Konqueror have adopted <code>documentElement</code> as part\nof their W3C DOM support. <code>body</code> was originally Explorer-only, but more recently\nboth Netscape 6 and Opera 6 have started supporting it (Konqueror not tested).</p></p><p><p>So <code>documentElement</code> refers to the outermost box in a document, the HTML element,\nwhile <code>body</code> refers to its only child box: the BODY element. Through their properties\nwe can read out information about the two most important elements.</p></p><p><pre>\n--------------\n     HTML     \n ------------ \n     BODY     \n              \n              \n              \n              \n ------------ \n--------------\n</pre></p><p><p>Unfortunately my tests have proven this theoretical model to be <b>unfounded</b> when applied\nto properties like <code>clientWidth</code> and <code>offsetHeight</code>.</p></p><p><p>Besides there is a third box that needs to be measured: the browser window itself. It is frequently\nfar smaller than the HTML document it contains. The theoretical model described above doesn't leave\nany room for the window dimensions; nonetheless they are present.</p></p><p><h3>No standards</h3></p><p><p>What we want is to read out interesting information about the entire HTML page and the browser\nwindow. One of the problems is that the properties that contain this information are not standardized.\nIn the W3C DOM, to read out the total height of the HTML document you'd have to do</p></p><p><pre>\ndocument.defaultView.getComputedStyle(document.documentElement,null).getPropertyValue("height")\n</pre></p><p><p>Apart from the syntax being way too complicated, this only works in Mozilla. It's even worse\nif you want to know the window width and height or the scrolling offset: there is no official\nW3C way to read out this information. (<em>Should</em> there be one? At the moment I don't\nthink so. But feel free to disagree.)</p></p><p><p>Fortunately the browser vendors have created their own properties: Netscape 4 and up supports <code>window.innerWidth/<wbr>Height</code>\nand Explorer 4 and up supports <code>document.body.clientWidth/<wbr>Height</code>. All this works fine, though without\nthe blessing of W3C.</p></p><p><h3>Doctype switching</h3></p><p><p>When Explorer 6 added the possibility of entering strict standards compliance mode by using\n<a href="http://msdn.microsoft.com/library/en-us/dnie60/html/cssenhancements.asp?frame=true#cssenhancements_topic2"\n      title="To the MSDN explanation of doctype switching. This link works at the moment of writing, but no doubt in a few months this page wil lhave been moved"\n	target="_blank">certain doctypes</a>, it turned out that using these doctypes also influenced\nthe value of some of these properties. As far as I know this happens only in Explorer 6 on Windows, I haven't\nyet found a trace of doctype-switching effects on JavaScript properties\nin Mozilla and Explorer on Mac. (But I stand ready to be corrected)</p></p><p><p>So what exactly happens? I wondered for six months, then finally found the time to do some browser\ntests.</p></p><p><h3>The experiment</h3></p><p><p>So I set up an experiment. I researched four property pairs, all of which may be properties of\n<code>document.body</code> and <code>document.documentElement</code>. The pairs are:</p></p><p><ol>\n<li>clientWidth, clientHeight</li>\n<li>offsetWidth, offsetHeight</li>\n<li>scrollWidth, scrollHeight</li>\n<li>scrollTop, scrollLeft</li>\n</ol></p><p><p>I created two test pages which print out the values of these properties. They are exactly the\nsame, except that I added the doctype</p></p><p><pre>\n&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"&gt;\n</pre></p><p><p>to one of them. It causes Explorer 6 to enter compatibility mode.\nI chose this doctype more or less randomly. For the moment I assume that all doctypes in Microsoft's\nlist cause the same compatibility mode. (Here, too, I stand ready to be\ncorrected in case anyone has noticed a difference).</p></p><p><p>View the test pages for yourself, if you like.</p></p><p><ul>\n<li><a href="http://www.xs4all.nl/~ppk/js/doctype_on.html"\n	target="_blank">Test page with doctype</a></li>\n<li><a href="http://www.xs4all.nl/~ppk/js/doctype_off.html"\n	target="_blank">Test page without doctype</a></li>\n</ul></p><p><p>I tested the various properties in several browsers: Explorer 5.0 and 6.0 on Windows, Explorer\n5.0 on Mac OS 9 and 5.1 on OS X, and Mozilla 1.0 final. I also studied Opera 6, which doesn't\nsupport <code>documentElement</code> at all.<br>\nThere were no differences between both\nMac Explorers, only very slight differences between the Windows Explorers on the no-doctype page.</p></p><p><p>The actual testing consisted of carefully measuring the various widths and heights and finding\nout which properties contained these numbers.</p></p><p><h3>No general rules</h3></p><p><p>I'd hoped to find some general rules for dealing with <code>document.body</code>,\n<code>document.documentElement</code> and doctype switching. Unfortunately the conclusion must be\nthat there are considerable differences between <code>body</code> and <code>documentElement</code>\nand that a lot happens in Explorer 6 when switching between quirks and standards mode,\nbut that it is impossible to formulate a general theory.</p></p><p><p>See the <a href="http://www.xs4all.nl/~ppk/js/index.html?doctypes.html"\n	target="_blank">table of research results</a> and try to make sense of it. I can't. If you\ndo find a general rule, please note it in a comment below.</p></p><p><p>One rule concerning Explorer 6 in Strict mode has been made clear by Michael van Ouwekerk of\n<a href="http://www.13thparallel.net" target="_blank">13th Parallel</a>. He wrote:</p></p><p><quote>\nFrom what I've gathered so far, IE6 in Strict mode always makes the html\nelement as big as the viewport. The styles given by currentStyle are width:\nauto, height: auto, overflow: scroll. The offsetWidth and offsetHeight are\nalways equal to the viewport's width and height. When there is a lot of\ncontent, the overflow: scroll takes care of that.\n</quote></p><p><p>This seems to explain the values I found, so I think he's right.</p></p><p><p>A few more interesting points:</p></p><p><ul>\n<li>Above I said <code>document.body</code> is supposed to represent the BODY element, while\n<code>document.documentElement</code> should represent the HTML element. This turned out only to be\nthe case with the <code>offset</code> properties in Mozilla and the <code>scrollWidth/Height</code> properties\nin Explorer 6 in standards compliance mode. Otherwise this theory has little to do with practice.</li>\n<li>Explorer 5 on Mac and Opera 6 are inconsistent in their use of the <code>offset</code> properties. While\n<code>offsetHeight</code> gives the height of the entire HTML document (as it does in most\nother browsers), <code>offsetWidth</code> gives the width of the <em>window</em>, not of the\nHTML document.</li>\n<li>The only reliable property pair is <code>scrollTop/Left</code>: it always gives the amount\nof pixels the page has scrolled. Unfortunately this information is highly doctype-sensitive:\nin standards compliance mode in Explorer 6 these properties belong to <code>documentElement</code>,\nwhile in quirks mode they belong to <code>body</code>, just like in all other browsers. In Explorer 5.0\non Windows these properties were assigned to both <code>body</code> and <code>documentElement</code>.\nI wish Explorer 6 had done the same regardless of doctype, it would spare me the need to rewrite\nscripts.</li>\n<li>I have been unable to find out what function the <code>scrollLeft/Top</code> property pair\nhas in Opera 6. The values simply don't make sense.</li>\n</ul></p><p><h3>Practice</h3></p><p><p>So how do you write cross-browser scripts that avoid all these complications?\nHere are some examples that survive using a doctype that switches Explorer 6 to compatibility\nmode:</p></p><p><h4>Scrolling offset</h4></p><p><p>The scrolling offset of the page is reflected in <code>document.body.scrollTop/Left</code>,\nexcept when you use a doctype in Explorer 6, then it is reflected in\n<code>document.documentElement.scrollTop/Left</code>. Opera is unreliable here. Fortunately the\nold Netscape properties <code>window.pageXOffset/pageYOffset</code> still work in all Netscapes\nand Opera. So the script would become:</p></p><p><pre>\nif (window.pageYOffset)\n{\n	  pos = window.pageYOffset\n}\nelse if (document.documentElement && document.documentElement.scrollTop)\n{\n	pos = document.documentElement.scrollTop\n}\nelse if (document.body)\n{\n	  pos = document.body.scrollTop\n}\n</pre></p><p><p>and <code>pos</code> contains the vertical scrolling offset.</p></p><p><h4>Window dimensions</h4></p><p><p>The window dimensions are reflected in <code>document.body.clientWidth/Height</code>,\nexcept when you use a doctype in Explorer 6, then they are reflected in\n<code>document.documentElement.clientWidth/Height</code>. Opera is unreliable here, the window\nheight is never less than the height of the HTML document. Fortunately the\nold Netscape properties <code>window.innerWidth/Height</code> still work in all Netscapes\nand Opera. So the script would become:</p></p><p><pre>\nif (window.innerWidth)\n{\n	theWidth = window.innerWidth\n}\nelse if (document.documentElement && document.documentElement.clientWidth)\n{\n	theWidth = document.documentElement.clientWidth\n}\nelse if (document.body)\n{\n	theWidth = document.body.clientWidth\n}\n</pre></p><p><p>and <code>theWidth</code> contains the width of the window. Note that the clientWidth is always\nthe width <em>excluding the scrollbars</em>. Generally (but not always),\n<code>offsetWidth/Height</code> gives access to the window width <em>including the scrollbars</em>.</p></p><p><h3>Conclusion</h3></p><p><p>The conclusion must be that the implementation of the <code>body/documentElement</code>\nproperties in the various browsers, with and without doctypes, is very complicated. I can find no overall\ntheoretical model that explains what the four property pairs are for and what the effect of a\ndoctype switch is.</p></p><p><p>I hope my <a href="http://www.xs4all.nl/~ppk/js/index.html?doctypes.html"\n	target="_blank">table of research results</a> will allow people to formulate theories. If you think you understand the behaviour of a certain browser (or, better yet, all browsers), please leave a comment below.</p>