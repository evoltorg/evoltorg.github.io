---
layout: post
permalink: node/60160
ratings: 7
avgrate: 2.7143
user: port80
real_name: "Joe Lima & Thomas Powell"
user_since: 2003-05-21
avatar: ""
article_count: 2
excerpt: "Masking or anonymizing a Web server involves removing identifying details that intruders could use to detect your OS and Web server vendor and version. This information, while providing little or no utility to legitimate users, is often the starting place for crackers, blackhat hackers and \"script "
---
<p></p>Masking or anonymizing a Web server involves removing identifying details that intruders could use to detect your OS and Web server vendor and version.  This information, while providing little or no utility to legitimate users, is often the starting place for crackers, blackhat hackers and &quot;script kiddies&quot;. This article explores some ways you can minimize the risk of such detection. Most of the following examples focus on Microsoft&#39;s Internet Information Server (IIS), since it has been most widely lambasted for its vulnerabilities, but some Apache detection countermeasures are also covered.  While IIS users probably have the most vested interest here, server anonymization is relevant to anyone responsible for administering a Web server.</p></p> </p><p><h2>Crackers Start Here.  Shouldn&#39;t You?</h2></p><p><p>	</p>Let&#39;s look at it from the attacker&#39;s point of view:  Security vulnerabilities tend to be dependent on software vendor and version. Blind probing might lead to further requests being denied or a system temporarily taken off line. Knowing Web server details greatly increases the efficiency of any attack.  If an attacker can target exploits, the chances of successful cracking prior to detection increase significantly.  Script kiddies can leverage canned, newly-discovered exploits to do more damage faster by targeting hosts with recognizable signatures.  A self-identifying system invites trouble.</p></p></p><p><!-- removing gratuitous product plug</p><p></p>Port80 Software has developed an IIS server module called <a href="http://www.servermask.com">ServerMask</a> to combat the majority of issues explored here for the Windows Web Server.</p></p></p>--></p><p><h2>The Server Header Tells All</h2></p><p><p></p>Most Web servers politely identify themselves and the OS to anyone who asks. Using a network query tool like <a href="http://www.samspade.org" target="_blank">Sam Spade</a>, you can discern the HTTP Server header. Just request a Web site&#39;s home page and examine the resulting HTTP headers or &quot;banners&quot; sent back by the server.  Among them, you will likely find something like this&#58;</p></p></p><p></p><p></p><code>Server&#58; Microsoft-IIS/5.0</code></p></p></p><p><p></p>There is not much mystery here. Apache&#39;s default settings make it no less identifiable&#58;</p></p></p><p><p></p><code>Server&#58; Apache/2.0.41-dev (UNIX)</code></p></p></p><p><p></p>You can remove or obscure this HTTP Server header in a variety of ways, depending on your platform. Apache 2.x users who have the <a href="http://httpd.apache.org/docs/mod/mod_headers.html" target="_blank">mod_headers</a> module loaded can use a simple directive in their httpd.conf file, as follows:</p></p></p><p><p></p><code>Header set Server &#34;New Server Name Goes Here&#34;</code></p></p></p><p><p></p>Unfortunately, mod_headers cannot alter the Server header in prior versions of Apache, so 1.3.x users will have to resort to editing <a href="http://apache.dev.wapme.net/doxygen-1.3/httpd_8h-source.html#l00425" target="_blank">the defines in httpd.h</a> and recompiling Apache to get the same result.  IIS users can install <a href="http://www.microsoft.com/technet/treeview/default.asp?url=/technet/security/tools/tools/locktool.asp" target="_blank">IISLockDown</a> and use the configuration option in <a href="http://www.microsoft.com/technet/treeview/default.asp?url=/technet/security/tools/tools/urlscan.asp" target="_blank">URLScan&#39;s</a> INI file for removing or replacing the header.  Be careful with URLScan if you are using Cold Fusion application server &#8212; the way the current version replaces the Server header wreaks havoc with CFM pages.  In fact, removing the header is the way to go when using URLScan, since if you try replacing the header it moves to the bottom of the header order &#8212; which pretty much gives away that you are running URLScan on IIS.</p></p></p><p></p><h2>Unsightly File Extensions</h2></p><p><p></p>Displaying file extensions like .asp or .aspx in a site is a clear indication that you are running a Microsoft server and, in general, hiding file extensions is a good practice to mask the technology generating dynamic pages. You can change your application mappings (.asp becomes .htm or .foo, etc.), but such one-to-one mapping can make mixing server-side technologies painful and does nothing to alleviate headaches during site migrations.  Doing without file extensions altogether is an even better idea, not only for security but also for ease-of-migration and content negotiation.  Apache people will want to take a look at <a href="http://httpd.apache.org/docs/mod/mod_negotiation.html" target="_blank">mod_negotiation</a>.  Watch out, though, for the Content-Location header in the server&#39;s response, which can give away the file extension that is not shown in the URL.  You might have to suppress this header separately using mod_headers. In a similar vein, Port80 offers a tool called <a href="http://www.pagexchanger.com">PageXchanger</a> that allows file extension hiding in IIS.</p></p></p><p></p><h2>Half-Baked Cookies</h2></p><p><p></p>The ASP session ID cookie, used by the Session object to maintain client state, is another dead giveaway&#58;</p></p></p><p><p></p><code>Set-Cookie&#58; ASPSESSIONIDQGQGGWFC=MGMLNKMDENPEOPIJHPOPEPPB;</code></p></p></p><p><p></p>You can <a href="http://support.microsoft.com/default.aspx?scid=kb;en-us;Q244465" target="_blank">disable ASP Session State</a> so that this cookie is not placed, but you lose the convenience of using the Session object to maintain client state.  You could also create an ISAPI filter to change the names of any session ID cookie.  On the other hand, ASP sessions are resource intensive, and turning them off improves the performance and scalability of your ASP application, while also helping to anonymize your server.</p></p></p><p><h2>Send These to the Recycle Bin</h2></p><p></p><h3>WebDAV&#58;</h3></p><p></p><p>Another way of identifying Microsoft servers is their implementation (from Windows 2000 and IIS 5.0 on) of WebDAV &#8212; the HTTP Extensions for Distributed Authoring and Versioning. WebDAV itself is not unique to Microsoft or IIS; it is a proposed standard (<a href="http://asg.web.cmu.edu/rfc/rfc2518.html" target="_blank">RFC 2518</a>) with an IETF <a href="http://www.ics.uci.edu/~ejw/authoring/" target="_blank">Working Group</a>. Microsoft&#39;s WebDAV support, however, adds a lot of information to the headers sent back by the server, especially when an HTTP OPTIONS request is made. If you are not using WebDAV (to support Outlook Web Access or Web Folders, etc.), you can disable it entirely <a href="http://support.microsoft.com/default.aspx?scid=KB;EN-US;Q241520" target="_blank">by editing the registry</a> or <a href="http://support.microsoft.com/default.aspx?scid=KB;EN-US;Q325864" target="_blank">by using IISLockDown and URLScan</a>.</p></p></p><p></p><h3>Public Header&#58;</h3></p><p></p><p></p>Certain Web servers betray their identity by displaying the Public header in HTTP responses.  Few popular Web Servers send this header in response to OPTIONS requests (while almost all respond with the similar Allow header).  The presence of Public is a good indication you are connected to either an IIS box or Netscape Enterprise 3.6.  The Public header can be removed with a custom ISAPI filter (IIS) or NSAPI plug-in (Netscape).</p></p></p><p><h3>Integrated Windows Authentication&#58;</h3></p><p></p><p></p>IIS users should not rely on "Integrated Windows Authentication" &#8212; especially not as a way of hiding anything on the server. This method betrays the very secret it would keep, since a script or visual hacker can identify the Windows box by means of the WWW-Authenticate headers sent by the server. When a file or directory is protected by NT Challenge-Response authentication, one of the authentication headers contains the string &quot;NTLM&quot; (NT LAN Manager) &#8212; a Microsoft-specific form of HTTP authentication.</p></p></p><p></p><h2>Get Your Headers Straight</h2></p><p></p><p></p>The number and sequence of your HTTP headers and the presence or absence of certain platform-specific headers provide handy ways for more sophisticated hackers to fingerprint your Web server.  A relatively unexplored area of server profiling, this will become a more common exploit as administrators start to implement countermeasures against obvious HTTP vulnerabilities like the Server header.  For IIS users, a custom ISAPI filter can alter the Microsoft-specific header order or sequence to emulate, say, a default Apache installation.  Apache users can accomplish any header order emulation they wish by experimenting with the location and order of Header directives in <a href="http://httpd.apache.org/docs/mod/mod_headers.html" target="_blank">mod_headers</a>.</p></p></p><p><h2>Whose Default is That?</h2></p><p></p><p></p>Default messages, pages and scripts of all kinds often contain clues to server identity, and these should be removed or modified accordingly. Software behind the Web server often bubbles error messages back through the HTTP request/response cycle, and customized HTTP errors can mask application server, database server, Web server and OS identity.   <a href="http://www.customerror.com">For IIS, CustomError</a> makes it easy for developers to deploy custom 404 and other HTTP error pages. This article shows how to implement <a href="http://www.devarticles.com/content.php?articleId=124" target="_blank">custom HTTP errors in Apache</a>. Avoid this on a development server, since, when done properly, it prevents database and server-side scripting errors from being seen &#8212; making it tough for developers to debug their applications!  Remove or hide any Web or application server administration pages, scripts or documentation installed under your server&#39;s Web root, and make sure to replace those default home pages.</p></p></p><p></p><p><h2>We Don&#39;t Need No Extra Services</h2></p><p></p><p><p></p>Beyond the HTTP service itself, many computers used as Web servers host a number of other network services.  Perhaps the most common are FTP and SMTP.  As a general security rule, try to avoid running these services on your Web server.  In particular, avoid the default FTP and SMTP services in Microsoft IIS.  Despite the convenience of integrated services, there is no reason to have Web, FTP and SMTP services interlinked.  This is not an issue for Apache, since the Web server is not associated with FTP and SMTP services through a common administrative service. If you do use these services, be aware that they will advertise your IIS server&#39;s identity.</p></p></p><p><p></p>When a connection is established with an SMTP service, the recipient server sends a human-readable greeting to the client, the "SMTP banner". What the SMTP banner displays has no effect on e-mail service, but, like the HTTP Server header, it divulges details about the software running on the box.  The default Windows SMTP service exposes such information. To find out how to change the SMTP banner, <a href="http://www.iisfaq.com/default.aspx?View=A385&P=109" target="_blank">check here</a>.</p></p></p><p><p></p>The default Microsoft IIS FTP server also presents a known banner.  Since modifying the FTP banner is a more involved process than modifying the SMTP banner (plan on hacking several system DLLs), your best bet is an alternate FTP server like <a href="http://www.rhinosoft.com/serv-u" target="_blank">RhinoSoft&#39;s Serv-U FTP server</a> that can display any text message in the FTP banner.  As an added bonus, third-party FTP servers like Serv-U are more configurable than the IIS FTP service when it comes to security measures like assigning users their own login directories.</p></p></p><p><h2>Unsanitary Inputs</h2></p><p></p><p></p>Many platform-specific exploits use complex URL strings to gain access to a shell or CGI program, from which a hacker can easily get a directory listing revealing the OS&#39; default file structure. Once a shell or CGI program is hijacked and the file system revealed, the door is wide open. The best defense against this trial-and-error exploit is a user-input filter or &quot;sanitizer&quot; that removes unacceptable characters (such as  meta-characters and their various possible encodings) from user-supplied data. For IIS, the current standard is IISLockDown/URLScan.  A new generation of <a href="http://www.nwfusion.com/news/tech/2002/0603tech.html" target="_blank">application firewalls</a> extend this protection to the application layer behind the Web server.  In the Apache world, user input sanitizing is traditionally the responsibility of CGI authors. <a href="http://www.cert.org/tech_tips/cgi_metacharacters.html" target="_blank">Here is the classic CERT article</a> on the topic, with examples in Perl and C. If you are setting up a new box, consider changing the default file structure as well.  Input sanitizing and rearranged file structures do double duty &#8212; helping to disguise the box and neutralize common exploits simultaneously.</p></p></p><p></p><h2>Combing Through the Stacks</h2></p><p></p><p></p>Even when all telltale signs are removed from your Web server&#39;s application layer, there remain detection weaknesses at lower network layers. Any server with a network connection has a network protocol stack subject to being scanned and identified. The best stack scanners (like NMAP from <a href="http://www.insecure.org" target="_blank">insecure.org</a>) can ID most operating systems by using a variety of techniques to fingerprint the system&#39;s TCP stack. OS-specific IP stacks are also vulnerable to detection via the Internet Control Message Protocol (ICMP), used by the popular Ping utility. Good resources on ICMP vulnerabilities can be found <a href="http://www.networkmagazine.com/article/NMG20000829S0003" target="_blank">here</a>. The first line of defense against these kinds of network scanning vulnerabilities is a good, well-administered firewall.  However, careful network analysis can still identify a box by examining the packets a firewall must permit a Web server to pass through in response to HTTP requests.</p></p></p><p></p><p><h2>Netcraft is Watching</h2></p><p></p><p></p>Take a look at the &quot;What&#39;s that site running?&quot; tool on <a href="http://www.netcraft.com" target="_blank">Netcraft</a>.  If you point the site profiling tool at your own Web site, it will probably correctly report both your Web server and OS.  Changing your HTTP Server header will cause Netcraft to report a false value for your Web server &#8212; or just &quot;unknown&quot; if the header is completely removed (the change is not immediate, as Netcraft caches results for a time).</p></p></p><p><p></p>Still, your OS will probably be correctly identified &#8212; even behind a good firewall.  To get Netcraft to report your OS as &quot;unknown&quot;, you will have to tinker with some of your default TCP/IP settings, such as the receive window size (RWIN), the maximum transmission units (MTU), the maximum segment size (MSS), and/or the IP header time-to-live (TTL).  Altering these settings will affect your server&#39;s performance in diverse ways, depending on network conditions, so considerable care should be taken when changing these defaults.  In the hands of a skilled network administrator, however, this strategy can be an effective countermeasure to information leakage through stack scanning.</p></p></p><p><h2>Let&#39;s Be Careful Out There</h2></p><p></p><p><p></p>No combination of detection avoidance succeeds in completely anonymizing your Web server &#8212; just as no combination of firewalls, IDS, and other security countermeasures can completely defeat a skilled and determined cracker.  Like server hardening, server anonymization can help defeat the majority of would-be attackers.  And like all aspects of network security, it&#39;s a never-ending battle to stay ahead of the bad guys.</p></p>