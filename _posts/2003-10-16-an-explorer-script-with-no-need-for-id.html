---
layout: post
permalink: explorer_script
ratings: 6
avgrate: 4.1667
category: Code
user: codepo8
real_name: "Chris Heilmann"
user_biog: "Currently employed in London as a Lead Front End Developer, Chris has been bouncing around the globe working for several agencies and companies. A web enthusiast from 1997 on workplaces include Munich, London, Santa Monica and San Francisco. 
More of Chris\' writings can be found at http://icant.co.uk and he blogs at http://wait-till-i.com"
user_since: 29 Jul 2002
avatar: /images/pictures/picture-35456.jpg
article_count: 17
excerpt: "As a lot of people use windows explorer to navigate through their harddisk, more and more people ask for the same navigation for deeply nested web sites. This article explains how to develop one of these in a backward-compatible, expandable and accessible way."
---
<p>From the emails I got after publishing the </p><a href="http://www.evolt.org/collapsible_page_elements/" </p>title="Collapsible page elements with DOM" target="_blank">collapsible page elements</a> article</p>I realised that what the world needs now (apart from love, sweet love) is a </p>clean explorer-like collapsing and expanding nested list script.</p> </p><p>Check <a href="http://www.onlinetools.org/puredom/example1.html" </p>target="_blank" title="example of a dynamic explorer navigation">this example </p>page</a> to see what we are talking about.</p></p><p>If you <a href="http://www.google.com/search?hl=en&lr=&ie=UTF-8&oe=UTF-8&q=dynamic+explorer+menu+script" target="_blank" title="google search for dynamic explorer scripts">google</a> for these you </p>find a lot, and most likely all of them fail in one way or another. They might </p>be browser dependent, need horrid markup, are not backward compatible, whatever, </p>for some reason most will just not do.</p></p><p>So let's see how we can do it better...</p></p><h2>Step one: collect underwear</h2></p><p>Without a solid foundation, a house shows cracks (mine does), and without a </p>solid HTML markup to enhance, a script is likely to fail.</p></p><p>That is why the HTML to be turned into the fancy collapse and expand script </p>should be a HTML list. If you haven't heard about the merits of navigations</p>as lists yet, read the ravings on <a href="http://www.listamatic.com/about-why.htm" </p>target="_blank" title="why lists are a good markup idea for navigations">listamatic</a>.</p></p><p>This is what it might look like:</p></p><pre></p>&#60;ul&#62;</p> &#60;li&#62;&#60;a href=&#34;#&#34;&#62;Link1&#60;/a&#62;&#60;/li&#62;</p> &#60;li&#62;&#60;a href=&#34;#&#34;&#62;Link2&#60;/a&#62;</p>  &#60;ul&#62;</p>   &#60;li&#62;&#60;a href=&#34;#&#34;&#62;Link2_1&#60;/a&#62;&#60;/li&#62;</p>   &#60;li&#62;&#60;a href=&#34;#&#34;&#62;Link2_2&#60;/a&#62;&#60;/li&#62;</p>   &#60;li&#62;&#60;a href=&#34;#&#34;&#62;Link2_3&#60;/a&#62;&#60;/li&#62;</p>   &#60;li&#62;&#60;a href=&#34;#&#34;&#62;Link2_4&#60;/a&#62;&#60;/li&#62;</p>  &#60;/ul&#62;</p> &#60;/li&#62;</p> &#60;li&#62;&#60;a href=&#34;#&#34;&#62;Link3&#60;/a&#62;&#60;/li&#62;</p> &#60;li&#62;&#60;a href=&#34;#&#34;&#62;Link4&#60;/a&#62;&#60;/li&#62;</p>&#60;/ul&#62;</p></pre></p><p>And we want to be able to nest as many levels as necessary.</p></p><h3>Ponderings: script or no script?</h3></p><p>You don't necessarily need Javascript to achieve the functionality of a</p>file explorer menu, you could use CSS and some clever :hover statements.</p></p><p>However collapsing and expanding an explorer menu when you touch it with a </p>mouse means you need neurosurgical skills to navigate into nested items.</p></p><p>Furthermore you cannot keep the nested items visible once you move away from </p>the link.</p></p><p>Hence, no CSS for us this time, let's do a Javascript instead.</p></p><p>Let us also focus on accessibility and &#34;graceful degradation&#34;.</p>People with the inability to use a mouse should be able to use the script with </p>the keyboard. People without Javascript should see the menu as a totally expanded </p>list without bells and whistles.</p></p><p>Mouse independence is easy: Simply add an &#34;onkeypress&#34; event handler</p>to each link you enhanced with your &#34;onclick&#34; one.</p></p><p>This is common practise and a <a href="http://www.w3.org/WAI/wcag-curric/sam70-0.htm" </p>title="information about event handlers and accessibility">recommendation by the </p>W3C Web Accessibility Initiative(WAI)</a>.</p></p><p>Some browsers (like some builds of Mozilla and IE on mac) have problems with</p>the keyboard implementation, but it is not our job to work around them. Keyboard</p>users that need to use it won't use these browsers anyway.</p></p><p>There are loads of ways to collapse and expand elements on a page, let's take</p>a peek at a common one.</p></p><p><h2>Hey, I got an ID</h2></p><p>Collapsing nested elements is easy, once you give them an ID.</p></p><p>Let's create one of these solutions, and, as this is not the real thing, </p>we won't worry about the onkeypress for the moment.</p></p><pre></p>&#60;ul&#62;</p> &#60;li&#62;&#60;a href=&#34;#&#34;&#62;Link1&#60;/a&#62;&#60;/li&#62;</p> &#60;li&#62;&#60;a href=&#34;#&#34;</p> onclick=&#34;d=document.getElementById('nest1');d.style.display=d.style.display=='none'?'block':'none'; return false&#34;&#62;Link2&#60;/a&#62;</p>  &#60;ul id=&#34;nest1&#34; style=&#34;display:none&#34;&#62; </p>   &#60;li&#62;&#60;a href=&#34;#&#34;&#62;Link2_1&#60;/a&#62;&#60;/li&#62;</p>   &#60;li&#62;&#60;a href=&#34;#&#34;&#62;Link2_2&#60;/a&#62;&#60;/li&#62;</p>   &#60;li&#62;&#60;a href=&#34;#&#34;&#62;Link2_3&#60;/a&#62;&#60;/li&#62;</p>   &#60;li&#62;&#60;a href=&#34;#&#34;&#62;Link2_4&#60;/a&#62;&#60;/li&#62;</p>  &#60;/ul&#62;</p> &#60;/li&#62;</p> &#60;li&#62;&#60;a href=&#34;#&#34;&#62;Link3&#60;/a&#62;&#60;/li&#62;</p> &#60;li&#62;&#60;a href=&#34;#&#34;&#62;Link4&#60;/a&#62;&#60;/li&#62;</p>&#60;/ul&#62;</p></pre></p><p>Does the job, but is dependent on too many things. First of all you need an </p>ID for each nested element, and that could interfere with existing IDs (whoever </p>did an ASP.NET project and has seen its way of deliberately scattering obscure IDs </p>all over the document will have faced that problem). Secondly, if I turn</p>off Javascript, the nested element is hidden (unless I also turn off CSS). </p></p><p>What we need to do is to find a function that checks for us </p>if there is something to collapse and does so if it exists. And that without </p>knowing its name (ID in this case).</p></p><h2>Forget me node</h2></p><p>The answer: DOM. This handy thing (Document Object Model) allows you to </p>navigate through your HTML document and access each bit of it. This can be done</p>via ID or tag name. And tag name is what we will use here.</p></p><pre></p>&#60;ul&#62;</p> &#60;li&#62;&#60;a href=&#34;#&#34;&#62;Link1&#60;/a&#62;&#60;/li&#62;</p> &#60;li&#62;&#60;a href=&#34;#&#34; </p> onclick=&#34;d=this.parentNode.getElementsByTagName('ul')[0];d.style.display=d.style.display=='none'?'block':'none';</p> return false&#34;&#62;Link2&#60;/a&#62;</p>  &#60;ul style=&#34;display:none&#34;&#62; </p>   &#60;li&#62;&#60;a href=&#34;#&#34;&#62;Link2_1&#60;/a&#62;&#60;/li&#62;</p>   &#60;li&#62;&#60;a href=&#34;#&#34;&#62;Link2_2&#60;/a&#62;&#60;/li&#62;</p>   &#60;li&#62;&#60;a href=&#34;#&#34;&#62;Link2_3&#60;/a&#62;&#60;/li&#62;</p>   &#60;li&#62;&#60;a href=&#34;#&#34;&#62;Link2_4&#60;/a&#62;&#60;/li&#62;</p>  &#60;/ul&#62;</p> &#60;/li&#62;</p> &#60;li&#62;&#60;a href=&#34;#&#34;&#62;Link3&#60;/a&#62;&#60;/li&#62;</p> &#60;li&#62;&#60;a href=&#34;#&#34;&#62;Link4&#60;/a&#62;&#60;/li&#62;</p>&#60;/ul&#62;</p></pre></p><p>What?</p></p><p>Ok, let's go through this one bit by bit:</p></p><p><code>d.style.display=='none'?'block':'none';return false"</code> is the same</p>as above, we take an object(d) and check its display value. If that value is none, we set it </p>to block and vice versa.</p></p><p>More challenging is the first part, <code>d=this.parentNode.getElementsByTagName('ul')[0];</code>, </p>especially when you haven't used DOM before, or anything that also works with </p>traversing through node trees (XSLT for example).</p></p><p>We define d, and it is defined as something starting from &#34;this&#34;. &#34;this&#34;</p>is handy, as it always is what we clicked on. In our case, &#34;this&#34; is </p>the link element with the text &#34;Link2&#34; in it.</p></p><p>&#34;parentNode&#34; is the node our link is in, in our case the LI element. If we</p>had nested the link in a STRONG tag, that would be parentNode. This DOM variable always </p>gets the parent element of the one we are dealing with. (Much like a &#34;cd ..&#34; command gets </p>you up one level in DOS or on a unix bash).</p></p><p>Now that we are at the LI level, we get all the UL elements nested in it via</p><code>getElementsByTagName('ul')</code> and choose the first one </p><code>getElementsByTagName('ul')[0]</code> (computers start counting at 0, not 1, most</p>probably because they don't have any fingers).</p></p><p>Now all we need to make this work for every link on the page,</p>is to check for our &#34;d&#34; before we tell the browser to change its display value.</p></p><p>Let's create the fully reusable function that also checks if our browser can </p>do what we want it to do:</p></p><pre></p>&#60;script type=&#34;text/javascript&#34;&#62;</p>if (document.getElementById &#38;&#38; </p>document.createTextNode &#38;&#38; document.createElement){canDOM=true}</p>function ex(n){</p> if(canDOM){</p>  u=n.parentNode.getElementsByTagName('ul')[0];</p>  if(u){u.style.display=(u.style.display=='none'  u.style.display=='')?'block':'none';}</p> }</p>}</p>&#60;/script&#62;</p>&#60;ul&#62;</p> &#60;li&#62;&#60;a href=&#34;#&#34;&#62;Link1&#60;/a&#62;&#60;/li&#62;</p> &#60;li&#62;&#60;a href=&#34;#&#34; onclick=&#34;ex(this);return false;&#34; </p> onkeypress=&#34;ex(this);return false;&#34;&#62;Link2&#60;/a&#62;</p>  &#60;ul style=&#34;display:none&#34;&#62; </p>   &#60;li&#62;&#60;a href=&#34;#&#34;&#62;Link2_1&#60;/a&#62;&#60;/li&#62;</p>   &#60;li&#62;&#60;a href=&#34;#&#34;&#62;Link2_2&#60;/a&#62;&#60;/li&#62;</p>   &#60;li&#62;&#60;a href=&#34;#&#34;&#62;Link2_3&#60;/a&#62;&#60;/li&#62;</p>   &#60;li&#62;&#60;a href=&#34;#&#34;&#62;Link2_4&#60;/a&#62;&#60;/li&#62;</p>  &#60;/ul&#62;</p> &#60;/li&#62;</p> &#60;li&#62;&#60;a href=&#34;#&#34;&#62;Link3&#60;/a&#62;&#60;/li&#62;</p> &#60;li&#62;&#60;a href=&#34;#&#34;&#62;Link4&#60;/a&#62;&#60;/li&#62;</p>&#60;/ul&#62;</p></pre></p><h2>Gotta hide 'em all</h2></p><p>Ok, that still leaves the non Javascript users with CSS enabled with a collapsed</p>list though. We need to find a way to collapse all nested ULs in the document. </p>getElementsByTagName helps us there.</p></p><pre></p>&#60;script type=&#34;text/javascript&#34;&#62;</p>function expinit(){</p> if (canDOM){</p>  alluls=document.getElementsByTagName('UL');</p>  for(i=0;i&#60;alluls.length;i++){</p>   subul=alluls[i];</p>   if(subul.parentNode.tagName=='LI'){</p>    subul.style.display='none';</p>   }</p>  }</p> }</p>}</p>window.onload=expinit;</p>&#60;/script&#62;</p>&#60;ul&#62;</p> &#60;li&#62;&#60;a href=&#34;#&#34;&#62;Link1&#60;/a&#62;&#60;/li&#62;</p> &#60;li&#62;&#60;a href=&#34;#&#34; onclick=&#34;ex(this);return false;&#34; </p> onkeypress=&#34;ex(this);return false;&#34;&#62;Link2&#60;/a&#62;</p>  &#60;ul&#62; </p>   &#60;li&#62;&#60;a href=&#34;#&#34;&#62;Link2_1&#60;/a&#62;&#60;/li&#62;</p>   &#60;li&#62;&#60;a href=&#34;#&#34;&#62;Link2_2&#60;/a&#62;&#60;/li&#62;</p>   &#60;li&#62;&#60;a href=&#34;#&#34;&#62;Link2_3&#60;/a&#62;&#60;/li&#62;</p>   &#60;li&#62;&#60;a href=&#34;#&#34;&#62;Link2_4&#60;/a&#62;&#60;/li&#62;</p>  &#60;/ul&#62;</p> &#60;/li&#62;</p> &#60;li&#62;&#60;a href=&#34;#&#34;&#62;Link3&#60;/a&#62;&#60;/li&#62;</p> &#60;li&#62;&#60;a href=&#34;#&#34;&#62;Link4&#60;/a&#62;&#60;/li&#62;</p>&#60;/ul&#62;</p></pre></p><p>We check if the browser supports DOM, then we get all the UL objects in the </p>document and store them in an array called &#34;alluls&#34;. We then loop </p>through this array, and check if the parentNode of the UL we are currently </p>looking at is an LI (which defines a nested UL). If this is the case, we </p>set the display of the UL to none. We call this script when the document is </p>loaded and, hey, all nested lists get hidden.</p></p><p>Two more problems though: First, all nested lists get hidden, and second, how</p>do I know that some of the links have sub elements and some not?</p></p><h2>Indicate left, take over</h2></p><p>We want an indicator left of the link that tells us that there is something to </p>expand, and we want only lists in LIs with links in them to be hidden.</p></p><pre></p>&#60;script type=&#34;text/javascript&#34;&#62;</p>function expinit(){</p> if (canDOM){</p>  alluls=document.getElementsByTagName('UL');</p>  for(i=0;i&#60;alluls.length;i++){</p>   subul=alluls[i];</p>   if(subul.parentNode.tagName=='LI'){</p>    mom=subul.parentNode.getElementsByTagName('A')[0]</p>    if(mom){</p>     momlink=mom.childNodes[0];</p>     momlink.nodeValue='+'+momlink.nodeValue;</p>     subul.style.display='none';</p>    }</p>   }</p>  }</p> }</p>}</p>window.onload=expinit;</p>&#60;/script&#62;</p></pre></p><p>We define &#34;mom&#34; as the first link within the parent node of the ul we</p>are in. (We are at the UL level, one up is the LI, the first A is actually the </p>link that gets clicked to expand or collapse this UL). We check if &#34;mom&#34; exists</p>and if that is the case we take the first child node of the A (which is the text),</p>and read its value via &#34;nodeValue&#34. Then we add a + in front of it. Voila, </p>all links with nested elements have a + in front of them.</p></p><p>The nice thing is that non Javascript browsers don't even see this, and it </p>doesn't confuse them.</p></p><p>Now we need to change the function that does the actual collapsing to change</p>this + into a - when the display change happens:</p></p><pre></p>&#60;script type=&#34;text/javascript&#34;&#62;</p>function ex(n){</p> if(canDOM){</p>  u=n.parentNode.getElementsByTagName(&#34;ul&#34;)[0];</p>  if(u){</p>   u.style.display=(u.style.display=='none'  u.style.display=='')?'block':'none';</p>   str=n.firstChild.nodeValue;</p>   sign=str.substr(0,1)=='+'?'&#173;':'+';     </p>   n.firstChild.nodeValue= sign + str.substr(1,str.length);</p>  }</p> }   </p>}</p>&#60;/script&#62;</p></pre></p><p>We define &#34;str&#34 as the text of the link we just clicked (firstChild is </p>the text, nodeValue is the text data). Then we check if the first character </p>(substr(0,1)) is a + and define &#34;sign&#34; as a - or a + accordingly. Remember </p>we added this + via the expinit() function.</p></p><p>Then we set the nodeValue of the link's text to our new sign followed by the rest </p>of the text in the link (substr 1 until the end of the string).</p></p><h2>You have taken your first step into a larger world...</h2></p><p>Now we have the script we wanted. We don't need to enhance our HTML with </p>any IDs or extra Javascript in the document body. The functionality (and the </p>extra text, namely the + and -) only shows up when the browser is capable of </p>supporting it. And it works! Where to go next?</p></p><p>It might be a bad idea to collapse all nested lists in one document. If </p>you want to prevent that happening, you'll have to either nest the </p>navigation list in a DIV with an ID or to make sure you know the location of the </p>list in the document node tree.</p></p><p>For the ID solution, replace <code>alluls=document.getElementsByTagName('UL');</code> </p>in expinit() with <code>alluls=document.getElementById('yourid').getElementsByTagName('UL');</code>.</p></p><p>For the known location solution, replace <code>alluls=document.getElementsByTagName('UL');</code> </p>in expinit() with <code>alluls=document.getElementsByTagName('UL')[1].getElementsByTagName('UL');</code> </p>where &#34;1&#34; is the number of the location.</p></p><p>Also, you might want to add an image as the indicator for collapsed elements,</p>or nest the indicator in some other element to add some extra styles.</p></p><p>If you want a readymade script using this techniques here with some of these</p>enhancements, go and download.</p></p><p><a href="http://www.onlinetools.org/tools/puredom/" title="readymade script using the tricks explained here" target="_blank">pureDom explorer</a></p></p><p>And look at the source code to see how these changes were implemented.</p>