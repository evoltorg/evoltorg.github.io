---
layout: post
permalink: node/60685
---
<p>In some cases you may want your loging form to be able to prevent automatic \n    login by a robot ( script ). To achieve this we can create a login form which \n    displays an image showing random numbers. The login form will have an extra \n    input field to enter the values shown. </p>\n   <p>Take a look at the <a href="http://mylockerzone.com?show=register" target="_blank">register\n    form</a>. The numbers shown there will change everytime you refresh the page. \n    Go ahead and try refreshing that page you will see the numbers always change. \n   </p>\n   <p>Before working on the login form we must take care of the script that create \n    the verification image first. Here is the code :</p></p><p><p>Example : <a href="http://bensite.zendurl.com/secure_numbers.php" target="_blank">secure_numbers.php</a><br>\nSource : <a href="http://bensite.zendurl.com/secure_numbers.html" target="_blank">secure_numbers.html</a></p></p><p><code>\n<?php\nsession_start();</p><p>// generate 5 digit random number\n$rand = rand(10000, 99999);</p><p>// create the hash for the random number and put it in the session\n$_SESSION['image_random_value'] = md5($rand);</p><p>// create the image\n$image = imagecreate(60, 30);</p><p>// use white as the background image\n$bgColor = imagecolorallocate ($image, 255, 255, 255);</p><p>// the text color is black\n$textColor = imagecolorallocate ($image, 0, 0, 0);</p><p>// write the random number\nimagestring ($image, 5, 5, 8, $rand, $textColor);</p><p>// send several headers to make sure the image is not cached\n// taken directly from the PHP Manual</p><p>// Date in the past\nheader("Expires: Mon, 26 Jul 1997 05:00:00 GMT");</p><p>// always modified\nheader("Last-Modified: " . gmdate("D, d M Y H:i:s") . " GMT");</p><p>// HTTP/1.1\nheader("Cache-Control: no-store, no-cache, must-revalidate");\nheader("Cache-Control: post-check=0, pre-check=0", false);</p><p>// HTTP/1.0\nheader("Pragma: no-cache");</p><p>\n// send the content type header so the image is displayed properly\nheader('Content-type: image/jpeg');</p><p>// send the image to the browser\nimagejpeg($image);</p><p>// destroy the image to free up the memory\nimagedestroy($image);\n?>\n</code></p><p><p>To create a five digit random number we use <code>rand()</code> \n    function and specify that the random number must be between 10000 and 99999. \n    We put the hash value of this random number in the session. This hash value \n    will be used by the login script to check if the entered number is correct.</p>\n   <p>Next we create a small image, 60 x 30 pixels, using <code>imagecreate()</code>. \n    We set the background color to white ( RGB = 255, 255, 255 ) using <code>imagecolorallocate()</code> \n    function. Note that the first call to <code>imagecolorallocate() \n    </code>will always set the background color for the image. Then we set the \n    text color as black ( RGB = 0, 0, 0 ). Feel free to change the color text \n    to your liking.</p></p><p>   <p>To print the random number to the image we use the function imagestring(). \n    In the script above we call this function like this : <code>imagestring \n    ($image, 5, 5, 8, $rand, $textColor);</code></p>\n   <p>The first argument passed to this function is the image handler ( $image \n    ). The second one ( 5 ) is the font. You can choose from one to five where \n    one is the smallest font. The third and fourth parameter is the horizontal \n    and vertical coordinate where we will print the image. The top left corner \n    is defined as 0, 0. The last one is the text color which is black as mentioned \n    earlier. </p>\n   <p>After we got the image ready we can now send it to the browser. But before \n    doing that we must set several headers to make sure that the image is not \n    cached. If the image is cached then the login form will show the same image \n    even if you refresh it. That will cause a problem since the random number \n    is always different. </p>\n   <p>Finally after everything is set we send the image to the browser using <strong>imagejpeg()</strong> and to free the memory we use <strong>imagedestroy()</strong>.</p></p><p><h3>How to use!</h3>\n<p>The way to use this is to run a check on what the entered compared to the MD5(ed) $_SESSION var, so the way you would do this is something like this</p>\n<p>View example of this here: <a href="http://bensite.zendurl.com/secure_check.php">secure_check.php</a></p><p><strong>Note: </strong><code>session_start()</code><strong> string is needed!</strong></p></p><p><code>\n<?\nif($_POST["go"]){\n     session_start();\n     if (md5($_POST["number"]) == $_SESSION['image_random_value']) {\n          echo "<h1>You enter correct</h1>";\n     }else{\n          echo "<h1>Wrong Verification</h1>";\n     }\n}\n?>\n<table width="100%"><tr><td></p><p><img src="secure_numbers.php"/></p><p></td><td><input type="text" name="number" size="40"></td></tr>\n<tr><td><input type="submit" name="go" value="Check Number"/></td><td><input type="reset" value="Reset"></td></tr>\n</table>\n</code></p><p><p>&nbsp;</p>\n   <h2>Improving The Verification Image</h2></p><p>   <p>We can improve the verification image in at least two ways. They are :</p>\n   <ol>\n    <li>Using alphanumeric characters as the verification code instead of numbers</li>\n    <li>Using backgound images</li>\n   </ol>\n   <p>For the first improvement the only thing we need to change is the way we \n    generate the code. Take a look at the code below</p>\n   <p>Example : <a href="http://bensite.zendurl.com/secure_words+numbers.php" target="_blank">secure_words+numbers.php</a><br>\n    Source : <a href="http://bensite.zendurl.com/secure_words+numbers.html" target="_blank">secure_words+numbers.html</a></p>\n<code>\n<?php\nsession_start();</p><p>$alphanum = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";</p><p>// generate the verication code\n$rand = substr(str_shuffle($alphanum), 0, 5);</p><p>// ... no changes after this point\n?>\n</code></p><p><p>We start by defining the characters that we want to use in the verification \n    code. For this example we use upper case alphabet plus numbers. The code is \n    generated using the combination of <span class="phpcode">str_shuffle()</span> \n    and <span class="phpcode">substr()</span> function. Using <span class="phpcode">str_shuffle()</span> \n    we jumble all the characters in <span class="phpcode">$aplhanum</span> and \n    then using <span class="phpcode">substr()</span> we take just the first five \n    characters. The result will look something like &quot;D79ZG&quot;. Just <a href="../examples/user-authentication/image-verification/randomImage2.php" target="_blank">run \n    the example</a> and see it for yourself.</p></p><p>   <p>The second improvement is by using background images. Maybe you already \n    know this but there are software/scripts that can extract the characters displayed \n    as images. And if the verification image only use plain background color identifying \n    the characters wil be quite easy.</p>\n   <p>For this reason we will make the verification code displayed on a background \n    image. In this tutorial we will only use four different background images. \n    You can add as many background images as you want in your own code. Here are \n    the background images :</p>\n   <ul>\n    <li>background image #1 : <img src="http://bensite.zendurl.com/background1.jpg" width="60" height="30"></li>\n    <li>background image #2 : <img src="http://bensite.zendurl.com/background2.jpg" width="60" height="30"></li>\n    <li>background image #3 : <img src="http://bensite.zendurl.com/background3.jpg" width="60" height="30"></li>\n   </ul>\n   <p><strong>Note :</strong> When you want to create a background image make \n    sure the code will still be readable on them. For instance it's quite hard \n    ( at least for me ) to recognize the code when the code is displayed on image \n    #1 and image #4. Go <a href="../examples/user-authentication/image-verification/randomImage3.php" target="_blank">take \n    a look</a> if you don't believe me.</p>\n   <p>Here is the code for this second improvement </p>\n            <p>Example : <a href="http://bensite.zendurl.com/secure_background.php" target="_blank">secure_background.php</a><br>\n                Source : <a href="http://bensite.zendurl.com/secure_background.html" target="_blank">secure_background.html</a></p>\n<code></p><p>\n<?php\nsession_start();</p><p>$alphanum = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";</p><p>// generate the verication code\n$rand = substr(str_shuffle($alphanum), 0, 5);</p><p>// choose one of four background images\n$bgNum = rand(1, 4);</p><p>$image = imagecreatefromjpeg("background$bgNum.jpg");</p><p>$textColor = imagecolorallocate ($image, 0, 0, 0);</p><p>// write the code on the background image\nimagestring ($image, 5, 5, 8, $rand, $textColor);</p><p>// ... no changes after this point\n?>\n</code>\n<p>After making the verification code we randomly pick one background image. \n    Then we create an image object from the chosen background using <span class="phpcode">imagecreatefromjpeg()</span> \n    and draw the code on the background. The rest of the code is the same as randomImage1.php \n    and randomImage2.php so no need to explain it here.</p>\n   <hr align="left" width="200" noshade> <p>Okay that is it. The three method \n    of user authentication. Just pick one that fit your application. Btw, all \n    the code for the three methods can be downloaded <a href="http://bensite.zendurl.com/secure_download.zip">here</a></p>