---
layout: post
permalink: node/12716
ratings: 3
avgrate: 4.0000
categories: [Code]
user: Martin Tsachev
real_name: "Martin Tsachev"
user_biog: "<p>Martin Tsachev started using computers
in 1992, programming Basic and has since
then developed a great passion for them.
</p>

<p>Nowadays he runs
<a href=\"http://www.mtdev.com\" rel=\"nofollow\" target=\"_blank\"
title=\"mtdev covers PHP, Python, JavaScript, and Linux shell scripts\">
mtdev</a> - a web site with highlight on PHP.
</p>"
user_since: 27 Jun 2001
avatar: /images/pictures/picture-12535.jpg
article_count: 6
excerpt: "How to create a DHTML Slideshow with fading effects, version 4 compatible, also accessible to version 3 browsers or lower browsers."
---
<h2>Compatibility</h2></p><ul></p><li>This script does not work in version 3 or lower browsers</p><li>The fading effect does not work in Opera 5, Konqueror and Omniweb, because these browser don't support clipping</p><li>Version 3 or lower browsers should just see the photos side by side and down to the end of the page</p></ul></p><p>I have seen many slideshow scripts almost all of which support version 3 browsers but require</p><strong>equal sized</strong> photos. My script does <strong>not</strong> require equal sized photos at all.</p>In addition it also adds a fading effect( I can't quite remember is that called doors or only the horizontal version is).</p></p><p><p>Clipping is a very powerful <a href="http://www.w3.org/Style/CSS" target="_blank" title="Styling with CSS">CSS</a> property. It tells the browser what area of the visual element should be displayed, as far as I know only the</p>rect area( rectangle) is supported by now. You can produce amazing fade effects dynamically changing its value.</p></p><p><h2>The script</h2></p><h3>The HTML</h3></p><pre></p>&lt;h1&gt;My DHTML slideshow gallery&lt;/h1&gt;</p>&lt;div align=&quot;center&quot;&gt;</p>&lt;a href=&quot;javascript:changeSlide(-1)&quot;&gt;Previous&lt;/a&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;</p>&lt;a href=&quot;javascript:changeSlide(1)&quot;&gt;Next&lt;/a&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;</p>&lt;a href=&quot;javascript:setFade(false)&quot;&gt;No fade&lt;/a&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;</p>&lt;a href=&quot;javascript:setFade(true)&quot;&gt;Fade&lt;/a&gt;&lt;br&gt;</p>&lt;/div&gt;</p>	&lt;div id=&quot;slide0&quot; class=&quot;slide&quot;&gt;&lt;img src=&quot;images/slide0.jpg&quot; alt=&quot;slide0&quot; width=&quot;100&quot; height=&quot;50&quot; border=&quot;0&quot;&gt;&lt;/div&gt;</p>	&lt;div id=&quot;slide1&quot; class=&quot;slide&quot;&gt;&lt;img src=&quot;images/slide1.jpg&quot; alt=&quot;slide1&quot; width=&quot;100&quot; height=&quot;50&quot; border=&quot;0&quot;&gt;&lt;/div&gt;</p>	&lt;div id=&quot;slide2&quot; class=&quot;slide&quot;&gt;&lt;img src=&quot;images/slide2.jpg&quot; alt=&quot;slide2&quot; width=&quot;50&quot; height=&quot;100&quot; border=&quot;0&quot;&gt;&lt;/div&gt;</p>	&lt;div id=&quot;slide3&quot; class=&quot;slide&quot;&gt;&lt;img src=&quot;images/slide3.jpg&quot; alt=&quot;slide3&quot; width=&quot;100&quot; height=&quot;50&quot; border=&quot;0&quot;&gt;&lt;/div&gt;</p>	&lt;div id=&quot;slide4&quot; class=&quot;slide&quot;&gt;&lt;img src=&quot;images/slide4.jpg&quot; alt=&quot;slide4&quot; width=&quot;50&quot; height=&quot;100&quot; border=&quot;0&quot;&gt;&lt;/div&gt;</p>	&lt;div id=&quot;slide5&quot; class=&quot;slide&quot;&gt;&lt;img src=&quot;images/slide5.jpg&quot; alt=&quot;slide5&quot; width=&quot;100&quot; height=&quot;50&quot; border=&quot;0&quot;&gt;&lt;/div&gt;</p>	&lt;div id=&quot;slide6&quot; class=&quot;slide&quot;&gt;&lt;img src=&quot;images/slide6.jpg&quot; alt=&quot;slide6&quot; width=&quot;50&quot; height=&quot;100&quot; border=&quot;0&quot;&gt;&lt;/div&gt;</p>	&lt;div id=&quot;slide7&quot; class=&quot;slide&quot;&gt;&lt;img src=&quot;images/slide7.jpg&quot; alt=&quot;slide7&quot; width=&quot;100&quot; height=&quot;50&quot; border=&quot;0&quot;&gt;&lt;/div&gt;</p></pre></p><p>Simple but working. Of course you do not have to name your images slide0.jpg and so on.</p></p><h3>The stylesheet</h3></p><pre>&lt;style type=&quot;text/css&quot;&gt;</p>.slide {</p>	position : absolute;</p>	visibility : hidden;</p>	top : 200px;</p>	left : 50px;</p>}</p><p>#slide0 {</p>	visibility : visible;</p>}</p>&lt;/style&gt;</pre></p><p>Maybe you are wondering why I didn't set the clipping in the stylesheet but left it to the JavaScript.</p>The answer is simple: Netscape Navigator 4 can get only the height/width of the block( actually the clipping area),&nbsp;</p>when no clipping is set( apparently it doesn't get the height value properly, but I have never seen a difference more than 10 pixels).</p></p><p><h3>The JavaScript</h3></p><pre></p>&lt;script type=&quot;text/javascript&quot;&gt;</p>var DHTML = (document.getElementById    document.all    document.layers);</p>if ( !DHTML ) alert('Your browser is not capable of displaying DHTML');</p>function getObj(name) {</p>	if (document.getElementById) {</p>		this.obj = document.getElementById(name);</p>		this.style = document.getElementById(name).style;</p>	} else</p>	if (document.all) {</p>		this.obj = document.all[name];</p>		this.style = document.all[name].style;</p>	} else</p>	if (document.layers) {</p>		this.obj = document.layers[name];</p>		this.style = document.layers[name];</p>	}</p>}</p><p>function visib(objName, flag) {</p>	x = new getObj(objName);</p>	x.style.visibility = (flag) ? 'visible' : 'hidden';</p>}</p><p></p>slides = new Array( // The id's of the slides</p>	'slide0',</p>	'slide1',</p>	'slide2',</p>	'slide3',</p>	'slide4',</p>	'slide5',</p>	'slide6',</p>	'slide7');</p><p>var fadeOn = false;</p>function setFade(switchFade) {// Fade switch function</p>	if ( !fadeOn ) {</p>		prepLyr(slides[curImg], true);</p>		} else { // No fade</p>		stopFade();</p>		for ( var i = 0; i &lt; 8; i++ ) {</p>			prepLyr(slides[i], true);</p>			if ( slides[i] != slides[curImg] )</p>				visib(slides[i], false);</p>		}</p>	}</p>	fadeOn = switchFade;</p>}</p><p>var curImg = 0; // index of the array entry</p>var lastImg = 0;</p>function changeSlide ( change ) {</p>	if (!DHTML) return;</p>	curImg += change;</p>	if ( curImg &lt; 0 ) curImg = slides.length-1;</p>	else</p>		if ( curImg &gt;= slides.length ) curImg = 0;</p>	if ( fadeOn ) {</p>		firstFade = true;</p>		prepLyr(slides[lastImg], true );</p>		fadeLayer(slides[lastImg], 10, 50);</p>	} else {</p>		visib(slides[lastImg], false);</p>		visib(slides[curImg], true);</p>	}</p>	lastImg = curImg;</p>}</p><p>var firstFade = true;</p>function nextFade() {</p>	firstFade = false;</p>	prepLyr(slides[curImg], false);</p>	fadeLayer(slides[curImg], -10, 50);</p>}</p><p>var clipTop = 0;</p>var clipWidth = 150;</p>var clipBottom = 0;</p>var lyrheight = 0;</p>var time,amount,theTime,middle;</p>var slideSize = new Array()</p><p>function prepLyr(lyr, vis) {</p>	if (!DHTML) return;</p>	x = new getObj( lyr );</p>	if (document.layers) {</p>		if ( !slideSize[lyr] ) {</p>			lyrheight = x.style.clip.bottom;</p>			clipWidth = x.style.clip.right;</p>			slideSize[lyr] = lyrheight + 'x' + clipWidth;</p>		} else {</p>			lyrheight = parseInt(slideSize[lyr]);</p>			clipWidth = slideSize[lyr].substr(slideSize[lyr].indexOf('x')+1);</p>		}</p>		if ( vis ) {</p>			clipTop = 0;</p>			middle = Math.round(lyrheight/2);</p>			clipBottom = lyrheight;</p>		} else {</p>			middle = Math.round(lyrheight/2);</p>			clipBottom = middle;</p>			clipTop = middle;</p>		}</p>		x.style.clip.top = clipTop;</p>		x.style.clip.left = 0;</p>		x.style.clip.right = clipWidth;</p>		x.style.clip.bottom = clipBottom;</p>		x.style.visibility = 'show';</p>	} else</p>	if (document.getElementById    document.all) {</p>		lyrheight = x.obj.offsetHeight;</p>		clipWidth = x.obj.offsetWidth;</p>		if ( vis ) {</p>			clipTop = 0;</p>			middle = Math.round(lyrheight/2);</p>			clipBottom = lyrheight;</p>		} else {</p>			middle = Math.round(lyrheight/2);</p>			clipBottom = middle;</p>			clipTop = middle;</p>		}</p>		x.style.clip = 'rect('+clipTop+' '+clipWidth+' '+ clipBottom +' 0)';</p>		visib(lyr, true);</p>	}</p>}</p><p>function fadeLayer(layername, amt, tim) {</p>	if (!DHTML) return;</p>	thelayer = new getObj( layername );</p>	if (!thelayer) return;</p>	amount = amt;</p>	theTime = tim;</p>	realFade();</p>}</p><p>function stopFade() {</p>	if (time) clearTimeout(time);</p>}</p><p>function realFade() {</p>	clipTop += amount;</p>	clipBottom -= amount;</p>	if (clipTop &lt; 0    clipBottom &gt; lyrheight    clipTop &gt; middle) {</p>		if ( clipTop &gt; middle ) thelayer.style.visibility = 'hidden';</p>		if ( firstFade ) nextFade();</p>		return;</p>	}</p>	if (document.getElementById    document.all) {</p>		clipstring = 'rect('+clipTop+' '+clipWidth+' '+clipBottom+' 0)'</p>		thelayer.style.clip = clipstring;</p>	}	else</p>	if (document.layers) {</p>		thelayer.style.clip.top = clipTop;</p>		thelayer.style.clip.bottom = clipBottom;</p>	}</p>	time = setTimeout('realFade()',theTime);</p>}</p><p>&lt;/script&gt;</p></pre></p><p><h2>Explanation</h2></p><p><h3>The HTML</h3></p><p><p>First the controls are set using anchors( I also thought of having a form with a checkbox for the fade</p>effect but the slideshow was to be included in a layer and it was to be a problem with NN 4).</p>I have never liked coding for NN 4 browsers but unfortunately I have to do so because their users</p>cannot be simply discarded off your site. Not that some should but in such a case it is not a matter (for a</p>browser market share stats (free) go to <a href="http://www.webreview.com/browsers/browser_faq.shtml" target="_blank">www.webreview.com/browsers/browser_faq.shtml</a>).</p></p><p><pre>&lt;div id=&quot;slide0&quot; class=&quot;slide&quot;&gt;</p>&lt;img src=&quot;images/slide0.jpg&quot; alt=&quot;slide0&quot; width=&quot;100&quot;</p>height=&quot;50&quot; border=&quot;0&quot;&gt;&lt;/div&gt;</pre></p><p><p>This sets the first slide of your DHTML slideshow. The <code>img</code> should be wraped in a <code>div</code></p>because NN 4 considers only <code>div</code>'s and <code>span</code>'s ( I think) for layers, not counting proprietary</p>tags. The case is that NN 4 can only set visibility/clipping of a layer. The <code>class="slide"</code> is</p>for setting the <code>position</code> and <code>visibility</code> of all slides, and the <code>id</code></p>is to identify the needed slide to be viewed.</p></p><p><h3>The stylesheet</h3></p><pre></p>.slide {</p>	position : absolute;</p>	visibility : hidden;</p>	top : 200px;</p>	left : 50px;</p>}</p><p>#slide0 {</p>	visibility : visible;</p>}</p></pre></p><p></p>First the class definition for all the slides. It sets the <code>position</code> to <code>absolute</code></p>to get the impression that the next slides comes from below the previous (not to have the user scroll down the</p>page to see the next slide). <code>Visibility : hidden</code> prevents the browser from visializing the</p>slides on the screen, while still reserving the space needed. We set also the <code>top</code> and</p><code>left</code> coordinates of the slides (px being the pixel unit).</p></p><p><p>The following style rule is to make only the first slide visible to the user. </p></p><h3>The script</h3></p><pre></p>var DHTML = (document.getElementById    document.all    document.layers);</p>if ( !DHTML ) alert('Your browser is not capable of displaying DHTML');</p>function getObj(name) {</p>	if (document.getElementById) {</p>		this.obj = document.getElementById(name);</p>		this.style = document.getElementById(name).style;</p>	} else</p>	if (document.all) {</p>		this.obj = document.all[name];</p>		this.style = document.all[name].style;</p>	} else</p>	if (document.layers) {</p>		this.obj = document.layers[name];</p>		this.style = document.layers[name];</p>	}</p>}</p><p>function visib(objName, flag) { // triggers layer visibility</p>	x = new getObj(objName);</p>	x.style.visibility = (flag) ? 'visible' : 'hidden';</p>}</p></pre></p><p><p>These are basic DHTML functions that I use for the slideshow. Actually I took them from</p><a href="http://www.xs4all.nl/~ppk/js/" target="_blank">www.xs4all.nl/~ppk/js/</a></p>I consider them self explaining, but for all of you who never had a chance to get involved with DHTML:</p></p><p><ul></p><li>First we test for DHTML support( i.e. DOM1: the getElementById method, IE 4 the document.all collection,</p>NN 4 the document.layers array). If there is such a method/array its toBoolean converted result</p>is true otherwise it is false, and if all evaluate to false that means that the browser does not support DHTML.</p><li>Having the DHTML variable, described above we check if the browser does not support DHTML,</p>and if this is so we inform the users that their browser won't show the slideshow properly.</p><li>The <code>getObj</code> function is used to handle that browser incompatibilities in a way that</p>won't get the hell out of you just to write a DHTML cross-browser code. What it does is to check</p>what DOM is supported and according to the result create an object and stuff its <code>obj</code></p>and <code>style</code> properties with references to the style rules applied to the layer, and its</p>HTML properties too.</p><li>The <code>visib</code> function triggers the visibility of a layer and is used basicly to ease the</p>programmer not having to call the <code>getObj</code> function by humself.</p></ul></p><p><p>Only to note that in NN 4 if you want to get a reference to a sublayer you have to use</p><code>document.layers['parentLayer'].document.layers['subLayer']</code> instead of the easier</p>non-changing way of the other browsers.</p></p><p><pre></p>slides = new Array( // The id's of the slides</p>	'slide0',</p>	'slide1',</p>	'slide2',</p>	'slide3',</p>	'slide4',</p>	'slide5',</p>	'slide6',</p>	'slide7');</p><p>var fadeOn = false;</p>function setFade(switchFade) {// Fade switch function</p>	if ( !fadeOn ) {</p>		prepLyr(slides[curImg], true);</p>		} else { // No fade</p>		stopFade();</p>		for ( var i = 0; i &lt; 8; i++ ) {</p>			prepLyr(slides[i], true);</p>			if ( slides[i] != slides[curImg] )</p>				visib(slides[i], false);</p>		}</p>	}</p>	fadeOn = switchFade;</p>}</p></pre></p><p><p>First create an array of the id's of the slides, later used when switching from one image to another.</p>The <code>setFade()</code> function is used to trigger fading effects on/off( initially no fading is set).</p>The function uses some of the other functions to change the layers settings in a way that is sensible for the</p>fade or no fade slideshow.</p></p><p><pre></p>var curImg = 0; // index of the array entry</p>var lastImg = 0;</p>function changeSlide ( change ) {</p>	if (!DHTML) return;</p>	curImg += change;</p>	if ( curImg &lt; 0 ) curImg = slides.length-1;</p>	else</p>		if ( curImg &gt;= slides.length ) curImg = 0;</p>	if ( fadeOn ) {</p>		firstFade = true;</p>		prepLyr(slides[lastImg], true );</p>		fadeLayer(slides[lastImg], 10, 50);</p>	} else {</p>		visib(slides[lastImg], false);</p>		visib(slides[curImg], true);</p>	}</p>	lastImg = curImg;</p>}</p></pre></p><p><p>This is the function that I use to change the current slide displayed. I no fade is set it only hides the</p>previous image and shows the next one, otherwise it sets the firstFade variable to true, which is required</p>to determine wheter after the fade a next one should be invoked. Then the layers clipping is set to no-clipping</p>by the prepLayer function( the true parameter), and the fadeLayer function executed sets the global variables</p>which are later used by the realFade function.</p></p><p><pre></p>var clipTop, clipWidth, clipBottom, lyrheight;</p>var time,amount,theTime,middle;</p>var slideSize = new Array()</p><p>function prepLyr(lyr, vis) {</p>	if (!DHTML) return;</p>	x = new getObj( lyr );</p>	if (document.layers) {</p>		if ( !slideSize[lyr] ) {</p>			lyrheight = x.style.clip.bottom;</p>			clipWidth = x.style.clip.right;</p>			slideSize[lyr] = lyrheight + 'x' + clipWidth;</p>		} else {</p>			lyrheight = parseInt(slideSize[lyr]);</p>			clipWidth = slideSize[lyr].substr(slideSize[lyr].indexOf('x')+1);</p>		}</p>		if ( vis ) {</p>			clipTop = 0;</p>			middle = Math.round(lyrheight/2);</p>			clipBottom = lyrheight;</p>		} else {</p>			middle = Math.round(lyrheight/2);</p>			clipBottom = middle;</p>			clipTop = middle;</p>		}</p>		x.style.clip.top = clipTop;</p>		x.style.clip.left = 0;</p>		x.style.clip.right = clipWidth;</p>		x.style.clip.bottom = clipBottom;</p>		x.style.visibility = 'show';</p>	} else</p>	if (document.getElementById    document.all) {</p>		lyrheight = x.obj.offsetHeight;</p>		clipWidth = x.obj.offsetWidth;</p>		if ( vis ) {</p>			clipTop = 0;</p>			middle = Math.round(lyrheight/2);</p>			clipBottom = lyrheight;</p>		} else {</p>			middle = Math.round(lyrheight/2);</p>			clipBottom = middle;</p>			clipTop = middle;</p>		}</p>		x.style.clip = 'rect('+clipTop+' '+clipWidth+' '+ clipBottom +' 0)';</p>		visib(lyr, true);</p>	}</p>}</p></pre></p><p>First declaration of the global variables. The prepLyr function first tests the global variable</p>DHTML wheter to be executes or not. Then it creates object x which refers to the layer manipulated, when it</p>comes to the hard part of it. This is where there is no way to write a code that will be executed on all browsers,</p>and especially great problems with NN 4 (not wondering). I use the fact that arrays in JavaScript can have</p>string indices, not only numbers to determine whether this layer's size has been determined before.</p>If not set the <code>lyrheight</code> to the clipping area's bottom (which should mean the image's height),</p>and the <code>clipWidth</code> to the image width. Then create an array entry with that data, because if you</p>don't do so NN 4 will get a constanlty reducing image size for your slides until they cannot be much longer</p>visible. If the images has been shown before it justs reads the array entry to get these values.</p>Then it is time to test the <code>vis</code> parameter which tells us whether the image should be faded in or</p>faded out. When fading in we initially set the clippig area's top and bottom to be the middle of the image,</p>otherwise the are the top and bottom coordinates respectively.</p></p><p><p>When all these calculations have been made we actually apply the settings to the layer, in NN 4 it is</p>through the <code>clip.top/right/bottom/left</code> properties and set it's <code>visibility</code> to</p><code>show</code>( Netscape's proprietary value).</p></p><p><p>Then we have finished NN 4 code and we check for DOM 1 or IE 4 support. The task is easier here because</p>no matter what clipping set we can always get the image height/width. Then we make the same test for fade in or</p>fade out, and at the end apply the settings as a string to the clip property.</p></p><p><p>Actually I first made a version of the slideshow with the units specified( px), but I didn't like it at all</p>because I couldn't get it to work in NN 4 and Opera 5. Then I found this</p><a href="http://www.xs4all.nl/~ppk/js/layerscroll.html" target="_blank">layer scroll</a> script,</p>and I got the idea of the compatibility and decided to make a version in which the fading can be swiched off.</p>The thing is that the browser assume the pixels as default measure units, and I can't really tell you whether</p>you should specify them.</p></p><p><pre></p>function fadeLayer(layername, amt, tim) {</p>	if (!DHTML) return;</p>	thelayer = new getObj( layername );</p>	if (!thelayer) return;</p>	amount = amt;</p>	theTime = tim;</p>	realFade();</p>}</p><p>function stopFade() {</p>	if (time) clearTimeout(time);</p>}</p></pre></p><p><p>The <code>fadeLayer</code> function is used just to set the global variables to the parameters passed to it</p>and then invoke the <code>realFade</code> function to do the hard work.</p></p><p><p>The only thing that the <code>stopFade</code> function does is that it checks the timer ID and if the timer</p>is running it stops it.</p></p><p><pre></p>function realFade() {</p>	clipTop += amount;</p>	clipBottom -= amount;</p>	if (clipTop &lt; 0    clipBottom &gt; lyrheight    clipTop &gt; middle) {</p>		if ( clipTop &gt; middle ) thelayer.style.visibility = 'hidden';</p>		if ( firstFade ) nextFade();</p>		return;</p>	}</p>	if (document.getElementById    document.all) {</p>		clipstring = 'rect('+clipTop+' '+clipWidth+' '+clipBottom+' 0)'</p>		thelayer.style.clip = clipstring;</p>	}	else</p>	if (document.layers) {</p>		thelayer.style.clip.top = clipTop;</p>		thelayer.style.clip.bottom = clipBottom;</p>	}</p>	time = setTimeout('realFade()',theTime);</p>}</p><p>var firstFade = true;</p>function nextFade() {</p>	firstFade = false;</p>	prepLyr(slides[curImg], false);</p>	fadeLayer(slides[curImg], -10, 50);</p>}</p></pre></p><p>The <code>realFade</code> function adds the amount to the clipTop and subtracts it from the clipBottom.</p>Then we check whether the clipping is off the image, if it is we check whether it is fade out. When fade</p>out we hide the slide, otherwise sometimes there are stripes that stay visible and distract the whole</p>slideshow. If the <code>firstFade</code> variable is true we execute the <code>nextFade</code> function which</p>fades in the next slide. In both case of fading we end the function, preventing the setTimeout invokation</p>which would result in an infinite loop. The next thing to do is to actually apply the calculated clipping</p>area to the layer, there are differences in the DOM 1 / IE 4 way and the NN 4 (described above in the</p><code>prepLyr</code> function explanation). Afterwards we set a timeout that executes the same function again.</p></p><p><p>The <code>nextFade</code> function then sets the <code>fisrtFade</code> variable to false, to prevent</p>looping the fading in effect and invokes the <code>prepLyr</code> function with parameters the next slide and</p>false to initialize the image to fade in( clipping top and bottom to the middle). The <code>realFade</code></p>function is then invoked, passing it the current slide, a change amount of -10 pixels, which means that the</p>clipping area should get bigger, and a delay of 50 miliseconds to widen the area.</p>