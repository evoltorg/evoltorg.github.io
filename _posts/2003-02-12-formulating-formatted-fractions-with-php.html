---
layout: post
permalink: node/55140
ratings: 3
avgrate: 3.3333
category: Code
user: hal
real_name: "Hal Eckhart"
user_since: 01 Feb 2003
avatar: ""
article_count: 1
excerpt: "This shows a way to present an unknown list of numbers sorted, collated, and formatted to the nearest 1/16, using PHP."
---
<h2>I had this idea...</h2></p><p></p>As a maker of things, and a beginner starting to monkey with <a href="http://www.php.net/" target="_blank" title="definition">PHP</a>, I began to wonder what its usefulness might be for constructing a "practical" application. That is, one that has a use in the real world, for something tangible, rather than as a system for building on-line shopping cart worlds and elaborately confusing web pages. PHP has a lot of tools available to it, including the stunningly useful image creation library <a href="http://www.boutell.com/gd/" target="_blank" title="define me">GD</a>, as well as a pretty nice bunch of <a href="http://www.php.net/manual/en/ref.math.php" target="_blank" title="here's another definition">math</a> functions. It sounded promising.</p></p></p><p><h2>The real world intrudes</h2></p><p><p></p>One stumbling block that I immediately ran afoul of was fractions. Anything built in the good old US of A that doesn't add up to a whole number of inches is almost always calculated with the sadistically archaic British invention of fractional inches. (Note here that the British have long since abandoned this silliness in favour of the much more sensible metric system).</p></p></p><p><p></p>Searching for fractions on several PHP oriented tech sites left me with almost nothing useful, so I couldn't follow my usual method of just stealing somebody else's ideas. Either this is not a subject that regular geeks find interesting, or I'm breaking new ground. Or wind. Either way, and despite being a little intimidated by the technology, the solution was easier than I'd imagined. </p></p></p><p><h2>Cosmic alignment</h2></p><p><p></p>Another part of the puzzle was alignment of numbers. And if you're going to generate random numbers, it would be awfully useful to line them up properly. Since <code> align=&quot;char&quot; </code> doesn't seem to work yet in HTML, it seems necessary to use tables (egad!) to make numbers align properly. Since we have to break down the numbers anyway to extract the fractions, this doesn't turn out to be any more work at all. </p></p></p><p><h2>The Code</h2></p><p><p></p>Since any further explanation by me will probably be less enlightening than just reading the code and messing with it, I will leave you to do that. With any luck, the following will generate a dynamically sized table with aligned fractions from an array of random numbers. Since I don't care about fractions less than 1/16, this rounds them into oblivion. Also, it sorts the list from long to short and collates multiples in the array. One bit of cleverness here that might not be obvious: I'm using <em>"1 <a href="http://www.php.net/manual/en/language.operators.bitwise.php" target="_blank" title="a defining moment">bitwise and</a>"</em> <code>(1 &)</code> to determine odd numbers. If you don't have a good head for math (like me) that might take a moment to sink in. Think <a href="http://dictionary.reference.com/search?q=binary%20arithmetic" target="_blank" title="ooh, now this is really a definition">binary</a>. If you copy and paste this code, try refreshing the page a few times to see how the table adjusts itself. </p></p></p><p><pre></p>&lt;?php</p><p>// get some numbers to play with</p><p>$x = rand(0, 130000)/10;</p>$y = rand(0, 1200);</p>$z = rand(0, 4)/64;</p>$array = array($x, $x, $x, $y, $y, $z, sqrt(2), pi(), pi());</p><p>// functions</p><p>function mult($n) { return intval (round ($n*16)); }</p><p>function frac($num) { $mod = fmod ($num, 1)*16; </p>if (1 &amp; $mod) { return " - ".$mod."/16"; } </p>else $mod = $mod/2;</p>if (1 &amp; $mod) { return " - ".$mod."/8"; }</p>else $mod = $mod/2;</p>if (1 &amp; $mod) { return " - ".$mod."/4"; }</p>else $mod = $mod/2;</p>if (1 &amp; $mod) { return " - ".$mod."/2"; }</p>}</p><p>// make a table</p><p>echo '&lt;table&gt;';</p>$array = array_map("mult", $array);</p>$array = (array_filter($array, strval)); //get rid of zeros</p>$array = (array_count_values ($array));</p>krsort ($array);</p>while (list ($key, $val) = each ($array)) </p>{</p>$key = $key/16;</p>echo "&lt;tr&gt;&lt;td&gt;$val&lt;/td&gt;</p>	&lt;td&gt;&amp;nbsp; @ &amp;nbsp;&lt;/td&gt;</p>	&lt;td align=\"right\"&gt;".intval($key)." &lt;/td&gt;</p>	&lt;td&gt; ".frac($key)." &lt;/td&gt;&lt;/tr&gt;";</p>}</p>echo '&lt;/table&gt;';</p><p>?&gt;</p></pre></p><p><h2>Example Output</h2></p><p><table><tr><td>3</td></p>	<td>&nbsp; @ &nbsp;</td></p>	<td align="right">10241 </td></p>	<td>  - 5/8 </td></tr><tr><td>2</td></p>	<td>&nbsp; @ &nbsp;</td></p>	<td align="right">1062 </td></p>	<td>  </td></tr><tr><td>2</td></p>	<td>&nbsp; @ &nbsp;</td></p>	<td align="right">3 </td></p>	<td>  - 1/8 </td></tr><tr><td>1</td></p>	<td>&nbsp; @ &nbsp;</td></p>	<td align="right">1 </td></p>	<td>  - 7/16 </td></tr><tr><td>1</td></p>	<td>&nbsp; @ &nbsp;</td></p>	<td align="right">0 </td></p>	<td>  - 1/16 </td></tr></table></p><p></p><p></p>Happy hacking!</p></p>