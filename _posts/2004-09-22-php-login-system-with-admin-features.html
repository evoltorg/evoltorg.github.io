---
layout: post
permalink: PHP-Login-System-with-Admin-Features
---
<h2>Introduction</h2>\n<p>\nI wrote the popular evolt.org tutorial <a href="/article/comment/17/60265/index.html">PHP Login Script with Remember Me Feature</a> mainly as an introduction to user sessions and cookies in PHP. Since it was created as a learning tool, many advanced features were left out of the script. By popular demand, I have written and am presenting here a complete Login System, with all the features that were left out of the first script, that can be easily integrated into any website. \n</p></p><p><h3>Notes</h3>\n<p>\nThis article is intended primarily for intermediate to advanced users of PHP, as it is not exactly a tutorial, but a description of the implementation of an advanced Login System. Beginners who are looking to learn about user session and cookies in PHP are advised to read the above mentioned tutorial before reading this article.\n</p></p><p><h2>Features</h2>\n<p>\nHere are some of the features in this Login System that weren't included in the initial tutorial:</p>\n<ul>\n<li><strong>Better Security</strong> - Passwords are not stored in cookies, randomly generated ids take their place.</li>\n<li><strong>Member Levels</strong> - Now users can be differentiated by what level they are (user, admin, etc.)</li>\n<li><strong>Admin Center</strong> - As an admin, you have full control over registered users. You can view user info, upgrade/demote user levels, delete users, delete inactive users, and ban users.</li>\n<li><strong>Visitor Tracking</strong> - You can now tell how many guests and users are actively viewing your site, and who those users are. You also know how many total members your site has.</li>\n<li><strong>Account Info</strong> - Users can now view their own\ninformation, and edit it as well. They can also see the information of\nother users.</li>\n<li><strong>Form Helper</strong> - No more ugly error pages! Now users are redirected to the form they filled out and the errors that have occurred are displayed.</li>\n<li><strong>Forgot Password</strong> - Users who forget their password can have a new one generated for them and sent to their email address.</li>\n<li><strong>Email</strong> - Now emails can be sent to newly registered users.</li>\n<li><strong>Miscellaneous</strong> - Much better code design, smooth page transitions, and MORE!</li>\n</ul></p><p>\n<h2>Database</h2>\n<p>\nAll the tables needed for the Login System are written in the file dbtables.sql. You can look at the file and create each table manually or you can just run the file with mysql and it will create all the necessary tables automatically.\n</p>\n<h3>dbtables.sql</h3>\n<pre>\n#\n#  dbtables.sql\n#\n#  Simplifies the task of creating all the database tables\n#  used by the login system.\n#\n#  Can be run from command prompt by typing:\n#\n#  mysql -u yourusername -D yourdatabasename < dbtables.sql\n#\n#  That's with dbtables.sql in the mysql bin directory, but\n#  you can just include the path to dbtables.sql and that's\n#  fine too.\n#\n#  Written by: Jpmaster77 a.k.a. The Grandmaster of C++ (GMC)\n#  Last Updated: August 13, 2004\n#</p><p>#\n#  Table structure for users table\n#\nDROP TABLE IF EXISTS users;</p><p>CREATE TABLE users (\n username varchar(30) primary key,\n password varchar(32),\n userid varchar(32),\n userlevel tinyint(1) unsigned not null,\n email varchar(50),\n timestamp int(11) unsigned not null\n);</p><p>\n#\n#  Table structure for active users table\n#\nDROP TABLE IF EXISTS active_users;</p><p>CREATE TABLE active_users (\n username varchar(30) primary key,\n timestamp int(11) unsigned not null\n);</p><p>\n#\n#  Table structure for active guests table\n#\nDROP TABLE IF EXISTS active_guests;</p><p>CREATE TABLE active_guests (\n ip varchar(15) primary key,\n timestamp int(11) unsigned not null\n);</p><p>\n#\n#  Table structure for banned users table\n#\nDROP TABLE IF EXISTS banned_users;</p><p>CREATE TABLE banned_users (\n username varchar(30) primary key,\n timestamp int(11) unsigned not null\n);\n</pre></p><p><h2>Code Design</h2>\n<p>I will be presenting the Login System by showing only the important files, describing what they do and how they interact with each other. By reading this you should get a good idea of how the Login System works and understand how to integrate it into your website. It is important to note before you start that the code relies on classes and the key variables of this Login System are class objects.</p></p><p><h3>constants.php</h3>\n<p>\nThis file will contain all the constants and important information used by the login system. Here you specify stuff like your database username and password, the admin account name (which will be able to create other admins), visitor timeouts, email options, etc.\n</p></p><p><pre>\n&lt;?\n/**\n * Constants.php\n *\n * This file is intended to group all constants to\n * make it easier for the site administrator to tweak\n * the login script.\n *\n * Written by: Jpmaster77 a.k.a. The Grandmaster of C++ (GMC)\n * Last Updated: August 19, 2004\n */\n \n/**\n * Database Constants - these constants are required\n * in order for there to be a successful connection\n * to the MySQL database. Make sure the information is\n * correct.\n */\ndefine(&quot;DB_SERVER&quot;, &quot;localhost&quot;);\ndefine(&quot;DB_USER&quot;, &quot;your_name&quot;);\ndefine(&quot;DB_PASS&quot;, &quot;your_pass&quot;);\ndefine(&quot;DB_NAME&quot;, &quot;your_dbname&quot;);</p><p>/**\n * Database Table Constants - these constants\n * hold the names of all the database tables used\n * in the script.\n */\ndefine(&quot;TBL_USERS&quot;, &quot;users&quot;);\ndefine(&quot;TBL_ACTIVE_USERS&quot;,  &quot;active_users&quot;);\ndefine(&quot;TBL_ACTIVE_GUESTS&quot;, &quot;active_guests&quot;);\ndefine(&quot;TBL_BANNED_USERS&quot;,  &quot;banned_users&quot;);</p><p>/**\n * Special Names and Level Constants - the admin\n * page will only be accessible to the user with\n * the admin name and also to those users at the\n * admin user level. Feel free to change the names\n * and level constants as you see fit, you may\n * also add additional level specifications.\n * Levels must be digits between 0-9.\n */\ndefine(&quot;ADMIN_NAME&quot;, &quot;admin&quot;);\ndefine(&quot;GUEST_NAME&quot;, &quot;Guest&quot;);\ndefine(&quot;ADMIN_LEVEL&quot;, 9);\ndefine(&quot;USER_LEVEL&quot;,  1);\ndefine(&quot;GUEST_LEVEL&quot;, 0);</p><p>/**\n * This boolean constant controls whether or\n * not the script keeps track of active users\n * and active guests who are visiting the site.\n */\ndefine(&quot;TRACK_VISITORS&quot;, true);</p><p>/**\n * Timeout Constants - these constants refer to\n * the maximum amount of time (in minutes) after\n * their last page fresh that a user and guest\n * are still considered active visitors.\n */\ndefine(&quot;USER_TIMEOUT&quot;, 10);\ndefine(&quot;GUEST_TIMEOUT&quot;, 5);</p><p>/**\n * Cookie Constants - these are the parameters\n * to the setcookie function call, change them\n * if necessary to fit your website. If you need\n * help, visit www.php.net for more info.\n * &lt;http://www.php.net/manual/en/function.setcookie.php&gt;\n */\ndefine(&quot;COOKIE_EXPIRE&quot;, 60*60*24*100);  //100 days by default\ndefine(&quot;COOKIE_PATH&quot;, &quot;/&quot;);  //Available in whole domain</p><p>/**\n * Email Constants - these specify what goes in\n * the from field in the emails that the script\n * sends to users, and whether to send a\n * welcome email to newly registered users.\n */\ndefine(&quot;EMAIL_FROM_NAME&quot;, &quot;YourName&quot;);\ndefine(&quot;EMAIL_FROM_ADDR&quot;, &quot;youremail@address.com&quot;);\ndefine(&quot;EMAIL_WELCOME&quot;, false);</p><p>/**\n * This constant forces all users to have\n * lowercase usernames, capital letters are\n * converted automatically.\n */\ndefine(&quot;ALL_LOWERCASE&quot;, false);\n?&gt;\n</pre></p><p><h3>database.php</h3>\n<p>\nThis file contains all the functions that perform database operations, like adding new users to the database table, verifying username and password, retrieving user info, deleting users, etc. It also makes the initial connection to the MySQL database. The functions are members of the Database class, which means they can only be called through a variable of that class. At the end of the file, the <code>$database</code> variable is defined, which is the class object that gets used throughout the Login System.\n</p>\n<pre>\n&lt;?\n/**\n * Database.php\n * \n * The Database class is meant to simplify the task of accessing\n * information from the website's database.\n *\n * Written by: Jpmaster77 a.k.a. The Grandmaster of C++ (GMC)\n * Last Updated: August 17, 2004\n */\ninclude(&quot;constants.php&quot;);\n      \nclass MySQLDB\n{\n   var $connection;         //The MySQL database connection\n   var $num_active_users;   //Number of active users viewing site\n   var $num_active_guests;  //Number of active guests viewing site\n   var $num_members;        //Number of signed-up users\n   /* Note: call getNumMembers() to access $num_members! */</p><p>   /* Class constructor */\n   function MySQLDB(){\n      /* Make connection to database */\n      $this-&gt;connection = mysql_connect(DB_SERVER, DB_USER, DB_PASS) or die(mysql_error());\n      mysql_select_db(DB_NAME, $this-&gt;connection) or die(mysql_error());\n      \n      /**\n       * Only query database to find out number of members\n       * when getNumMembers() is called for the first time,\n       * until then, default value set.\n       */\n      $this-&gt;num_members = -1;\n      \n      if(TRACK_VISITORS){\n         /* Calculate number of users at site */\n         $this-&gt;calcNumActiveUsers();\n      \n         /* Calculate number of guests at site */\n         $this-&gt;calcNumActiveGuests();\n      }\n   }</p><p>   /**\n    * confirmUserPass - Checks whether or not the given\n    * username is in the database, if so it checks if the\n    * given password is the same password in the database\n    * for that user. If the user doesn't exist or if the\n    * passwords don't match up, it returns an error code\n    * (1 or 2). On success it returns 0.\n    */\n   function confirmUserPass($username, $password){\n      /* Add slashes if necessary (for query) */\n      if(!get_magic_quotes_gpc()) {\n	      $username = addslashes($username);\n      }</p><p>      /* Verify that user is in database */\n      $q = &quot;SELECT password FROM &quot;.TBL_USERS.&quot; WHERE username = '$username'&quot;;\n      $result = mysql_query($q, $this-&gt;connection);\n      if(!$result    (mysql_numrows($result) &lt; 1)){\n         return 1; //Indicates username failure\n      }</p><p>      /* Retrieve password from result, strip slashes */\n      $dbarray = mysql_fetch_array($result);\n      $dbarray['password'] = stripslashes($dbarray['password']);\n      $password = stripslashes($password);</p><p>      /* Validate that password is correct */\n      if($password == $dbarray['password']){\n         return 0; //Success! Username and password confirmed\n      }\n      else{\n         return 2; //Indicates password failure\n      }\n   }\n   \n   /**\n    * confirmUserID - Checks whether or not the given\n    * username is in the database, if so it checks if the\n    * given userid is the same userid in the database\n    * for that user. If the user doesn't exist or if the\n    * userids don't match up, it returns an error code\n    * (1 or 2). On success it returns 0.\n    */\n   function confirmUserID($username, $userid){\n      /* Add slashes if necessary (for query) */\n      if(!get_magic_quotes_gpc()) {\n	      $username = addslashes($username);\n      }</p><p>      /* Verify that user is in database */\n      $q = &quot;SELECT userid FROM &quot;.TBL_USERS.&quot; WHERE username = '$username'&quot;;\n      $result = mysql_query($q, $this-&gt;connection);\n      if(!$result    (mysql_numrows($result) &lt; 1)){\n         return 1; //Indicates username failure\n      }</p><p>      /* Retrieve userid from result, strip slashes */\n      $dbarray = mysql_fetch_array($result);\n      $dbarray['userid'] = stripslashes($dbarray['userid']);\n      $userid = stripslashes($userid);</p><p>      /* Validate that userid is correct */\n      if($userid == $dbarray['userid']){\n         return 0; //Success! Username and userid confirmed\n      }\n      else{\n         return 2; //Indicates userid invalid\n      }\n   }\n   \n   /**\n    * usernameTaken - Returns true if the username has\n    * been taken by another user, false otherwise.\n    */\n   function usernameTaken($username){\n      if(!get_magic_quotes_gpc()){\n         $username = addslashes($username);\n      }\n      $q = &quot;SELECT username FROM &quot;.TBL_USERS.&quot; WHERE username = '$username'&quot;;\n      $result = mysql_query($q, $this-&gt;connection);\n      return (mysql_numrows($result) &gt; 0);\n   }\n   \n   /**\n    * usernameBanned - Returns true if the username has\n    * been banned by the administrator.\n    */\n   function usernameBanned($username){\n      if(!get_magic_quotes_gpc()){\n         $username = addslashes($username);\n      }\n      $q = &quot;SELECT username FROM &quot;.TBL_BANNED_USERS.&quot; WHERE username = '$username'&quot;;\n      $result = mysql_query($q, $this-&gt;connection);\n      return (mysql_numrows($result) &gt; 0);\n   }\n   \n   /**\n    * addNewUser - Inserts the given (username, password, email)\n    * info into the database. Appropriate user level is set.\n    * Returns true on success, false otherwise.\n    */\n   function addNewUser($username, $password, $email){\n      $time = time();\n      /* If admin sign up, give admin user level */\n      if(strcasecmp($username, ADMIN_NAME) == 0){\n         $ulevel = ADMIN_LEVEL;\n      }else{\n         $ulevel = USER_LEVEL;\n      }\n      $q = &quot;INSERT INTO &quot;.TBL_USERS.&quot; VALUES ('$username', '$password', '0', $ulevel, '$email', $time)&quot;;\n      return mysql_query($q, $this-&gt;connection);\n   }\n   \n   /**\n    * updateUserField - Updates a field, specified by the field\n    * parameter, in the user's row of the database.\n    */\n   function updateUserField($username, $field, $value){\n      $q = &quot;UPDATE &quot;.TBL_USERS.&quot; SET &quot;.$field.&quot; = '$value' WHERE username = '$username'&quot;;\n      return mysql_query($q, $this-&gt;connection);\n   }\n   \n   /**\n    * getUserInfo - Returns the result array from a mysql\n    * query asking for all information stored regarding\n    * the given username. If query fails, NULL is returned.\n    */\n   function getUserInfo($username){\n      $q = &quot;SELECT * FROM &quot;.TBL_USERS.&quot; WHERE username = '$username'&quot;;\n      $result = mysql_query($q, $this-&gt;connection);\n      /* Error occurred, return given name by default */\n      if(!$result    (mysql_numrows($result) &lt; 1)){\n         return NULL;\n      }\n      /* Return result array */\n      $dbarray = mysql_fetch_array($result);\n      return $dbarray;\n   }\n   \n   /**\n    * getNumMembers - Returns the number of signed-up users\n    * of the website, banned members not included. The first\n    * time the function is called on page load, the database\n    * is queried, on subsequent calls, the stored result\n    * is returned. This is to improve efficiency, effectively\n    * not querying the database when no call is made.\n    */\n   function getNumMembers(){\n      if($this-&gt;num_members &lt; 0){\n         $q = &quot;SELECT * FROM &quot;.TBL_USERS;\n         $result = mysql_query($q, $this-&gt;connection);\n         $this-&gt;num_members = mysql_numrows($result);\n      }\n      return $this-&gt;num_members;\n   }\n   \n   /**\n    * calcNumActiveUsers - Finds out how many active users\n    * are viewing site and sets class variable accordingly.\n    */\n   function calcNumActiveUsers(){\n      /* Calculate number of users at site */\n      $q = &quot;SELECT * FROM &quot;.TBL_ACTIVE_USERS;\n      $result = mysql_query($q, $this-&gt;connection);\n      $this-&gt;num_active_users = mysql_numrows($result);\n   }\n   \n   /**\n    * calcNumActiveGuests - Finds out how many active guests\n    * are viewing site and sets class variable accordingly.\n    */\n   function calcNumActiveGuests(){\n      /* Calculate number of guests at site */\n      $q = &quot;SELECT * FROM &quot;.TBL_ACTIVE_GUESTS;\n      $result = mysql_query($q, $this-&gt;connection);\n      $this-&gt;num_active_guests = mysql_numrows($result);\n   }\n   \n   /**\n    * addActiveUser - Updates username's last active timestamp\n    * in the database, and also adds him to the table of\n    * active users, or updates timestamp if already there.\n    */\n   function addActiveUser($username, $time){\n      $q = &quot;UPDATE &quot;.TBL_USERS.&quot; SET timestamp = '$time' WHERE username = '$username'&quot;;\n      mysql_query($q, $this-&gt;connection);\n      \n      if(!TRACK_VISITORS) return;\n      $q = &quot;REPLACE INTO &quot;.TBL_ACTIVE_USERS.&quot; VALUES ('$username', '$time')&quot;;\n      mysql_query($q, $this-&gt;connection);\n      $this-&gt;calcNumActiveUsers();\n   }\n   \n   /* addActiveGuest - Adds guest to active guests table */\n   function addActiveGuest($ip, $time){\n      if(!TRACK_VISITORS) return;\n      $q = &quot;REPLACE INTO &quot;.TBL_ACTIVE_GUESTS.&quot; VALUES ('$ip', '$time')&quot;;\n      mysql_query($q, $this-&gt;connection);\n      $this-&gt;calcNumActiveGuests();\n   }\n   \n   /* These functions are self explanatory, no need for comments */\n   \n   /* removeActiveUser */\n   function removeActiveUser($username){\n      if(!TRACK_VISITORS) return;\n      $q = &quot;DELETE FROM &quot;.TBL_ACTIVE_USERS.&quot; WHERE username = '$username'&quot;;\n      mysql_query($q, $this-&gt;connection);\n      $this-&gt;calcNumActiveUsers();\n   }\n   \n   /* removeActiveGuest */\n   function removeActiveGuest($ip){\n      if(!TRACK_VISITORS) return;\n      $q = &quot;DELETE FROM &quot;.TBL_ACTIVE_GUESTS.&quot; WHERE ip = '$ip'&quot;;\n      mysql_query($q, $this-&gt;connection);\n      $this-&gt;calcNumActiveGuests();\n   }\n   \n   /* removeInactiveUsers */\n   function removeInactiveUsers(){\n      if(!TRACK_VISITORS) return;\n      $timeout = time()-USER_TIMEOUT*60;\n      $q = &quot;DELETE FROM &quot;.TBL_ACTIVE_USERS.&quot; WHERE timestamp &lt; $timeout&quot;;\n      mysql_query($q, $this-&gt;connection);\n      $this-&gt;calcNumActiveUsers();\n   }</p><p>   /* removeInactiveGuests */\n   function removeInactiveGuests(){\n      if(!TRACK_VISITORS) return;\n      $timeout = time()-GUEST_TIMEOUT*60;\n      $q = &quot;DELETE FROM &quot;.TBL_ACTIVE_GUESTS.&quot; WHERE timestamp &lt; $timeout&quot;;\n      mysql_query($q, $this-&gt;connection);\n      $this-&gt;calcNumActiveGuests();\n   }\n   \n   /**\n    * query - Performs the given query on the database and\n    * returns the result, which may be false, true or a\n    * resource identifier.\n    */\n   function query($query){\n      return mysql_query($query, $this-&gt;connection);\n   }\n};</p><p>/* Create database connection */\n$database = new MySQLDB;</p><p>?&gt;\n</pre></p><p><h3>session.php</h3>\n<p>\nThis file is the heart and soul of the Login System. It contains the code to login, logout and register users. It also holds all the information about the user that is viewing the site. All the variables and functions are part of the Session class, and the <code>$session</code> class object variable is created so you can access those variables and functions. You will be using this class object whenever you want to get information about the visitor of your site, like whether or not they are logged in. How to use this object, and others as well, is apparent when looking through the example pages which are given (main.php, userinfo.php, etc.).\n</p>\n<pre>\n&lt;?\n/**\n * Session.php\n * \n * The Session class is meant to simplify the task of keeping\n * track of logged in users and also guests.\n *\n * Written by: Jpmaster77 a.k.a. The Grandmaster of C++ (GMC)\n * Last Updated: August 19, 2004\n */\ninclude(&quot;database.php&quot;);\ninclude(&quot;mailer.php&quot;);\ninclude(&quot;form.php&quot;);</p><p>class Session\n{\n   var $username;     //Username given on sign-up\n   var $userid;       //Random value generated on current login\n   var $userlevel;    //The level to which the user pertains\n   var $time;         //Time user was last active (page loaded)\n   var $logged_in;    //True if user is logged in, false otherwise\n   var $userinfo = array();  //The array holding all user info\n   var $url;          //The page url current being viewed\n   var $referrer;     //Last recorded site page viewed\n   /**\n    * Note: referrer should really only be considered the actual\n    * page referrer in process.php, any other time it may be\n    * inaccurate.\n    */</p><p>   /* Class constructor */\n   function Session(){\n      $this-&gt;time = time();\n      $this-&gt;startSession();\n   }</p><p>   /**\n    * startSession - Performs all the actions necessary to \n    * initialize this session object. Tries to determine if the\n    * the user has logged in already, and sets the variables \n    * accordingly. Also takes advantage of this page load to\n    * update the active visitors tables.\n    */\n   function startSession(){\n      global $database;  //The database connection\n      session_start();   //Tell PHP to start the session</p><p>      /* Determine if user is logged in */\n      $this-&gt;logged_in = $this-&gt;checkLogin();</p><p>      /**\n       * Set guest value to users not logged in, and update\n       * active guests table accordingly.\n       */\n      if(!$this-&gt;logged_in){\n         $this-&gt;username = $_SESSION['username'] = GUEST_NAME;\n         $this-&gt;userlevel = GUEST_LEVEL;\n         $database-&gt;addActiveGuest($_SERVER['REMOTE_ADDR'], $this-&gt;time);\n      }\n      /* Update users last active timestamp */\n      else{\n         $database-&gt;addActiveUser($this-&gt;username, $this-&gt;time);\n      }\n      \n      /* Remove inactive visitors from database */\n      $database-&gt;removeInactiveUsers();\n      $database-&gt;removeInactiveGuests();\n      \n      /* Set referrer page */\n      if(isset($_SESSION['url'])){\n         $this-&gt;referrer = $_SESSION['url'];\n      }else{\n         $this-&gt;referrer = &quot;/&quot;;\n      }</p><p>      /* Set current url */\n      $this-&gt;url = $_SESSION['url'] = $_SERVER['PHP_SELF'];\n   }</p><p>   /**\n    * checkLogin - Checks if the user has already previously\n    * logged in, and a session with the user has already been\n    * established. Also checks to see if user has been remembered.\n    * If so, the database is queried to make sure of the user's \n    * authenticity. Returns true if the user has logged in.\n    */\n   function checkLogin(){\n      global $database;  //The database connection\n      /* Check if user has been remembered */\n      if(isset($_COOKIE['cookname']) && isset($_COOKIE['cookid'])){\n         $this-&gt;username = $_SESSION['username'] = $_COOKIE['cookname'];\n         $this-&gt;userid   = $_SESSION['userid']   = $_COOKIE['cookid'];\n      }</p><p>      /* Username and userid have been set and not guest */\n      if(isset($_SESSION['username']) && isset($_SESSION['userid']) &&\n         $_SESSION['username'] != GUEST_NAME){\n         /* Confirm that username and userid are valid */\n         if($database-&gt;confirmUserID($_SESSION['username'], $_SESSION['userid']) != 0){\n            /* Variables are incorrect, user not logged in */\n            unset($_SESSION['username']);\n            unset($_SESSION['userid']);\n            return false;\n         }</p><p>         /* User is logged in, set class variables */\n         $this-&gt;userinfo  = $database-&gt;getUserInfo($_SESSION['username']);\n         $this-&gt;username  = $this-&gt;userinfo['username'];\n         $this-&gt;userid    = $this-&gt;userinfo['userid'];\n         $this-&gt;userlevel = $this-&gt;userinfo['userlevel'];\n         return true;\n      }\n      /* User not logged in */\n      else{\n         return false;\n      }\n   }</p><p>   /**\n    * login - The user has submitted his username and password\n    * through the login form, this function checks the authenticity\n    * of that information in the database and creates the session.\n    * Effectively logging in the user if all goes well.\n    */\n   function login($subuser, $subpass, $subremember){\n      global $database, $form;  //The database and form object</p><p>      /* Username error checking */\n      $field = &quot;user&quot;;  //Use field name for username\n      if(!$subuser    strlen($subuser = trim($subuser)) == 0){\n         $form-&gt;setError($field, &quot;* Username not entered&quot;);\n      }\n      else{\n         /* Check if username is not alphanumeric */\n         if(!eregi(&quot;^([0-9a-z])*$&quot;, $subuser)){\n            $form-&gt;setError($field, &quot;* Username not alphanumeric&quot;);\n         }\n      }</p><p>      /* Password error checking */\n      $field = &quot;pass&quot;;  //Use field name for password\n      if(!$subpass){\n         $form-&gt;setError($field, &quot;* Password not entered&quot;);\n      }\n      \n      /* Return if form errors exist */\n      if($form-&gt;num_errors &gt; 0){\n         return false;\n      }</p><p>      /* Checks that username is in database and password is correct */\n      $subuser = stripslashes($subuser);\n      $result = $database-&gt;confirmUserPass($subuser, md5($subpass));</p><p>      /* Check error codes */\n      if($result == 1){\n         $field = &quot;user&quot;;\n         $form-&gt;setError($field, &quot;* Username not found&quot;);\n      }\n      else if($result == 2){\n         $field = &quot;pass&quot;;\n         $form-&gt;setError($field, &quot;* Invalid password&quot;);\n      }\n      \n      /* Return if form errors exist */\n      if($form-&gt;num_errors &gt; 0){\n         return false;\n      }</p><p>      /* Username and password correct, register session variables */\n      $this-&gt;userinfo  = $database-&gt;getUserInfo($subuser);\n      $this-&gt;username  = $_SESSION['username'] = $this-&gt;userinfo['username'];\n      $this-&gt;userid    = $_SESSION['userid']   = $this-&gt;generateRandID();\n      $this-&gt;userlevel = $this-&gt;userinfo['userlevel'];\n      \n      /* Insert userid into database and update active users table */\n      $database-&gt;updateUserField($this-&gt;username, &quot;userid&quot;, $this-&gt;userid);\n      $database-&gt;addActiveUser($this-&gt;username, $this-&gt;time);\n      $database-&gt;removeActiveGuest($_SERVER['REMOTE_ADDR']);</p><p>      /**\n       * This is the cool part: the user has requested that we remember that\n       * he's logged in, so we set two cookies. One to hold his username,\n       * and one to hold his random value userid. It expires by the time\n       * specified in constants.php. Now, next time he comes to our site, we will\n       * log him in automatically, but only if he didn't log out before he left.\n       */\n      if($subremember){\n         setcookie(&quot;cookname&quot;, $this-&gt;username, time()+COOKIE_EXPIRE, COOKIE_PATH);\n         setcookie(&quot;cookid&quot;,   $this-&gt;userid,   time()+COOKIE_EXPIRE, COOKIE_PATH);\n      }</p><p>      /* Login completed successfully */\n      return true;\n   }</p><p>   /**\n    * logout - Gets called when the user wants to be logged out of the\n    * website. It deletes any cookies that were stored on the users\n    * computer as a result of him wanting to be remembered, and also\n    * unsets session variables and demotes his user level to guest.\n    */\n   function logout(){\n      global $database;  //The database connection\n      /**\n       * Delete cookies - the time must be in the past,\n       * so just negate what you added when creating the\n       * cookie.\n       */\n      if(isset($_COOKIE['cookname']) && isset($_COOKIE['cookid'])){\n         setcookie(&quot;cookname&quot;, &quot;&quot;, time()-COOKIE_EXPIRE, COOKIE_PATH);\n         setcookie(&quot;cookid&quot;,   &quot;&quot;, time()-COOKIE_EXPIRE, COOKIE_PATH);\n      }</p><p>      /* Unset PHP session variables */\n      unset($_SESSION['username']);\n      unset($_SESSION['userid']);</p><p>      /* Reflect fact that user has logged out */\n      $this-&gt;logged_in = false;\n      \n      /**\n       * Remove from active users table and add to\n       * active guests tables.\n       */\n      $database-&gt;removeActiveUser($this-&gt;username);\n      $database-&gt;addActiveGuest($_SERVER['REMOTE_ADDR'], $this-&gt;time);\n      \n      /* Set user level to guest */\n      $this-&gt;username  = GUEST_NAME;\n      $this-&gt;userlevel = GUEST_LEVEL;\n   }</p><p>   /**\n    * register - Gets called when the user has just submitted the\n    * registration form. Determines if there were any errors with\n    * the entry fields, if so, it records the errors and returns\n    * 1. If no errors were found, it registers the new user and\n    * returns 0. Returns 2 if registration failed.\n    */\n   function register($subuser, $subpass, $subemail){\n      global $database, $form, $mailer;  //The database, form and mailer object\n      \n      /* Username error checking */\n      $field = &quot;user&quot;;  //Use field name for username\n      if(!$subuser    strlen($subuser = trim($subuser)) == 0){\n         $form-&gt;setError($field, &quot;* Username not entered&quot;);\n      }\n      else{\n         /* Spruce up username, check length */\n         $subuser = stripslashes($subuser);\n         if(strlen($subuser) &lt; 5){\n            $form-&gt;setError($field, &quot;* Username below 5 characters&quot;);\n         }\n         else if(strlen($subuser) &gt; 30){\n            $form-&gt;setError($field, &quot;* Username above 30 characters&quot;);\n         }\n         /* Check if username is not alphanumeric */\n         else if(!eregi(&quot;^([0-9a-z])+$&quot;, $subuser)){\n            $form-&gt;setError($field, &quot;* Username not alphanumeric&quot;);\n         }\n         /* Check if username is reserved */\n         else if(strcasecmp($subuser, GUEST_NAME) == 0){\n            $form-&gt;setError($field, &quot;* Username reserved word&quot;);\n         }\n         /* Check if username is already in use */\n         else if($database-&gt;usernameTaken($subuser)){\n            $form-&gt;setError($field, &quot;* Username already in use&quot;);\n         }\n         /* Check if username is banned */\n         else if($database-&gt;usernameBanned($subuser)){\n            $form-&gt;setError($field, &quot;* Username banned&quot;);\n         }\n      }</p><p>      /* Password error checking */\n      $field = &quot;pass&quot;;  //Use field name for password\n      if(!$subpass){\n         $form-&gt;setError($field, &quot;* Password not entered&quot;);\n      }\n      else{\n         /* Spruce up password and check length*/\n         $subpass = stripslashes($subpass);\n         if(strlen($subpass) &lt; 4){\n            $form-&gt;setError($field, &quot;* Password too short&quot;);\n         }\n         /* Check if password is not alphanumeric */\n         else if(!eregi(&quot;^([0-9a-z])+$&quot;, ($subpass = trim($subpass)))){\n            $form-&gt;setError($field, &quot;* Password not alphanumeric&quot;);\n         }\n         /**\n          * Note: I trimmed the password only after I checked the length\n          * because if you fill the password field up with spaces\n          * it looks like a lot more characters than 4, so it looks\n          * kind of stupid to report &quot;password too short&quot;.\n          */\n      }\n      \n      /* Email error checking */\n      $field = &quot;email&quot;;  //Use field name for email\n      if(!$subemail    strlen($subemail = trim($subemail)) == 0){\n         $form-&gt;setError($field, &quot;* Email not entered&quot;);\n      }\n      else{\n         /* Check if valid email address */\n         $regex = &quot;^[_+a-z0-9-]+(\.[_+a-z0-9-]+)*&quot;\n                 .&quot;@[a-z0-9-]+(\.[a-z0-9-]{1,})*&quot;\n                 .&quot;\.([a-z]{2,}){1}$&quot;;\n         if(!eregi($regex,$subemail)){\n            $form-&gt;setError($field, &quot;* Email invalid&quot;);\n         }\n         $subemail = stripslashes($subemail);\n      }</p><p>      /* Errors exist, have user correct them */\n      if($form-&gt;num_errors &gt; 0){\n         return 1;  //Errors with form\n      }\n      /* No errors, add the new account to the */\n      else{\n         if($database-&gt;addNewUser($subuser, md5($subpass), $subemail)){\n            if(EMAIL_WELCOME){\n               $mailer-&gt;sendWelcome($subuser,$subemail,$subpass);\n            }\n            return 0;  //New user added succesfully\n         }else{\n            return 2;  //Registration attempt failed\n         }\n      }\n   }\n   \n   /**\n    * editAccount - Attempts to edit the user's account information\n    * including the password, which it first makes sure is correct\n    * if entered, if so and the new password is in the right\n    * format, the change is made. All other fields are changed\n    * automatically.\n    */\n   function editAccount($subcurpass, $subnewpass, $subemail){\n      global $database, $form;  //The database and form object\n      /* New password entered */\n      if($subnewpass){\n         /* Current Password error checking */\n         $field = &quot;curpass&quot;;  //Use field name for current password\n         if(!$subcurpass){\n            $form-&gt;setError($field, &quot;* Current Password not entered&quot;);\n         }\n         else{\n            /* Check if password too short or is not alphanumeric */\n            $subcurpass = stripslashes($subcurpass);\n            if(strlen($subcurpass) &lt; 4   \n               !eregi(&quot;^([0-9a-z])+$&quot;, ($subcurpass = trim($subcurpass)))){\n               $form-&gt;setError($field, &quot;* Current Password incorrect&quot;);\n            }\n            /* Password entered is incorrect */\n            if($database-&gt;confirmUserPass($this-&gt;username,md5($subcurpass)) != 0){\n               $form-&gt;setError($field, &quot;* Current Password incorrect&quot;);\n            }\n         }\n         \n         /* New Password error checking */\n         $field = &quot;newpass&quot;;  //Use field name for new password\n         /* Spruce up password and check length*/\n         $subpass = stripslashes($subnewpass);\n         if(strlen($subnewpass) &lt; 4){\n            $form-&gt;setError($field, &quot;* New Password too short&quot;);\n         }\n         /* Check if password is not alphanumeric */\n         else if(!eregi(&quot;^([0-9a-z])+$&quot;, ($subnewpass = trim($subnewpass)))){\n            $form-&gt;setError($field, &quot;* New Password not alphanumeric&quot;);\n         }\n      }\n      /* Change password attempted */\n      else if($subcurpass){\n         /* New Password error reporting */\n         $field = &quot;newpass&quot;;  //Use field name for new password\n         $form-&gt;setError($field, &quot;* New Password not entered&quot;);\n      }\n      \n      /* Email error checking */\n      $field = &quot;email&quot;;  //Use field name for email\n      if($subemail && strlen($subemail = trim($subemail)) &gt; 0){\n         /* Check if valid email address */\n         $regex = &quot;^[_+a-z0-9-]+(\.[_+a-z0-9-]+)*&quot;\n                 .&quot;@[a-z0-9-]+(\.[a-z0-9-]{1,})*&quot;\n                 .&quot;\.([a-z]{2,}){1}$&quot;;\n         if(!eregi($regex,$subemail)){\n            $form-&gt;setError($field, &quot;* Email invalid&quot;);\n         }\n         $subemail = stripslashes($subemail);\n      }\n      \n      /* Errors exist, have user correct them */\n      if($form-&gt;num_errors &gt; 0){\n         return false;  //Errors with form\n      }\n      \n      /* Update password since there were no errors */\n      if($subcurpass && $subnewpass){\n         $database-&gt;updateUserField($this-&gt;username,&quot;password&quot;,md5($subnewpass));\n      }\n      \n      /* Change Email */\n      if($subemail){\n         $database-&gt;updateUserField($this-&gt;username,&quot;email&quot;,$subemail);\n      }\n      \n      /* Success! */\n      return true;\n   }\n   \n   /**\n    * isAdmin - Returns true if currently logged in user is\n    * an administrator, false otherwise.\n    */\n   function isAdmin(){\n      return ($this-&gt;userlevel == ADMIN_LEVEL   \n              $this-&gt;username  == ADMIN_NAME);\n   }\n   \n   /**\n    * generateRandID - Generates a string made up of randomized\n    * letters (lower and upper case) and digits and returns\n    * the md5 hash of it to be used as a userid.\n    */\n   function generateRandID(){\n      return md5($this-&gt;generateRandStr(16));\n   }\n   \n   /**\n    * generateRandStr - Generates a string made up of randomized\n    * letters (lower and upper case) and digits, the length\n    * is a specified parameter.\n    */\n   function generateRandStr($length){\n      $randstr = &quot;&quot;;\n      for($i=0; $i&lt;$length; $i++){\n         $randnum = mt_rand(0,61);\n         if($randnum &lt; 10){\n            $randstr .= chr($randnum+48);\n         }else if($randnum &lt; 36){\n            $randstr .= chr($randnum+55);\n         }else{\n            $randstr .= chr($randnum+61);\n         }\n      }\n      return $randstr;\n   }\n};</p><p>\n/**\n * Initialize session object - This must be initialized before\n * the form object because the form uses session variables,\n * which cannot be accessed unless the session has started.\n */\n$session = new Session;</p><p>/* Initialize form object */\n$form = new Form;</p><p>?&gt;\n</pre></p><p><p>\nRead through the code and get a feel for how the script knows when the users are logged in or not (checks cookies and $_SESSION variables). Everything is commented so you won't have trouble. Note that the Session functions make good use of the <code>$database</code> object because the database needs to be queried for a lot of functions. Visitor tracking is also being done here. Whenever this page loads, the visitor is added as an active guest or active user, depending on if they are logged in or not, and it also performs the operation to remove any inactive users/guests (people who haven't loaded any pages within the timeout specified in constants.php).\n</p></p><p><h3>Forms</h3>\n<p>\nThe creation of a Form class was meant to facilitate the handling of errors with user-submitted forms. It keeps track of what the user entered into the form fields (the values) and what errors have occurred with the form.\n</p>\n<h3>form.php</h3>\n<pre>\n&lt;? \n/**\n * Form.php\n *\n * The Form class is meant to simplify the task of keeping\n * track of errors in user submitted forms and the form\n * field values that were entered correctly.\n *\n * Written by: Jpmaster77 a.k.a. The Grandmaster of C++ (GMC)\n * Last Updated: August 19, 2004\n */\n \nclass Form\n{\n   var $values = array();  //Holds submitted form field values\n   var $errors = array();  //Holds submitted form error messages\n   var $num_errors;   //The number of errors in submitted form</p><p>   /* Class constructor */\n   function Form(){\n      /**\n       * Get form value and error arrays, used when there\n       * is an error with a user-submitted form.\n       */\n      if(isset($_SESSION['value_array']) && isset($_SESSION['error_array'])){\n         $this-&gt;values = $_SESSION['value_array'];\n         $this-&gt;errors = $_SESSION['error_array'];\n         $this-&gt;num_errors = count($this-&gt;errors);</p><p>         unset($_SESSION['value_array']);\n         unset($_SESSION['error_array']);\n      }\n      else{\n         $this-&gt;num_errors = 0;\n      }\n   }</p><p>   /**\n    * setValue - Records the value typed into the given\n    * form field by the user.\n    */\n   function setValue($field, $value){\n      $this-&gt;values[$field] = $value;\n   }</p><p>   /**\n    * setError - Records new form error given the form\n    * field name and the error message attached to it.\n    */\n   function setError($field, $errmsg){\n      $this-&gt;errors[$field] = $errmsg;\n      $this-&gt;num_errors = count($this-&gt;errors);\n   }</p><p>   /**\n    * value - Returns the value attached to the given\n    * field, if none exists, the empty string is returned.\n    */\n   function value($field){\n      if(array_key_exists($field,$this-&gt;values)){\n         return htmlspecialchars(stripslashes($this-&gt;values[$field]));\n      }else{\n         return &quot;&quot;;\n      }\n   }</p><p>   /**\n    * error - Returns the error message attached to the\n    * given field, if none exists, the empty string is returned.\n    */\n   function error($field){\n      if(array_key_exists($field,$this-&gt;errors)){\n         return &quot;&lt;font size=\&quot;2\&quot; color=\&quot;#ff0000\&quot;&gt;&quot;.$this-&gt;errors[$field].&quot;&lt;/font&gt;&quot;;\n      }else{\n         return &quot;&quot;;\n      }\n   }</p><p>   /* getErrorArray - Returns the array of error messages */\n   function getErrorArray(){\n      return $this-&gt;errors;\n   }\n};\n \n?&gt;\n</pre></p><p><p>\nThe <strong>$form</strong> class object is actually defined at the bottom of session.php, for reasons explained there. Basically how it works is there is a value array and an error array. They can be indexed with the names of the fields in the HTML form. So if you had a field whose name was "email", once the user submits the form and an error occurred, you can display what the user already typed in by calling $form->value("email"). If there was an error with what the user typed into the "email" field, you can display the error with $form->error("email").</p> </p><p><p>Look at session.php, login and register functions, they use the form object well and show how to appropriately specify the form errors. Also look later on at main.php and you'll see how to appropriately use the form object when displaying any HTML form on your website. \n</p></p><p><h3>process.php</h3>\n<p>\nAll forms submitted by the user have to be processed in some way, and this file takes care of that. Every form the user fills out is directed to this page, and this page figures out which form needs to be processed (whether it be login, register, forgot pass, etc.) and calls the appropriate functions to handle the request.</p> </p><p><p>This page is also in charge of re-directing the user to the correct page after the form has been processed, whether it be to the page referrer (default), or some other specified page. When errors have been found with the submitted form, the default action is to re-direct to the page where the user filled out the form in order to let them know about the error and fix it. If you want your users when just logging-in to be re-directed to their own specific home page, instead of the website main page, this is the file you want to edit to do that.\n</p></p><p><pre>\n&lt;?\n/**\n * Process.php\n * \n * The Process class is meant to simplify the task of processing\n * user submitted forms, redirecting the user to the correct\n * pages if errors are found, or if form is successful, either\n * way. Also handles the logout procedure.\n *\n * Written by: Jpmaster77 a.k.a. The Grandmaster of C++ (GMC)\n * Last Updated: August 19, 2004\n */\ninclude(&quot;include/session.php&quot;);</p><p>class Process\n{\n   /* Class constructor */\n   function Process(){\n      global $session;\n      /* User submitted login form */\n      if(isset($_POST['sublogin'])){\n         $this-&gt;procLogin();\n      }\n      /* User submitted registration form */\n      else if(isset($_POST['subjoin'])){\n         $this-&gt;procRegister();\n      }\n      /* User submitted forgot password form */\n      else if(isset($_POST['subforgot'])){\n         $this-&gt;procForgotPass();\n      }\n      /* User submitted edit account form */\n      else if(isset($_POST['subedit'])){\n         $this-&gt;procEditAccount();\n      }\n      /**\n       * The only other reason user should be directed here\n       * is if he wants to logout, which means user is\n       * logged in currently.\n       */\n      else if($session-&gt;logged_in){\n         $this-&gt;procLogout();\n      }\n      /**\n       * Should not get here, which means user is viewing this page\n       * by mistake and therefore is redirected.\n       */\n       else{\n          header(&quot;Location: main.php&quot;);\n       }\n   }</p><p>   /**\n    * procLogin - Processes the user submitted login form, if errors\n    * are found, the user is redirected to correct the information,\n    * if not, the user is effectively logged in to the system.\n    */\n   function procLogin(){\n      global $session, $form;\n      /* Login attempt */\n      $retval = $session-&gt;login($_POST['user'], $_POST['pass'], isset($_POST['remember']));\n      \n      /* Login successful */\n      if($retval){\n         header(&quot;Location: &quot;.$session-&gt;referrer);\n      }\n      /* Login failed */\n      else{\n         $_SESSION['value_array'] = $_POST;\n         $_SESSION['error_array'] = $form-&gt;getErrorArray();\n         header(&quot;Location: &quot;.$session-&gt;referrer);\n      }\n   }\n   \n   /**\n    * procLogout - Simply attempts to log the user out of the system\n    * given that there is no logout form to process.\n    */\n   function procLogout(){\n      global $session;\n      $retval = $session-&gt;logout();\n      header(&quot;Location: main.php&quot;);\n   }\n   \n   /**\n    * procRegister - Processes the user submitted registration form,\n    * if errors are found, the user is redirected to correct the\n    * information, if not, the user is effectively registered with\n    * the system and an email is (optionally) sent to the newly\n    * created user.\n    */\n   function procRegister(){\n      global $session, $form;\n      /* Convert username to all lowercase (by option) */\n      if(ALL_LOWERCASE){\n         $_POST['user'] = strtolower($_POST['user']);\n      }\n      /* Registration attempt */\n      $retval = $session-&gt;register($_POST['user'], $_POST['pass'], $_POST['email']);\n      \n      /* Registration Successful */\n      if($retval == 0){\n         $_SESSION['reguname'] = $_POST['user'];\n         $_SESSION['regsuccess'] = true;\n         header(&quot;Location: &quot;.$session-&gt;referrer);\n      }\n      /* Error found with form */\n      else if($retval == 1){\n         $_SESSION['value_array'] = $_POST;\n         $_SESSION['error_array'] = $form-&gt;getErrorArray();\n         header(&quot;Location: &quot;.$session-&gt;referrer);\n      }\n      /* Registration attempt failed */\n      else if($retval == 2){\n         $_SESSION['reguname'] = $_POST['user'];\n         $_SESSION['regsuccess'] = false;\n         header(&quot;Location: &quot;.$session-&gt;referrer);\n      }\n   }\n   \n   /**\n    * procForgotPass - Validates the given username then if\n    * everything is fine, a new password is generated and\n    * emailed to the address the user gave on sign up.\n    */\n   function procForgotPass(){\n      global $database, $session, $mailer, $form;\n      /* Username error checking */\n      $subuser = $_POST['user'];\n      $field = &quot;user&quot;;  //Use field name for username\n      if(!$subuser    strlen($subuser = trim($subuser)) == 0){\n         $form-&gt;setError($field, &quot;* Username not entered&lt;br&gt;&quot;);\n      }\n      else{\n         /* Make sure username is in database */\n         $subuser = stripslashes($subuser);\n         if(strlen($subuser) &lt; 5    strlen($subuser) &gt; 30   \n            !eregi(&quot;^([0-9a-z])+$&quot;, $subuser)   \n            (!$database-&gt;usernameTaken($subuser))){\n            $form-&gt;setError($field, &quot;* Username does not exist&lt;br&gt;&quot;);\n         }\n      }\n      \n      /* Errors exist, have user correct them */\n      if($form-&gt;num_errors &gt; 0){\n         $_SESSION['value_array'] = $_POST;\n         $_SESSION['error_array'] = $form-&gt;getErrorArray();\n      }\n      /* Generate new password and email it to user */\n      else{\n         /* Generate new password */\n         $newpass = $session-&gt;generateRandStr(8);\n         \n         /* Get email of user */\n         $usrinf = $database-&gt;getUserInfo($subuser);\n         $email  = $usrinf['email'];\n         \n         /* Attempt to send the email with new password */\n         if($mailer-&gt;sendNewPass($subuser,$email,$newpass)){\n            /* Email sent, update database */\n            $database-&gt;updateUserField($subuser, &quot;password&quot;, md5($newpass));\n            $_SESSION['forgotpass'] = true;\n         }\n         /* Email failure, do not change password */\n         else{\n            $_SESSION['forgotpass'] = false;\n         }\n      }\n      \n      header(&quot;Location: &quot;.$session-&gt;referrer);\n   }\n   \n   /**\n    * procEditAccount - Attempts to edit the user's account\n    * information, including the password, which must be verified\n    * before a change is made.\n    */\n   function procEditAccount(){\n      global $session, $form;\n      /* Account edit attempt */\n      $retval = $session-&gt;editAccount($_POST['curpass'], $_POST['newpass'], $_POST['email']);</p><p>      /* Account edit successful */\n      if($retval){\n         $_SESSION['useredit'] = true;\n         header(&quot;Location: &quot;.$session-&gt;referrer);\n      }\n      /* Error found with form */\n      else{\n         $_SESSION['value_array'] = $_POST;\n         $_SESSION['error_array'] = $form-&gt;getErrorArray();\n         header(&quot;Location: &quot;.$session-&gt;referrer);\n      }\n   }\n};</p><p>/* Initialize process */\n$process = new Process;</p><p>?&gt;\n</pre></p><p><h2>Active Visitors</h2>\n<p>\nTracking active visitors is accomplished in the following way: There are two database tables, one to hold the active users and one to hold the active guests. The users are distinguished by their username and the guests by their IP address. This is so we won't add any given user or guest to the tables more than once, because if we did, our information would be incorrect.</p></p><p><p>Associated with the user or guest is a timestamp, this is updated every time he/she loads a page. The timestamp tells us when the user/guest was last active. When a visitor loads a page, not only are they added/updated in the active table, but a clean-up operation is performed, one that removes any IP addresses or usernames in the database tables that haven't recently been active, the ones who have a timestamp older than the current time minus the timeout specified in constants.php. The tracking of visitors is accomplished in session.php.\n</p></p><p><h2>Admin Center</h2>\n<p>\nThe admin center is the page where admins go to do what they do best, administer the Login System. There they can view the table of users and all the user information, except for user passwords because they are encrypted. But how does someone become an admin, how does the system even recognize admins? Well, I'll tell you. If you look in constants.php you'll see that the admin level and admin name are specified. When a user logs in to the website, their user level is retrieved from the database, if their user level equals the admin level, then they are an admin, and they have all admin priviledges.\n</p>\n<h3>Admin Name</h3>\n<p>\nWell, who gets the admin name as a username? You do, but you have to register it, just like any other name. You should do this once you get the script up and running. Once you register the admin name, the Login System gives that username an admin user level. Let's assume someone were to steal it from you. You have access to constants.php, which means you can edit it, so you could create a new admin name, then register that name, go to the admin center and delete the guy from the system.\n</p></p><p><h3>Adding Admins</h3>\n<p>\nLet's say you need help with your website, and you want your buddy to help out and be an admin. You can have him register under some username of his choice, then you can go to the admin center and give his username the admin user level. Done. That would put him at your level, ...maybe you don't want to give him that much power. Well, the user level is a number from 0-9. By default, guests are 0, users are 1, and admins are 9. You can just give him a user level of 8, and let your website define what that means as far as privileges.\n</p></p><p>\n<h2>Main Page</h2>\n<p>\nThe following is an example for your website's main page. It shows a little bit how to use the <code>$session</code>, <code>$form</code>, and <code>$database</code> variables. It contains the login form of the Login System. Note when looking at the HTML form, there's a hidden field called "sublogin", that's the name of the form. That's important because when process.php is loaded it needs to know what form is being processed. So if you want to create different forms later on, make sure you give it a unique name.\n</p></p><p><h3>main.php</h3>\n<pre>\n&lt;?\n/**\n * Main.php\n *\n * This is an example of the main page of a website. Here\n * users will be able to login. However, like on most sites\n * the login form doesn't just have to be on the main page,\n * but re-appear on subsequent pages, depending on whether\n * the user has logged in or not.\n *\n * Written by: Jpmaster77 a.k.a. The Grandmaster of C++ (GMC)\n * Last Updated: August 26, 2004\n */\ninclude(&quot;include/session.php&quot;);\n?&gt;</p><p>&lt;html&gt;\n&lt;title&gt;Jpmaster77's Login Script&lt;/title&gt;\n&lt;body&gt;</p><p>&lt;table&gt;\n&lt;tr&gt;&lt;td&gt;</p><p>\n&lt;?\n/**\n * User has already logged in, so display relevant links, including\n * a link to the admin center if the user is an administrator.\n */\nif($session-&gt;logged_in){\n   echo &quot;&lt;h1&gt;Logged In&lt;/h1&gt;&quot;;\n   echo &quot;Welcome &lt;b&gt;$session-&gt;username&lt;/b&gt;, you are logged in. &lt;br&gt;&lt;br&gt;&quot;\n       .&quot;[&lt;a href=\&quot;userinfo.php?user=$session-&gt;username\&quot;&gt;My Account&lt;/a&gt;] &nbsp;&nbsp;&quot;\n       .&quot;[&lt;a href=\&quot;useredit.php\&quot;&gt;Edit Account&lt;/a&gt;] &nbsp;&nbsp;&quot;;\n   if($session-&gt;isAdmin()){\n      echo &quot;[&lt;a href=\&quot;admin/admin.php\&quot;&gt;Admin Center&lt;/a&gt;] &nbsp;&nbsp;&quot;;\n   }\n   echo &quot;[&lt;a href=\&quot;process.php\&quot;&gt;Logout&lt;/a&gt;]&quot;;\n}\nelse{\n?&gt;</p><p>&lt;h1&gt;Login&lt;/h1&gt;\n&lt;?\n/**\n * User not logged in, display the login form.\n * If user has already tried to login, but errors were\n * found, display the total number of errors.\n * If errors occurred, they will be displayed.\n */\nif($form-&gt;num_errors &gt; 0){\n   echo &quot;&lt;font size=\&quot;2\&quot; color=\&quot;#ff0000\&quot;&gt;&quot;.$form-&gt;num_errors.&quot; error(s) found&lt;/font&gt;&quot;;\n}\n?&gt;\n&lt;form action=&quot;process.php&quot; method=&quot;POST&quot;&gt;\n&lt;table align=&quot;left&quot; border=&quot;0&quot; cellspacing=&quot;0&quot; cellpadding=&quot;3&quot;&gt;\n&lt;tr&gt;&lt;td&gt;Username:&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;user&quot; maxlength=&quot;30&quot; value=&quot;&lt;? echo $form-&gt;value(&quot;user&quot;); ?&gt;&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;? echo $form-&gt;error(&quot;user&quot;); ?&gt;&lt;/td&gt;&lt;/tr&gt;\n&lt;tr&gt;&lt;td&gt;Password:&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;password&quot; name=&quot;pass&quot; maxlength=&quot;30&quot; value=&quot;&lt;? echo $form-&gt;value(&quot;pass&quot;); ?&gt;&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;? echo $form-&gt;error(&quot;pass&quot;); ?&gt;&lt;/td&gt;&lt;/tr&gt;\n&lt;tr&gt;&lt;td colspan=&quot;2&quot; align=&quot;left&quot;&gt;&lt;input type=&quot;checkbox&quot; name=&quot;remember&quot; &lt;? if($form-&gt;value(&quot;remember&quot;) != &quot;&quot;){ echo &quot;checked&quot;; } ?&gt;&gt;\n&lt;font size=&quot;2&quot;&gt;Remember me next time &nbsp;&nbsp;&nbsp;&nbsp;\n&lt;input type=&quot;hidden&quot; name=&quot;sublogin&quot; value=&quot;1&quot;&gt;\n&lt;input type=&quot;submit&quot; value=&quot;Login&quot;&gt;&lt;/td&gt;&lt;/tr&gt;\n&lt;tr&gt;&lt;td colspan=&quot;2&quot; align=&quot;left&quot;&gt;&lt;br&gt;&lt;font size=&quot;2&quot;&gt;[&lt;a href=&quot;forgotpass.php&quot;&gt;Forgot Password?&lt;/a&gt;]&lt;/font&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;&lt;/td&gt;&lt;/tr&gt;\n&lt;tr&gt;&lt;td colspan=&quot;2&quot; align=&quot;left&quot;&gt;&lt;br&gt;Not registered? &lt;a href=&quot;register.php&quot;&gt;Sign-Up!&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;\n&lt;/table&gt;\n&lt;/form&gt;</p><p>&lt;?\n}</p><p>/**\n * Just a little page footer, tells how many registered members\n * there are, how many users currently logged in and viewing site,\n * and how many guests viewing site. Active users are displayed,\n * with link to their user information.\n */\necho &quot;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td align=\&quot;center\&quot;&gt;&lt;br&gt;&lt;br&gt;&quot;;\necho &quot;&lt;b&gt;Member Total:&lt;/b&gt; &quot;.$database-&gt;getNumMembers().&quot;&lt;br&gt;&quot;;\necho &quot;There are $database-&gt;num_active_users registered members and &quot;;\necho &quot;$database-&gt;num_active_guests guests viewing the site.&lt;br&gt;&lt;br&gt;&quot;;</p><p>include(&quot;include/view_active.php&quot;);</p><p>?&gt;</p><p>\n&lt;/td&gt;&lt;/tr&gt;\n&lt;/table&gt;</p><p>\n&lt;/body&gt;\n&lt;/html&gt;\n</pre></p><p><h2>Download</h2>\n<p>\nAs you've probably noticed, pages have been left out of the article. Where's the Admin Center? User Account Page? Forgot Password Form? ... Well, there's too much code to show it all here, plus most of it is self-explanatory. So if you want to see that stuff, and use what I've shown you, download it!</p>\n<ul>\n<li><strong><a href="files/Login_System_v.2.0.zip">PHP Login System v.2.0</a></strong> (zip file 23KB)</li>\n</ul></p><p>\n<h2>Conclusion</h2>\n<p>\nThe only reason I made this advanced Login System was because so many people liked my first one and wanted to see more features get added. So I decided to put all the requested features together into this new Login System and give the people what they wanted. So I want to say thank you to all those who enjoyed my first script and supported me, and I hope you enjoy this one too. Happy programming!\n</p>