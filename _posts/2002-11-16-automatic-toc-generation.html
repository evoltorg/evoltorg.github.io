---
layout: post
permalink: Automatic_TOC_Generation
---
<p>Many one-page HTML documents need to have a simple <q>Table of\nContents</q> (abbreviated to TOC for the rest of this article).  Writing it by\nhand can be difficult to maintain after some time.  To have an\nautomatically generated TOC I see two solutions:</p></p><p><ul>\n  \n  <li><p>writing the document using a <acronym\n  title="What You See Is What You Get">WYSIWYG</acronym> editor that knows\n  to generate a TOC.\n  This has the unacceptable disadvantage\n  that the generated code is usually atrocious and in some cases it does not\n  even validate.</p></li></p><p>  <li><p>writing the document without a TOC and have the TOC automatically\n  generated through the wonders of JavaScript and the\n  <acronym title="Document Object Model">DOM</acronym>.</p></li></p><p></ul></p><p><p>In this article we will discuss the second method.  So the motto is:\n<em>let the browser do it</em>.</p></p><p><h2 id="wwg">What we get</h2></p><p><p>First, let's just assume that we already have the script and see how are\nwe going to use it.  Basically, we want to be able to write the BODY tag\nlike this:</p></p><p><p><code>\n&lt;body onload=&quot;generate_TOC('toc');&quot;&gt;\n</code></p></p><p><p>And somewhere inside the BODY content, where we want the TOC to appear,\nwe should have the following:</p></p><p><p><code>\n&lt;div id=&quot;toc&quot;&gt;&lt;/div&gt;\n</code></p></p><p><p>This DIV will be known as the <em>parent</em> of the TOC.</p></p><p><p>With this setup, when a browser which haa proper support for JavaScript and the\n<acronym title="Document Object Model">DOM</acronym> loads our page, it\nwill automatically generate the TOC inside the parent.</p></p><p><h2>Problem overview</h2></p><p><p>The <code>generate_TOC</code> function should walk through the document\nand remember all the headlines (&lt;H<b>x</b>&gt; tags where <b>x</b> is 1,\n2, &#8230;, 6).  For each headline it should extract the text inside, create a\nlink which has the headline as its target and add the link to the parent DIV.</p></p><p><p>The script will <em>not</em> handle styling.  Styling can &#8212; and should\n&#8212; be done using external <acronym\ntitle="Cascading Style Sheet">CSS</acronym>, knowing the fact that the\nparent DIV has the ID &quot;toc&quot; and some other small details that we\nwill discuss later.</p></p><p><h3>Tasks</h3></p><p><p>Here is the complete definition of tasks involved in TOC generation:</p></p><p><ol></p><p>  <li><p><a href="/Automatic_TOC_Generation#gettext">Retrieving text.</a> We will create a function\n  that retrieves the text from an element.  While this function should work\n  with any element type, we will only use it for retrieving text from\n  headlines.</p></p><p>  <li><p><a href="/Automatic_TOC_Generation#getheadlines">Finding the headlines.</a> We will create a\n  list of objects that contain a reference to the headline element, the text\n  inside it and an integer variable representing the TOC item level (for\n  proper indentation).</p></p><p>  <li><p><a href="/Automatic_TOC_Generation#generatetoc">Creating the TOC.</a> For all items retrieved at\n  step <b>2</b> we will:</p></p><p>  <ul>\n    <li><p>Check if the headline element has an ID assigned.  If not we will\n    add an automatically generated ID.  This will allow us to create a link\n    that targets the headline.</p></p><p>    <li><p>Create a DIV element (<strong>D</strong>) that has the class\n    &quot;level<b>x</b>&quot;, where <b>x</b> is the level of the TOC\n    element (1, 2, ..., 6).  This will help us style the TOC using CSS.</p></p><p>    <li><p>Create a link element that displays the text retrieved at step\n    <b>2</b> for the current item and has the ID of the current\n    headline as its HREF (remember, if the ID did not exist then we have generated it).\n    Append this link to the DIV created above.</p></p><p>    <li><p>Finally, append the (<strong>D</strong>) DIV into the <em>TOC's\n    parent DIV</em>.</p>\n  </ul></p><p></ol></p><p><h2>The Code</h2></p><p><p>Now, for the most interesting part of this article, the code.</p></p><p><h3 id="gettext">The text retrieval function</h3></p><p><p>For retrieving text from a simple heading like\n&quot;<code>&lt;H2&gt;Overview&lt;/H2&gt;</code>&quot; we could use simple\ncode like &quot;<code>text = element.firstChild.data;</code>&quot;.\nHowever, we want to be able to retrieve code even from complicated headings,\nlike &quot;<code>&lt;H2&gt;&lt;b&gt;This&lt;/b&gt; is a\n&lt;em&gt;complicated&lt;/em&gt;\n&lt;u&gt;heading&lt;/u&gt;&lt;/H2&gt;</code>&quot;.  They just might contain\nmore than simple text, therefore we need to have a recursive function that\nwalks through all children elements and accumulates every little piece of\ntext it finds.  The code is given below.</p></p><p><pre>\nfunction H_getText(el) {\n  var text = &quot;&quot;;\n  for (var i = el.firstChild; i != null; i = i.nextSibling) {\n    if (i.nodeType == 3 /* Node.TEXT_NODE, IE doesn't speak constants */)\n      text += i.data;\n    else if (i.firstChild != null)\n      text += H_getText(i);\n  }\n  return text;\n}\n</pre></p><p><p>The only parameter to this function, <var>el</var>, is a reference to the\nHTML element from which we need to extract the text.  We can get one, for\ninstance, using <code>document.getElementById()</code>.</p></p><p><h3>A simple JavaScript object</h3></p><p><p>JavaScript arrays are very powerful tools.  However, they can only\ncontain <em>one</em> value for each element.  If we need to store more\nvalues inside, say, <code>a[1]</code>, then we need a function that creates\na new object containing all of these values and then we can store <em>that\nobject</em> (or more correctly, a reference to it) in\n<code>a[1]</code>.</p></p><p><p>Note that another good approach would be to just store another\n<code>Array</code> object, instead of a customized object.  But using an\nobject customized for our problem is more elegant, not to mention allowing better\ncode readability.</p></p><p><p>Our object needs three properties: a reference to the headline element\n(<var>el</var>), the text inside it (<var>text</var>) and the item's TOC level\n(<var>level</var>).  The code needed to create it is below.</p></p><p><pre>\nfunction TOC_EL(el, text, level) {\n  this.element = el;\n  this.text = text;\n  this.level = level;\n}\n</pre></p><p><h3 id="getheadlines">Retrieving headlines</h3></p><p><p>A very simple solution for this problem is to use\n<code>document.getElementsByTagName(&quot;*&quot;)</code>, which should return all\nelements from the HTML document.  Then, for each element, we compare the\n<code>tagName</code> attribute with &quot;H1&quot;, &quot;H2&quot;, etc.</p></p><p><p>However, this method does not work for Internet Explorer 5.0 because the\nbrowser doesn't properly understand the <code>&quot;*&quot;</code> parameter and\nreturns no elements.  Therefore we created the following function to deal\nwith this problem.  The function returns an <code>Array</code> object\ncontaining all the headlines found in the document, as objects defined in\nthe previous section (thus also having the title and the TOC level).  It\nshould be called with a reference to the <code>&lt;BODY&gt;</code>\nelement.</p></p><p><pre>\nfunction getHeadlines(el) {\n  var l = new Array;\n  var rx = /[hH]([1-6])/;\n  // internal recursive function that scans the DOM tree\n  var rec = function (el) {\n    for (var i = el.firstChild; i != null; i = i.nextSibling) {\n      if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {\n        if (rx.exec(i.tagName))\n          l[l.length] = new TOC_EL(i, H_getText(i), parseInt(RegExp.$1));\n        rec(i);\n      }\n    }\n  }\n  rec(el);\n  return l;\n}\n</pre></p><p><p>Some notes:</p></p><p><ul></p><p>  <li><code>getHeadlines()</code> contains a nested function.  This function\n  doesn't have a name, but we &quot;assign&quot; it to the variable\n  <code>rec</code> so that we can call it.  This kind of construct is very\n  useful to avoid putting too many parameters or local variables inside the\n  recursive function &#8212; it has access to variables defined in the containing\n  function.</p><p>  <li>We are using a RegExp to test if the current element is a headline,\n  that is, if it's <code>tagName</code> matches any of H<b>x</b>, where\n  <b>x</b> is 1 .. 6.</p><p>  <li>A somewhat confusing construct is used to push an element into the\n  array: &quot;<code>l[l.length] = ...</code>&quot;.  That is because IE5\n  does not have the <code>push</code> method in the <code>Array</code>\n  object.  I recently found a\n  <a href="http://www.crockford.com/javascript/remedial.html"\n  target="_blank" title="Remedial JavaScript. Opens in new window.">\n  good article</a> that shows how to solve such problems at a more general\n  level.</p><p></ul></p><p><h3 id="generatetoc">The <code>generate_TOC</code> function</h3></p><p><p>This function is the main entry point into this script.  It is intended\nto be called from the <code>&lt;body onload=""&gt;</code> handler with the ID of\nsome <code>&lt;div&gt;</code> element (or anything else) that will be the\n<em>parent</em> of TOC.</p></p><p><p>It will construct the list of all headings, using\n<code>getHeadlines()</code>, then iterate through it and create elements\ninside the <em>parent</em> for each headline.  The created elements will\nconsist of a <code>&lt;div&gt;</code> having the class name\n&quot;level<b>X</b>&quot;, where <b>X</b> is the level of indentation (1 to\n6) of that TOC entry.  This will allow easy customization through CSS.</p></p><p><pre>\nfunction generate_TOC(parent_id) {\n  var parent = document.getElementById(parent_id);\n  var hs = getHeadlines(document.getElementsByTagName(&quot;body&quot;)[0]);\n  for (var i = 0; i &lt; hs.length; ++i) {\n    var hi = hs[i];\n    var d = document.createElement(&quot;div&quot;);\n    if (hi.element.id == &quot;&quot;)\n      hi.element.id = &quot;gen&quot; + i;\n    var a = document.createElement(&quot;a&quot;);\n    a.href = &quot;#&quot; + hi.element.id;\n    a.appendChild(document.createTextNode(hi.text));\n    d.appendChild(a);\n    d.className = &quot;level&quot; + hi.level;\n    parent.appendChild(d);\n  }\n}\n</pre></p><p><p>For example, following is the HTML code that the above function generates\nfor this page.  As a side note, I used a handy feature of <a\nhref="http://mozilla.org" title="The Browser's Home Page"\ntarget="_blank">Mozilla</a>: if you select something on the page then right\nclick, in the menu that appears you see this option: &quot;View Selection\nSource&quot;.  It shows the HTML code for the selected block, as it is right\nat that moment &#8212; therefore, it also shows code generated by\nJavaScript-s.</p></p><p><pre>\n&lt;div id=&quot;toc&quot;&gt;\n  &lt;div class=&quot;level1&quot;&gt;&lt;a href=&quot;#gen0&quot;&gt;Automatic TOC Generation&lt;/a&gt;&lt;/div&gt;\n  &lt;div class=&quot;level2&quot;&gt;&lt;a href=&quot;#wwg&quot;&gt;What we get&lt;/a&gt;&lt;/div&gt;\n  &lt;div class=&quot;level2&quot;&gt;&lt;a href=&quot;#gen2&quot;&gt;Problem overview&lt;/a&gt;&lt;/div&gt;\n  &lt;div class=&quot;level3&quot;&gt;&lt;a href=&quot;#gen3&quot;&gt;Tasks&lt;/a&gt;&lt;/div&gt;\n  &lt;div class=&quot;level2&quot;&gt;&lt;a href=&quot;#gen4&quot;&gt;The Code&lt;/a&gt;&lt;/div&gt;\n  &lt;div class=&quot;level3&quot;&gt;&lt;a href=&quot;#gettext&quot;&gt;The text retrieval function&lt;/a&gt;&lt;/div&gt;\n  &lt;div class=&quot;level3&quot;&gt;&lt;a href=&quot;#gen6&quot;&gt;A simple JavaScript object&lt;/a&gt;&lt;/div&gt;\n  &lt;div class=&quot;level3&quot;&gt;&lt;a href=&quot;#getheadlines&quot;&gt;Retrieving headlines&lt;/a&gt;&lt;/div&gt;\n  &lt;div class=&quot;level3&quot;&gt;&lt;a href=&quot;#generatetoc&quot;&gt;The generate_TOC function&lt;/a&gt;&lt;/div&gt;\n  &lt;div class=&quot;level2&quot;&gt;&lt;a href=&quot;#styling&quot;&gt;Styling and indentation&lt;/a&gt;&lt;/div&gt;\n  &lt;div class=&quot;level2&quot;&gt;&lt;a href=&quot;#gen10&quot;&gt;Putting all together&lt;/a&gt;&lt;/div&gt;\n&lt;/div&gt;\n</pre></p><p><h2 id="styling">Styling and indentation</h2></p><p><p>We can heavily style the TOC using external CSS and just knowing the ID\nof the <em>parent</em> DIV, and the fact that items of different levels will\nhave different classes (starting from &quot;level1&quot; to\n&quot;level6&quot;).  Indentation is also possible with CSS, so the script\nsimply doesn't need to know how much to indent levels.</p></p><p><p>An example style is shown below.  For a more fancy look you can check <a\nhref="http://students.infoiasi.ro/~mishoo/site/calendar.epl" target="_blank"\ntitle="JS calendar, on my personal site. Opens in new window.">this page</a>.</p></p><p><pre>\n#toc {\n  float: right;\n  font-size: 80%;\n  border: 1px solid #000;\n  margin: 0px 0px 20px 20px;\n  padding: 5px;\n  background: #ddd;\n}\n#toc .level2 { margin-left: 1em; }\n#toc .level3 { margin-left: 2em; }\n#toc .level4 { margin-left: 3em; }\n#toc .level5 { margin-left: 4em; }\n#toc .level6 { margin-left: 5em; }\n</pre></p><p><h2>Putting all together</h2></p><p><p>Usage is simple: just dump all these functions inside a &quot;.js&quot;\nfile, load that file into your page that needs a TOC and do the simple setup\ndescribed in section <a href="/Automatic_TOC_Generation#wwg">What we get</a>.</p></p><p><p>To get a properly indented TOC you should also include a stylesheet, like\nthe one above.  Further customization is possible, i.e. different background\n/ color for different TOC levels, or a fancy hover / active style for links\ninside <tt>#toc</tt>, etc.</p>