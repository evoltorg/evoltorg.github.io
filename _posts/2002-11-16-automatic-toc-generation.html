---
layout: post
permalink: Automatic_TOC_Generation
ratings: 4
avgrate: 3.5000
user: mishoo
real_name: "Mihai Bazon"
user_since: 2002-10-27
avatar: ""
article_count: 1
excerpt: "Many one-page HTML documents need to have a simple \"Table of Contents\".  Writing it by hand can be difficult to maintain after some time.  This article proposes a JavaScript-based solution of the problem with support for external CSS styling."
---
<p>Many one-page HTML documents need to have a simple <q>Table of</p>Contents</q> (abbreviated to TOC for the rest of this article).  Writing it by</p>hand can be difficult to maintain after some time.  To have an</p>automatically generated TOC I see two solutions:</p></p><p><ul></p>  </p>  <li><p>writing the document using a <acronym</p>  title="What You See Is What You Get">WYSIWYG</acronym> editor that knows</p>  to generate a TOC.</p>  This has the unacceptable disadvantage</p>  that the generated code is usually atrocious and in some cases it does not</p>  even validate.</p></li></p><p>  <li><p>writing the document without a TOC and have the TOC automatically</p>  generated through the wonders of JavaScript and the</p>  <acronym title="Document Object Model">DOM</acronym>.</p></li></p><p></ul></p><p><p>In this article we will discuss the second method.  So the motto is:</p><em>let the browser do it</em>.</p></p><p><h2 id="wwg">What we get</h2></p><p><p>First, let's just assume that we already have the script and see how are</p>we going to use it.  Basically, we want to be able to write the BODY tag</p>like this:</p></p><p><p><code></p>&lt;body onload=&quot;generate_TOC('toc');&quot;&gt;</p></code></p></p><p><p>And somewhere inside the BODY content, where we want the TOC to appear,</p>we should have the following:</p></p><p><p><code></p>&lt;div id=&quot;toc&quot;&gt;&lt;/div&gt;</p></code></p></p><p><p>This DIV will be known as the <em>parent</em> of the TOC.</p></p><p><p>With this setup, when a browser which haa proper support for JavaScript and the</p><acronym title="Document Object Model">DOM</acronym> loads our page, it</p>will automatically generate the TOC inside the parent.</p></p><p><h2>Problem overview</h2></p><p><p>The <code>generate_TOC</code> function should walk through the document</p>and remember all the headlines (&lt;H<b>x</b>&gt; tags where <b>x</b> is 1,</p>2, &#8230;, 6).  For each headline it should extract the text inside, create a</p>link which has the headline as its target and add the link to the parent DIV.</p></p><p><p>The script will <em>not</em> handle styling.  Styling can &#8212; and should</p>&#8212; be done using external <acronym</p>title="Cascading Style Sheet">CSS</acronym>, knowing the fact that the</p>parent DIV has the ID &quot;toc&quot; and some other small details that we</p>will discuss later.</p></p><p><h3>Tasks</h3></p><p><p>Here is the complete definition of tasks involved in TOC generation:</p></p><p><ol></p><p>  <li><p><a href="/Automatic_TOC_Generation#gettext">Retrieving text.</a> We will create a function</p>  that retrieves the text from an element.  While this function should work</p>  with any element type, we will only use it for retrieving text from</p>  headlines.</p></p><p>  <li><p><a href="/Automatic_TOC_Generation#getheadlines">Finding the headlines.</a> We will create a</p>  list of objects that contain a reference to the headline element, the text</p>  inside it and an integer variable representing the TOC item level (for</p>  proper indentation).</p></p><p>  <li><p><a href="/Automatic_TOC_Generation#generatetoc">Creating the TOC.</a> For all items retrieved at</p>  step <b>2</b> we will:</p></p><p>  <ul></p>    <li><p>Check if the headline element has an ID assigned.  If not we will</p>    add an automatically generated ID.  This will allow us to create a link</p>    that targets the headline.</p></p><p>    <li><p>Create a DIV element (<strong>D</strong>) that has the class</p>    &quot;level<b>x</b>&quot;, where <b>x</b> is the level of the TOC</p>    element (1, 2, ..., 6).  This will help us style the TOC using CSS.</p></p><p>    <li><p>Create a link element that displays the text retrieved at step</p>    <b>2</b> for the current item and has the ID of the current</p>    headline as its HREF (remember, if the ID did not exist then we have generated it).</p>    Append this link to the DIV created above.</p></p><p>    <li><p>Finally, append the (<strong>D</strong>) DIV into the <em>TOC's</p>    parent DIV</em>.</p></p>  </ul></p><p></ol></p><p><h2>The Code</h2></p><p><p>Now, for the most interesting part of this article, the code.</p></p><p><h3 id="gettext">The text retrieval function</h3></p><p><p>For retrieving text from a simple heading like</p>&quot;<code>&lt;H2&gt;Overview&lt;/H2&gt;</code>&quot; we could use simple</p>code like &quot;<code>text = element.firstChild.data;</code>&quot;.</p>However, we want to be able to retrieve code even from complicated headings,</p>like &quot;<code>&lt;H2&gt;&lt;b&gt;This&lt;/b&gt; is a</p>&lt;em&gt;complicated&lt;/em&gt;</p>&lt;u&gt;heading&lt;/u&gt;&lt;/H2&gt;</code>&quot;.  They just might contain</p>more than simple text, therefore we need to have a recursive function that</p>walks through all children elements and accumulates every little piece of</p>text it finds.  The code is given below.</p></p><p><pre></p>function H_getText(el) {</p>  var text = &quot;&quot;;</p>  for (var i = el.firstChild; i != null; i = i.nextSibling) {</p>    if (i.nodeType == 3 /* Node.TEXT_NODE, IE doesn't speak constants */)</p>      text += i.data;</p>    else if (i.firstChild != null)</p>      text += H_getText(i);</p>  }</p>  return text;</p>}</p></pre></p><p><p>The only parameter to this function, <var>el</var>, is a reference to the</p>HTML element from which we need to extract the text.  We can get one, for</p>instance, using <code>document.getElementById()</code>.</p></p><p><h3>A simple JavaScript object</h3></p><p><p>JavaScript arrays are very powerful tools.  However, they can only</p>contain <em>one</em> value for each element.  If we need to store more</p>values inside, say, <code>a[1]</code>, then we need a function that creates</p>a new object containing all of these values and then we can store <em>that</p>object</em> (or more correctly, a reference to it) in</p><code>a[1]</code>.</p></p><p><p>Note that another good approach would be to just store another</p><code>Array</code> object, instead of a customized object.  But using an</p>object customized for our problem is more elegant, not to mention allowing better</p>code readability.</p></p><p><p>Our object needs three properties: a reference to the headline element</p>(<var>el</var>), the text inside it (<var>text</var>) and the item's TOC level</p>(<var>level</var>).  The code needed to create it is below.</p></p><p><pre></p>function TOC_EL(el, text, level) {</p>  this.element = el;</p>  this.text = text;</p>  this.level = level;</p>}</p></pre></p><p><h3 id="getheadlines">Retrieving headlines</h3></p><p><p>A very simple solution for this problem is to use</p><code>document.getElementsByTagName(&quot;*&quot;)</code>, which should return all</p>elements from the HTML document.  Then, for each element, we compare the</p><code>tagName</code> attribute with &quot;H1&quot;, &quot;H2&quot;, etc.</p></p><p><p>However, this method does not work for Internet Explorer 5.0 because the</p>browser doesn't properly understand the <code>&quot;*&quot;</code> parameter and</p>returns no elements.  Therefore we created the following function to deal</p>with this problem.  The function returns an <code>Array</code> object</p>containing all the headlines found in the document, as objects defined in</p>the previous section (thus also having the title and the TOC level).  It</p>should be called with a reference to the <code>&lt;BODY&gt;</code></p>element.</p></p><p><pre></p>function getHeadlines(el) {</p>  var l = new Array;</p>  var rx = /[hH]([1-6])/;</p>  // internal recursive function that scans the DOM tree</p>  var rec = function (el) {</p>    for (var i = el.firstChild; i != null; i = i.nextSibling) {</p>      if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {</p>        if (rx.exec(i.tagName))</p>          l[l.length] = new TOC_EL(i, H_getText(i), parseInt(RegExp.$1));</p>        rec(i);</p>      }</p>    }</p>  }</p>  rec(el);</p>  return l;</p>}</p></pre></p><p><p>Some notes:</p></p><p><ul></p><p>  <li><code>getHeadlines()</code> contains a nested function.  This function</p>  doesn't have a name, but we &quot;assign&quot; it to the variable</p>  <code>rec</code> so that we can call it.  This kind of construct is very</p>  useful to avoid putting too many parameters or local variables inside the</p>  recursive function &#8212; it has access to variables defined in the containing</p>  function.</p><p>  <li>We are using a RegExp to test if the current element is a headline,</p>  that is, if it's <code>tagName</code> matches any of H<b>x</b>, where</p>  <b>x</b> is 1 .. 6.</p><p>  <li>A somewhat confusing construct is used to push an element into the</p>  array: &quot;<code>l[l.length] = ...</code>&quot;.  That is because IE5</p>  does not have the <code>push</code> method in the <code>Array</code></p>  object.  I recently found a</p>  <a href="http://www.crockford.com/javascript/remedial.html"</p>  target="_blank" title="Remedial JavaScript. Opens in new window."></p>  good article</a> that shows how to solve such problems at a more general</p>  level.</p><p></ul></p><p><h3 id="generatetoc">The <code>generate_TOC</code> function</h3></p><p><p>This function is the main entry point into this script.  It is intended</p>to be called from the <code>&lt;body onload=""&gt;</code> handler with the ID of</p>some <code>&lt;div&gt;</code> element (or anything else) that will be the</p><em>parent</em> of TOC.</p></p><p><p>It will construct the list of all headings, using</p><code>getHeadlines()</code>, then iterate through it and create elements</p>inside the <em>parent</em> for each headline.  The created elements will</p>consist of a <code>&lt;div&gt;</code> having the class name</p>&quot;level<b>X</b>&quot;, where <b>X</b> is the level of indentation (1 to</p>6) of that TOC entry.  This will allow easy customization through CSS.</p></p><p><pre></p>function generate_TOC(parent_id) {</p>  var parent = document.getElementById(parent_id);</p>  var hs = getHeadlines(document.getElementsByTagName(&quot;body&quot;)[0]);</p>  for (var i = 0; i &lt; hs.length; ++i) {</p>    var hi = hs[i];</p>    var d = document.createElement(&quot;div&quot;);</p>    if (hi.element.id == &quot;&quot;)</p>      hi.element.id = &quot;gen&quot; + i;</p>    var a = document.createElement(&quot;a&quot;);</p>    a.href = &quot;#&quot; + hi.element.id;</p>    a.appendChild(document.createTextNode(hi.text));</p>    d.appendChild(a);</p>    d.className = &quot;level&quot; + hi.level;</p>    parent.appendChild(d);</p>  }</p>}</p></pre></p><p><p>For example, following is the HTML code that the above function generates</p>for this page.  As a side note, I used a handy feature of <a</p>href="http://mozilla.org" title="The Browser's Home Page"</p>target="_blank">Mozilla</a>: if you select something on the page then right</p>click, in the menu that appears you see this option: &quot;View Selection</p>Source&quot;.  It shows the HTML code for the selected block, as it is right</p>at that moment &#8212; therefore, it also shows code generated by</p>JavaScript-s.</p></p><p><pre></p>&lt;div id=&quot;toc&quot;&gt;</p>  &lt;div class=&quot;level1&quot;&gt;&lt;a href=&quot;#gen0&quot;&gt;Automatic TOC Generation&lt;/a&gt;&lt;/div&gt;</p>  &lt;div class=&quot;level2&quot;&gt;&lt;a href=&quot;#wwg&quot;&gt;What we get&lt;/a&gt;&lt;/div&gt;</p>  &lt;div class=&quot;level2&quot;&gt;&lt;a href=&quot;#gen2&quot;&gt;Problem overview&lt;/a&gt;&lt;/div&gt;</p>  &lt;div class=&quot;level3&quot;&gt;&lt;a href=&quot;#gen3&quot;&gt;Tasks&lt;/a&gt;&lt;/div&gt;</p>  &lt;div class=&quot;level2&quot;&gt;&lt;a href=&quot;#gen4&quot;&gt;The Code&lt;/a&gt;&lt;/div&gt;</p>  &lt;div class=&quot;level3&quot;&gt;&lt;a href=&quot;#gettext&quot;&gt;The text retrieval function&lt;/a&gt;&lt;/div&gt;</p>  &lt;div class=&quot;level3&quot;&gt;&lt;a href=&quot;#gen6&quot;&gt;A simple JavaScript object&lt;/a&gt;&lt;/div&gt;</p>  &lt;div class=&quot;level3&quot;&gt;&lt;a href=&quot;#getheadlines&quot;&gt;Retrieving headlines&lt;/a&gt;&lt;/div&gt;</p>  &lt;div class=&quot;level3&quot;&gt;&lt;a href=&quot;#generatetoc&quot;&gt;The generate_TOC function&lt;/a&gt;&lt;/div&gt;</p>  &lt;div class=&quot;level2&quot;&gt;&lt;a href=&quot;#styling&quot;&gt;Styling and indentation&lt;/a&gt;&lt;/div&gt;</p>  &lt;div class=&quot;level2&quot;&gt;&lt;a href=&quot;#gen10&quot;&gt;Putting all together&lt;/a&gt;&lt;/div&gt;</p>&lt;/div&gt;</p></pre></p><p><h2 id="styling">Styling and indentation</h2></p><p><p>We can heavily style the TOC using external CSS and just knowing the ID</p>of the <em>parent</em> DIV, and the fact that items of different levels will</p>have different classes (starting from &quot;level1&quot; to</p>&quot;level6&quot;).  Indentation is also possible with CSS, so the script</p>simply doesn't need to know how much to indent levels.</p></p><p><p>An example style is shown below.  For a more fancy look you can check <a</p>href="http://students.infoiasi.ro/~mishoo/site/calendar.epl" target="_blank"</p>title="JS calendar, on my personal site. Opens in new window.">this page</a>.</p></p><p><pre></p>#toc {</p>  float: right;</p>  font-size: 80%;</p>  border: 1px solid #000;</p>  margin: 0px 0px 20px 20px;</p>  padding: 5px;</p>  background: #ddd;</p>}</p>#toc .level2 { margin-left: 1em; }</p>#toc .level3 { margin-left: 2em; }</p>#toc .level4 { margin-left: 3em; }</p>#toc .level5 { margin-left: 4em; }</p>#toc .level6 { margin-left: 5em; }</p></pre></p><p><h2>Putting all together</h2></p><p><p>Usage is simple: just dump all these functions inside a &quot;.js&quot;</p>file, load that file into your page that needs a TOC and do the simple setup</p>described in section <a href="/Automatic_TOC_Generation#wwg">What we get</a>.</p></p><p><p>To get a properly indented TOC you should also include a stylesheet, like</p>the one above.  Further customization is possible, i.e. different background</p>/ color for different TOC levels, or a fancy hover / active style for links</p>inside <tt>#toc</tt>, etc.</p>