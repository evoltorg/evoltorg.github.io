---
layout: post
permalink: node/5768
ratings: 1
avgrate: 4.0000
category: Code
user: johnpeace
real_name: "John Corry"
user_biog: "John P. Corry has been building web sites since IE 3/Win 95. After working full time in the web dev industry both as an employee and business owner, he discovered aviation and eventually decided on a career change. He flew airplanes until he got sick of always being broke and tired, then left aviation to come back to web app development work.
John presently is a software engineer at Airwatch where he writes PHP web apps."
user_since: 20 Aug 1999
avatar: "/images/pictures/picture-198.jpg"
article_count: 2
excerpt: "Have a group of \'items\' in your website that you want your users to store for a later use? I did...Not quite a \'shopping cart\', but similar in concept, this set of functions & forms allows a user to store items that they\'ve browsed through and add them to a single inquiry form."
---
<p>I'm a JavaScript newbie.</p></p><p><p>Sure, I've read the tutorials at <a href="http://www.webmonkey.com" target="_blank">webmonkey</a>, and followed along through thread after thread on the mailing lists about 'how can I get my function to <em>insert task here</em>. But I never really <em>got it</em>. Up until last week, the most complex thing I'd ever done with JS was copying other people's scripts and adapting them ever so slightly to work on my page. I was beginning to become very discouraged, but ran into a problem that was just begging to be solved with JavaScript.</p></p><p><p>I live on Maui, and work as a freelancer running my own very small web-design studio. Most of my work is for local small businesses who are usually under-represented on the web and who typically lack both the resources and understanding to make full use of the internet in their business. My biggest challenge as a designer is making enough money to survive, working on projects with a shoestring budget. My other biggest challenge is pleasing clients, who feel like they are paying WAY TOO MUCH. From talking to other designers and having worked in a local web design company for a year, I know that my rates are incredibly reasonable and that this challenge will always be there when I work with local clients.</p></p><p><p><strong>Note:</strong> I am extremely open to working as a freelance designer/coder for other companies either here or on the mainland :)</p></p><p><p>Anyway, this amounts to fancy server side solutions (which I would just LOVE </p>  to get into) being generally beyond the reach of many of the projects I am involved </p>  with. I have a hard enough time selling clients on the fact that they need a </p>  new website, much less needing to spend $20/month for PHP or ASP hosting. So, </p>  I usually have to find a way to solve problems that is probably not the best </p>  solution, but one that serves the purpose and does so cheaply and quickly and </p>  requiring a minimum investment. Bummer, but don't feel to sorry for me...I have </p>  it pretty good. :)</p></p><p><h2>The Problem I needed to solve...</h2></p><p>Over the course of the past few months, I've been working on a site for a windsurfing company...<a href="http://www.simmerhawaii.com" target="_blank">Simmer Hawaii</a>. This has been a great job, because I somehow managed to talk the client into letting me do whatever I want with their site. When I proposed that the best way for them to be successful on the web is to continually add to the content of the site: they believed me. That means I get to work on this on an ongoing basis, earning pretty good $$ and getting fat discounts on new wave sails and beachwear every now and then.</p></p><p><p>One of the ideas we had was to add a <a href="http://www.simmerhawaii.com/travel" target="_blank">travel section</a> to the website. Part of </p>  Simmer's business is renting windsurfing gear to vacationing windsurfers. If </p>  you come to Maui to sail, you want to stay on the north shore, because that's </p>  where all the sailing is. There aren't any resorts, there aren't any hotels, </p>  there aren't any condos. On the north shore, you stay in private homes that </p>  are maintained by their owners as vacation rentals. So, this accommodations </p>  reality necessitated featuring many different vacation rental properties on </p>  the website. We also figured there would be a great deal of value in adding </p>  more keyword rich pages of content to the site.</p></p><p><p>The structure called for a hierarchy of pages, 'site &gt;&gt;  travel section &gt;&gt;  neighborhood </p>  &gt;&gt; property/unit'. That's how we'd done it in the rest of the site, so we continued </p>  to structure information that way. <a href="http://www.windsurfari.com" target="_blank">My </p>  wife's company</a>, which specializes in vacation accommodations for windsurfers </p>  on Maui's north shore agreed to provide content and handle the inquiries generated. </p>  I have to mention this, because its another thing about the web that I'ma huge </p>  advocate of: using the internet to bring unique businesses together to better </p>  serve the customer public. In this arrangement, Simmer Hawaii gets a) more content </p>  for their website, b) another service that they can offer their customers, c) </p>  a small commission on each sale of a vacation. My wife's company gets a) exposure </p>  for her product/company in another venue, b) more inquiries and an expanded </p>  customer base, c) a small commission on each gear rental sale made, d) the chance </p>  to show her vendors, 'look, I'm marketing you here too'. It's a win/win situation </p>  and a model that I will continue to explore for my customers. But back to the </p>  problem...</p></p><p><p>The idea behind presenting many options for vacation accommodations in the </p>  travel section was to give visitors to the site as many choices as we can. Each </p>  neighborhood features a number of properties representing a range of price, </p>  size and level of luxury. Trouble is, visitors to the site are likely to want </p>  to inquire about more than one property. I mean, sure that one-bedroom on the </p>  beach at Sprecks might be good...but the studio in Paia is the same price and </p>  closer to town. So, the problem was to provide a mechanism by which users could </p>  add different properties to the list of those that they would inquire about, </p>  and only make them fill out one form to inquire about them all. The limitations </p>  were that the form gets submitted by CGI-email, because that's the only script </p>  available through the <a href="http://www.maui.net/home" target="_blank">cheap-ass </p>  web host</a></p></p><p><h2>The solution I came up with...</h2></p><p>So, how to get those choices about different properties into the CGI-Email </p>  form...I thought about listing each property/unit on the form with a checkbox </p>  beside it and a link back to that property/unit so users could go back for reference. </p>  That seemed a little cumbersome and less than elegant. What I really wanted </p>  was a sort of 'shopping cart', to allow users to choose their properties <em>as </p>  they browsed</em>. So, I figured if I could 1) put checkboxes next to each property </p>  choice, 2) get the checkboxes to store a value, 3) retrieve the stored values </p>  at the form, 4) use the stored values to print the user's choices into the </p>  form as display text <em>and</em> form input...I'd be looking good. So, how </p>  could I do it?</p></p><p><p>Because I'm a newbie, this seemed like a really complex thing to do. But it </p>  turned out to be a really perfect 'first software development project'. The </p>  first step is above...<em>define each step of what your script has to do.</em> </p>  How can you write a function or anything until you know what you have to do </p>  at each step? Since my first step called for checkboxes beside each property, </p>  I started by building the property pages for each property/unit. I figured whatever </p>  I came up with function-wise for step two would be the same for each page, and </p>  just a matter of copy &amp; paste.</p></p><p><p>Step two required a way to store the values for the checked forms. Since most </p>  people are terrified of cookies (and since writing 22 or so values into a cookie </p>  seemed really daunting) I wanted to avoid them. Sort of overkill anyway, </p>  since the state only needs to be remembered until they fill out the form. So, </p>  I chose to split the travel section into frames...one frame for displaying the </p>  content, one for storing the values of the checkboxes. My frameset code (index.html </p>  in the /travel directory) looks like this:</p></p><p><pre>&lt;frameset rows=&quot;0,*&quot; cols=&quot;*&quot; framespacing=&quot;0&quot; </p>    frameborder=&quot;0&quot;&gt;</p>    &lt;frame src=&quot;frm_hidden_var_storage.html&quot; name=&quot;topFrame&quot; </p>    id=&quot;topFrame&quot; frameborder=&quot;0&quot; scrolling=&quot;No&quot; </p>    noresize marginwidth=&quot;0&quot; marginheight=&quot;0&quot;&gt;</p>    &lt;frame src=&quot;travel.html&quot; name=&quot;mainFrame&quot; id=&quot;mainframe&quot; </p>    frameborder=&quot;0&quot; scrolling=&quot;Auto&quot; noresize marginwidth=&quot;0&quot; </p>    marginheight=&quot;0&quot;&gt;</p>    </p>    &lt;/frameset&gt;</p>    &lt;noframes&gt;</p>    &lt;body bgcolor=&quot;#FFFFFF&quot; text=&quot;#000000&quot; topmargin=&quot;0&quot; </p>    marginheight=&quot;0&quot;&gt;</p>    Sorry, you can't see frames...this site wasn't built for you.</p>    &lt;/body&gt;</p>    &lt;/noframes&gt;</pre></p><p><p>Note: The framset puts the page where the values are stored <em>on top</em>. This </p>  is imperative. Otherwise, the page in the bottom of the frameset is trying to </p>  access objects that don't exist yet. You'll see what I'm talking about when </p>  I get into the functions that make it work...</p></p><p><p>All that's on the page 'frm_hidden_var_storage.html' is a form with 22 &lt;input </p>  type="hidden" name="[name that corresponds with a property/unit]" </p>  value="false"&gt;. When a user checks a checkbox, a function changes </p>  the value of that property/unit's &lt;input type="hidden"... to true. </p>  Like this:</p></p><p><pre>   function updateValue(propName) { </p>    var hideyElement = eval('parent.topFrame.document.form1.' + propName.name);</p>    hideyElement.value = propName.checked;</p>    }</pre></p><p><p>This function is called by the onClick event handler on the checkbox...onClick="updateValue(this);". </p>  In the first line, I make a variable called hideyElement. Now, I had help with </p>  this part from Erik Mattheis. I don't really understand why I have to eval the </p>  string 'parent.topFrame.document.form1.' before concatenating the argument.name </p>  to it, but it didn't' work when I did it the other way...var hideyElement = </p>  parent.topFrame.document.form1.propName.name;...I got an error telling me that </p>  ' parent.topFrame.document.form1.propName' is null or not an object. The conceptual </p>  difference between what JS thinks of as an object, and what it thinks of as </p>  a string is more than I can currently grasp. But thanks to <a href="http://lists.evolt.org/mailman/listinfo/thelist" target="_blank" title="Thelist info, opens in a new window">thelist</a>, I was able </p>  to get beyond this point in spite of my limited understanding. The argument </p>  passed to the function is a reference to the checkbox itself. It is important </p>  to note that each checkbox in the site has a name attribute that is exactly </p>  the same as the name attribute for it's corresponding &lt;input type="hidden"... </p>  in the hidden frame. That way, my function can just plug the name value from </p>  the checkbox into the variable that references the hidden input on the other </p>  page and change that objects value attribute to the checked value of the checkbox. </p>  Following? Since 'true' is the value of the checkbox when its checked, I can </p>  change the value of the hidden input to the checked value of the checkbox, and </p>  it evaluates to changing the hidden inputs' value to 'true'.</p></p><p><p>That was easy enough...now to get those values printed on the page in a useful </p>  format...</p></p><p><p>One of the very first lessons in my JavaScript tutorials in Danny Goodman's </p>  'JavaScript Bible' (a resource I highly recommend to any newbie wanting to get </p>  their feet wet in JS) deals with looping through an array. Since that intuitively </p>  seemed like the way to get all the values from my hidden inputs, and then do </p>  something based on those values, I started by making an array to loop through:</p></p><p><pre> var AllProperties = new Array(22);</p>    AllProperties[0] = parent.topFrame.document.form1.tavares_bay_home;</p>    AllProperties[1] = parent.topFrame.document.form1.tropical_hideaway;</p>    AllProperties[2] = parent.topFrame.document.form1.rays_hanawi;</p>    AllProperties[3] = parent.topFrame.document.form1.rays_mauna;</p>    AllProperties[4] = parent.topFrame.document.form1.rays_lua_pele;</p>    AllProperties[5] = parent.topFrame.document.form1.paia_studio;</p>    AllProperties[6] = parent.topFrame.document.form1.kehau;</p>    AllProperties[7] = parent.topFrame.document.form1.kai_hale;</p>    AllProperties[8] = parent.topFrame.document.form1.hookipa_bayview;</p>    AllProperties[9] = parent.topFrame.document.form1.hale_lea_lea1;</p>    AllProperties[10] = parent.topFrame.document.form1.hale_lea_lea2;</p>    AllProperties[11] = parent.topFrame.document.form1.hale_lea_lea3;</p>    AllProperties[12] = parent.topFrame.document.form1.hale_kulani1;</p>    AllProperties[13] = parent.topFrame.document.form1.hale_kulani2;</p>    AllProperties[14] = parent.topFrame.document.form1.hale_kulani3;</p>    AllProperties[15] = parent.topFrame.document.form1.hale_kulani4;</p>    AllProperties[16] = parent.topFrame.document.form1.hale_kulani5;</p>    AllProperties[17] = parent.topFrame.document.form1.aqua_terra1;</p>    AllProperties[18] = parent.topFrame.document.form1.aqua_terra2;</p>    AllProperties[19] = parent.topFrame.document.form1.aqua_terra3;</p>    AllProperties[20] = parent.topFrame.document.form1.aina_lani1;</p>    AllProperties[21] = parent.topFrame.document.form1.aina_lani2;</pre></p><p><p>This array is just a list of all of the &lt;input type="hidden"... </p>  objects on the other, hidden page in the frameset. These objects are the objects </p>  whose values were changed from their default (false) to true in the checkbox </p>  updateValue(propName) function. So now that I have them in an array, I can loop </p>  through that array and find all of the values that are true, like this:</p></p><p><pre> for (var i = 0; i &lt; AllProperties.length ; i++){</p>    if (AllProperties[i].value == &quot;true&quot;){...</pre></p><p><p>This is one of the most basic constructs in any programming language, what </p>  it does is to make a variable (i), set it to 0. Then it compares the variable </p>  to some other statement, in this case, the length of the AllProperties array </p>  (AllProperties.length), and increments the variable 'i' by one. So, the loop </p>  will run as many times as i &lt; the length of the AllProperties array. And </p>  the value of 'i' always corresponds with an index number of a 22 item array. </p>  Every time it runs, it does something:</p></p><p><pre> var linkStr = &quot;&lt;a href=\&quot;&quot; + PropLinks[i] + &quot;.html\&quot; </p>    target=\&quot;_self\&quot;&gt;&quot;</p>    document.write(linkStr + PageProperties[i] + &quot;&lt;/a&gt;&lt;br&gt;&quot;)</p>    }</pre></p><p><p>It makes a variable that contains a string ( "&lt;a href=\""), </p>  since I wanted my selected properties to display on the page not merely as text, </p>  but as links back to that properties page in the site. That calls for another </p>  array item, PropLinks[i]. PropLinks[i] is another array I made to serve as a </p>  sort of lookup table for the first array. Its like the AllProperties array, </p>  except that instead of holding a list of objects, it holds a list of strings </p>  that when inserted into this function are included in the output string. So </p>  basically, &lt;a href=\"" + PropLinks[i] + ".html\" target=\"_self\"&gt;</p>  comes out as "&lt;a href=" + "prop_apagesname" + ".html </p>  target="self"&gt;". That way, I can write a link back to the </p>  associated, chosen property as I write that chosen property into the page for </p>  display, which happens in the 2nd line. That takes carefully canceling out the </p>  right quotation marks, so my attributes in the <a> tag are properly quoted. </p>  The variable linkStr (which is constructed by pulling items out of an array </p>  of link values) builds the opening &lt;a&gt; tag. Another array's value (with </p>  the same index, 'i' as the other arrays) gets written in next, then the link </p>  tag is closed and a line break inserted by adding"&lt;/a&gt;&lt;br&gt;".</p></p><p>This gets done for each 'true' value in the hidden inputs on the hidden frame </p>  page. Cool, so that's how I get the list of links back to the selected properties.</p></p><p>But I also needed to get those values into my CGI-email form...</p></p><p>So, I made another array that contained the values that I want to pass to CGIemails </p>  text template. It's just another array of strings called PageProperties. It's </p>  values get inserted into the page like this:</p></p><p><pre>&lt;script&gt;</p>    &lt;!--</p>    for (var i = 0; i &lt; AllProperties.length ; i++){</p>    if (AllProperties[i].value == &quot;true&quot;){</p>    var inputStr1 = &quot;&lt;input type=\&quot;hidden\&quot; value=\&quot;&quot;</p>    var inputStr2 = &quot;\&quot; name=\&quot;&quot;</p>    document.write(inputStr1 +</p>    PageProperties[i] + </p>    inputStr2 + </p>    AllProperties[i].name + </p>    &quot;\&quot;&gt;&quot;)</p>    }</p>    }</p>    //--&gt;</p>    &lt;/script&gt;</pre></p><p><p>This is really no different than the other output loop, except that it creates </p>  hidden input fields in the form to pass the dynamically generated values to </p>  CGI-Email's text template. Each time through the loop, the function creates </p>  a ' &lt;input type="hidden" name="AllProperties[i]Name" </p>  value="PageProperties[i]"&gt;. Then, in the text template for cgi-email, </p>  I have a 'accommodations preferences:' field that has little [] slots for each </p>  of the AllProperties array items...pretty simple.</p></p><p><h2>Yes...it does leave a lot to be desired...</h2></p><p><p>So, it's not foolproof. I had to put a function to bust the frames on all of </p>  the pages in the site that are not in the /travel section, otherwise, if you </p>  followed a link from the travel section to another area of the site and then </p>  went back, you'd be in a double frame. Since I did that, if you check some properties </p>  while you're browsing, then go look at the sail line or women's swimsuits and </p>  come back to the travel section...your checked values are gone. And I still </p>  have to write a function that checks the boxes if you check it once, leave the </p>  page, and then go back. And if you have JS turned of, it doesn't work. But like </p>  I said at the beginning of the article, it doesn't have to be a foolproof solution, </p>  just good enough to solve the problem with a minimum investment of resources. </p>  The client is happy because the inquiries we get now have information about </p>  which properties the inquirer was interested in. The user is happy because they </p>  only have to fill out one form, and can go back to the properties they checked </p>  while filling out the form. I'm happy because I learned more about planning </p>  and building web sites/web applications.</p></p><p><p>Thanks!</p>