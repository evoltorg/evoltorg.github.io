---
layout: post
permalink: node/15882
ratings: 14
avgrate: 4.4286
rating: 4.29
categories: [Site Development]
user: morbus
real_name: "Morbus Iff"
user_biog: ""
user_since: 01 Oct 2000
avatar: 
article_count: 2
excerpt: "In this article, I\'ll show you how I created a search engine friendly dynamic image gallery, using only the features built into a core distribution of the Apache web server. This image gallery will support supplementary file information, as well as error damage control. The techniques can..."
---
<p>Well, that's certainly a mouthful, eh? In this article, I'll show you how I created a search engine friendly dynamic image gallery, using only the features built into a core distribution of the Apache web server. This image gallery will support supplementary file information, as well as error damage control. You can see an example of this image gallery at <a href="http://www.disobey.com/" title="Visit Disobey.com - Opens New Window" target="_new">Disobey.com's</a> <a href="http://www.disobey.com/ghostsites/" title="View Example - Opens New Window" target="_new">Ghost Sites</a>. The techniques can be used for far more than just images; any type of downloadable file (movies, mp3s, etc.) could be used to create a gallery.</p></p><p><h2>What You'll Need</h2></p><p><ul><li>Apache web server (any current version).</li></p><li>Server Side Includes turned on for your directory. </li></ul></p><p><p><strong>Note:</strong> It's outside the realm of this article to tell you how to enable Server Side Includes (SSI) for your web site. Please consult the <a href="http://httpd.apache.org/docs/" title="View Apache Documentation - Opens New Window" target="_new">Apache documentation</a> or contact your web host for more information.</p></p><p><h2>Glossary</h2></p><p><ul><li><strong>Dynamic:</strong> Hard coded pages are "static" - once you upload them to your web site, they don't change again until you manually make the changes yourself. "Dynamic" pages, on the other hand, react and change their behavior and appearance based on environment variables, user preference, direction of the sun, what Mishka's cat was fed (or wasn't fed), etc. This article describes how to create a dynamic image gallery.</li></p><p><li><strong>Environment Variables:</strong> Every time you visit a web page, Apache creates a number of "environment variables" such as PATH_INFO, DOCUMENT_ROOT, HTTP_USER_AGENT, and so forth. These environment variables contain helpful bits of information and can be used within SSI (as well as CGI-based scripts) to cater to the user in question. In this article, we use PATH_INFO to determine which image name is being sent to our SSI page.</li></p><p><li><strong>Search Engine Friendly:</strong> Search engines generally only index static pages (see "Dynamic", above), skipping over dynamic pages due to the assumption that the data changes frequently and the index would become out of date. Most search engines will skip over any URL that has a "?" in the title (such as "http://www.example.com/?dynamic=1"). In this article, we trick the search engines into indexing our dynamic image gallery.</li></p><p><li><strong>Server Side Includes:</strong> SSI give you the opportunity to use a very limited control language built within Apache to include other pages into the body of another, to test files for their date and file size, to handle conditionals based on page data, environment, and so on and so forth. They are a lifesaver for large sites. In this article, we use SSI to look at environment data sent to Apache, as well as some file tests.</li></ul></p><p><h2>Step 1: Creating Our Gallery Page</h2></p><p><p>Our first step is to create our gallery page. This page will be used to show every single individual image in our gallery of delight. For this article, we're going to make a pretty ugly page to keep things brief. I'll save it as "show.shtml":</p></p><p><pre></p>   &lt;html&gt;</p>   &lt;title&gt;My Ugly Image Gallery&lt;/title&gt;</p>   &lt;body&gt;</p>   &nbsp;&nbsp;&nbsp;&lt;img src="example.jpg" alt="beautiful image on ugly page" /&gt;</p>   &lt;/body&gt;&lt;/html&gt;</p></pre></p><p><p>Pretty damn elite, if I do say so. We'll be ripping the above apart and making it dynamic in just a bit. For more, let's understand how an environment variable works, specifically PATH_INFO.</p></p><p><h2>Step 2: Understanding PATH_INFO</h2></p><p><p>When you load a normal old web page in a browser, you're loading a single page that has no added frills attached. A boring old URL would be something like "http://www.example.com/show.shtml". When you load pages like this, environment variables are created, but none that are all too exciting to work with.</p></p><p><p>A URL with added frills, however, could look like "http://www.example.com/show.shtml?image=jack.jpg". As mentioned above, this page would generally be ignored by search engines, but gives the "show.shtml" page something to work with, namely the added information of "image=jack.jpg". This information is stored in an environment variable called QUERY_STRING. What "show.shtml" does with QUERY_STRING is irrelevant in this article for one reason: search engines won't like us.</p></p><p><p>How do we get some engine love? Just like we can pass information to "show.shtml" by adding a question mark to the URL, we can also pass information by passing a slash to the page. So, to modify our above URL, we could use "http://www.example.com/show.shtml/jack.jpg". Even though the URL looks to have a subdirectory of "show.shtml" in which "jack.jpg" exists, that's not the case. You really have a page named "show.shtml" that was passed an environment variable of PATH_INFO, which contained "/jack.jpg".</p></p><p><p>And that's where our magic kicks in.</p></p><p><p>Since we're not using question marks in the URL, search engines will index us; since we passed extra information to the "show.shtml" via PATH_INFO, we now have something to react to. "http://www.example.com/show.shtml/jack.jpg" is different from "http://www.example.com/show.shtml/jill.jpg" by PATH_INFO alone -  the same old "show.shtml" is just being passed different information. This allows us to construct any number of links to the same "show.shtml" page, just with different PATH_INFO.</p></p><p><p><strong>Caveat:</strong> I've assumed that search engines will look at the above URLs, see the ".jpg" extension and not index the page. I've also assumed the same of browsers - that a browser will see the ".jpg" extension and try to display the result as an image, without consulting the server for the mime-type (if you don't understand mime-types, don't worry about it). Thus, we're going to modify our URLs thusly: "http://www.example.com/show.shtml/jill". This won't cause us any problems at all (see below).</p></p><p><h2>Step 3: Reacting to PATH_INFO</h2></p><p><p>So, we're passing PATH_INFO, but we haven't told our "show.shtml" page how to react to it. This is actually pretty dang'd simple, so let's modify the ugly HTML page we started with:</p></p><p><pre></p>   &lt;html&gt;</p>   &lt;title&gt;My Ugly Image Gallery&lt;/title&gt;</p>   &lt;body&gt;</p>   &nbsp;&nbsp;&nbsp;&lt;h1&gt;Your PATH_INFO is: &lt;!--#echo var="PATH_INFO"--&gt;&lt;/h1&gt;</p>   &nbsp;&nbsp;&nbsp;&lt;img src="example.jpg" alt="can you smell the flowers?" /&gt;</p>   &lt;/body&gt;&lt;/html&gt;</p></pre></p><p><p>See that "echo" line? That's an SSI that just echoes the value of a variable - in this case, we're shoving the value of the PATH_INFO environment variable into an header for display. Loading "http://www.example.com/show.shtml/jill", our page would tell us that "Your PATH_INFO is: /jill" (if you've uploaded this page to your Apache server and nothing seems to happen, then SSI probably is not enabled or configured. Again, this is outside the scope of this article).</p></p><p><p>Can you see where we're heading with this? A modified example:</p></p><p><pre></p>   &lt;html&gt;</p>   &lt;title&gt;My Ugly Image Gallery&lt;/title&gt;</p>   &lt;body&gt;</p>   &nbsp;&nbsp;&nbsp;&lt;img src="&lt;!--#echo var="PATH_INFO"--&gt;.jpg" alt="sheer beauty!" /&gt;</p>   &lt;/body&gt;&lt;/html&gt;</p></pre></p><p><p>When Apache displays this page, it'll replace PATH_INFO with "/jill":</p></p><p><pre></p>   &lt;html&gt;</p>   &lt;title&gt;My Ugly Image Gallery&lt;/title&gt;</p>   &lt;body&gt;</p>   &nbsp;&nbsp;&nbsp;&lt;img src="/jill.jpg" alt="sheer beauty!" /&gt;</p>   &lt;/body&gt;&lt;/html&gt;</p></pre></p><p><p><strong>Caveat:</strong> Looking at the above result, it makes sense to think that if "jill.jpg" is in the same directory as "show.shtml" that everything should work fine. This isn't the case. Because the added slash of the URL *seems* to create an added hierarchy, we've actually got to tell our browser to go up one directory. Thus, change "<code>img src=</code>" to "<code>img src=..</code>" to achieve the desired effect (we've done this for the rest of our examples).</p></p><p><p><strong>Further Caveat:</strong> Say you load "http://www.example.com/show.shtml" - what happens? Since no extra information was sent to the page, PATH_INFO is set to "(none)", and your user will get a big old broken image with no added explanation, as the browser will try to load a file named "(none).jpg". We'll cater to this problem by cheating - read Step 4 (below).</p></p><p><p>At this point, you could call it a day. Simply create a page of different URLs, all directing to "show.shtml", and the SSI will slavishly load the passed image name. But what happens when the image isn't there? We should graciously tell the user, shouldn't we?</p></p><p><h2>Step 4: Handling Errors</h2></p><p><p>Your SSI image gallery is humming along quite nicely... when, suddenly, you mistype a link on your web page, and thousands of your users are trying to load "http://www.example.com/show.shtml/jock" instead of "jack". Instead of seeing that boyish child of our youth, they're seeing a dastardly broken image link. Thankfully, using the power of SSI, we can notify the user with a custom error message.</p></p><p><p>Modify your HTML to the following:</p></p><p><pre></p>   &lt;html&gt;</p>   &lt;title&gt;My Ugly Image Gallery&lt;/title&gt;</p>   &lt;body&gt;</p>   &nbsp;&nbsp;&nbsp;Image Last Modified: &lt;!--#flastmod virtual="..$PATH_INFO.jpg"--&gt;</p>   &nbsp;&nbsp;&nbsp;&lt;br /&gt;Image File Size: &lt;!--#fsize virtual="..$PATH_INFO.jpg"--&gt;</p>   &nbsp;&nbsp;&nbsp;&lt;img src="..&lt;!--#echo var="PATH_INFO"--&gt;.jpg" alt="wonderful plumage!" /&gt;</p>   &lt;/body&gt;&lt;/html&gt;</p></pre></p><p><p>The above shows how to use SSI to get the "last modified" date of the image file, as well as its file size. While this information isn't too important for the normal user to know about, the <strong>side effect</strong> of using these SSI commands is. When "http://www.example.com/show.shtml/jill" is loaded in the browser, Apache will translate the SSI commands to:</p></p><p><pre></p>   &lt;html&gt;</p>   &lt;title&gt;My Ugly Image Gallery&lt;/title&gt;</p>   &lt;body&gt;</p>   &nbsp;&nbsp;&nbsp;Image Last Modified: Friday, 31-Aug-2001 02:06:21 EDT </p>   &nbsp;&nbsp;&nbsp;&lt;br /&gt;Image File Size: 70k </p>   &nbsp;&nbsp;&nbsp;&lt;img src="../jill.jpg" alt="wonderful plumage!" /&gt;</p>   &lt;/body&gt;&lt;/html&gt;</p></pre></p><p><p>If, on the other hand, we load a broken URL like "http://www.example.com/show.shtml/jock", we get the following:</p></p><p><pre></p>   &lt;html&gt;</p>   &lt;title&gt;My Ugly Image Gallery&lt;/title&gt;</p>   &lt;body&gt;</p>   &nbsp;&nbsp;&nbsp;Image Last Modified: [an error occurred while processing this directive]</p>   &nbsp;&nbsp;&nbsp;&lt;br /&gt;Image File Size: [an error occurred while processing this directive]</p>   &nbsp;&nbsp;&nbsp;&lt;img src="../jock.jpg" alt="no curls here" /&gt;</p>   &lt;/body&gt;&lt;/html&gt;</p></pre></p><p><p>Since the "last modified" and "file size" SSI commands make the server return info on a file, Apache will let us know when something goes wrong. This "something" could be the file not being there (as in the above case), permission problems, or some other weird thing. We can't know for sure without actually looking in our log files.</p></p><p><p>We can, however, modify the error message to be a bit friendlier:</p></p><p><pre></p>   &lt;html&gt;</p>   &lt;title&gt;My Ugly Image Gallery&lt;/title&gt;</p>   &lt;body&gt;</p>   &nbsp;&nbsp;&nbsp;&lt;!--#config errmsg="This image does not exist!"--&gt;</p>   &nbsp;&nbsp;&nbsp;Image Last Modified: &lt;!--#flastmod virtual="..$PATH_INFO.jpg"--&gt;</p>   &nbsp;&nbsp;&nbsp;&lt;br /&gt;Image File Size: &lt;!--#fsize virtual="..$PATH_INFO.jpg"--&gt;</p>   &nbsp;&nbsp;&nbsp;&lt;img src="..&lt;!--#echo var="PATH_INFO"--&gt;.jpg" alt="failure coming, i bet" /&gt;</p>   &lt;/body&gt;&lt;/html&gt;</p></pre></p><p><p>Our last example, I promise. Now, Apache will now show the following when something goes wrong:</p></p><p><pre></p>   &lt;html&gt;</p>   &lt;title&gt;My Ugly Image Gallery&lt;/title&gt;</p>   &lt;body&gt;</p>   &nbsp;&nbsp;&nbsp;Image Last Modified: This image does not exist!</p>   &nbsp;&nbsp;&nbsp;&lt;br /&gt;Image File Size: This image does not exist!</p>   &nbsp;&nbsp;&nbsp;&lt;img src="../jock.jpg" alt="failure coming, i bet" /&gt;</p>   &lt;/body&gt;&lt;/html&gt;</p></pre></p><p><p>Of course, you can modify your "errmsg" to anything you want, even including HTML if you wish.</p></p><p><h2>Conclusion</h2></p><p><p>We've really only scratched a small part of what Apache can do with SSI. One major feature we didn't touch on here includes conditionals (where we could say something like "if PATH_INFO equals jill, then make the background color blue"). I'll leave that as an exercise to the reader, however, both in diving into Apache's documentation, as well as experimenting with an oft ignored feature that many people limit to "header / footer templating".</p></p><p><p><strong>Caveat:</strong> Although I mention that we're making an "image gallery", we've really only made the "image display page". To make the gallery portion of your masterpiece, simply start making links to "show.shtml", passing different PATH_INFOs for each one of your images.</p></p><p><p><strong>Anal Caveat:</strong> Think "http://www.example.com/show.shtml/jack" looks ugly because it looks like a filename is being used as a directory name? Yeah, I did too. If you have .htaccess control in your Apache directory, then you can add the following to that file: <code>RedirectMatch /show/(.*) ../show.shtml/$1</code> and then refer to the URLs as "http://www.example.com/show/jack". Not only does this make the URL nicer looking, it also allows you to change the method of serving the files later on down the line, without changing links or causing 404's. It's an exercise to the user to find out what the hell I'm talking about (as it's a long explanation).</p>