---
layout: post
permalink: node/29426
ratings: 4
avgrate: 2.5000
user: Martin Tsachev
real_name: "Martin Tsachev"
user_since: 2001-06-27
avatar: "/images/pictures/picture-12535.jpg"
article_count: 6
excerpt: " will sign-up at all. What you need is to &quot;remember&quot; non-registered visitors."
---
<p>You have a couple of forms on your site that require the same user information or</p>a single form that is frequently resubmitted by visitors. You don't have the time to implement</p>user registration and don't want to spend hours or days learning somebody else's code. </p>You are not sure if people will sign-up at all. What you need is to &quot;remember&quot; non-registered visitors.</p></p></p><p><h2>Why people <em>may</em> not register</h2></p><ul></p>    <li>It takes time even if you only fill in a username and password</li></p>    <li>Many services on the web <em>require</em> lots of information</li></p>    <li>Some sites require additional action to activate your account</li></p></ul></p><p><h2>What are the benefits of remembering visitors?</h2></p><ul></p>    <li>People may opt to turn it off</li></p>    <li>Can coexist with the same service for registered users</li></p>    <li>Doesn't take much time to implement it</li></p>    <li>Doesn't require a database</li></p></ul></p><p><h2>And the drawbacks</h2></p><ul></p>    <li>Requires cookies, at least when you want it to be permanent</li></p>    <li>The same browser has to be used every time</li></p></ul></p><p><h2>What exactly is it?</h2></p><p>It is a way to remember the information the visitor of your site entered </p>either for the current session or for a specified amount of time with a cookie.</p></p></p><p><p>When the visitor submits the form the reusable information - the information that doesn't change</p>when the same user fills the form another time - is saved. Depending on the implementation, you could offer</p>an option to permanently save the information as a cookie or just to save it for the session.</p></p></p><p><h2>What is required?</h2></p><p>A server-side scripting language such as </p><a href="http://www.php.net" target="_blank"><acronym  title="PHP Hypertext Preprocessor">PHP</acronym></a>,</p><acronym title="Active Server Pages">ASP</acronym>,</p><acronym title="Java Server Pages">JSP</acronym> or anything as CGI </p>that will both display the form and process the submitted values. </p></p></p><p></p><p><h2>And some code</h2></p><p>The example provides the code in PHP but as said above it can be done in </p>any server-side scripting language or application.</p></p></p><p><pre></p>define('COOKIE_REMEMBER', 'remember-me');</p><p>session_load_remembered();</p><p>if ($_SERVER['REQUEST_METHOD'] == 'POST') {</p>    processData();</p>} else {</p>    displayForm();</p>}</p></pre></p><p><p>Our cookie name is defined with a constant so if you want to change</p>it you can do it in one place. The first function call initializes the session variables</p>from that cookie, if available.</p></p></p><p></p>Next we check if we should display the form or </p>process the submitted one.</p></p></p><p><pre></p>function session_load_remembered() {</p>    if (isset($_COOKIE[COOKIE_REMEMBER]) ) {</p>        // the order of name, email has to be the same as in the code to save the data</p>        list($_SESSION['name'], $_SESSION['email']) = @unserialize($_COOKIE[COOKIE_REMEMBER]);</p>    }</p>}</p></pre></p><p><p>PHP's <code>unserialize</code> function takes a string representation </p>of a PHP variable - array in our case, and returns the structure itself. We've suppressed </p>error messages with the <code>@</code> control operator because the cookie may have </p>been modified by the user. The <code>list</code> language construct is used to set the values of </p>our session variables at once.</p></p></p><p><p>We've used PHP's 4.1 style superglobal <code>_COOKIE</code> and </p><code>_SESSION</code> arrays; if you want to use the code with an earlier </p>version of PHP you need to modify the code to <code>HTTP_*_VARS</code></p>and import it from the global namespace with a <code>global</code> declaration </p>as in the example:</p></p></p><p><pre></p>global $HTTP_COOKIE_VARS;</p><p>echo $HTTP_COOKIE_VARS[COOKIE_REMEMBER];</p></pre></p><p><pre></p>function displayForm($subject = '', $comment = '') {</p>    ?&gt;</p>    &lt;form method="post" action="&lt;?php echo $_SERVER['PHP_SELF']?&gt;"</p>        onsubmit="return true"&gt;</p>    &lt;table border="0" cellspacing="5" cellpadding="0" summary="Comments form"&gt;</p><p>    &lt;tr&gt;</p>        &lt;td&gt;Name:&lt;/td&gt;</p>        &lt;td&gt;&lt;input type="text" name="fullName" id="fullName" value="&lt;?php echo $_SESSION['name']?&gt;" /&gt;&lt;/td&gt;</p>    &lt;/tr&gt;</p><p>    &lt;tr&gt;</p>        &lt;td&gt;E-mail:&lt;/td&gt;</p>        &lt;td&gt;&lt;input type="text" name="email" id="email" value="&lt;?php echo $_SESSION['email']?&gt;" /&gt;&lt;/td&gt;</p>    &lt;/tr&gt;</p><p>    &lt;tr&gt;</p>        &lt;td&gt;Subject:&lt;/td&gt;</p>        &lt;td&gt;&lt;input type="text" name="subject" id="subject" value="&lt;?php echo $subject?&gt;" /&gt;&lt;/td&gt;</p>    &lt;/tr&gt;</p><p>    &lt;tr&gt;</p>        &lt;td colspan="2"&gt;</p>            &lt;input type="checkbox" name="remember" /&gt;</p>            Remember me</p>        &lt;/td&gt;</p>    &lt;/tr&gt;</p><p>    &lt;tr&gt;</p>        &lt;td colspan="2"&gt;Comments:&lt;/td&gt;</p>    &lt;/tr&gt;</p><p>    &lt;tr&gt;</p>        &lt;td colspan="2"&gt;</p>            &lt;textarea id="comment" name="comment" rows="8" cols="40"&gt;&lt;?php echo $comment?&gt;&lt;/textarea&gt;</p>        &lt;/td&gt;</p>    &lt;/tr&gt;</p><p>    &lt;tr&gt;</p>        &lt;td&gt;&lt;input type="submit" value="Add comment" /&gt;&lt;/td&gt;</p>        &lt;td&gt;&lt;input type="reset" value="Clear fields" /&gt;&lt;/td&gt;</p>    &lt;/tr&gt;</p><p>    &lt;/table&gt;</p>    &lt;/form&gt;</p>    &lt;?php</p>}</p></pre></p><p><p>This isn't perfect HTML: you should add <code>title</code>s to the code,</p>and also wrap the text labels in HTML <code>label</code> elements. Other improvements </p>can also be made, it's up to you.</p></p></p><p><p>This is an example PHP function to display a comments form. Note that we've set the</p>default values of the <code>name</code> and <code>email</code> fields to our session</p>variables that will hold the saved data. The other two default values for the </p><code>subject</code> and <code>comment</code> are just put in case server-side </p>validation fails and we need to redisplay the form with the values filled in.</p></p></p><p></p><pre></p>function processData() {</p>    // some validation</p>    // redisplay the form if it fails with a line like:</p>    // displayForm($_POST['subject'], $_POST['comment']);</p><p></p>    // if all is ok</p>    $_SESSION['name'] = $_POST['fullName'];</p>    $_SESSION['email'] = $_POST['email'];</p><p>    if (isset($_POST['remember']) ) {</p>        setcookie(COOKIE_REMEMBER, </p>            serialize(array($_SESSION['name'], $_SESSION['email']) ),</p>            time() + 31104000);</p>    }</p><p>    // add the info to database</p>}</p></pre></p><p><p>This one handles the submitted data, validation needs to be put in place of course.</p>When all data is correct we can save our data in the session, and </p>also set up a cookie that will remember the info for the visitor's next visit to the site if he/she requested it.</p></p></p><p><p>The POST variable <code>remember</code> will be set to <code>on</code> when </p>the visitor checks the box, otherwise it will not be set at all. The code to set the </p>cookie will make it expire in one year.</p></p><p></p> If you are on a shared host and your site is </p>accessible under one directory it is recommended to set the next optional parameter </p>to <code>setcookie</code> to that directory to prevent cookie leaks.</p></p>