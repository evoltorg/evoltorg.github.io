---
layout: post
permalink: php_login_script_with_remember_me_feature
ratings: 32
avgrate: 4.5938
rating: 4.5
categories: [Code]
user: jpmaster77
real_name: "JP "
user_biog: ""
user_since: 10 Jan 2004
avatar: 
article_count: 2
excerpt: "This tutorial will teach you how to create a login member system with the popular \"Remember me\" feature. Allows use of MySQL and flat file databases."
---
<h2>Introduction</h2></p><p></p>I just started programming with PHP and MySQL this week and the first script I wanted to write was a login script. I wanted to include the popular "Remember Me" feature seen on a lot of websites that basically keeps users logged into the website, even after they've closed the browser so that the next time they come, they won't have to login again manually.</p></p></p><p></p>I found this tutorial <a href="http://www.free2code.net/tutorials/programming/php/4/phplogin.php">Creating a PHP Login Script</a> to be very helpful in writing this script, in fact, a lot of the code presented here is very similar to the code presented in that tutorial. The differences are seen with the new "Remember Me" feature, the use of cookies in addition to sessions, and with slight modifications in the design.</p></p></p><p><h2>Goals</h2></p><p></p>The ultimate goal is to create a PHP login script with the capability of remembering logged-in users. I also hope this tutorial will serve as a way to introduce people to user sessions and cookies in PHP.</p></p></p><p><h3>Notes</h3></p><p></p>Although this tutorial uses a MySQL database for storing user information, it has been written so that the data accessing code is separated from the main code through specific functions, so it would be easy to instead use a flat file "database" system, simply by changing the code in those specific functions, without messing with the rest. </p>This tutorial uses the latest and greatest of PHP 4, which means super globals are used, such as $_POST, $_SESSION, etc.. This tutorial will aim to teach you about sessions and cookies through example, however if you need to know more information, go to the <a href="http://www.php.net">official website </a>.</p></p></p><p><h2>Database</h2></p><p></p>For those of you planning on using a flat file system, you can skip this section. For the rest of us, we want to create a MySQL database table that holds user information, here it is:</p></p></p><p><pre></p>CREATE TABLE users (</p>&nbsp; &nbsp; username varchar(30),</p>&nbsp; &nbsp; password varchar(32));</p></pre></p><p><p></p>Of course this table can be modified according to your needs, however the password field must not be less than 32 because it has to store the md5 encrypted versions of passwords which are 32 bytes.</p></p></p><p><h3>database.php</h3></p><p></p>This file will contain the code that connects you to your MySQL database and the functions that access user information, you need to modify this to show your MySQL username, password and database.</p></p></p><p><pre></p>&lt;?</p><p>/**</p> * Connect to the mysql database.</p> */</p>$conn = mysql_connect("localhost", "your_username", "your_password") or die(mysql_error());</p>mysql_select_db('your_database', $conn) or die(mysql_error());</p><p>?&gt;</p></pre></p><p></p><h2>Allow Users to Sign-Up</h2></p><p></p>Before we can login users, we need users. Here we will focus on the code that allows users to sign-up, registering their username and password.</p></p></p><p><h3>register.php</h3></p><pre></p>&lt;?</p>session_start(); </p>include("database.php");</p><p>/**</p> * Returns true if the username has been taken</p> * by another user, false otherwise.</p> */</p>function usernameTaken($username){</p>   global $conn;</p>   if(!get_magic_quotes_gpc()){</p>      $username = addslashes($username);</p>   }</p>   $q = "select username from users where username = '$username'";</p>   $result = mysql_query($q,$conn);</p>   return (mysql_numrows($result) &gt; 0);</p>}</p><p>/**</p> * Inserts the given (username, password) pair</p> * into the database. Returns true on success,</p> * false otherwise.</p> */</p>function addNewUser($username, $password){</p>   global $conn;</p>   $q = "INSERT INTO users VALUES ('$username', '$password')";</p>   return mysql_query($q,$conn);</p>}</p><p>/**</p> * Displays the appropriate message to the user</p> * after the registration attempt. It displays a </p> * success or failure status depending on a</p> * session variable set during registration.</p> */</p>function displayStatus(){</p>   $uname = $_SESSION['reguname'];</p>   if($_SESSION['regresult']){</p>?&gt;</p><p>&lt;h1&gt;Registered!&lt;/h1&gt;</p>&lt;p&gt;Thank you &lt;b&gt;&lt;? echo $uname; ?&gt;&lt;/b&gt;, your information has been added to the database, you may now &lt;a href="main.php" title="Login"&gt;log in&lt;/a&gt;.&lt;/p&gt;</p><p>&lt;?</p>   }</p>   else{</p>?&gt;</p><p>&lt;h1&gt;Registration Failed&lt;/h1&gt;</p>&lt;p&gt;We're sorry, but an error has occurred and your registration for the username &lt;b&gt;&lt;? echo $uname; ?&gt;&lt;/b&gt;, could not be completed.&lt;br&gt;</p>Please try again at a later time.&lt;/p&gt;</p><p>&lt;?</p>   }</p>   unset($_SESSION['reguname']);</p>   unset($_SESSION['registered']);</p>   unset($_SESSION['regresult']);</p>}</p><p>if(isset($_SESSION['registered'])){</p>/**</p> * This is the page that will be displayed after the</p> * registration has been attempted.</p> */</p>?&gt;</p><p>&lt;html&gt;</p>&lt;title&gt;Registration Page&lt;/title&gt;</p>&lt;body&gt;</p><p>&lt;? displayStatus(); ?&gt;</p><p>&lt;/body&gt;</p>&lt;/html&gt;</p><p>&lt;?</p>   return;</p>}</p><p>/**</p> * Determines whether or not to show to sign-up form</p> * based on whether the form has been submitted, if it</p> * has, check the database for consistency and create</p> * the new account.</p> */</p>if(isset($_POST['subjoin'])){</p>   /* Make sure all fields were entered */</p>   if(!$_POST['user']    !$_POST['pass']){</p>      die('You didn\'t fill in a required field.');</p>   }</p><p>   /* Spruce up username, check length */</p>   $_POST['user'] = trim($_POST['user']);</p>   if(strlen($_POST['user']) &gt; 30){</p>      die("Sorry, the username is longer than 30 characters, please shorten it.");</p>   }</p><p>   /* Check if username is already in use */</p>   if(usernameTaken($_POST['user'])){</p>      $use = $_POST['user'];</p>      die("Sorry, the username: &lt;strong&gt;$use&lt;/strong&gt; is already taken, please pick another one.");</p>   }</p><p>   /* Add the new account to the database */</p>   $md5pass = md5($_POST['pass']);</p>   $_SESSION['reguname'] = $_POST['user'];</p>   $_SESSION['regresult'] = addNewUser($_POST['user'], $md5pass);</p>   $_SESSION['registered'] = true;</p>   echo "&lt;meta http-equiv=\"Refresh\" content=\"0;url=$HTTP_SERVER_VARS[PHP_SELF]\"&gt;";</p>   return;</p>}</p>else{</p>/**</p> * This is the page with the sign-up form, the names</p> * of the input fields are important and should not</p> * be changed.</p> */</p>?&gt;</p><p>&lt;html&gt;</p>&lt;title&gt;Registration Page&lt;/title&gt;</p>&lt;body&gt;</p>&lt;h1&gt;Register&lt;/h1&gt;</p>&lt;form action="&lt;? echo $HTTP_SERVER_VARS['PHP_SELF']; ?&gt;" method="post"&gt;</p>&lt;table align="left" border="0" cellspacing="0" cellpadding="3"&gt;</p>&lt;tr&gt;&lt;td&gt;Username:&lt;/td&gt;&lt;td&gt;&lt;input type="text" name="user" maxlength="30"&gt;&lt;/td&gt;&lt;/tr&gt;</p>&lt;tr&gt;&lt;td&gt;Password:&lt;/td&gt;&lt;td&gt;&lt;input type="password" name="pass" maxlength="30"&gt;&lt;/td&gt;&lt;/tr&gt;</p>&lt;tr&gt;&lt;td colspan="2" align="right"&gt;&lt;input type="submit" name="subjoin" value="Join!"&gt;&lt;/td&gt;&lt;/tr&gt;</p>&lt;/table&gt;</p>&lt;/form&gt;</p>&lt;/body&gt;</p>&lt;/html&gt;</p><p></p>&lt;?</p>}</p>?&gt;</p></pre></p><p><p></p>Read through the code and see what it's doing, there are comments there to help you. It was written with you in mind, I tried to make it so people could just paste their website specific html code in between the php code with ease. Don't be scared when you see the use of session variables right away, they are used to tell the script key information like the requested username, registration attempt and registration success. With this information the script knows what to display, and when the registration is done, it "forgets" the information (by unsetting the variables).</p></p></p><p><h3>Note</h3></p><p></p>You'll notice that the script immediately refreshes itself after the registration request, this is done to eliminate the case where users, for any reason, hit the Refresh button on their browser and cause a pop-up window that says the page has expired and prompts the user to send the registration request again. This technique is also used in the login script, so watch out for it.</p></p></p><p><h2>Allow Users to Log-In</h2></p><p></p>Now the fun begins, now that we have users, we can log them in. This is the heart of this tutorial, it will create the login script with the "Remember me" feature that we all want, and it accomplishes this by using cookies.</p></p></p><p><h3>login.php</h3></p><pre></p>&lt;?</p><p>/**</p> * Checks whether or not the given username is in the</p> * database, if so it checks if the given password is</p> * the same password in the database for that user.</p> * If the user doesn't exist or if the passwords don't</p> * match up, it returns an error code (1 or 2). </p> * On success it returns 0.</p> */</p>function confirmUser($username, $password){</p>   global $conn;</p>   /* Add slashes if necessary (for query) */</p>   if(!get_magic_quotes_gpc()) {</p>	$username = addslashes($username);</p>   }</p><p>   /* Verify that user is in database */</p>   $q = "select password from users where username = '$username'";</p>   $result = mysql_query($q,$conn);</p>   if(!$result    (mysql_numrows($result) &lt; 1)){</p>      return 1; //Indicates username failure</p>   }</p><p>   /* Retrieve password from result, strip slashes */</p>   $dbarray = mysql_fetch_array($result);</p>   $dbarray['password']  = stripslashes($dbarray['password']);</p>   $password = stripslashes($password);</p><p>   /* Validate that password is correct */</p>   if($password == $dbarray['password']){</p>      return 0; //Success! Username and password confirmed</p>   }</p>   else{</p>      return 2; //Indicates password failure</p>   }</p>}</p><p>/**</p> * checkLogin - Checks if the user has already previously</p> * logged in, and a session with the user has already been</p> * established. Also checks to see if user has been remembered.</p> * If so, the database is queried to make sure of the user's </p> * authenticity. Returns true if the user has logged in.</p> */</p>function checkLogin(){</p>   /* Check if user has been remembered */</p>   if(isset($_COOKIE['cookname']) && isset($_COOKIE['cookpass'])){</p>      $_SESSION['username'] = $_COOKIE['cookname'];</p>      $_SESSION['password'] = $_COOKIE['cookpass'];</p>   }</p><p>   /* Username and password have been set */</p>   if(isset($_SESSION['username']) && isset($_SESSION['password'])){</p>      /* Confirm that username and password are valid */</p>      if(confirmUser($_SESSION['username'], $_SESSION['password']) != 0){</p>         /* Variables are incorrect, user not logged in */</p>         unset($_SESSION['username']);</p>         unset($_SESSION['password']);</p>         return false;</p>      }</p>      return true;</p>   }</p>   /* User not logged in */</p>   else{</p>      return false;</p>   }</p>}</p><p>/**</p> * Determines whether or not to display the login</p> * form or to show the user that he is logged in</p> * based on if the session variables are set.</p> */</p>function displayLogin(){</p>   global $logged_in;</p>   if($logged_in){</p>      echo "&lt;h1&gt;Logged In!&lt;/h1&gt;";</p>      echo "Welcome &lt;b&gt;$_SESSION[username]&lt;/b&gt;, you are logged in. &lt;a href=\"logout.php\"&gt;Logout&lt;/a&gt;";</p>   }</p>   else{</p>?&gt;</p><p>&lt;h1&gt;Login&lt;/h1&gt;</p>&lt;form action="" method="post"&gt;</p>&lt;table align="left" border="0" cellspacing="0" cellpadding="3"&gt;</p>&lt;tr&gt;&lt;td&gt;Username:&lt;/td&gt;&lt;td&gt;&lt;input type="text" name="user" maxlength="30"&gt;&lt;/td&gt;&lt;/tr&gt;</p>&lt;tr&gt;&lt;td&gt;Password:&lt;/td&gt;&lt;td&gt;&lt;input type="password" name="pass" maxlength="30"&gt;&lt;/td&gt;&lt;/tr&gt;</p>&lt;tr&gt;&lt;td colspan="2" align="left"&gt;&lt;input type="checkbox" name="remember"&gt;</p>&lt;font size="2"&gt;Remember me next time&lt;/td&gt;&lt;/tr&gt;</p>&lt;tr&gt;&lt;td colspan="2" align="right"&gt;&lt;input type="submit" name="sublogin" value="Login"&gt;&lt;/td&gt;&lt;/tr&gt;</p>&lt;tr&gt;&lt;td colspan="2" align="left"&gt;&lt;a href="register.php"&gt;Join&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;</p>&lt;/table&gt;</p>&lt;/form&gt;</p><p>&lt;?</p>   }</p>}</p><p></p>/**</p> * Checks to see if the user has submitted his</p> * username and password through the login form,</p> * if so, checks authenticity in database and</p> * creates session.</p> */</p>if(isset($_POST['sublogin'])){</p>   /* Check that all fields were typed in */</p>   if(!$_POST['user']    !$_POST['pass']){</p>      die('You didn\'t fill in a required field.');</p>   }</p>   /* Spruce up username, check length */</p>   $_POST['user'] = trim($_POST['user']);</p>   if(strlen($_POST['user']) &gt; 30){</p>      die("Sorry, the username is longer than 30 characters, please shorten it.");</p>   }</p><p>   /* Checks that username is in database and password is correct */</p>   $md5pass = md5($_POST['pass']);</p>   $result = confirmUser($_POST['user'], $md5pass);</p><p>   /* Check error codes */</p>   if($result == 1){</p>      die('That username doesn\'t exist in our database.');</p>   }</p>   else if($result == 2){</p>      die('Incorrect password, please try again.');</p>   }</p><p>   /* Username and password correct, register session variables */</p>   $_POST['user'] = stripslashes($_POST['user']);</p>   $_SESSION['username'] = $_POST['user'];</p>   $_SESSION['password'] = $md5pass;</p><p>   /**</p>    * This is the cool part: the user has requested that we remember that</p>    * he's logged in, so we set two cookies. One to hold his username,</p>    * and one to hold his md5 encrypted password. We set them both to</p>    * expire in 100 days. Now, next time he comes to our site, we will</p>    * log him in automatically.</p>    */</p>   if(isset($_POST['remember'])){</p>      setcookie("cookname", $_SESSION['username'], time()+60*60*24*100, "/");</p>      setcookie("cookpass", $_SESSION['password'], time()+60*60*24*100, "/");</p>   }</p><p>   /* Quick self-redirect to avoid resending data on refresh */</p>   echo "&lt;meta http-equiv=\"Refresh\" content=\"0;url=$HTTP_SERVER_VARS[PHP_SELF]\"&gt;";</p>   return;</p>}</p><p>/* Sets the value of the logged_in variable, which can be used in your code */</p>$logged_in = checkLogin();</p><p>?&gt;</p></pre></p><p></p>This one's a little bit tricky because of the function calling. Let me just clarify what this script does.</p></p><p><p>It first checks to see if the login form has just been filled out and submitted, if not it checks to see if a session has already been established where the username and password are already known. This is true in two cases, when the user has chosen to be remembered and a session is established automatically, or when the user has not chosen to be remembered but has already logged in and is still using the same browser window that he used to log in.</p> </p><p>If either of these two cases is true, then it verifies that the username is in the database and that the password is valid, if these two checks pass then the almighty $logged_in variable is set to true, false otherwise. If the user has just filled out the login form and submitted it, the script detects this and then verifies the authenticity of the username and password, if all is well then session variables are set with the username and md5 encrypted password.</p></p></p><p></p>Great, but when does the login form get displayed? That's all up to you. It's up to you the programmer to display the login form when the $logged_in variable is false. But wait! I have added a function that you can call that relieves you of this horrible burden. The displayLogin() function is there to check if the $logged_in variable is true or not and displays information accordingly. How to use this function is described in the Usage section.</p></p></p><h3>Note</h3></p><p></p>login.php is not meant to be a stand-alone file like register.php, it is meant to be included at the top of every file that needs to use it, so it doesn't contain the call to "session_start()", that should be at the top of the file that wants to include login.php, as you will see in the examples below. </p></p></p><p><h2>Remember Me Feature</h2></p><p></p>So, how was this accomplished again? As is described in login.php, when a user chooses to be remembered, two cookies are set on the user's computer. Well, really one cookie, but one that contains two important pieces of information: the username and the md5 encrypted password. What is a cookie anyways? It is a temporary file that is stored on the user's computer on behalf of the website in order to hold information that is important to the website. How long does this temporary file last? As long as we say so. As written, the expiry time is 100 days, after which the cookie will be deleted. However, it also gets deleted when the user decides to log out, as you will soon see.</p></p></p><p><h2>Allow Users to Log-Out</h2></p><p></p>If users want to log-out, we should let them. All we need to do is delete the cookies we've set if they chose to be remembered, and simply unset the session variables. Done.</p></p></p><p><h3>logout.php</h3></p><pre></p>&lt;?</p>session_start(); </p>include("database.php");</p>include("login.php");</p><p>/**</p> * Delete cookies - the time must be in the past,</p> * so just negate what you added when creating the</p> * cookie.</p> */</p>if(isset($_COOKIE['cookname']) && isset($_COOKIE['cookpass'])){</p>   setcookie("cookname", "", time()-60*60*24*100, "/");</p>   setcookie("cookpass", "", time()-60*60*24*100, "/");</p>}</p><p>?&gt;</p><p>&lt;html&gt;</p>&lt;title&gt;Logging Out&lt;/title&gt;</p>&lt;body&gt;</p><p>&lt;?</p><p>if(!$logged_in){</p>   echo "&lt;h1&gt;Error!&lt;/h1&gt;</p>";</p>   echo "You are not currently logged in, logout failed. Back to &lt;a href=\"main.php\"&gt;main&lt;/a&gt;";</p>}</p>else{</p>   /* Kill session variables */</p>   unset($_SESSION['username']);</p>   unset($_SESSION['password']);</p>   $_SESSION = array(); // reset session array</p>   session_destroy();   // destroy session.</p><p>   echo "&lt;h1&gt;Logged Out&lt;/h1&gt;</p>";</p>   echo "You have successfully &lt;b&gt;logged out&lt;/b&gt;. Back to &lt;a href=\"main.php\"&gt;main&lt;/a&gt;";</p>}</p><p>?&gt;</p><p>&lt;/body&gt;</p>&lt;/html&gt;</p></pre></p><p></p>You're probably wondering why login.php was included in logout.php, seems a little weird right? Well, if the user is not logged in how can we log them out? We use login.php to verify that the user really is logged in with the help of the variable $logged_in which gets set when login.php is run.</p></p></p><p><h2>Flat File Database</h2></p><p></p>If you don't have MySQL, don't worry, you can still use this script! All you would have to do is change the following functions to include your flat file user management code, but remember to keep the operations and return values consistent with the documentation.</p></p></p><ul></p><li><strong>In register.php</strong> - change usernameTaken() and addNewUser()</li></p><li><strong>In login.php</strong> - change confirmUser() and checkLogin()</li></p></ul></p><p><h2>Usage</h2></p><p></p>Now that everything has been coded, all that's left is for you to know how to actually use this beast.</p></p></p><ul></p><li><strong>database.php</strong> - make sure you put your own MySQL information into it</li></p><li><strong>register.php and logout.php</strong> - no changes needed, however you could change the html to reflect that of your website</li></p><li><strong>login.php</strong> - In order to use it within a file you must call "session_start()" before the line where you include login.php.</li></p></ul></p><p></p>I've mentioned the function "displayLogin()" found within login.php. If you call it within one of your files, it will display the login form if no user is logged in, if a user is logged in, it displays a message reflecting such. The point of this is so that you won't have to include that code in all of your files, all you have to do is just call the function:</p></p></p><h3>Example: main.php</h3></p><pre></p>&lt;? </p>/* Include Files *********************/</p>session_start(); </p>include("database.php");</p>include("login.php");</p>/*************************************/</p>?&gt;</p><p>&lt;html&gt;</p>&lt;title&gt;Jpmaster77's Login Script&lt;/title&gt;</p>&lt;body&gt;</p><p>&lt;? displayLogin(); ?&gt;</p><p>&lt;/body&gt;</p>&lt;/html&gt;</p></pre></p><p></p>You should also know that login.php sets a boolean variable called $logged_in, which is true when a user is logged in, and false when no user is logged in. You can use this variable in your files for whatever you'd like.</p></p></p><h3>Example: main2.php</h3></p><pre></p>&lt;? </p>/* Include Files *********************/</p>session_start(); </p>include("database.php");</p>include("login.php");</p>/*************************************/</p>?&gt;</p><p>&lt;html&gt;</p>&lt;title&gt;Jpmaster77's Login Script&lt;/title&gt;</p>&lt;body&gt;</p><p>&lt;? </p>if($logged_in){</p>   echo 'Logged in as '.$_SESSION['username'].', &lt;a href="logout.php"&gt;logout&lt;/a&gt;';</p>}else{</p>   echo 'Not logged in.';</p>}</p>?&gt;</p><p>&lt;/body&gt;</p>&lt;/html&gt;</p></pre></p><p><h2>Improvements</h2></p><p></p>What can make this script even better? Well, you can add a check to enforce that usernames are strictly alphanumeric, without any wacky characters. At registration, you probably want more info from the user (email, homepage, location,..), but this script is about user logins, so we only focused on the username and password.</p> </p><p><p>Also the error pages are not very cool, for example, when someone doesn't enter a field thats required from the form, instead of just stopping and printing an error message, you can redirect him to the form again, but have specified which field was left blank (in red lettering possibly). There's more that I'm sure you'll think of.</p></p></p><p><h2>Conclusion</h2></p><p></p>I hope you were able to learn something from my script, and if you choose to use my script on your site, I hope you enjoy it. Good luck programming!</p></p>