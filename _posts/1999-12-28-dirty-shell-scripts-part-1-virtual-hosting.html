---
layout: post
permalink: node/653
ratings: 1
avgrate: 4.0000
category: Code
user: djc
real_name: "Daniel Cody"
user_since: 14 Dec 1998
avatar: ""
article_count: 146
excerpt: "If you run any type of Web hosting service like me, you know what a pain in the ass it can be to have to add new virtual hosts to your Web server. If you have Linux and Apache, here's a quick'n'dir"
---
<p>If you run any type of Web hosting service like me, you know what a pain in the ass it can be to have to add new virtual hosts to your Web server. If you have Linux and Apache, here's a quick'n'dirty little script that will save you a ton of time:</p></p></p><pre></p>if [ -t 0 ] # Make sure stdio is a terminal</p>then</p>        echo &quot;Enter the new hostname:&quot;;</p>        read arg1</p>        /usr/sbin/useradd -s /bin/false $arg1;</p>        echo &quot;User added...&quot;;</p>        sed -e &quot;s/name.com/$arg1/g&quot; virthost.conf &gt;&gt; httpd.conf;</p>        /usr/local/apache/bin/apachectl restart;</p>        echo &quot;$arg1 was added and Apache restarted. You're so sexy!&quot;;</p>        chmod 755 /home/$arg1;</p>else</p>        echo &quot;Houston, we had a problem!&quot;</p>fi</p></pre></p><p></p>Step by step:</p></p></p><ul></p><LI>Basically, the script takes input from the terminal, and makes whatever you typed in the variable 'arg1'.</LI></p><LI>Next, we create a user account for the new domain.</LI></p><LI>The line that does most of the work, 'sed -e ...' is next. We're simply doing a searching for <strong>name.com</strong> and replacing it with the name of our new domain. It does the search and replace on a file named <strong>virthost.conf</strong>, which simply contains the Apache &lt;VirtualHost&gt; directive. Here's what my virthost.conf looks like:<br /></p><p><pre></p>&lt;VirtualHost 10.10.10.10&gt;</p>ServerName www.name.com</p>DocumentRoot /home/name.com/public_html</p>CustomLog /home/name.com/web.log combined</p>CustomLog /home/name.com/main.referer.log referer</p>&lt;/VirtualHost&gt;</p></pre></p><p>Naturally, you'll replace the IP address 10.10.10.10 with the IP address of your webserver.</p>This step finishes up by appending what it replaced in virthost.conf to your httpd.conf(Apache config) file - while leaving the virthost.conf file intact.</LI></p><LI>The script finishes up by restarting Apache, <B>chmod</B>'ing the users directory and letting you know how of your sexual prowess.</LI></p><LI>To get everything to run, copy and paste the virthost.conf file above and save it in $your_apache_home/conf - same with the script itself, cut and paste it into $your_apache_home/conf and save it as newhost.sh(Don't forget to set it executable!). Everything should work pretty smurfy. If not, post a question below and I'll try to help ya out :)</p></LI></p></UL></p><p><P></p>Now, this script is extremelly lacking in the error and exception checking department, so use at your own risk. Like I said, its quick'n'dirty :) However, if you are adding a couple virtual host's a day to your httpd.conf file, you'll soon be wonder where you would be without a script to do the grunt work for you..</P></p><P></p>Next time we'll throw together a script that will make updating your DNS servers a snap. If you have any other ideas for shell scripts that would make your life easier, and like to see them here, <a href="mailto:djc@members.evolt.org">email me</a> or put your suggestion below!</p><p></P>