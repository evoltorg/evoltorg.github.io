---
layout: post
permalink: node/26896
---
<p>\n&quot;Collinstwerp!&quot;</p>\n<p>&quot;That's Collinsworth, sir,&quot; you say, meakly.</p>\n<p>&quot;Whatever Collinearth, I need to see some trending data on sales...<em>NOW!</em>&quot;</p>\n<p>&quot;It's Collinsworth sir,&quot; you repeat</p>\n<p>&quot;Can I get that in my speadsheet thingie Collinsyurp?!?", he continues to yell.</p>\n<p>&quot;I'll get on it right away! mumbling*you pig-headed freak*mumbling,&quot; as you head for your cube.\n</p></p><p><p>\nNumber crunchers just love spreadsheets, the numbers, the colors, the graphs, and all of the functions for bending and shaping the numbers to do their bidding. And they like them a certain way, usually as a pivot table where the columns represent groups of data, the rows represent groups of data, and at the intersection of a row and column is the number that they are looking for, as in this example;\n</p></p><p><table class="data" cellspacing="0">\n <thead>\n  <tr valign="top">\n   <th>&nbsp;</th>  \n   <th>Water Pistols</th>\n   <th>Balloons</th>\n   <th>Party Packs</th>\n   <th>Streamers</th>\n   <th>Total Shipped Today</th>\n  </tr>\n </thead>\n<tbody>\n <tr valign="top">\n  <td align="right">2002-03-01</td>\n  <td align="right">270</td>\n  <td align="right">352</td>\n  <td align="right">368</td>\n  <td align="right">360</td>\n  <td align="right">1350</td>\n </tr>\n <tr valign="top">\n  <td align="right">2002-03-02</td>\n  <td align="right">250</td>\n  <td align="right">212</td>\n  <td align="right">374</td>\n  <td align="right">310</td>\n  <td align="right">1146</td>\n </tr>\n <tr valign="top">\n  <td align="right">2002-03-03</td>\n  <td align="right">167</td>\n  <td align="right">208</td>\n  <td align="right">421</td>\n  <td align="right">311</td>\n  <td align="right">1107</td>\n </tr>\n <tr valign="top">\n  <td align="right">2002-03-04</td>\n  <td align="right">165</td>\n  <td align="right">223</td>\n  <td align="right">404</td>\n  <td align="right">297</td>\n  <td align="right">1089</td>\n </tr>\n <tr valign="top">\n  <td align="right">2002-03-05</td>\n  <td align="right">115</td>\n  <td align="right">214</td>\n  <td align="right">409</td>\n  <td align="right">301</td>\n  <td align="right">1039</td>\n </tr>\n</tbody>\n<tfoot>\n <tr valign="top">\n  <td align="right">Total By Items</td>\n  <td align="right">967</td>\n  <td align="right">1209</td>\n  <td align="right">1976</td>\n  <td align="right">1279</td>\n  <td align="right">&nbsp;</td>\n </tr>\n</tfoot>\n</table></p><p><p>\nYou need to make it as easy as possible, a one-click link to the data. What is a developer to do?\n</p></p><p><h2>Set Up Some Test Data</h2></p><p><p>Let's create a table, and some data to work with:</p></p><p><pre>\nCREATE TABLE `tblProductToy` (\n  `ID` int(11) NOT NULL auto_increment,\n  `Toy` varchar(32) default NULL,\n  `DateShipped` varchar(10) default NULL,\n  `NumberShipped` int(11) default NULL,\n  PRIMARY KEY  (`ID`)\n)\n</pre></p><p><pre>\ninsert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Water Pistol', '2002-03-01', '36');\ninsert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Water Pistol', '2002-03-01', '12');\ninsert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Water Pistol', '2002-03-01', '11');\ninsert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Water Pistol', '2002-03-01', '14');\ninsert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Balloon', '2002-03-01', '36');\ninsert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Water Pistol', '2002-03-01', '36');\ninsert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Water Pistol', '2002-03-03', '11');\ninsert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Water Pistol', '2002-03-02', '14');\ninsert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Water Pistol', '2002-03-04', '36');\ninsert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Water Pistol', '2002-03-06', '12');\ninsert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Balloon', '2002-03-03', '17');\ninsert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Balloon', '2002-03-04', '13');\ninsert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Party Pack', '2002-03-02', '14');\ninsert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Party Pack', '2002-03-04', '36');\ninsert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Party Pack', '2002-03-06', '12');\ninsert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Party Pack', '2002-03-03', '17');\ninsert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Party Pack', '2002-03-04', '13');\ninsert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Water Pistol', '2002-03-01', '14');\ninsert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Balloon', '2002-03-01', '36');\ninsert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Water Pistol', '2002-03-01', '36');\ninsert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Water Pistol', '2002-03-03', '11');\ninsert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Water Pistol', '2002-03-02', '14');\ninsert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Streamer', '2002-03-04', '36');\ninsert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Streamer', '2002-03-06', '12');\ninsert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Streamer', '2002-03-03', '17');\ninsert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Streamer', '2002-03-04', '13');\ninsert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Streamer', '2002-03-02', '14');\ninsert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Streamer', '2002-03-04', '36');\n</pre></p><p><p>\nIf you select all of the data in the table it will look something like this;\n</p></p><p><pre>\nmysql> select * from tblProductToy;\n+----+--------------+-------------+---------------+\n  ID   Toy            DateShipped   NumberShipped  \n+----+--------------+-------------+---------------+\n   1   Water Pistol   2002-03-01               36  \n   2   Water Pistol   2002-03-01               12  \n   3   Water Pistol   2002-03-01               11  \n   4   Water Pistol   2002-03-01               14  \n   5   Balloon        2002-03-01               36  \n   6   Water Pistol   2002-03-01               36  \n   7   Water Pistol   2002-03-03               11  \n   8   Water Pistol   2002-03-02               14  \n   9   Water Pistol   2002-03-04               36  \n  10   Water Pistol   2002-03-06               12  \n  11   Balloon        2002-03-03               17  \n  12   Balloon        2002-03-04               13  \n  13   Party Pack     2002-03-02               14  \n  14   Party Pack     2002-03-04               36  \n  15   Party Pack     2002-03-06               12  \n  16   Party Pack     2002-03-03               17  \n  17   Party Pack     2002-03-04               13  \n  18   Water Pistol   2002-03-01               14  \n  19   Balloon        2002-03-01               36  \n  20   Water Pistol   2002-03-01               36  \n  21   Water Pistol   2002-03-03               11  \n  22   Water Pistol   2002-03-02               14  \n  23   Streamer       2002-03-04               36  \n  24   Streamer       2002-03-06               12  \n  25   Streamer       2002-03-03               17  \n  26   Streamer       2002-03-04               13  \n  27   Streamer       2002-03-02               14  \n  28   Streamer       2002-03-04               36  \n+----+--------------+-------------+---------------+\n28 rows in set (0.02 sec)\n</pre></p><p><p>\nHow are we going to turn this into something that looks like our example above?\n</p></p><p><h2>Do It At The Data Level</h2></p><p><p>\nWhat you need to know about first of all is a handy little thing called a crosstab query. Using a crosstab you can output the data from the database into a table format with almost everything you need to deliver a spreadsheet. Here is the full crosstab query for this table to show how many of each item were shipped on a particular date;\n</p></p><p><pre>\nSELECT DateShipped,\nSUM(IF(Toy = 'Water Pistol', NumberShipped, 0)) AS "Water Pistols",\nSUM(IF(Toy = 'Balloon', NumberShipped, 0)) AS "Balloons",\nSUM(IF(Toy = 'Party Pack', NumberShipped, 0)) AS "Party Packs",\nSUM(IF(Toy = 'Streamer', NumberShipped, 0)) AS "Streamers"\nFROM tblProductToy\nGROUP BY DateShipped\n</pre></p><p><p>\nIf you run this query against the data we created above you will get the following results;\n</p></p><p><pre>\n+-------------+---------------+----------+-------------+-----------+\n  DateShipped   Water Pistols   Balloons   Party Packs   Streamers  \n+-------------+---------------+----------+-------------+-----------+\n  2002-03-01              159         72             0           0  \n  2002-03-02               28          0            14          14  \n  2002-03-03               22         17            17          17  \n  2002-03-04               36         13            49          85  \n  2002-03-06               12          0            12          12  \n+-------------+---------------+----------+-------------+-----------+\n</pre></p><p><p>\nPretty slick, eh? It works like this, first we get the data we wish to group by, <code>SELECT DateShipped</code>. Then we do something that looks complicated, but in reality is quite simple. For each product in the table we write a line of SQL that looks like this, <code>SUM(IF(Toy = 'Water Pistol', NumberShipped, 0)) AS "Water Pistols"</code>. What does this line do? Let's break it down;\n</p></p><p><p>\n<ul>\n<li><code>SUM( </code> will total the information that we tell it to, in this case the values returned by the IF statement</li>\n<li><code>IF(Toy = 'Water Pistol', </code> determines if this column value exists</li>\n<li><code> NumberShipped, </code> gets the value from this column if <code> Toy = 'Water Pistol'</code> is true</li>\n<li><code> 0)) </code> makes the value zero if <code>Toy = 'Water Pistol'</code> is false</li>\n<li><code> AS "Water Pistols" </code> gives the result column a name</li>\n</ul>\n</p></p><p><p>\nOf course, <code>FROM tblProductToy</code> tells the query which table, and <code>GROUP BY DateShipped</code> groups the records together by date with the proper totals. If you wanted to count the shipments of each item per day change <code>NumberShipped</code> to <code>1</code> in each of the <code>SUM...IF</code> statements. There are many functions available to MySQL as well as many other database management packages that will allow you to do things like average results or use conditional expressions to generate results.\n</p></p><p><p>\nWe still don't have some of the numbers we need though, such as &quot;Total Shipped Today&quot so lets change our query, adding the line <code>sum(NumberShipped) as "Total Shipped Today"</code> ;\n</p></p><p><pre>\nSELECT DateShipped,\nSUM(if(Toy = 'Water Pistol', NumberShipped, 0)) AS "Water Pistols",\nSUM(if(Toy = 'Balloon', NumberShipped, 0)) AS "Balloons",\nSUM(if(Toy = 'Party Pack', NumberShipped, 0)) AS "Party Packs",\nSUM(if(Toy = 'Streamer', NumberShipped, 0)) AS "Streamers",\nSUM(NumberShipped) AS "Total Shipped Today"\nFROM tblProductToy\nGROUP BY DateShipped\n</pre></p><p><p>\nRunning this query gives us the following results;\n</p></p><p><pre>\n+-------------+---------------+----------+-------------+-----------+---------------------+\n  DateShipped   Water Pistols   Balloons   Party Packs   Streamers   Total Shipped Today  \n+-------------+---------------+----------+-------------+-----------+---------------------+\n  2002-03-01              159         72             0           0                   231  \n  2002-03-02               28          0            14          14                    56  \n  2002-03-03               22         17            17          17                    73  \n  2002-03-04               36         13            49          85                   183  \n  2002-03-06               12          0            12          12                    36  \n+-------------+---------------+----------+-------------+-----------+---------------------+\n</pre></p><p><p>\nVery handy. Again, if we were counting total shipments we could replace <code>SUM(NumberShipped) as "Total Shipped Today"</code> with <code>COUNT(*)</code>. Try making the replacements and see what happens.\n</p></p><p><p>\nCrosstabs enable you to get pretty complete information from your database where this kind of table is concerned, but it may not give you all you need, at least not without running another query like this one, which totals each item for the complete range of records and provides a total number of items shipped;\n</p></p><p><pre>\nSELECT SUM(IF(Toy = 'Water Pistol', NumberShipped, 0)) AS "Total Water Pistols",\nSUM(IF(Toy = 'Balloon', NumberShipped, 0)) AS "Total Balloons",\nSUM(IF(Toy = 'Party Pack', NumberShipped, 0)) AS "Total Party Packs",\nSUM(IF(Toy = 'Streamer', NumberShipped, 0)) AS "Total Streamers",\nSUM(NumberShipped) AS "Total Shipped"\nFROM tblProductToy\n</pre></p><p><p>\nWhich returns;\n</p></p><p><pre>\n+---------------------+----------------+-------------------+-----------------+---------------+\n  Total Water Pistols   Total Balloons   Total Party Packs   Total Streamers   Total Shipped  \n+---------------------+----------------+-------------------+-----------------+---------------+\n                  257              102                  92               128             579  \n+---------------------+----------------+-------------------+-----------------+---------------+\n</pre></p><p><p>\nOr we can &quot;turn the table&quot;;\n</p></p><p><pre>\nSELECT Toy,\nSUM(IF(DateShipped = '2002-03-01', NumberShipped, 0)) AS "March 1, 2002",\nSUM(IF(DateShipped = '2002-03-02', NumberShipped, 0)) AS "March 2, 2002",\nSUM(IF(DateShipped = '2002-03-03', NumberShipped, 0)) AS "March 3, 2002",\nSUM(IF(DateShipped = '2002-03-04', NumberShipped, 0)) AS "March 4, 2002",\nSUM(IF(DateShipped = '2002-03-05', NumberShipped, 0)) AS "March 5, 2002",\nSUM(IF(DateShipped = '2002-03-06', NumberShipped, 0)) AS "March 6, 2002",\nSUM(NumberShipped) AS "Total Shipped"\nFROM tblProductToy\nGROUP BY Toy;\n</pre></p><p><p>\nGetting these results;\n</p></p><p><pre>\n+--------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+\n  Toy            March 1, 2002   March 2, 2002   March 3, 2002   March 4, 2002   March 5, 2002   March 6, 2002   Total Shipped  \n+--------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+\n  Balloon                   72               0              17              13               0               0             102  \n  Party Pack                 0              14              17              49               0              12              92  \n  Streamer                   0              14              17              85               0              12             128  \n  Water Pistol             159              28              22              36               0              12             257  \n+--------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+\n</pre></p><p><p>\nThis doesn't give us a total shipped each day though and we only want to run one query to the database for these results. That means that we will have to do some calculations in our one-click link to the spreadsheet. We'll handle this in PHP, with a couple of &quot;Stupid IE Tricks&quot; thrown in for good measure.\n</p></p><p><h2>PHP To The Rescue</h2></p><p><p>\nWithin our PHP code we can place raw HTTP headers (see <a href="http://www.php.net/manual/en/function.header.php">PHP Header Function</a>, <a href="http://www.w3.org/Protocols/rfc2616/rfc2616">Hypertext Transfer Protocol - HTTP/1.1</a>, and other associated links) prior to any output from the PHP in order that the output might be utilized by applications, such as Microsoft<sup>&reg;</sup> Excel.\n</p></p><p><p>\n<code>\n&lt;?php<br>\nheader(&quot;Content-Type:  application/vnd.ms-excel&quot;);<br>\nheader(&quot;Expires: 0&quot;);<br>\nheader(&quot;Cache-Control: must-revalidate, post-check=0, pre-check=0&quot;);<br>\n?&gt;\n</code>\n</p></p><p><p>\nThe first header line sets up the application type, in this case Microsoft<sup>&reg;</sup> Excel. The second header line essentially tells the browser not to cache the information. The third header line makes sure that subsequent calls to the server are revalidated/authenticated. For further detail about HTTP headers I will refer you to the above links.\n</p></p><p><p>\nOnce we have connected to the MySQL server and selected the database we wish to use we can issue our crosstab query. \n</p></p><p><p>\n<code>\n&lt;?php<br>\n$qx = "SELECT DateShipped, ";<br>\n$qx .= "SUM(if(Toy = 'Water Pistol', NumberShipped, 0)) AS "Water Pistols", ";<br>\n$qx .= "SUM(if(Toy = 'Balloon', NumberShipped, 0)) AS "Balloons", ";<br>\n$qx .= "SUM(if(Toy = 'Party Pack', NumberShipped, 0)) AS "Party Packs", ";<br>\n$qx .= "SUM(if(Toy = 'Streamer', NumberShipped, 0)) AS "Streamers", ";<br>\n$qx .= "SUM(NumberShipped) AS "Total Shipped Today" ";<br>\n$qx .= "FROM tblProductToy ";<br>\n$qx .= "GROUP BY DateShipped ";<br>\n?&gt;\n</code>\n</p></p><p><p>\nWhich is great if we know that out list of toys is static. What if they are not? We can do two queries in PHP, using the results of one query to complete the second query. This will always give us all of the products available to analyze.\n</p></p><p><p>\n<code>\n&lt;?php<br>\n//query for toy list<br>\n$qtoy = "SELECT DISTINCT Toy ";<br>\n$qtoy .= "FROM tblProductToy ";<br>\n$qtoy .= "ORDER BY Toy ";<br>\n<br>\n$dbtoy = mysql_query($qtoy, $dbconnect);<br>\n<br>\n//query for crosstab<br>\n$qx = "SELECT DateShipped ";<br>\nwhile($rowx = mysql_fetch_object($dbtoy)){<br>\n		$qx .= ", SUM(IF(Toy = '$rowx->Toy', NumberShipped, 0)) AS Toy ";<br>\n	}<br>\n$qx .= ", SUM(NumberShipped) AS \"Total Shipped\" ";<br>\n$qx .= "FROM tblProductToy ";<br>\n$qx .= "GROUP BY DateShipped ";<br>\n?&gt;\n</code>\n</p></p><p><p>\nOne of the convenient things about doing this little project is the fact that Excel &quot;understands&quot; tables formatted in HTML, which is how we are going to output the table. You can output the information as comma seperated values (CSV) or other formats as well. Sending the output in HTML format also gives us the chance to easily apply style information, either from CSS or inline.\n</p></p><p><p>\nHere is the entire code for crosstab.php;\n</p></p><p><pre>\n&lt;?php\nheader("Content-Type:  application/vnd.ms-excel");\nheader("Expires: 0");\nheader("Cache-Control: must-revalidate, post-check=0, pre-check=0");</p><p>//connect to and select database\nif(!($dbconnect = mysql_pconnect("127.0.0.1", "user", "password"))){\n	print("Failed to connect to database!\n");\n	exit();\n	}\nif(!mysql_select_db("test", $dbconnect)){\n	print("Failed to select database!\n");\n	exit();\n	}</p><p>//query for toy list\n$qtoy = "SELECT DISTINCT Toy ";\n$qtoy .= "FROM tblProductToy ";\n$qtoy .= "ORDER BY Toy ";</p><p>if(!($dbtoy = mysql_query($qtoy, $dbconnect))){\n	print("MySQL reports: " . mysql_error() . "\n");\n	exit();\n	}</p><p>//query for crosstab\n$qx = "SELECT DateShipped ";\nwhile($rowx = mysql_fetch_object($dbtoy)){\n		$qx .= ", SUM(IF(Toy = '$rowx->Toy', NumberShipped, 0)) AS Toy ";\n	}\n$qx .= ", SUM(NumberShipped) AS \"Total Shipped\" ";\n$qx .= "FROM tblProductToy ";\n$qx .= "GROUP BY DateShipped ";</p><p>//print($qx);</p><p>if(!($dbx = mysql_query($qx, $dbconnect))){\n	print("MySQL reports: " . mysql_error() . "\n");\n	exit();\n	}\n?&gt;\n&lt;table border="1"&gt;\n&lt;tr&gt;\n&lt;td bgcolor="#FFFFCC"&gt;&lt;/td&gt;\n&lt;? php\nmysql_data_seek($dbtoy, 0);\n	while($rowx = mysql_fetch_object($dbtoy)){\n		print("&lt;td bgcolor=\"#FFFFCC\"&gt;");\n		print("$rowx->Toy");\n		print("&lt;/td&gt;");\n		}\n?&gt;\n&lt;td bgcolor="#00FFFF"&gt;&lt;strong&gt;Total By Date&lt;/strong&gt;&lt;/td&gt;\n&lt;/tr&gt;\n&lt;?php\nwhile($dbrow = mysql_fetch_row($dbx)){\n	print("&lt;tr&gt;");\n	$col_num = 0;\n	foreach($dbrow as $key=>$value){\n		if($dbrow[$col_num] > 0){\n			print("&lt;td&gt;$dbrow[$col_num]&lt;/td&gt;");\n			}\n		else {\n			print("&lt;td&gt;&nbsp;&lt;/td&gt;");\n			}\n		$col_num++;\n		}\n	print("&lt;/tr&gt;\n");\n	}\n//total the columns\nprint("&lt;tr bgcolor=\"#CCCCCC\"&gt;");\nprint("&lt;td&gt;&lt;strong&gt;Total By Record&lt;/strong&gt;&lt;/td&gt;");\n	$alpha = b;\n	$numeric = 2;\n	$rows = mysql_num_rows($dbx)+1;\n	for($i=1; $i < mysql_num_fields($dbx); $i++){\n		print("&lt;td&gt;&lt;strong&gt;=sum($alpha$numeric:$alpha$rows)&lt;/strong&gt;&lt;/td&gt;");\n		$alpha++;\n		}\nprint("&lt;/tr&gt;\n");\n?&gt;\n&lt;/table&gt;\n</pre></p><p><p>\nFor those of you who jumped ahead, cut-n-pasted the code (you know who you are!) things came out differently than you had planned. You actually got the HTML table;\n</p></p><p><table class="data" cellspacing="0">\n<thead>\n<tr>\n<th bgcolor="#FFFFCC"></th>\n<th bgcolor="#FFFFCC">Balloon</th>\n<th bgcolor="#FFFFCC">Party Pack</th>\n<th bgcolor="#FFFFCC">Streamer</th>\n<th bgcolor="#FFFFCC">Water Pistol</th>\n<th bgcolor="#00FFFF"><strong>Total By Date</strong>\n</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>2002-03-01</td>\n<td>72</td>\n<td>&nbsp;</td>\n<td>&nbsp;</td>\n<td>159</td>\n<td>231</td>\n</tr>\n<tr>\n<td>2002-03-02</td>\n<td>&nbsp;</td>\n<td>14</td>\n<td>14</td>\n<td>28</td>\n<td>56</td>\n</tr>\n<tr>\n<td>2002-03-03</td>\n<td>17</td>\n<td>17</td>\n<td>17</td>\n<td>22</td>\n<td>73</td>\n</tr>\n<tr>\n<td>2002-03-04</td>\n<td>13</td>\n<td>49</td>\n<td>85</td>\n<td>36</td>\n<td>183</td>\n</tr>\n<tr>\n<td>2002-03-06</td>\n<td>&nbsp;</td>\n<td>12</td>\n<td>12</td>\n<td>12</td>\n<td>36</td>\n</tr>\n<tbody>\n<tfoot>\n<tr bgcolor="#CCCCCC">\n<td><strong>Total By Record</strong></td>\n<td><strong>=sum(b2:b6)</strong></td>\n<td><strong>=sum(c2:c6)</strong></td>\n<td><strong>=sum(d2:d6)</strong></td>\n<td><strong>=sum(e2:e6)</strong></td>\n<td><strong>=sum(f2:f6)</strong></td>\n</tr>\n</tfoot>\n</table></p><p><p>\nThis is where the &quot;Stupid IE Trick&quot; comes in, but more about that later. Let's look at the code that sets up the ability to be able to total columns of data within the spreadsheet.\n</p></p><p><p>\n<code>\nprint("&lt;tr bgcolor=\"#CCCCCC\"&gt;");<br>\nprint("&lt;td&gt;&lt;strong&gt;Total By Record&lt;/strong&gt;&lt;/td&gt;");<br>\n	$alpha = b;<br>\n	$numeric = 2;<br>\n	$rows = mysql_num_rows($dbx)+1;<br>\n	for($i=1; $i < mysql_num_fields($dbx); $i++){<br>\n		print("&lt;td&gt;&lt;strong&gt;=sum($alpha$numeric:$alpha$rows)&lt;/strong&gt;&lt;/td&gt;");<br>\n		$alpha++;<br>\n		}<br>\nprint("&lt;/tr&gt;\n");<br>\n</code>\n</p></p><p><p>\nEach calculation in an Excel spreadsheet using relative positioning of the cells requires an alphanumeric combination within the function to specify the cell information (i.e. <code>=sum(f2:f6)</code>). Since we are dynamically generating our query we cannot be sure how many rows or columns may be involved, therfore we have to find a way to calculate these alphanumeric combinations.\n</p></p><p><p>\nFirst we set some variables, <code>$alpha = b;</code> and <code>$numeric = 2;</code>. Why these values? Because the first column and row (A and 1) of the spreadsheet haave data in them other than quantities of items. Next we get the number of rows returned by the query and add 1 to it to make up for the row where the toy names are presented. Next we get the number of fields (from left-to-right) in the query, and starting at 1 (because of our offset for the column with the date in it), we loop through each field and increment the letter in the alphanumeric combo. It is all put together in this line;\n</p></p><p><p>\n<code>print("&lt;td&gt;&lt;strong&gt;=sum($alpha$numeric:$alpha$rows)&lt;/strong&gt;&lt;/td&gt;");</code>\n</p></p><p><p>\nthat gives Excel the information that it needs to properly calculate each column in the query. As you can see, being able to use functions available to Excel can be quite a powerful tool.\n</p></p><p><h2>But It's Not A Spreadsheet!</h2></p><p><p>\nNow, for that &quot;Stupid IE Trick&quot;! *drum roll* ....<br>\nThere is a bug in Internet Explorer that causes the browser to fail on recognition of some HTTP headers, including Excel. But we are still looking for that &quot;one-click pony&quot;, so how do we overcome this problem? Thanks to input from <a href="http://lists.evolt.org/index.cfm/a/listinfo">thelist</a> a solution was gained through the use of a phantom link, a link that fools Internet Explorer about the content type of the information. The URL to the spreadsheet needs to be like this;\n</p></p><p><p>\n<code>\n&lt;a href=&quot;http://yourservername/crosstab.php/crosstab.xls&quot;&gt;\n</code>\n</p></p><p><p>\nBy linking this way the PHP will get processed properly and the phantom <code>crosstab.xls</code> will say to Internet Explorer that Excel type information is coming.\n</p></p><p><h2>Etcetera...</h2></p><p><p>\nOnce a user has gotten his spreadsheet he can save it, modify it, manipulate the numbers, do graphs, or do any number of other things (without changing data in the database) that will satisfy any number-cruncher's heart.\n</p></p><p><p>\nThis article has just barely scratched the surface of the flexibility and power of being able to present data in a pivot table format within Microsoft&reg; Excel. There may be ways to streamline and refine this code as well, offering more possibilities for using spreadsheets generated from live data. You can use an HTML form to accept input (such as date ranges or product types) to generate more specific spreadsheets. It is possible to use macros within the spreadsheet to present the data in different formats. And I suspect that it is possible to generate data for other spreadsheet programs.\n</p></p><p><p>\n&quot;Good work Collinsgirth&quot;</p>\n<p>&quot;It's Collinsworth, sir&quot;\n</p>