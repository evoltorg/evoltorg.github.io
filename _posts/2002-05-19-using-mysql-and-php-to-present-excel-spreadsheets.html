---
layout: post
permalink: node/26896
ratings: 11
avgrate: 4.5455
user: Jay Blanchard
real_name: "Jay Blanchard"
user_since: 21 Mar 2001
avatar: "/images/pictures/picture-9186.jpg"
article_count: 6
excerpt: "On occasion web developers are called upon to present output in formats other than HTML, especailly where numeric data is concerned. Here is one tool to add to your arsenal when the need arises."
---
<p></p>&quot;Collinstwerp!&quot;</p></p><p>&quot;That's Collinsworth, sir,&quot; you say, meakly.</p></p><p>&quot;Whatever Collinearth, I need to see some trending data on sales...<em>NOW!</em>&quot;</p></p><p>&quot;It's Collinsworth sir,&quot; you repeat</p></p><p>&quot;Can I get that in my speadsheet thingie Collinsyurp?!?", he continues to yell.</p></p><p>&quot;I'll get on it right away! mumbling*you pig-headed freak*mumbling,&quot; as you head for your cube.</p></p></p><p><p></p>Number crunchers just love spreadsheets, the numbers, the colors, the graphs, and all of the functions for bending and shaping the numbers to do their bidding. And they like them a certain way, usually as a pivot table where the columns represent groups of data, the rows represent groups of data, and at the intersection of a row and column is the number that they are looking for, as in this example;</p></p></p><p><table class="data" cellspacing="0"></p> <thead></p>  <tr valign="top"></p>   <th>&nbsp;</th>  </p>   <th>Water Pistols</th></p>   <th>Balloons</th></p>   <th>Party Packs</th></p>   <th>Streamers</th></p>   <th>Total Shipped Today</th></p>  </tr></p> </thead></p><tbody></p> <tr valign="top"></p>  <td align="right">2002-03-01</td></p>  <td align="right">270</td></p>  <td align="right">352</td></p>  <td align="right">368</td></p>  <td align="right">360</td></p>  <td align="right">1350</td></p> </tr></p> <tr valign="top"></p>  <td align="right">2002-03-02</td></p>  <td align="right">250</td></p>  <td align="right">212</td></p>  <td align="right">374</td></p>  <td align="right">310</td></p>  <td align="right">1146</td></p> </tr></p> <tr valign="top"></p>  <td align="right">2002-03-03</td></p>  <td align="right">167</td></p>  <td align="right">208</td></p>  <td align="right">421</td></p>  <td align="right">311</td></p>  <td align="right">1107</td></p> </tr></p> <tr valign="top"></p>  <td align="right">2002-03-04</td></p>  <td align="right">165</td></p>  <td align="right">223</td></p>  <td align="right">404</td></p>  <td align="right">297</td></p>  <td align="right">1089</td></p> </tr></p> <tr valign="top"></p>  <td align="right">2002-03-05</td></p>  <td align="right">115</td></p>  <td align="right">214</td></p>  <td align="right">409</td></p>  <td align="right">301</td></p>  <td align="right">1039</td></p> </tr></p></tbody></p><tfoot></p> <tr valign="top"></p>  <td align="right">Total By Items</td></p>  <td align="right">967</td></p>  <td align="right">1209</td></p>  <td align="right">1976</td></p>  <td align="right">1279</td></p>  <td align="right">&nbsp;</td></p> </tr></p></tfoot></p></table></p><p><p></p>You need to make it as easy as possible, a one-click link to the data. What is a developer to do?</p></p></p><p><h2>Set Up Some Test Data</h2></p><p><p>Let's create a table, and some data to work with:</p></p><p><pre></p>CREATE TABLE `tblProductToy` (</p>  `ID` int(11) NOT NULL auto_increment,</p>  `Toy` varchar(32) default NULL,</p>  `DateShipped` varchar(10) default NULL,</p>  `NumberShipped` int(11) default NULL,</p>  PRIMARY KEY  (`ID`)</p>)</p></pre></p><p><pre></p>insert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Water Pistol', '2002-03-01', '36');</p>insert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Water Pistol', '2002-03-01', '12');</p>insert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Water Pistol', '2002-03-01', '11');</p>insert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Water Pistol', '2002-03-01', '14');</p>insert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Balloon', '2002-03-01', '36');</p>insert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Water Pistol', '2002-03-01', '36');</p>insert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Water Pistol', '2002-03-03', '11');</p>insert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Water Pistol', '2002-03-02', '14');</p>insert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Water Pistol', '2002-03-04', '36');</p>insert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Water Pistol', '2002-03-06', '12');</p>insert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Balloon', '2002-03-03', '17');</p>insert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Balloon', '2002-03-04', '13');</p>insert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Party Pack', '2002-03-02', '14');</p>insert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Party Pack', '2002-03-04', '36');</p>insert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Party Pack', '2002-03-06', '12');</p>insert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Party Pack', '2002-03-03', '17');</p>insert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Party Pack', '2002-03-04', '13');</p>insert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Water Pistol', '2002-03-01', '14');</p>insert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Balloon', '2002-03-01', '36');</p>insert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Water Pistol', '2002-03-01', '36');</p>insert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Water Pistol', '2002-03-03', '11');</p>insert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Water Pistol', '2002-03-02', '14');</p>insert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Streamer', '2002-03-04', '36');</p>insert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Streamer', '2002-03-06', '12');</p>insert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Streamer', '2002-03-03', '17');</p>insert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Streamer', '2002-03-04', '13');</p>insert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Streamer', '2002-03-02', '14');</p>insert into tblProductToy (Toy, DateShipped, NumberShipped) values ('Streamer', '2002-03-04', '36');</p></pre></p><p><p></p>If you select all of the data in the table it will look something like this;</p></p></p><p><pre></p>mysql> select * from tblProductToy;</p>+----+--------------+-------------+---------------+</p>  ID   Toy            DateShipped   NumberShipped  </p>+----+--------------+-------------+---------------+</p>   1   Water Pistol   2002-03-01               36  </p>   2   Water Pistol   2002-03-01               12  </p>   3   Water Pistol   2002-03-01               11  </p>   4   Water Pistol   2002-03-01               14  </p>   5   Balloon        2002-03-01               36  </p>   6   Water Pistol   2002-03-01               36  </p>   7   Water Pistol   2002-03-03               11  </p>   8   Water Pistol   2002-03-02               14  </p>   9   Water Pistol   2002-03-04               36  </p>  10   Water Pistol   2002-03-06               12  </p>  11   Balloon        2002-03-03               17  </p>  12   Balloon        2002-03-04               13  </p>  13   Party Pack     2002-03-02               14  </p>  14   Party Pack     2002-03-04               36  </p>  15   Party Pack     2002-03-06               12  </p>  16   Party Pack     2002-03-03               17  </p>  17   Party Pack     2002-03-04               13  </p>  18   Water Pistol   2002-03-01               14  </p>  19   Balloon        2002-03-01               36  </p>  20   Water Pistol   2002-03-01               36  </p>  21   Water Pistol   2002-03-03               11  </p>  22   Water Pistol   2002-03-02               14  </p>  23   Streamer       2002-03-04               36  </p>  24   Streamer       2002-03-06               12  </p>  25   Streamer       2002-03-03               17  </p>  26   Streamer       2002-03-04               13  </p>  27   Streamer       2002-03-02               14  </p>  28   Streamer       2002-03-04               36  </p>+----+--------------+-------------+---------------+</p>28 rows in set (0.02 sec)</p></pre></p><p><p></p>How are we going to turn this into something that looks like our example above?</p></p></p><p><h2>Do It At The Data Level</h2></p><p><p></p>What you need to know about first of all is a handy little thing called a crosstab query. Using a crosstab you can output the data from the database into a table format with almost everything you need to deliver a spreadsheet. Here is the full crosstab query for this table to show how many of each item were shipped on a particular date;</p></p></p><p><pre></p>SELECT DateShipped,</p>SUM(IF(Toy = 'Water Pistol', NumberShipped, 0)) AS "Water Pistols",</p>SUM(IF(Toy = 'Balloon', NumberShipped, 0)) AS "Balloons",</p>SUM(IF(Toy = 'Party Pack', NumberShipped, 0)) AS "Party Packs",</p>SUM(IF(Toy = 'Streamer', NumberShipped, 0)) AS "Streamers"</p>FROM tblProductToy</p>GROUP BY DateShipped</p></pre></p><p><p></p>If you run this query against the data we created above you will get the following results;</p></p></p><p><pre></p>+-------------+---------------+----------+-------------+-----------+</p>  DateShipped   Water Pistols   Balloons   Party Packs   Streamers  </p>+-------------+---------------+----------+-------------+-----------+</p>  2002-03-01              159         72             0           0  </p>  2002-03-02               28          0            14          14  </p>  2002-03-03               22         17            17          17  </p>  2002-03-04               36         13            49          85  </p>  2002-03-06               12          0            12          12  </p>+-------------+---------------+----------+-------------+-----------+</p></pre></p><p><p></p>Pretty slick, eh? It works like this, first we get the data we wish to group by, <code>SELECT DateShipped</code>. Then we do something that looks complicated, but in reality is quite simple. For each product in the table we write a line of SQL that looks like this, <code>SUM(IF(Toy = 'Water Pistol', NumberShipped, 0)) AS "Water Pistols"</code>. What does this line do? Let's break it down;</p></p></p><p><p></p><ul></p><li><code>SUM( </code> will total the information that we tell it to, in this case the values returned by the IF statement</li></p><li><code>IF(Toy = 'Water Pistol', </code> determines if this column value exists</li></p><li><code> NumberShipped, </code> gets the value from this column if <code> Toy = 'Water Pistol'</code> is true</li></p><li><code> 0)) </code> makes the value zero if <code>Toy = 'Water Pistol'</code> is false</li></p><li><code> AS "Water Pistols" </code> gives the result column a name</li></p></ul></p></p></p><p><p></p>Of course, <code>FROM tblProductToy</code> tells the query which table, and <code>GROUP BY DateShipped</code> groups the records together by date with the proper totals. If you wanted to count the shipments of each item per day change <code>NumberShipped</code> to <code>1</code> in each of the <code>SUM...IF</code> statements. There are many functions available to MySQL as well as many other database management packages that will allow you to do things like average results or use conditional expressions to generate results.</p></p></p><p><p></p>We still don't have some of the numbers we need though, such as &quot;Total Shipped Today&quot so lets change our query, adding the line <code>sum(NumberShipped) as "Total Shipped Today"</code> ;</p></p></p><p><pre></p>SELECT DateShipped,</p>SUM(if(Toy = 'Water Pistol', NumberShipped, 0)) AS "Water Pistols",</p>SUM(if(Toy = 'Balloon', NumberShipped, 0)) AS "Balloons",</p>SUM(if(Toy = 'Party Pack', NumberShipped, 0)) AS "Party Packs",</p>SUM(if(Toy = 'Streamer', NumberShipped, 0)) AS "Streamers",</p>SUM(NumberShipped) AS "Total Shipped Today"</p>FROM tblProductToy</p>GROUP BY DateShipped</p></pre></p><p><p></p>Running this query gives us the following results;</p></p></p><p><pre></p>+-------------+---------------+----------+-------------+-----------+---------------------+</p>  DateShipped   Water Pistols   Balloons   Party Packs   Streamers   Total Shipped Today  </p>+-------------+---------------+----------+-------------+-----------+---------------------+</p>  2002-03-01              159         72             0           0                   231  </p>  2002-03-02               28          0            14          14                    56  </p>  2002-03-03               22         17            17          17                    73  </p>  2002-03-04               36         13            49          85                   183  </p>  2002-03-06               12          0            12          12                    36  </p>+-------------+---------------+----------+-------------+-----------+---------------------+</p></pre></p><p><p></p>Very handy. Again, if we were counting total shipments we could replace <code>SUM(NumberShipped) as "Total Shipped Today"</code> with <code>COUNT(*)</code>. Try making the replacements and see what happens.</p></p></p><p><p></p>Crosstabs enable you to get pretty complete information from your database where this kind of table is concerned, but it may not give you all you need, at least not without running another query like this one, which totals each item for the complete range of records and provides a total number of items shipped;</p></p></p><p><pre></p>SELECT SUM(IF(Toy = 'Water Pistol', NumberShipped, 0)) AS "Total Water Pistols",</p>SUM(IF(Toy = 'Balloon', NumberShipped, 0)) AS "Total Balloons",</p>SUM(IF(Toy = 'Party Pack', NumberShipped, 0)) AS "Total Party Packs",</p>SUM(IF(Toy = 'Streamer', NumberShipped, 0)) AS "Total Streamers",</p>SUM(NumberShipped) AS "Total Shipped"</p>FROM tblProductToy</p></pre></p><p><p></p>Which returns;</p></p></p><p><pre></p>+---------------------+----------------+-------------------+-----------------+---------------+</p>  Total Water Pistols   Total Balloons   Total Party Packs   Total Streamers   Total Shipped  </p>+---------------------+----------------+-------------------+-----------------+---------------+</p>                  257              102                  92               128             579  </p>+---------------------+----------------+-------------------+-----------------+---------------+</p></pre></p><p><p></p>Or we can &quot;turn the table&quot;;</p></p></p><p><pre></p>SELECT Toy,</p>SUM(IF(DateShipped = '2002-03-01', NumberShipped, 0)) AS "March 1, 2002",</p>SUM(IF(DateShipped = '2002-03-02', NumberShipped, 0)) AS "March 2, 2002",</p>SUM(IF(DateShipped = '2002-03-03', NumberShipped, 0)) AS "March 3, 2002",</p>SUM(IF(DateShipped = '2002-03-04', NumberShipped, 0)) AS "March 4, 2002",</p>SUM(IF(DateShipped = '2002-03-05', NumberShipped, 0)) AS "March 5, 2002",</p>SUM(IF(DateShipped = '2002-03-06', NumberShipped, 0)) AS "March 6, 2002",</p>SUM(NumberShipped) AS "Total Shipped"</p>FROM tblProductToy</p>GROUP BY Toy;</p></pre></p><p><p></p>Getting these results;</p></p></p><p><pre></p>+--------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+</p>  Toy            March 1, 2002   March 2, 2002   March 3, 2002   March 4, 2002   March 5, 2002   March 6, 2002   Total Shipped  </p>+--------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+</p>  Balloon                   72               0              17              13               0               0             102  </p>  Party Pack                 0              14              17              49               0              12              92  </p>  Streamer                   0              14              17              85               0              12             128  </p>  Water Pistol             159              28              22              36               0              12             257  </p>+--------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+</p></pre></p><p><p></p>This doesn't give us a total shipped each day though and we only want to run one query to the database for these results. That means that we will have to do some calculations in our one-click link to the spreadsheet. We'll handle this in PHP, with a couple of &quot;Stupid IE Tricks&quot; thrown in for good measure.</p></p></p><p><h2>PHP To The Rescue</h2></p><p><p></p>Within our PHP code we can place raw HTTP headers (see <a href="http://www.php.net/manual/en/function.header.php">PHP Header Function</a>, <a href="http://www.w3.org/Protocols/rfc2616/rfc2616">Hypertext Transfer Protocol - HTTP/1.1</a>, and other associated links) prior to any output from the PHP in order that the output might be utilized by applications, such as Microsoft<sup>&reg;</sup> Excel.</p></p></p><p><p></p><code></p>&lt;?php<br></p>header(&quot;Content-Type:  application/vnd.ms-excel&quot;);<br></p>header(&quot;Expires: 0&quot;);<br></p>header(&quot;Cache-Control: must-revalidate, post-check=0, pre-check=0&quot;);<br></p>?&gt;</p></code></p></p></p><p><p></p>The first header line sets up the application type, in this case Microsoft<sup>&reg;</sup> Excel. The second header line essentially tells the browser not to cache the information. The third header line makes sure that subsequent calls to the server are revalidated/authenticated. For further detail about HTTP headers I will refer you to the above links.</p></p></p><p><p></p>Once we have connected to the MySQL server and selected the database we wish to use we can issue our crosstab query. </p></p></p><p><p></p><code></p>&lt;?php<br></p>$qx = "SELECT DateShipped, ";<br></p>$qx .= "SUM(if(Toy = 'Water Pistol', NumberShipped, 0)) AS "Water Pistols", ";<br></p>$qx .= "SUM(if(Toy = 'Balloon', NumberShipped, 0)) AS "Balloons", ";<br></p>$qx .= "SUM(if(Toy = 'Party Pack', NumberShipped, 0)) AS "Party Packs", ";<br></p>$qx .= "SUM(if(Toy = 'Streamer', NumberShipped, 0)) AS "Streamers", ";<br></p>$qx .= "SUM(NumberShipped) AS "Total Shipped Today" ";<br></p>$qx .= "FROM tblProductToy ";<br></p>$qx .= "GROUP BY DateShipped ";<br></p>?&gt;</p></code></p></p></p><p><p></p>Which is great if we know that out list of toys is static. What if they are not? We can do two queries in PHP, using the results of one query to complete the second query. This will always give us all of the products available to analyze.</p></p></p><p><p></p><code></p>&lt;?php<br></p>//query for toy list<br></p>$qtoy = "SELECT DISTINCT Toy ";<br></p>$qtoy .= "FROM tblProductToy ";<br></p>$qtoy .= "ORDER BY Toy ";<br></p><br></p>$dbtoy = mysql_query($qtoy, $dbconnect);<br></p><br></p>//query for crosstab<br></p>$qx = "SELECT DateShipped ";<br></p>while($rowx = mysql_fetch_object($dbtoy)){<br></p>		$qx .= ", SUM(IF(Toy = '$rowx->Toy', NumberShipped, 0)) AS Toy ";<br></p>	}<br></p>$qx .= ", SUM(NumberShipped) AS \"Total Shipped\" ";<br></p>$qx .= "FROM tblProductToy ";<br></p>$qx .= "GROUP BY DateShipped ";<br></p>?&gt;</p></code></p></p></p><p><p></p>One of the convenient things about doing this little project is the fact that Excel &quot;understands&quot; tables formatted in HTML, which is how we are going to output the table. You can output the information as comma seperated values (CSV) or other formats as well. Sending the output in HTML format also gives us the chance to easily apply style information, either from CSS or inline.</p></p></p><p><p></p>Here is the entire code for crosstab.php;</p></p></p><p><pre></p>&lt;?php</p>header("Content-Type:  application/vnd.ms-excel");</p>header("Expires: 0");</p>header("Cache-Control: must-revalidate, post-check=0, pre-check=0");</p><p>//connect to and select database</p>if(!($dbconnect = mysql_pconnect("127.0.0.1", "user", "password"))){</p>	print("Failed to connect to database!</p>");</p>	exit();</p>	}</p>if(!mysql_select_db("test", $dbconnect)){</p>	print("Failed to select database!</p>");</p>	exit();</p>	}</p><p>//query for toy list</p>$qtoy = "SELECT DISTINCT Toy ";</p>$qtoy .= "FROM tblProductToy ";</p>$qtoy .= "ORDER BY Toy ";</p><p>if(!($dbtoy = mysql_query($qtoy, $dbconnect))){</p>	print("MySQL reports: " . mysql_error() . "</p>");</p>	exit();</p>	}</p><p>//query for crosstab</p>$qx = "SELECT DateShipped ";</p>while($rowx = mysql_fetch_object($dbtoy)){</p>		$qx .= ", SUM(IF(Toy = '$rowx->Toy', NumberShipped, 0)) AS Toy ";</p>	}</p>$qx .= ", SUM(NumberShipped) AS \"Total Shipped\" ";</p>$qx .= "FROM tblProductToy ";</p>$qx .= "GROUP BY DateShipped ";</p><p>//print($qx);</p><p>if(!($dbx = mysql_query($qx, $dbconnect))){</p>	print("MySQL reports: " . mysql_error() . "</p>");</p>	exit();</p>	}</p>?&gt;</p>&lt;table border="1"&gt;</p>&lt;tr&gt;</p>&lt;td bgcolor="#FFFFCC"&gt;&lt;/td&gt;</p>&lt;? php</p>mysql_data_seek($dbtoy, 0);</p>	while($rowx = mysql_fetch_object($dbtoy)){</p>		print("&lt;td bgcolor=\"#FFFFCC\"&gt;");</p>		print("$rowx->Toy");</p>		print("&lt;/td&gt;");</p>		}</p>?&gt;</p>&lt;td bgcolor="#00FFFF"&gt;&lt;strong&gt;Total By Date&lt;/strong&gt;&lt;/td&gt;</p>&lt;/tr&gt;</p>&lt;?php</p>while($dbrow = mysql_fetch_row($dbx)){</p>	print("&lt;tr&gt;");</p>	$col_num = 0;</p>	foreach($dbrow as $key=>$value){</p>		if($dbrow[$col_num] > 0){</p>			print("&lt;td&gt;$dbrow[$col_num]&lt;/td&gt;");</p>			}</p>		else {</p>			print("&lt;td&gt;&nbsp;&lt;/td&gt;");</p>			}</p>		$col_num++;</p>		}</p>	print("&lt;/tr&gt;</p>");</p>	}</p>//total the columns</p>print("&lt;tr bgcolor=\"#CCCCCC\"&gt;");</p>print("&lt;td&gt;&lt;strong&gt;Total By Record&lt;/strong&gt;&lt;/td&gt;");</p>	$alpha = b;</p>	$numeric = 2;</p>	$rows = mysql_num_rows($dbx)+1;</p>	for($i=1; $i < mysql_num_fields($dbx); $i++){</p>		print("&lt;td&gt;&lt;strong&gt;=sum($alpha$numeric:$alpha$rows)&lt;/strong&gt;&lt;/td&gt;");</p>		$alpha++;</p>		}</p>print("&lt;/tr&gt;</p>");</p>?&gt;</p>&lt;/table&gt;</p></pre></p><p><p></p>For those of you who jumped ahead, cut-n-pasted the code (you know who you are!) things came out differently than you had planned. You actually got the HTML table;</p></p></p><p><table class="data" cellspacing="0"></p><thead></p><tr></p><th bgcolor="#FFFFCC"></th></p><th bgcolor="#FFFFCC">Balloon</th></p><th bgcolor="#FFFFCC">Party Pack</th></p><th bgcolor="#FFFFCC">Streamer</th></p><th bgcolor="#FFFFCC">Water Pistol</th></p><th bgcolor="#00FFFF"><strong>Total By Date</strong></p></th></p></tr></p></thead></p><tbody></p><tr></p><td>2002-03-01</td></p><td>72</td></p><td>&nbsp;</td></p><td>&nbsp;</td></p><td>159</td></p><td>231</td></p></tr></p><tr></p><td>2002-03-02</td></p><td>&nbsp;</td></p><td>14</td></p><td>14</td></p><td>28</td></p><td>56</td></p></tr></p><tr></p><td>2002-03-03</td></p><td>17</td></p><td>17</td></p><td>17</td></p><td>22</td></p><td>73</td></p></tr></p><tr></p><td>2002-03-04</td></p><td>13</td></p><td>49</td></p><td>85</td></p><td>36</td></p><td>183</td></p></tr></p><tr></p><td>2002-03-06</td></p><td>&nbsp;</td></p><td>12</td></p><td>12</td></p><td>12</td></p><td>36</td></p></tr></p><tbody></p><tfoot></p><tr bgcolor="#CCCCCC"></p><td><strong>Total By Record</strong></td></p><td><strong>=sum(b2:b6)</strong></td></p><td><strong>=sum(c2:c6)</strong></td></p><td><strong>=sum(d2:d6)</strong></td></p><td><strong>=sum(e2:e6)</strong></td></p><td><strong>=sum(f2:f6)</strong></td></p></tr></p></tfoot></p></table></p><p><p></p>This is where the &quot;Stupid IE Trick&quot; comes in, but more about that later. Let's look at the code that sets up the ability to be able to total columns of data within the spreadsheet.</p></p></p><p><p></p><code></p>print("&lt;tr bgcolor=\"#CCCCCC\"&gt;");<br></p>print("&lt;td&gt;&lt;strong&gt;Total By Record&lt;/strong&gt;&lt;/td&gt;");<br></p>	$alpha = b;<br></p>	$numeric = 2;<br></p>	$rows = mysql_num_rows($dbx)+1;<br></p>	for($i=1; $i < mysql_num_fields($dbx); $i++){<br></p>		print("&lt;td&gt;&lt;strong&gt;=sum($alpha$numeric:$alpha$rows)&lt;/strong&gt;&lt;/td&gt;");<br></p>		$alpha++;<br></p>		}<br></p>print("&lt;/tr&gt;</p>");<br></p></code></p></p></p><p><p></p>Each calculation in an Excel spreadsheet using relative positioning of the cells requires an alphanumeric combination within the function to specify the cell information (i.e. <code>=sum(f2:f6)</code>). Since we are dynamically generating our query we cannot be sure how many rows or columns may be involved, therfore we have to find a way to calculate these alphanumeric combinations.</p></p></p><p><p></p>First we set some variables, <code>$alpha = b;</code> and <code>$numeric = 2;</code>. Why these values? Because the first column and row (A and 1) of the spreadsheet haave data in them other than quantities of items. Next we get the number of rows returned by the query and add 1 to it to make up for the row where the toy names are presented. Next we get the number of fields (from left-to-right) in the query, and starting at 1 (because of our offset for the column with the date in it), we loop through each field and increment the letter in the alphanumeric combo. It is all put together in this line;</p></p></p><p><p></p><code>print("&lt;td&gt;&lt;strong&gt;=sum($alpha$numeric:$alpha$rows)&lt;/strong&gt;&lt;/td&gt;");</code></p></p></p><p><p></p>that gives Excel the information that it needs to properly calculate each column in the query. As you can see, being able to use functions available to Excel can be quite a powerful tool.</p></p></p><p><h2>But It's Not A Spreadsheet!</h2></p><p><p></p>Now, for that &quot;Stupid IE Trick&quot;! *drum roll* ....<br></p>There is a bug in Internet Explorer that causes the browser to fail on recognition of some HTTP headers, including Excel. But we are still looking for that &quot;one-click pony&quot;, so how do we overcome this problem? Thanks to input from <a href="http://lists.evolt.org/index.cfm/a/listinfo">thelist</a> a solution was gained through the use of a phantom link, a link that fools Internet Explorer about the content type of the information. The URL to the spreadsheet needs to be like this;</p></p></p><p><p></p><code></p>&lt;a href=&quot;http://yourservername/crosstab.php/crosstab.xls&quot;&gt;</p></code></p></p></p><p><p></p>By linking this way the PHP will get processed properly and the phantom <code>crosstab.xls</code> will say to Internet Explorer that Excel type information is coming.</p></p></p><p><h2>Etcetera...</h2></p><p><p></p>Once a user has gotten his spreadsheet he can save it, modify it, manipulate the numbers, do graphs, or do any number of other things (without changing data in the database) that will satisfy any number-cruncher's heart.</p></p></p><p><p></p>This article has just barely scratched the surface of the flexibility and power of being able to present data in a pivot table format within Microsoft&reg; Excel. There may be ways to streamline and refine this code as well, offering more possibilities for using spreadsheets generated from live data. You can use an HTML form to accept input (such as date ranges or product types) to generate more specific spreadsheets. It is possible to use macros within the spreadsheet to present the data in different formats. And I suspect that it is possible to generate data for other spreadsheet programs.</p></p></p><p><p></p>&quot;Good work Collinsgirth&quot;</p></p><p>&quot;It's Collinsworth, sir&quot;</p></p>