---
layout: post
permalink: node/19340
ratings: 25
avgrate: 4.4000
category: Code
user: jesteruk
real_name: "Jester uk"
user_biog: "<p>I just like messing around with web design stuff, just a hobby.</p>
<p>Particularly perl, PHP and SQL.</p>

<p><a href=\"http://www.free2code.net\" rel=\"nofollow\" title=\"My site\" target=\"_blank\">http://www.free2code.net/</a></p>"
user_since: 22 Dec 2001
avatar: 
article_count: 6
excerpt: "This article will explain how you can split large results from a MySQL database into smaller, more managable chunks displayed on multiple pages. Allowing your visitors to navigate through your site with ease."
---
<p>Ever wondered how the search engines split your results up into those tidy pages with the <strong>&quot;next&quot;</strong> and <strong>&quot;previous&quot;</strong> links? Ever had a huge list of results you've wanted to make more organised? This article will show you how.</p></p><h2>The Benefits</h2></p><p>The first thing to consider when designing a website is <strong>user-friendliness</strong>. If you visit a website that's difficult to use, poorly constructed and you can't get to where you want to go fast -- what do you do? You hit that little &quot;X&quot; in the top-right corner, and that's exactly what visitors to your website will do if you don't take the time to make it easy to use. Splitting your results up into smaller, more managable chunks will make it easier for your visitors to browse through them.</p></p><h2>OK, What Do I Need?</h2></p><p>We're going to use PHP to query a MySQL database, manage the results and print a pre-defined limit of results onto each of the multiple pages. It'd be handy if you had a basic grasp of PHP and SQL -- if not visit the <a href="http://www.php.net" title="The Official PHP Website" target="_blank">official PHP website</a> and have a look at their tutorials. Experience with using PHP to interact with and handle data retrieved from a MySQL database is essential for you to understand this article. If you don't know what i'm talking about, go learn it; it's where web development is going. Oh, access to a PHP interpreter and a MySQL database would come in handy also.</p></p><h2>Let's Do It</h2></p><h3>Database Connection</h3></p><p>Ok firstly let's connect to your database. Obviously you would put your correct information in here. See the below code:</p></p><pre></p>&lt;?</p>$db_addr = 'localhost';		// address of MySQL server.</p>$db_user = 'user';		// Username to access server.</p>$db_pass = 'password';		// Password access server.</p>$db_name = 'MyDatabase';	// Name of database to connect to.</p>$connect = @mysql_connect(&quot;$db_addr&quot;, &quot;$db_user&quot;, &quot;$db_pass&quot;);</p><p>if (!($connect)) // If no connect, error and exit().</p>{</p>     echo(&quot;&lt;p&gt;Unable to connect to the database server.&lt;/p&gt;&quot;);</p>     exit();</p>}</p><p>if (!(@mysql_select_db($db_name))) // If can't connect to database, error and exit().</p>{</p>     echo(&quot;&lt;p&gt;Unable to locate the $db_name database.&lt;/p&gt;&quot;);</p>     exit();</p>}</p></pre></p><p>If you don't understand the above maybe you should stop now and read a basic PHP tutorial. Basically, all it does is use your information to try and make a connection to the database, if a connection to the database server cannot be made, it errors and exits. If the specified database cannot be found, it errors and exits.</p></p><h3>Define Some Variables</h3></p><p>Now we need to define some variables, sort out how many results we want per-page and construct our database query, look at the code below, then i'll explain:</p></p><pre></p>if (!($limit)){</p>     $limit = 10;} // Default results per-page.</p><p>if (!($page)){</p>     $page = 0;} // Default page value.</p><p>$numresults = mysql_query(&quot;SELECT * FROM your_table WHERE name LIKE '%&quot;. $query .&quot;%'&quot;); // the query.</p><p>$numrows = mysql_num_rows($numresults); // Number of rows returned from above query.</p><p>if ($numrows == 0){</p>     echo(&quot;No results found matching your query - $query&quot;); // bah, modify the &quot;Not Found&quot; error for your needs.</p>     exit();}</p></pre></p><p>Now we have some variables to work with. If <code>$limit</code> is not already specified (for example in the query string) then it will have the value of 10. If <code>$page</code> is not already specified in the query string it will be set to 0. <code>$limit</code> is used to control the number of results per-page, we are going to add to this and allow the user to control it. <code>$page</code> is used to let the script know which page, which chunk of results to show on each given page. Now we have the limit per-page, and the number of results that need to be displayed. Bear with me this will all become clearer soon.</p></p><h3>The Math</h3></p><p>Now we need to calculate the number of results pages there will be. Say we have <strong>35</strong> results, and we want to split them into 10 per-page, there will be <strong>4</strong> results pages. We're also going to add some visual fancies, take a look at the code:</p></p><pre></p>$pages = intval($numrows/$limit); // Number of results pages.</p><p>// $pages now contains int of pages, unless there is a remainder from division.</p><p>if ($numrows % $limit) {</p>$pages++;} // has remainder so add one page</p><p>$current = ($page/$limit) + 1; // Current page number.</p><p>if (($pages &lt; 1)    ($pages == 0)) {</p>$total = 1;} // If $pages is less than one or equal to 0, total pages is 1.</p><p>else {</p>$total = $pages;} // Else total pages is $pages value.</p><p>$first = $page + 1; // The first result.</p><p>if (!((($page + $limit) / $limit) &gt;= $pages) && $pages != 1) {</p>$last = $page + $limit;} //If not last results page, last result equals $page plus $limit.</p> </p>else{</p>$last = $numrows;} // If last results page, last result equals total number of results.</p></pre></p><p>OK let's slow down and have a look at what we have done so far:<br><br></p><li><strong>Database Connection</strong>: Establish that the script can connect to the MySQL database.</li></p><li><strong>Define Variables</strong>: Tell script how many results per-page we want, query the database and find total result we're going to be dealing with.</li></p><li><strong>The Math</strong>: Calculate the number of pages we'll be dealing with. Code in some extra little bits, the current page number (to allow us to show &quot;page 1 of 3&quot;), the first result on current page, the last result on current page.</li></p></p></p><h3>Visual Tid-Bits</h3></p><p>Now let's write the code that'll show the user what page they're on and what set of results they're viewing, see the code:</p></p><pre></p>//escape from PHP mode.</p>?&gt;</p>&lt;html&gt;</p>&lt;head&gt;</p>&lt;title&gt;Search Results for &lt;?=$query?&gt;&lt;/title&gt;</p>&lt;/head&gt;</p>&lt;body&gt;</p>&lt;center&gt;&lt;h2&gt;Search Results for &lt;?=$query?&gt;&lt;/h2&gt;&lt;/center&gt;</p>&lt;table width=&quot;100%&quot; border=&quot;0&quot;&gt;</p> &lt;tr&gt;</p>  &lt;td width=&quot;50%&quot; align=&quot;left&quot;&gt;</p>Results &lt;b&gt;&lt;?=$first?&gt;&lt;/b&gt; - &lt;b&gt;&lt;?=$last?&gt;&lt;/b&gt; of &lt;b&gt;&lt;?=$numrows?&gt;&lt;/b&gt;</p>  &lt;/td&gt;</p>  &lt;td width=&quot;50%&quot; align=&quot;right&quot;&gt;</p>Page &lt;b&gt;&lt;?=$current?&gt;&lt;/b&gt; of &lt;b&gt;&lt;?=$total?&gt;&lt;/b&gt;</p>  &lt;/td&gt;</p> &lt;/tr&gt;</p> &lt;tr&gt;</p>  &lt;td colspan=&quot;2&quot; align=&quot;right&quot;&gt;</p>&amp;nbsp;</p>  &lt;/td&gt;</p> &lt;/tr&gt;</p> &lt;tr&gt;</p>  &lt;td colspan=&quot;2&quot; align=&quot;right&quot;&gt;</p>Results per-page: &lt;a href=&quot;&lt;?=$PHP_SELF?&gt;?query=&lt;?=$query?&gt;&amp;page=&lt;?=$page?&gt;&amp;limit=5&quot;&gt;5&lt;/a&gt;   &lt;a href=&quot;&lt;?=$PHP_SELF?&gt;?query=&lt;?=$query?&gt;&page=&lt;?=$page?&gt;&limit=10&quot;&gt;10&lt;/a&gt;   &lt;a href=&quot;&lt;?=$PHP_SELF?&gt;?query=&lt;?=$query?&gt;&page=&lt;?=$page?&gt;&limit=20&quot;&gt;20&lt;/a&gt;   &lt;a href=&quot;&lt;?=$PHP_SELF?&gt;?query=&lt;?=$query?&gt;&amp;page=&lt;?=$page?&gt;&amp;limit=50&quot;&gt;50&lt;/a&gt;</p>  &lt;/td&gt;</p> &lt;/tr&gt;</p>&lt;/table&gt;</p>&lt;?</p>//Go back into PHP mode.</p></pre></p><p>Now we have the start of the results page that the user will actually see. Let's say again that the query returned <strong>35</strong> results, this bit of code would display at the top of the page:</p><br><br></p><table width="100%" border="0"></p> <tr></p>  <th width="50%" align="left"></p>Results <strong>1</strong> - <strong>10</strong> of <strong>35</strong></p>  </th></p>  <th width="50%" align="right"></p>Page <strong>1</strong> of <strong>4</strong></p>  </th></p> </tr></p> <tr></p>  <th colspan="2" align="right"></p>&nbsp;</p>  </th></p> </tr></p> <tr></p>  <th colspan="2" align="right"></p>Results per-page: <strong title="Not an actual link, just an example.">5</strong>   <strong title="Not an actual link, just an example.">10</strong>   <strong title="Not an actual link, just an example.">20</strong>   <strong title="Not an actual link, just an example.">50</strong></p>  </th></p> </tr></p></table></p><br><br></p>Now that the user can see the page they're on and the set of results they're viewing, we need to display the actual results to them, and show the links to each result page.</p></p></p><h3>Displaying The Results</h3></p><p>Now we're going to show the pre-defined limit of results on the current page, see the below code:</p></p><pre></p>// Now we can display results.</p>$results = mysql_query(&quot;SELECT * FROM your_table WHERE name LIKE '%&quot;. $query .&quot;%' ORDER BY name ASC LIMIT $page, $limit&quot;);</p>while ($data = mysql_fetch_array($results))</p>{</p>?&gt;</p>&lt;p&gt;&lt;a href=&quot;&lt;?=$data[&quot;url&quot;]?&gt;&quot; title=&quot;&lt;?=$data[&quot;name&quot;]?&gt;&quot;&gt;&lt;?=$data[&quot;name&quot;]?&gt;&lt;/a&gt; - &lt;?=$data[&quot;description&quot;]?&gt;&lt;/p&gt;</p>&lt;?</p>}</p></pre></p><p>Notice the MySQL query, we've modified it alittle. Instead of just selecting all the rows, we select them, order them alphabetically, limit them according to the relevant page and then display each row from the query. Bear in mind, this is an hypothetical situation. Your database table may not contain a url, name or description column, i am just improvising, i'm sure you can edit the script to meet your own needs and database. Read on....</p></p><h3>Linking To Other Pages</h3></p><p>Now the final part of the code, linking to each of the results pages so the user can browse through them easily, see the below code:</p></p><pre></p>?&gt;</p>&lt;p align=&quot;center&quot;&gt;</p>&lt;?</p>if ($page != 0) { // Don't show back link if current page is first page.</p>$back_page = $page - $limit;</p>echo(&quot;&lt;a href=\&quot;$PHP_SELF?query=$query&amp;page=$back_page&amp;limit=$limit\&quot;&gt;back&lt;/a&gt;  &nbsp; </p>&quot;);}</p><p>for ($i=1; $i &lt;= $pages; $i++) // loop through each page and give link to it.</p>{</p> $ppage = $limit*($i - 1);</p> if ($ppage == $page){</p> echo(&quot;&lt;b&gt;$i&lt;/b&gt;</p>&quot;);} // If current page don't give link, just text.</p> else{</p> echo(&quot;&lt;a href=\&quot;$PHP_SELF?query=$query&amp;page=$ppage&amp;limit=$limit\&quot;&gt;$i&lt;/a&gt; </p>&quot;);}</p>}</p><p>if (!((($page+$limit) / $limit) &gt;= $pages) && $pages != 1) { // If last page don't give next link.</p>$next_page = $page + $limit;</p>echo(&quot; &nbsp;  &lt;a href=\&quot;$PHP_SELF?query=$query&amp;page=$next_page&amp;limit=$limit\&quot;&gt;next&lt;/a&gt;&quot;);}</p>?&gt;</p>&lt;/p&gt;</p>&lt;/body&gt;</p>&lt;/html&gt;</p></pre></p><p>The above code checks to see if the current page is the first page. If it is, it bypasses the &quot;previous&quot; link. It then loops through each page and provides a link to them, except if the link number is that of the current page, then it displays a text number. It then checks to see if the current page is the last page, if it is, it bypasses the &quot;next&quot; link.</p></p><p>OK there we have it, a simple script that will query the database, find the number of rows affected by the query, calculate the number of pages, display to the user where they are amongst the results and provide links to the other results pages, easier than you thought, eh? Let's have a look at the full code.</p></p><hr></p><h2>The Finished Script</h2></p><pre></p>&lt;?</p>$db_addr = 'localhost';		// address of MySQL server.</p>$db_user = 'user';		// Username to access server.</p>$db_pass = 'password';		// Password access server.</p>$db_name = 'MyDatabase';	// Name of database to connect to.</p>$connect = @mysql_connect(&quot;$db_addr&quot;, &quot;$db_user&quot;, &quot;$db_pass&quot;);</p><p>if (!($connect)) // If no connect, error and exit().</p>{</p>echo(&quot;&lt;p&gt;Unable to connect to the database server.&lt;/p&gt;&quot;);</p>exit();</p>}</p><p>if (!(@mysql_select_db($db_name))) // If can't connect to database, error and exit().</p>{</p>echo(&quot;&lt;p&gt;Unable to locate the $db_name database.&lt;/p&gt;&quot;);</p>exit();</p>}</p><p>if (!($limit)){</p>$limit = 10;} // Default results per-page.</p>if (!($page)){</p>$page = 0;} // Default page value.</p>$numresults = mysql_query(&quot;SELECT * FROM your_table WHERE name LIKE '%&quot;. $query .&quot;%'&quot;); // the query.</p>$numrows = mysql_num_rows($numresults); // Number of rows returned from above query.</p>if ($numrows == 0){</p>echo(&quot;No results found matching your query - $query&quot;); // bah, modify the &quot;Not Found&quot; error for your needs.</p>exit();}</p><p>$pages = intval($numrows/$limit); // Number of results pages.</p><p>// $pages now contains int of pages, unless there is a remainder from division.</p><p>if ($numrows%$limit) {</p>$pages++;} // has remainder so add one page</p><p>$current = ($page/$limit) + 1; // Current page number.</p><p>if (($pages &lt; 1)    ($pages == 0)) {</p>$total = 1;} // If $pages is less than one or equal to 0, total pages is 1.</p><p>else {</p>$total = $pages;} // Else total pages is $pages value.</p><p>$first = $page + 1; // The first result.</p><p>if (!((($page + $limit) / $limit) &gt;= $pages) && $pages != 1) {</p>$last = $page + $limit;} //If not last results page, last result equals $page plus $limit.</p> </p>else{</p>$last = $numrows;} // If last results page, last result equals total number of results.</p><p>//escape from PHP mode.</p>?&gt;</p>&lt;html&gt;</p>&lt;head&gt;</p>&lt;title&gt;Search Results for &lt;?=$query?&gt;&lt;/title&gt;</p>&lt;/head&gt;</p>&lt;body&gt;</p>&lt;center&gt;&lt;h2&gt;Search Results for &lt;?=$query?&gt;&lt;/h2&gt;&lt;/center&gt;</p>&lt;table width=&quot;100%&quot; border=&quot;0&quot;&gt;</p> &lt;tr&gt;</p>  &lt;td width=&quot;50%&quot; align=&quot;left&quot;&gt;</p>Results &lt;b&gt;&lt;?=$first?&gt;&lt;/b&gt; - &lt;b&gt;&lt;?=$last?&gt;&lt;/b&gt; of &lt;b&gt;&lt;?=$numrows?&gt;&lt;/b&gt;</p>  &lt;/td&gt;</p>  &lt;td width=&quot;50%&quot; align=&quot;right&quot;&gt;</p>Page &lt;b&gt;&lt;?=$current?&gt;&lt;/b&gt; of &lt;b&gt;&lt;?=$total?&gt;&lt;/b&gt;</p>  &lt;/td&gt;</p> &lt;/tr&gt;</p> &lt;tr&gt;</p>  &lt;td colspan=&quot;2&quot; align=&quot;right&quot;&gt;</p>&amp;nbsp;</p>  &lt;/td&gt;</p> &lt;/tr&gt;</p> &lt;tr&gt;</p>  &lt;td colspan=&quot;2&quot; align=&quot;right&quot;&gt;</p>Results per-page: &lt;a href=&quot;&lt;?=$PHP_SELF?&gt;?query=&lt;?=$query?&gt;&page=&lt;?=$page?&gt;&limit=5&quot;&gt;5&lt;/a&gt;   &lt;a href=&quot;&lt;?=$PHP_SELF?&gt;?query=&lt;?=$query?&gt;&page=&lt;?=$page?&gt;&limit=10&quot;&gt;10&lt;/a&gt;   &lt;a href=&quot;&lt;?=$PHP_SELF?&gt;?query=&lt;?=$query?&gt;&page=&lt;?=$page?&gt;&limit=20&quot;&gt;20&lt;/a&gt;   &lt;a href=&quot;&lt;?=$PHP_SELF?&gt;?query=&lt;?=$query?&gt;&page=&lt;?=$page?&gt;&limit=50&quot;&gt;50&lt;/a&gt;</p>  &lt;/td&gt;</p> &lt;/tr&gt;</p>&lt;/table&gt;</p>&lt;?</p>//Go back into PHP mode.</p><p>// Now we can display results.</p>$results = mysql_query(&quot;SELECT * FROM your_table WHERE name LIKE '%&quot;. $query .&quot;%' ORDER BY name ASC LIMIT $page, $limit&quot;);</p>while ($data = mysql_fetch_array($results))</p>{</p>?&gt;</p>&lt;p&gt;&lt;a href=&quot;&lt;?=$data[&quot;url&quot;]?&gt;&quot; title=&quot;&lt;?=$data[&quot;name&quot;]?&gt;&quot;&gt;&lt;?=$data[&quot;name&quot;]?&gt;&lt;/a&gt; - &lt;?=$data[&quot;description&quot;]?&gt;&lt;/p&gt;</p>&lt;?</p>}</p>?&gt;</p>&lt;p align=&quot;center&quot;&gt;</p>&lt;?</p>if ($page != 0) { // Don't show back link if current page is first page.</p>$back_page = $page - $limit;</p>echo(&quot;&lt;a href=\&quot;$PHP_SELF?query=$query&amp;page=$back_page&amp;limit=$limit\&quot;&gt;back&lt;/a&gt;  &nbsp; </p>&quot;);}</p><p>for ($i=1; $i &lt;= $pages; $i++) // loop through each page and give link to it.</p>{</p> $ppage = $limit*($i - 1);</p> if ($ppage == $page){</p> echo(&quot;&lt;b&gt;$i&lt;/b&gt; </p>&quot;);} // If current page don't give link, just text.</p> else{</p> echo(&quot;&lt;a href=\&quot;$PHP_SELF?query=$query&page=$ppage&limit=$limit\&quot;&gt;$i&lt;/a&gt; </p>&quot;);}</p>}</p><p>if (!((($page+$limit) / $limit) &gt;= $pages) && $pages != 1) { // If last page don't give next link.</p>$next_page = $page + $limit;</p>echo(&quot; &nbsp;  &lt;a href=\&quot;$PHP_SELF?query=$query&amp;page=$next_page&amp;limit=$limit\&quot;&gt;next&lt;/a&gt;</p>&quot;);}</p>?&gt;</p>&lt;/p&gt;</p>&lt;/body&gt;</p>&lt;/html&gt;</p></pre></p><h2>So This Is Just a Simple Search Script?</h2></p><p>Absolutely not. This script could perform a myriad of uses. Say you had a &quot;downloads&quot; table in your database containing a list of programs. You want to display just the &quot;programming&quot; related software to your user but there are many programs in this category which would generate a huge page of links. With a slight modification to the database query you could display these programs in neat multiple pages which are <strong>user-friendly</strong> and easily navigable for your visitor. Many sites these days are built around a search-type script, give it a try for yourself.</p></p><h2>Expandable</h2></p><p>Why not see what ideas you can come up with? How about links on the page that allow your visitor to control how the results are ordered, by name, by date added to the database, by id? How about allowing them to reverse the listing? How about adding to the script to allow them different search actions, exact match or a vague match? The list is endless. Stick a conditional in the script, if the $query variable exists run the above script. If not display a form allowing you to enter a query, so the $query variable contains data and the script is run. This isn't a ready-run-script, it <em>will</em> take some modifiying. Play around!</p></p><h2>Bibliography</h2></p><p>If you wish to get deeper into this ever-popular partnership between PHP and MySQL, visit a couple of sites:<br><br></p><li><a href="http://www.php.net/manual/en/ref.mysql.php" title="List of PHP's MySQL related functions" target="_blank">PHP's MySQL Functions</a></li></p><li><a href="http://www.mysql.com" title="MySQL Website" target="_blank">MySQL Website</a></li></p><br><br></p>And don't forget, have any questions? Need any help? <a href="http://lists.evolt.org/mailman/listinfo/thelist" title="evolt.org thelist subscription form">Ask us</a>.</p>