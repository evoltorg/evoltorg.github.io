---
layout: post
permalink: failover-database-connection-with-php-mysql
ratings: 4
avgrate: 1.5000
category: Code
user: SJBDude7
real_name: "Stephen Belue"
user_biog: "I was born in Philly. I started to code. I read some books. Yeah."
user_since: 19 Feb 2007
avatar: "/images/pictures/picture-71623.png"
article_count: 1
excerpt: "<p>You want to connect to a mySQL database? Well, then it\'s likely you already know how. But how about connecting a second database if the first one fails? No? This could be a life saver. </p>"
---
<p>Imagine, you're connecting to a mySQL database with PHP, but hell, you want a bit more robustness. So why would you want just one database? You'd use a failover right? So if the first database is down or just doesn't connect, it can connect to the next one. Here's how to do that (I'm assuming you're already replicating between databases so that they're roughly in sync).</p></p></p><p>Here's how you do it. Firstly, you'll have to define some things...</p></p></p><?php</p>$host=""; //Database host.</p>$user=""; //Database username.</p>$pass=""; //Database password.</p>$dbase=""; //Database.</p>$host2=""; //Database host two... This is optional: in case the other database cannot connect.</p>$user2=""; //Database username two... This is optional: in case the other database cannot connect.</p>$pass2=""; //Database password two... This is optional: in case the other database cannot connect.</p>$dbase2=""; //Database two... This is optional: in case the other database cannot connect.</p>?></p><p></p>View the comments, they are simple yet... informative.</p>Now, the one thing that can make all of this come true:</p></p></p><?php</p>$connect=mysql_connect($host,$user,$pass); //Connect to the database.</p>?></p></p></p>That will connect to the mySQL database with the currently defined variables.</p>So, obviously, if <code>$connect</code> does that, what would <code>$connect2</code> do?</p></p></p><?php</p>$connect2=mysql_connect($host2,$user2,$pass2); //Connect to the database.</p>?></p><p></p>It connects to the database! But, oh, it's the second one. Strange, isn't it?</p>Now, you can check if the database connected or not by checking if its true, or false.</p></p></p><?php</p>if (!$connect) {</p>  mysql_close($connect); //Ends the current connection to the database.</p>  echo "Cannot connect to the first database!"; //Display the text inside the quotes.</p>}</p>else {</p>  echo "Connected to the first database!"; //Display the text inside the quotes.</p>}</p>?></p><p></p>Of course, how does it connect to the second database? Simple!</p></p></p><?php</p>if (!$connect) {</p>  mysql_close($connect); //Ends the current connection to the database.</p>  echo "Cannot connect to the first database!<br />"; //Display text inside the quotes.</p>  if (!$connect2) {</p>    mysql_close($connect2); //Ends the current connection to the second database.</p>    echo "Cannot connect to second database!"; //Display text inside the quotes.</p>  }</p>  else {</p>    echo "Connected to the second database!"; //Display text inside the quotes.</p>  }</p>}</p>else {</p>  echo "Connected to the first database!<br />Did not connect to the second database!"; //Display text in quotes</p>}</p>?></p><p></p>Now, that's all this really does. It has some <code>mysql_error()</code> stuff in it too, and checks if the url is <code>connection.php?type=1</code> before executing the code. I basically combined all of that into one script, all you have to do is edit the variables, and do:</p></p></p><?php</p>include "connection.php";</p>?></p><p></p>Here's the full script:</p></p></p><?php</p>/////////////////////////////////////////////////////////</p>//Name --- Connection.php                              //</p>/////////////////////////////////////////////////////////</p>//Description --- Connects to a mySQL database easily  //</p>/////////////////////////////////////////////////////////</p>//Author --- [SJB]Dude7                                //</p>/////////////////////////////////////////////////////////</p><p>$host=""; //Database host.</p>$user=""; //Database username.</p>$pass=""; //Database password.</p>$dbase=""; //Database.</p>$host2=""; //Database host two... This is optional: in case the other database cannot connect.</p>$user2=""; //Database username two... This is optional: in case the other database cannot connect.</p>$pass2=""; //Database password two... This is optional: in case the other database cannot connect.</p>$dbase2=""; //Database two... This is optional: in case the other database cannot connect.</p><p>$connect=mysql_connect($host,$user,$pass); //Connect to the database.</p><p>if ($_GET["type"]=="1") {</p>  if (!$connect) {</p>    mysql_close($connect); //End the connection to possibly prevent SQL injection or just for safety.</p>    $connect2=mysql_connect($host2,$user2,$pass2); //Connect to the host.</p>    if (!$connect2) {</p>      die("<b>ERROR:</b> " . mysql_error()); //Receive an error if it cannot connect.</p>	  mysql_close($connect2); //End the connection to possibly prevent SQL injection or just for safety.</p>    }</p>    else {</p>      $dbconnect2=mysql_select_db($dbase2, $connect2); //Select the database.</p>	  if (!$dbconnect2) {</p>	    die("<b>ERROR:</b> " . mysql_error()); //Receive an error if it cannot connect.</p>	    mysql_close($connect2); //End the connection to possibly prevent SQL injection or just for safety.</p>	  }</p>    }</p>  }</p>  else {</p>    $dbconnect=mysql_select_db($dbase, $connect); //Select the database.</p>    if (!$dbconnect) {</p>      die("<b>ERROR:</b> " . mysql_error()); //Receive an error if it cannot connect.</p>	  mysql_close($connect); //End the connection to possibly prevent SQL injection or just for safety.</p>    }</p>  }</p>}</p>else {</p>  echo "<b>ERROR:</b> Invalid argument '" . $_GET["type"] . "'."; //If the connect.php?type doesn't equal one, it will display this error.</p>}</p>?>