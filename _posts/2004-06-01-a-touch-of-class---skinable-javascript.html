---
layout: post
permalink: node/60326
ratings: 5
avgrate: 4.4000
category: Code
user: codepo8
real_name: "Chris Heilmann"
user_since: 29 Jul 2002
avatar: "/images/pictures/picture-35456.jpg"
article_count: 17
excerpt: "By now, almost all web developers have realised that it does make sense to separate structure from presentation and behaviour. Sadly enough, not too many openly available Javascripts do the same. Learn how to enhance markup while keeping the visuals in the CSS rather than in Javascript variables. Cr"
---
<p>Ok, let's repeat the trinity of web standards: Markup is the structure, </p>Style Sheets are the presentation and Javascript is the behaviour. That much </p>should be common sense by now. New starters in web development have the </p>chance to follow these rules easily - no more annoying IE4s and Netscape </p>Communicators to worry about - modern browsers can do the CSS and xHTML dance </p>quite well. The separation of markup and presentation is practised a lot, and </p>loads of tutorials and templates help the developer to do so.</p> </p><p>With Javascript, it is still a bit dodgy, as too many good resources get lost </p>in the mass of bad or outdated ones.</p></p><h2>Look - new Javascript!</h2></p><p>2004's state-of-the-art Javascript should be unobtrusive and easily maintainable. </p>In essence, this means:</p></p><ul></p>	<li>Only apply itself when it is possible to do so.</li></p>	<li>Use the markup as it is without the need to add inline event calls.</li></p>	<li>Be independent of the input device (insofar this is possible).</li></p>	<li>Play along well with other Javascripts (no common global variables, no event hijacking).</li></p>	<li>Keep the visuals to the CSS, to avoid double maintenance.</li></p></ul></p><p>The last item is what this article is about. Many a time, </p>you encounter scripts that are nice in themselves, but fail to completely </p>separate the presentation from the behaviour. We cannot assume that every web </p>developer knows Javascript - and its syntax. To avoid frustration using a </p>script, we need to find a way to allow the developer to skin the outcome of this behaviour with </p>CSS. This also makes maintenance easier, as you don't need to check in two </p>places, if you have to change the visiual outcome - all it needs is a change of </p>the CSS.</p></p><h2>We want clickable headlines - now!</h2></p><p>Let's take a look at an example. Say we want to make every second level headline </p>in a document clickable. What it should do is collapse and expand an adjacent element.</p></p><p>Headers as they are are not clickable elements, so we need to make the user </p>aware that ours are. We do this by adding a &#62; and a hover state.</p></p><p>In the world of non-Internet Explorer, the hover could be done via CSS, but </p>in the real world, we do it via Javascript to ensure that the majority of users </p>will see the effect.</p></p><p>When the header was clicked, we want to give it a selected state.</p></p><p>Now, if we kept the design in the Javascript, this could be done like this:</p></p><pre></p>// Define colours</p>var hovercolour='#ffc';</p>var normalcolour='#fff';</p>var highlight='#69c';</p>function init()</p>{</p> var h2s,i,tohide,tohideobj,isexpanded;</p>// grab all second level headlines and loop over them </p> h2s=document.getElementsByTagName('h2');</p> for (i=0;i&#60;h2s.length;i++)</p> {</p>// get next sibling (the element to hide, check that it is an element</p>  tohide=h2s[i].nextSibling;</p>  while(tohide.nodeType!=1)</p>  {</p>   tohide=tohide.nextSibling;</p>  }</p>  h2s[i].tohideobj=tohide;</p>// add the hover function onmouseover and onmouseout </p>  h2s[i].onmouseover=function(){hover(this,this.tohideobj,1);}</p>  h2s[i].onmouseout=function(){hover(this,this.tohideobj,0);}</p>// hide next element and add onclick event to show and hide it</p>  tohide.style.display='none';</p>  h2s[i].onclick=function(){collapse(this,this.tohideobj);return false}</p>  h2s[i].insertBefore(document.createTextNode('>'),h2s[i].firstChild);</p> }</p>   }</p>// hover function, adds the hover colour </p>// unless the headline is an active trigger</p>function hover(o,ho,state)</p>{</p> if(ho.style.display=='none')</p> {</p>  o.style.background=state==1?hovercolour:normalcolour;</p> }</p>}</p>// collapse function, shows and hides the element and sets the highlight </p>// colour of the headline</p>function collapse(o,ho)</p>{</p> ho.style.display=ho.style.display=='none'?'block':'none';</p> o.style.background=highlight;</p>}</p>window.onload=init;</p></pre></p><p>It does <a href="http://www.icant.co.uk/articleassets/h2test.html" target="_blank">work</a>, but has some disadvantages:</p></p><ul></p>	<li>We need to know javascript (at least how to set variables) to change </p>	the look and feel.</li></p>	<li>We can only change backgrounds, if we also wanted to change the colour, </p>	we'd need to set more variables and extend the hover and the collapse </p>	functions.</li></p></ul></p><h2>Becoming classy</h2></p><p>What to do? Easy - put all the presentation in style sheet classes, and </p>use the className attribute to change them.</p></p><p>This also means we won't have to add the &#62; any longer, as that can be </p>done in a background image.</p></p><pre></p>.hover{</p> padding-left:30px;</p> background:url(arrow.gif) 5px 5px no-repeat #ffc;</p> color:#000;</p>}</p>.highlight{</p> padding-left:30px;</p> background:url(arrowon.gif) 5px 5px no-repeat #69c;</p> color:#fff;</p>}</p>.normal{</p> padding-left:30px;</p> background:url(arrow.gif) 5px 5px no-repeat #fff;</p> color:#000;</p>}</p>.hidden{</p> display:none;</p>}</p></pre></p><p>Then we change the functions accordingly:</p></p><pre></p>function init()</p>{</p>[...]</p>// hide next element and add onclick event to show and hide it</p>  tohide.className='hidden';</p>  h2s[i].className='normal';</p>[...]</p>}</p>// hover function, adds the hover colour </p>// unless the headline is an active trigger</p>function hover(o,ho,state)</p>{</p> if(ho.className=='hidden')</p> {</p>  o.className=state==1?'hover':'normal';</p> }</p>}</p>// collapse function, shows and hides the element and sets the highlight </p>// colour of the headline</p>function collapse(o,ho)</p>{</p> ho.className=ho.className=='hidden'?'':'hidden';</p> o.className='highlight';</p>}</p></pre></p><p><a href="http://www.icant.co.uk/articleassets/h2test2.html" target="_blank">Works a treat</a>, but still has one problem:</p></p><p>If I already have a class on the headline, the script will remove that one,</p>which means once again Javascript meddling with presentation</p></p><h2>Becoming even classier</h2></p><p>One thing that is amazingly enough still not too commonly known:</p></p><p>Elements can have more than one class. Something like </p><code><h2 class="normal enhanced"></code> is <a href="http://www.w3.org/TR/REC-html40/struct/global.html#h-7.5.2" target="_blank">perfectly valid </p>HTML</a> and is <a href="http://www.pixelsurge.com/experiment/multiplestyles.htm" target="_blank">supported by modern browsers</a>.</p></p><p>Bearing this in mind, we can add our classes to the existing ones or remove </p>them. For this, we can use two small functions.</p></p><pre></p>function juggleClass(o,c,s)</p>{</p> o.className=s==1?o.className+' '+c:o.className.replace(' '+c,'');	</p>}</p>function checkClass(o,c)</p>{</p> var isClassInObj=o.className.indexOf(c)!=-1?true:false;</p> return isClassInObj;</p>}</p></pre></p><p>juggleClass adds the class c to the object o when s is 1, otherwise it removes the class </p>c from the object o.</p></p><p>checkClass checks if the class c is one of the classes of the object o.</p></p><p>If we add that feature, our final function looks like this:</p></p><pre></p>function init()</p>{</p> var h2s,i,tohide,tohideobj,isexpanded;</p>// grab all second level headlines and loop over them </p> h2s=document.getElementsByTagName('h2');</p> for (i=0;i&#60;h2s.length;i++)</p> {</p>// get next sibling (the element to hide, check that it is an element</p>  tohide=h2s[i].nextSibling;</p>  while(tohide.nodeType!=1)</p>  {</p>   tohide=tohide.nextSibling;</p>  }</p>  h2s[i].tohideobj=tohide;</p>// add the hover function onmouseover and onmouseout </p>  h2s[i].onmouseover=function(){hover(this,this.tohideobj,1);}</p>  h2s[i].onmouseout=function(){hover(this,this.tohideobj,0);}</p>// hide next element and add onclick event to the header to show and hide it</p>  juggleClass(tohide,'hidden',1);</p>  juggleClass(h2s[i],'normal',1);</p>  h2s[i].onclick=function(){collapse(this,this.tohideobj);return false}</p> }</p>}</p>// hover function, adds the hover colour </p>// unless the headline is an active trigger</p>function hover(o,ho,state)</p>{</p> if(checkClass(ho,'hidden'))</p> {</p>  if(state==1)</p>  {</p>   juggleClass(o,'normal',0);</p>   juggleClass(o,'hover',1);</p>  } else {</p>   juggleClass(o,'normal',1);</p>   juggleClass(o,'hover',0);</p>  }</p> }</p>}</p>// collapse function, shows and hides the element and sets the highlight </p>// colour of the headline</p>function collapse(o,ho)</p>{</p> if(checkClass(ho,'hidden'))</p> {</p>  juggleClass(ho,'hidden',0);</p>  juggleClass(o,'normal',0);</p>  juggleClass(o,'highlight',1);</p> }else{</p>  juggleClass(ho,'hidden',1);</p>  juggleClass(o,'highlight',0);</p>  juggleClass(o,'normal',1);</p> }</p>}</p>function juggleClass(o,c,s)</p>{</p> o.className=s==1?o.className+' '+c:o.className.replace(' '+c,''); </p>}</p>function checkClass(o,c)</p>{</p> var isClassInObj=o.className.indexOf(c)!=-1?true:false;</p> return isClassInObj;</p>}</p>window.onload=init;</p></pre></p><p><a href="http://www.icant.co.uk/articleassets/h2test3.html" target="_blank">Works the same</a>, but now features a full separation of </p>behaviour and presentation. Storing the class names in global variables would </p>also enable us to change them easily.</p></p><p>If we want to be independent of other Javascripts, we cannot use window.onload </p>of course but should use a </p><a href="http://www.scottandrew.com/weblog/articles/cbs-events" target="_blank">more clever </p>function</a> instead that adds our function to the overall window.onload.</p>