---
layout: post
permalink: pear_soap
ratings: 3
avgrate: 3.3333
rating: 3.68
categories: [Software]
user: dilipt
real_name: "Dilip Thomas"
user_biog: "Dilip Thomas works as a Content Architect for Wrox Press' Open Source Editorial - Saltmarch."
user_since: 09 Dec 2002
avatar: /images/pictures/picture-49991.jpg
article_count: 1
excerpt: "This article will step you through one of the leading SOAP implementations -- PEAR::SOAP, its installation, and then detail an example 'Hello World' SOAP application using PEAR::SOAP. </p><p>PEAR::SOAP is an implementation that is based on SOAPx4 and offers a basic, yet very useful way o..."
---
<h2>Installing PEAR:SOAP</h2></p><p></p>The Installation of PEAR:SOAP does not require any additional extensions, as the library will make use of the overload extension if it is loaded. The latest version of PEAR::SOAP at the time of this writing was 0.7. The dependencies for this release are listed below:</p></p></p><ol>pcre - PHP Extension:	This extension should be compiled in automatically in your PHP libraries/binary. If that is not the case, you need to enable it by passing --enable-pcre (note that this is standard) to configure.</ol></p><ol>HTTP_Request- PEAR Package: Should be installed by default. If it's not, install it manually by downloading it from pear.php.net, and copying the files to your PEAR base directory, or use the pear program: pear install HTTP_Request.</ol></p><ol>Mail_Mime- PEAR Package: Install manually or with pear: pear install Mail_Mime.</ol></p><ol>Net_Dime- PEAR Package: Install manually, or with pear: pear install Net_Dime.</ol></p><ol>Net_Url- PEAR Package: Should be installed by default. If not, install manually, or with pear: pear install Net_Url.</ol></p><p></p>When you've made sure you've got all the above packages installed, it's safe to install PEAR::SOAP. As with the other PEAR packages, this can either be done manually by downloading from http://pear.php.net/soap, or by using the pear script:</p></p></p><code>root@localhost:~# pear install soap</code></p><p></p>It should be said that there have been some problems with the dependency-check in the pear script, and that's not uncommon that the above command fails with a dependency error, although all required packages actually are installed. If that happens, just install the package manually instead, and try to keep in mind that we're dealing with bleeding-edge, experimental software here. Note that pear will be standard in PHP 4.3, and all these issues should be taken care of by that time.  </p></p></p><h2>'Hello World' With PEAR::SOAP</h2></p><p></p>After successfully installing PEAR::SOAP, the next step is to write a 'Hello World' using the implementation. To implement a SOAP server using PEAR::SOAP, you need to define a class that describes the server, and then pass an instance of this class over to PEAR::SOAP. </p>PEAR::SOAP's  SOAP_Server class will then use the characteristics of this class to set up a new SOAP service.</p></p></p><h3>pearsoap-hello-client.php</h3></p><p></p>pearsoap-hello-client.php is our PEAR::SOAP version of the 'Hello World' consumer. Below you'll find a listing and description of this script.</p></p></p><p></p>The SOAP_Client class is PEAR::SOAP's answer to NuSOAP's soapclient, and ezSOAP's eZSOAPClient classes. We need to include the definition of this class before we can proceed:</p></p></p><code></p></p></pre></p><h3></p>Pearsoap-hello-server.php</p></h3></p><p></p>In the PEAR::SOAP version of our simple SOAP service, pearsoap-hello-server.php, you'll see a quite different approach to server implementing that you've got used to walking through the two previous examples. As stated, PEAR::SOAP requires us to define a class that describes the service we want to deploy.</p></p></p><p></p>The SOAP_Server class will implement the SOAP service described by our class, so that we need to include:</p></p></p><pre></p>&lt;?</p>    /* Include PEAR::SOAP's SOAP_Server class: */</p>    require_once('SOAP/Server.php');</p></pre></p><p></p>Here we start the definition of our class, SOAP_Hello_Server:</p></p></p><pre></p><p>    /* To define a new SOAP service with PEAR::SOAP, we need to</p>       construct a class that defines the characteristics for our</p>       service. An instance of this class is then used by SOAP_Server</p>       to create a new SOAP service: */</p>    class SOAP_Hello_Server</p>    {</p></pre></p><p></p>In the constructor of SOAP_Hello_Server, we define the <var>$dispatch_map</var> variable. This variable is used by PEAR::SOAP to figure out what methods the service should process requests to, and what kind of data is sent in and out of these methods (I.e. what parameters is passed to them, and what kind of data they return).</p></p></p><pre></p>        /* $dispatch_map helps SOAP_Server figure out which parameters</p>		are used with the methods: */</p>        var $dispatch_map = array(); </p>        </p>        /* dispatch mapping is optional.  It is used in non-wsdl servers to allow       for being more explicit with what arguments and types are passed in and out.*/</p><p>        /* Here's the constructor for out class. It is used to define</p>           $dispath_map: */</p>        function SOAP_Hello_Server()</p>        {</p>            $this->dispatch_map['helloWorld'] = array(</p>                                                        'in'    => array('inmessage'=>'string'),</p>                                                        'out'   => array('outmessage'=>'string')</p>                                                     );</p>        }</p><p></pre></p><p></p>The helloWorld method remains basically the same. The only difference is that we use SOAP_Fault for error </p></p></p><pre></p>/* Of course, we also need to define all the functions that should</p>           be requestable through our server: */</p>        function helloWorld($inmessage)</p>        {</p>            /* Generate a SOAP error if the argument was not valid: */</p>            if($inmessage == '')</p>            {</p>                /* The SOAP error is generated by the SOAP_Fault class: */</p>                $fault = new SOAP_Fault('You must supply a valid string!','12345');</p>                return $fault->message();</p>            }</p>            else</p>            {</p>                /* If the argument is okay, we submit out return message: */</p>                return "Hello $inmessage!";</p>            }</p>        }</p>    }</p><p></pre></p><p></p>Okay, we've done the definition of SOAP_Hello_Server, se it's time to start the service. First thing we need to do is to create an instance of SOAP_Server:</p></p></p><pre></p>    /* Create a new SOAP server using PEAR::SOAP's SOAP_Server class: */</p>    $server = new SOAP_Server();</p></pre></p><p></p>We also need to create an instance of our own class, SOAP_Hello_Server:</p></p></p><pre></p>    /* Create an instance of our class: */</p>    $soaphelloserver = new SOAP_Hello_Server();</p></pre></p><p></p>And then we tell SOAP_Server about our class:</p></p></p><pre></p>    /* Register this instance to the server class: */</p>    $server->addObjectMap($soaphelloserver,array('namespace'=> 'urn:helloworld')););</p></pre></p><p></p>Next, SOAP_Server->service() is called to start the service:</p></p></p><pre></p>    /* The following line starts the actual service: */</p>    $server->service($HTTP_RAW_POST_DATA);</p></pre></p><p></p>And, exit to avoid printing characters that could cause problems for our application:</p></p></p><h3></p>Testing The Application</p></h3></p><p></p>Hopefully, you have now managed to install PEAR::SOAP on your box, and you're ready to test the application. Point your browser to pearsoap-hello-client.php, and you should see "Hello World" on your browser.</p></p></p><p></p>Note that this article is a distillation from Wrox' forthcoming release - Professional PHP Webservices. The specific chapter (from which this article has been extracted) in the book has coverage on the other two leading SOAP implementations -- NuSOAP and eZSOAP. If you will read and toy around with them, you will notice that all three do exactly the same thing for us, save that each one is based on a different SOAP implementation. Ultimately it is your call as a developer, on which implementation to focus - Maybe the simplicity of NuSOAP appeals to you, or maybe it is the object oriented base of PEAR::SOAP that makes you feel more convenient? Nah! Don't decide just yet! Read the entire chapter from the book instead, and take a look at a couple of other examples that demonstrates the capabilities of PHP SOAP applications a bit further before you make that choice.</p></p></p><p><a href="http://www.phppatterns.com/index.php/article/articleview/21/1/9/l" title="Professional PHP Web Services. Opens in new window." target="_blank">Click on this link to read a pre-release review of the book.</a></p>