---
layout: post
permalink: pear_soap
---
<h2>Installing PEAR:SOAP</h2>\n<p>\nThe Installation of PEAR:SOAP does not require any additional extensions, as the library will make use of the overload extension if it is loaded. The latest version of PEAR::SOAP at the time of this writing was 0.7. The dependencies for this release are listed below:\n</p>\n<ol>pcre - PHP Extension:	This extension should be compiled in automatically in your PHP libraries/binary. If that is not the case, you need to enable it by passing --enable-pcre (note that this is standard) to configure.</ol>\n<ol>HTTP_Request- PEAR Package: Should be installed by default. If it's not, install it manually by downloading it from pear.php.net, and copying the files to your PEAR base directory, or use the pear program: pear install HTTP_Request.</ol>\n<ol>Mail_Mime- PEAR Package: Install manually or with pear: pear install Mail_Mime.</ol>\n<ol>Net_Dime- PEAR Package: Install manually, or with pear: pear install Net_Dime.</ol>\n<ol>Net_Url- PEAR Package: Should be installed by default. If not, install manually, or with pear: pear install Net_Url.</ol>\n<p>\nWhen you've made sure you've got all the above packages installed, it's safe to install PEAR::SOAP. As with the other PEAR packages, this can either be done manually by downloading from http://pear.php.net/soap, or by using the pear script:\n</p>\n<code>root@localhost:~# pear install soap</code>\n<p>\nIt should be said that there have been some problems with the dependency-check in the pear script, and that's not uncommon that the above command fails with a dependency error, although all required packages actually are installed. If that happens, just install the package manually instead, and try to keep in mind that we're dealing with bleeding-edge, experimental software here. Note that pear will be standard in PHP 4.3, and all these issues should be taken care of by that time.  \n</p>\n<h2>'Hello World' With PEAR::SOAP</h2>\n<p>\nAfter successfully installing PEAR::SOAP, the next step is to write a 'Hello World' using the implementation. To implement a SOAP server using PEAR::SOAP, you need to define a class that describes the server, and then pass an instance of this class over to PEAR::SOAP. \nPEAR::SOAP's  SOAP_Server class will then use the characteristics of this class to set up a new SOAP service.\n</p>\n<h3>pearsoap-hello-client.php</h3>\n<p>\npearsoap-hello-client.php is our PEAR::SOAP version of the 'Hello World' consumer. Below you'll find a listing and description of this script.\n</p>\n<p>\nThe SOAP_Client class is PEAR::SOAP's answer to NuSOAP's soapclient, and ezSOAP's eZSOAPClient classes. We need to include the definition of this class before we can proceed:\n</p>\n<code>\n<?\n    /* Include PEAR::SOAP's SOAP_Client class: */\n    require_once('SOAP/Client.php');</p><p></code></p><p><p>\nSOAP_Client's requires one argument: the URL to the SOAP service we wish to connect to. Optionally, you can also pass an second boolean 'true' to the script, which would indicate that the first argument is not an URL to a service, but a path to a WSDL:\n</p></p><p><pre>\n    /* Create a new SOAP client using PEAR::SOAP's SOAP_Client-class: */\n    $client = new SOAP_Client('http://localhost/soap/pear-soap/pearsoap-hello-server.php');\n</pre>\n<p>\nAs usual, we send a single string to the server:</p>\n<pre></p><p>    /* Define the parameters we want to send to the server's helloWorld-function.\n       Note that these arguments should be sent as an array: */\n    $params = array('inmessage'=>'World');\n</pre>\n<p>\nNext, we make a call to the server, telling it we want to some assistance from its helloWorld method with the data in $params. When the request is carried out, the result gets stored in $response:\n</p>\n<pre>\n    /* Send a request to the server, and store its response in $response: */\n$response = $client->call('helloWorld',$params,array('namespace'=> 'urn:helloworld'));\n</pre>\n<p>\nPrint the result to the user:\n</p>\n<pre>\n    /* Print the server-response: */\n    print $response;\n?>\n</pre>\n<h3>\nPearsoap-hello-server.php\n</h3>\n<p>\nIn the PEAR::SOAP version of our simple SOAP service, pearsoap-hello-server.php, you'll see a quite different approach to server implementing that you've got used to walking through the two previous examples. As stated, PEAR::SOAP requires us to define a class that describes the service we want to deploy.\n</p>\n<p>\nThe SOAP_Server class will implement the SOAP service described by our class, so that we need to include:\n</p>\n<pre>\n&lt;?\n    /* Include PEAR::SOAP's SOAP_Server class: */\n    require_once('SOAP/Server.php');\n</pre>\n<p>\nHere we start the definition of our class, SOAP_Hello_Server:\n</p>\n<pre></p><p>    /* To define a new SOAP service with PEAR::SOAP, we need to\n       construct a class that defines the characteristics for our\n       service. An instance of this class is then used by SOAP_Server\n       to create a new SOAP service: */\n    class SOAP_Hello_Server\n    {\n</pre>\n<p>\nIn the constructor of SOAP_Hello_Server, we define the <var>$dispatch_map</var> variable. This variable is used by PEAR::SOAP to figure out what methods the service should process requests to, and what kind of data is sent in and out of these methods (I.e. what parameters is passed to them, and what kind of data they return).\n</p>\n<pre>\n        /* $dispatch_map helps SOAP_Server figure out which parameters\n		are used with the methods: */\n        var $dispatch_map = array(); \n        \n        /* dispatch mapping is optional.  It is used in non-wsdl servers to allow       for being more explicit with what arguments and types are passed in and out.*/</p><p>        /* Here's the constructor for out class. It is used to define\n           $dispath_map: */\n        function SOAP_Hello_Server()\n        {\n            $this->dispatch_map['helloWorld'] = array(\n                                                        'in'    => array('inmessage'=>'string'),\n                                                        'out'   => array('outmessage'=>'string')\n                                                     );\n        }</p><p></pre>\n<p>\nThe helloWorld method remains basically the same. The only difference is that we use SOAP_Fault for error \n</p>\n<pre>\n/* Of course, we also need to define all the functions that should\n           be requestable through our server: */\n        function helloWorld($inmessage)\n        {\n            /* Generate a SOAP error if the argument was not valid: */\n            if($inmessage == '')\n            {\n                /* The SOAP error is generated by the SOAP_Fault class: */\n                $fault = new SOAP_Fault('You must supply a valid string!','12345');\n                return $fault->message();\n            }\n            else\n            {\n                /* If the argument is okay, we submit out return message: */\n                return "Hello $inmessage!";\n            }\n        }\n    }</p><p></pre>\n<p>\nOkay, we've done the definition of SOAP_Hello_Server, se it's time to start the service. First thing we need to do is to create an instance of SOAP_Server:\n</p>\n<pre>\n    /* Create a new SOAP server using PEAR::SOAP's SOAP_Server class: */\n    $server = new SOAP_Server();\n</pre>\n<p>\nWe also need to create an instance of our own class, SOAP_Hello_Server:\n</p>\n<pre>\n    /* Create an instance of our class: */\n    $soaphelloserver = new SOAP_Hello_Server();\n</pre>\n<p>\nAnd then we tell SOAP_Server about our class:\n</p>\n<pre>\n    /* Register this instance to the server class: */\n    $server->addObjectMap($soaphelloserver,array('namespace'=> 'urn:helloworld')););\n</pre>\n<p>\nNext, SOAP_Server->service() is called to start the service:\n</p>\n<pre>\n    /* The following line starts the actual service: */\n    $server->service($HTTP_RAW_POST_DATA);\n</pre>\n<p>\nAnd, exit to avoid printing characters that could cause problems for our application:\n</p>\n<h3>\nTesting The Application\n</h3>\n<p>\nHopefully, you have now managed to install PEAR::SOAP on your box, and you're ready to test the application. Point your browser to pearsoap-hello-client.php, and you should see "Hello World" on your browser.\n</p>\n<p>\nNote that this article is a distillation from Wrox' forthcoming release - Professional PHP Webservices. The specific chapter (from which this article has been extracted) in the book has coverage on the other two leading SOAP implementations -- NuSOAP and eZSOAP. If you will read and toy around with them, you will notice that all three do exactly the same thing for us, save that each one is based on a different SOAP implementation. Ultimately it is your call as a developer, on which implementation to focus - Maybe the simplicity of NuSOAP appeals to you, or maybe it is the object oriented base of PEAR::SOAP that makes you feel more convenient? Nah! Don't decide just yet! Read the entire chapter from the book instead, and take a look at a couple of other examples that demonstrates the capabilities of PHP SOAP applications a bit further before you make that choice.\n</p>\n<p><a href="http://www.phppatterns.com/index.php/article/articleview/21/1/9/l" title="Professional PHP Web Services. Opens in new window." target="_blank">Click on this link to read a pre-release review of the book.</a></p>