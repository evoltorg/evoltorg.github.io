---
layout: post
permalink: search_engine_friendly_urls_with_iis_and_classic_asp
ratings: 0
avgrate: 
rating: 3.89
categories: [Code]
user: Marcel Feenstra
real_name: "Marcel Feenstra"
user_biog: "<p>Marcel holds a Master's degree in Comparative Literature from Utrecht University, one in International Relations from The Fletcher School (Tufts University), and an MBA from The Tuck School of Business at Dartmouth College. He is the owner of <a href=\"http://www.afterimage.nl/\" rel=\"nofollow\">AfterImage Internet Consultants</a> in The Hague, a company specializing in search engine optimization for <a href=\"http://www.ondernemingen.com/\" rel=\"nofollow\">SME in The Netherlands and Belgium</a>.</p>

<p>In his spare time, he works on <a href=\"http://www.voorbeginners.info/\" rel=\"nofollow\">Voor Beginners</a>, a collection of sites in Dutch containing information about a large (and growing) number of topics, and its English counterpart <a href=\"http://www.forbeginners.info/\" rel=\"nofollow\">For Beginners</a>; he is also an editor at the Open Directory Project. Other hobbies and interests include chess, computers, classical music, and literature. Marcel, his wife and their two daughters currently live in The Hague.</p>"
user_since: 20 Apr 2007
avatar: 
article_count: 2
excerpt: "<p>A few years ago, I needed a Content Management System (CMS) for my site <a href=\"http://www.voorbeginners.info/\" target=\"_blank\">Voor Beginners</a> and its English counterpart <a href=\"http://www.forbeginners.info/\" target=\"_blank\">For Beginners</a>. One of the requirements was,..."
---
<p>A few years ago, I needed a Content Management System (CMS) for my site <a href="http://www.voorbeginners.info/" target="_blank">Voor Beginners</a> and its English counterpart <a href="http://www.forbeginners.info/" target="_blank">For Beginners</a>. One of the requirements was, that the CMS should use "search engine friendly" URLs. This is fairly easy to accomplish with Linux and Apache; however, another requirement was that the CMS should run on the Windows platform... In this article, I will show how you can "simulate" the effects of .htaccess and mod_rewrite using Microsoft's Internet Information Server (IIS) and classic ASP.</p></p><p><!--break--></p><p><h2>The Problem</h2></p><p><p>A typical CMS stores its content in a database for easy maintenance. When an end user visits a web page, the content for that page must be retrieved from the database so that it can be displayed. So how does the system "know" which database record should be retrieved for a particular page? The answer is that the URL for that page contains a query string or "parameter" that uniquely identifies the content, e.g.:</p></p><p><code>http://www.example.com/showitem.php?id=12345</code></p><p><p>In this example, there is only a single parameter ("id"), but it is quite possible to have URLs with two or more parameters. For example, if you have a piece of clothing that is available in different colors and sizes, you could have something like:</p></p><p><code>http://www.example.com/showitem.php?id=12345&col=12&siz=34</code></p><p><p>Unfortunately, search engines have a problem indexing URLs with parameters (A.K.A. "dynamic URLs"); and that's especially true for URLs with <strong>multiple</strong> parameters. Therefore, if we want all of our pages to be indexed, we need a mechanism that hides the parameters from the search engines and turns them into "static" URLs that look something like:</p></p><p><code>http://www.example.com/showitem/12345/12/34/</code></p><p><p>Two earlier articles by <a href="http://evolt.org/node/15049">garrett</a> and <a href="http://evolt.org/node/17171">bheerssen</a> show how you can achieve the desired effect with Apache using .htaccess and mod_rewrite. However, .htaccess and mod_rewrite are not available if you use IIS, so we need a "trick" to simulate their effect on the Windows platform...</p></p><p><h2>Step One: 404 Error Handler</h2></p><p><p>Let's use the ASP version of the earlier example with three parameters. In other words, when end users request the page:</p></p><p><code>http://www.example.com/showitem/12345/12/34/</code></p><p><p>we will act as if they had requested the page:</p></p><p><code>http://www.example.com/showitem.asp?id=12345&col=12&siz=34</code></p><p><p>The first thing to notice is that the "parameterless page" <strong>does not really exist</strong>, so when end users request it, they will actually <strong>trigger an error</strong> ("404 File Not Found").</p></p><p><p>This leads us to the idea that we can use a <strong>custom error handler</strong> to deal with the problem.</p></p><p><p>To specify a custom error handler for our web site in IIS, we go to the "Custom Errors" tab of your site's Properties. The default handler for the 404 error will be of type "File" and will point to a file called "404b.htm" somewhere in your Windows directory. We click on "Edit" to specify a new error handler. First, we change "Message type" from "File" to "URL". Next, we enter the <strong>absolute</strong> URL of the ASP file that will act as our 404 error handler; i.e., we enter "/my404.asp" rather than "my404.asp". Finally, we click "OK" to confirm.</p></p><p><p>We have now stated that there will be a file called "my404.asp" in the root directory of our site that will deal with "file not found" errors, so our next step is to create one.</p></p><p><p>How do we know which (non-existent) file has been requested by an end user? Fortunately, that is something that we can easily find out by looking at "Request.QueryString".</p></p><p><p>If someone requests "http://www.example.com/showitem/12345/12/34", Request.QueryString will contain "404;http://www.example.com:80/showitem/12345/12/34", i.e., the error code "404" followed by a semicolon and the requested URL. (By the way, notice that the URL includes the port number ":80"!)</p></p><p><p>Now all we have to do is "parse" the URL to find the three "hidden" parameters, and then we can "translate" the requested URL into the <strong>actual</strong> URL that we will send back to the browser.</p></p><p><p>A first, extremely "naive" version of our code could be something like:</p></p><p><pre></p>Dim RQ, P, ID, Color, Size</p><p>RQ = Request.QueryString</p><p>P = Instr(RQ,"showitem/")</p><p>If P > 0 Then</p>  RQ = Mid(RQ,P+9) ' The string "showitem/" contains 9 characters!</p><p>  P = Instr(RQ, "/")</p>  ID = Left(RQ,P-1)</p>  RQ = Mid(RQ,P+1)</p><p>  P = Instr(RQ, "/")</p>  Color = Left(RQ,P-1)</p>  RQ = Mid(RQ,P+1)</p><p>  P = Instr(RQ, "/")</p>  Size = Left(RQ,P-1)</p>  </p>  Response.Write "ID: " & ID & ", Color: " & Color & ", Size: " & Size</p><p>End If</p></pre></p><p><p>In reality, we would need much better error handling; what, for example, if the URL does not contain the required number of parameters, or if it does not contain a trailing slash?</p></p><p><p>For the sake of simplicity, we will respond to these cases by sending a status code of 404 to the browser and stop further processing; we'll do the same when someone requests a completely unrelated (non-existent) page (e.g., http://www.example.com/nosuchpage.htm). This can be done with the following code:</p></p><p><pre></p>Dim RQ, P, ID, Color, Size, ErrorFound</p><p>RQ = Request.QueryString</p>ErrorFound = False</p><p>P = Instr(RQ,"showitem/")</p><p>If P > 0 Then</p>  RQ = Mid(RQ,P+9) ' The string "showitem/" contains 9 characters!</p>  P = Instr(RQ, "/")</p>  If P > 0 Then</p>    ID = Left(RQ,P-1)</p>    RQ = Mid(RQ,P+1)</p>    P = Instr(RQ, "/")</p>    If P > 0 Then</p>      Color = Left(RQ,P-1)</p>      RQ = Mid(RQ,P+1)</p>      P = Instr(RQ, "/")</p>      If P > 0 Then</p>        Size = Left(RQ,P-1)</p>      Else</p>        ErrorFound = True</p>      End If</p>    Else</p>      ErrorFound = True</p>    End If</p>  Else</p>    ErrorFound = True</p>  End If</p>Else</p>  ErrorFound = True</p>End If</p><p>If Not ErrorFound Then</p>  Response.Write "ID: " & ID & ", Color: " & Color & ", Size: " & Size</p>Else</p>  Response.Status = "404 File Not Found"</p>  Response.End</p>End If</p></pre></p><p><h2>Step Two: Server.Transfer</h2></p><p><p>So far, we have responded to a (well-formed) URL request by <strong>displaying</strong> the three parameters ID, Color, and Size. In reality, however, we want to return the page:</p></p><p><code>http://www.example.com/showitem.asp?id=12345&col=12&siz=34</code></p><p><p>This can easily be accomplished using Server.Transfer:</p></p><p><pre></p>  Server.Transfer "/showitem.asp?id=" & ID & "&col=" & Color & "&siz=" & Size</p></pre></p><p><p>(We have to make sure, however, that the file "showitem.asp" itself uses <strong>absolute</strong>, rather than relative, URLs for graphics, style sheets, etc., otherwise it will point to items in a non-existent directory!)</p></p><p><h2>A Flexible Alternative</h2></p><p><p>The example above deals with a single type of page (clothing items) with three parameters (ID, Color, and Size). Of course, we could expand the code so that it can handle <strong>different</strong> page types and (perhaps variable) numbers of parameters. As a result, we would be able to use URLs like:</p></p><p><code>http://www.example.com/showbook/9876/</code></p><p><p>to display information on books (that have no color or size, just an ID), or:</p></p><p><code>http://www.example.com/showitem/12345/12/34/5/</code></p><p><p>for clothing items that have a fourth parameter (e.g., material). However, as you can imagine, the required code could quickly get very messy and hard to debug...</p></p><p><p>As I was thinking about a way to improve upon this idea, the following thought struck me. What if we were to use the <strong>entire</strong> query string (after some "basic cleaning", perhaps, like converting it to lower case and removing extraneous characters) to retrieve the associated content from a database; something like:</p></p><p><pre></p>  SQL = "SELECT * FROM MyContent WHERE MyTitle = '" & CleanQueryString & "'"</p>  ' ...</p></pre></p><p><p>This would provide us with a very flexible way to display content from our database! While I haven't (yet) implemented this idea myself, it may well be worth exploring... Happy coding!</p>