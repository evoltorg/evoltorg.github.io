---
layout: post
permalink: How_to_create_a_hierarchical_navigation_menu
ratings: 2
avgrate: 2.5000
rating: 3.49
categories: [Code]
user: Martin Tsachev
real_name: "Martin Tsachev"
user_biog: "<p>Martin Tsachev started using computers
in 1992, programming Basic and has since
then developed a great passion for them.
</p>

<p>Nowadays he runs
<a href=\"http://www.mtdev.com\" rel=\"nofollow\" target=\"_blank\"
title=\"mtdev covers PHP, Python, JavaScript, and Linux shell scripts\">
mtdev</a> - a web site with highlight on PHP.
</p>"
user_since: 27 Jun 2001
avatar: /images/pictures/picture-12535.jpg
article_count: 6
excerpt: "Want to create a hierarchical navigation menu for your site &#8212; you think that's hard, read on and I'll show you it's not. The great thing about it is the section you're in will be expanded while the others collapsed to represent relation of the pages."
---
<h2>Introduction</h2></p><p>Want to create a hierarchical navigation menu for your site &#8212; you think that's hard, read on and I'll show you it's not. The great thing about it is the section you're in will be expanded while the others collapsed to represent relation of the pages.</p></p></p><p><p><em>Why would one want hierarchical navigation links ah?</em> &#8212; well this really improves organisation as a whole, eases finding of information and access to related information.</p></p></p><p><h2>What's required</h2></p><p><p></p>First of all your site will have to use a hierarchical structure or have some special way of representing it, using canonical URIs is recommended, you won't get the result wanted otherwise.</p></p></p><p><p></p>My site uses uses some remapping techniques so that more friendly URIs are presented to the user( and robots of course). If you want to know more about that a good start is to read</p><a href="http://evolt.org/article/Search_Engine_Friendly_URLs_with_PHP_and_Apache/17/15049/index.html" target="_new" title="Search Engine Friendly URLs Article (Opens in a New Window)">Search Engine Friendly URLs</a>,</p><a href="http://www.alistapart.com/stories/urls/index.html" target="_new" title="URLs! URLs! URLs! Article on A List Apart (Opens in a New Window)">URLs! URLs! URLs!</a> or</p><a href="http://www.alistapart.com/stories/succeed/index.html" target="_new" title="How to Succeed with URLs Article on A List Apart (Opens in a New Window)">How to Succeed with URLs</a>. Apache's documentation also has many examples of the use of mod_rewrite.</p></p></p><p><p></p>I'm using PHP for the code but there's no problem to use any given language that's used embedded in HTML or as a CGI, just some little adjustments need to be done.</p></p></p><p><h2>Configuration</h2></p><p><p></p>A good starting point is adding some configuration to your <code>.htaccess</code> or <code>httpd.conf</code> file.</p></p></p><p><pre></p>DirectoryIndex site index.php</p>&lt;Files "site"&gt;</p>	ForceType application/x-httpd-php</p>&lt;/Files&gt;</p></pre></p><p><p></p><code>DirectoryIndex</code> sets the file to be served when Apache receives a request for a directory. The next declaration forces the &quot;site&quot; file (without the quotes) to be treated as PHP code, even though it doesn't have the php extension.</p></p></p><p><pre></p>Action handle_my_php_pages /shaggy/site</p>AddHandlet handle_my_php_pages .php</p></pre></p><p><p></p>These two lines can ensure that your global page handler will also be called when a direct request for a php file is made. This is <em>optional</em> and may require some modifications to the code.</p></p></p><p><h2 id="style">Style rules to use</h2></p><p><pre></p>ul.links {</p>	margin-left : 0;</p>	padding-left : 0;</p>}</p><p>ul.links li {</p>        margin-left : 0;</p>        list-style : none;</p>}</p><p>ul.links li ul {</p>	padding-left : 2em;</p>	margin-left : 0;</p>}</p></pre></p><p><p></p>This will prevent the default rendering of the unordered list items that browsers do and change it into something that's more likely to look appropriate for navigation links.</p></p></p><p><h2>The core of it</h2></p><p><p></p>I have all PHP code that is shown below saved in a file named <code>site</code>.</p></p></p><p><pre></p>$pages = array(</p>	'Home' => 'home',</p>	'News' => array(</p>		0 => 'news/',</p>		'Europe' => 'news/europe',</p>		'USA' => 'news/usa',</p>		'Asia' => 'news/asia'),</p>	'Contact' => 'contact');</p>$root = 'shaggy';</p>$handler = 'site';</p></pre></p><p><p></p>The <code>pages</code> array will hold the labels and their mapping to the URIs. Note the index value 0 used within the News subcategory, it maps to the section index. I used 0 because it evaluates to false in PHP, you will see why a bit later.</p></p></p><p><p></p>The other two variables are set to the root of your site, and to the page that will handle file includes.</p></p></p><p><pre></p>$params = explode('/', $HTTP_SERVER_VARS['REQUEST_URI']);</p>array_shift($params);</p>foreach ( $params as $i => $value ) {</p>	if ( $value == $root or $value == $handler )</p>		array_shift($params);</p>}</p><p>$include_file = implode('/', $params);</p>if ( sizeof($params) &lt; 2 ) {</p>	$include_file = 'root/' . $include_file;</p>	$params[0] = 'root';</p>}</p><p>$include_file = explode('?', $include_file);</p>$include_file = $include_file[0];</p><p>if ( $params[sizeof($params)-1] == '' ) {</p>	$include_file .= 'index';</p>}</p><p>$include_file .= '.php';</p><p>if ( ! file_exists($include_file) ) {</p>	$include_file = "$params[0]/index.php";</p>}</p>include($include_file);</p></pre></p><p><p></p>First explode the URI on <code>/</code>es (</p><code>track_vars</code> must be set to <code>on</code> in php.ini or a .htaccess file, else just use <code>$REQUEST_URI</code>) and get rid of the first empty value &#8212; that's because webservers process only absolute requests and they start with a slash. Next remove the other unnecessary info &#8212; namely the root and the global page handler for your site.</p></p></p><p><p></p><code>$include_file = implode('/', $params)</code> does the same thing backwards, this time without the site global info to get the filename to be <code>include</code>d. A check is performed to find if the request is for a page in no category, I have all of them in a directory called <code>root</code>. You're maybe wondering why I have <code>$params[0] = 'root'</code> &#8212; this is because of the <code>file_exist</code> later on. Next remove the query string if present, that is usually done by the webserver for you but this time you want to include the files yourself and that's needed.</p></p></p><p><p></p>Directory indexed end with &quot;/&quot;(a slash) so append <code>index</code> if this is the case, otherwise you will have to store your directory indexes in files called <code>.php</code> and that may be quite confusing.</p></p></p><p><p></p>Finally, perform a check if the file exists, if not forward to the section index (this code may need some improvements if you think this is likely to happen often). <code>include</code> the file that's requested.</p></p></p><p><p></p>The <code>create_nav_links</code> does the <em>hard</em> work, it will traverse a given array and display the appropriate links, if it finds another array it will call itself with it as a parameter.</p></p></p><p><pre></p>function create_nav_links( $section, $level ) {</p>	global $params;</p>	if ( ! $level ) {</p>		$markup = '&lt;ul class="links"&gt;' . "</p>";</p>	} else {</p>		$markup = "&lt;ul&gt;</p>";</p>	}</p>	foreach ( $section as $desc =&gt; $filename ) {</p>		if ( ! is_array($filename) ) {</p>			if ( $desc )</p>				$markup .= '&lt;li&gt;&lt;a href="' . $handler . '/' . $filename . '"&gt;' . $desc . "&lt;/a&gt;&lt;/li&gt;</p>";</p>		} else {</p>			if ( $params[$level] . '/' == $filename[0] ) {</p>				$markup .= '&lt;li&gt;&lt;a href="' . $handler . '/' . $filename[0] . '"&gt;' . $desc . "&lt;/a&gt;</p>";</p>				$markup .= create_nav_links($filename, $level +1);</p>				$markup .= "&lt;/li&gt;</p>";</p>			} else {</p>				$markup .= '&lt;li&gt;&lt;a href="' . $handler . '/' . $filename[0] . '"&gt;' . $desc . "&lt;/a&gt;&lt;/li&gt;</p>";</p>			}</p>		}</p>	}</p>	return ( $markup . "&lt;/ul&gt;</p>" );</p>}</p><p>echo create_nav_links($pages, 0);</p></pre></p><p><p></p>First check if we are at level 0, the topmost, if so add a class of <code>links</code> to the unordered list (see the <a href="/How_to_create_a_hierarchical_navigation_menu#style" title="Style Sheet">style sheet</a> given above). All new lines are optional and are added just to make the output HTML look nicer.</p></p></p><p><p></p>The man loop traverses the array passed as a parameter, first we check to see if we're dealing with a normal file &#8212; i.e. not a section (which is represented as an array in our <code>pages</code> structure. Then a simple check if we have a description for this element &#8212; remember the 0 index used for the section URI in <code>pages</code>. If this was not checked you would have end up with categories listed again within themselves.</p></p></p><p><p></p>In the other case &#8212; a category check (<code>if ( $params[$level] . '/' == $filename[0] )</code> if this is what we're within, we don't want to mess up the navigation menu with tons of links. If it is indeed our category, display a link to the index and add the output of <code>create_nav_links</code>, this time called with the section array and a level deeper.</p></p></p><p><p></p>If this is some other category, the visitor is probably not interested in, just display a links to its index &#8212; <code>$markup .= '&lt;li&gt;&lt;a href="' . $handler . '/' . $filename[0] . '"&gt;' . $desc . "&lt;/a&gt;&lt;/li&gt;</p>"</code></p></p></p><p><p></p>Finally <code>echo</code> out the navigation to the browser, you should take care that it is printed where appropriate.</p></p></p><p><p></p>A little something that has to be added to the <code>head</code> of your pages:</p></p></p><p><pre></p>&lt;?php</p>$base = 'http://' . $HTTP_SERVER_VARS['SERVER_NAME'] . $HTTP_SERVER_VARS['SCRIPT_NAME'];</p>?&gt;</p>&lt;base href="&lt;?php echo $base?&gt;" /&gt;</p></pre></p><p><p></p>That ensures the consistency of your links generated by the <code>create_nav_links</code> function. Again this one requires <code>track_vars = on</code> in PHP's configuration.</p></p></p><p><h2>What else</h2></p><p><p></p>You noticed that last note about the links, right?  Well, it ensures that these links are okay but when you begin using anchors in your documents you <em>can't</em> use anchor names relative to the current page, you'll have to make them relative to your document root.</p></p></p><p><p></p><cite>You smarty, why don't you fix your function</cite> &#8212; well it will be not a problem to fix <em>this</em> function but what about any global style sheets or images referenced from your pages &#8212; you'll have to modify them for every page.</p></p></p><p><p></p>A better solution to this problem would be to use a function for creating links that are absolute (for the site) and get rid of the <code>base href</code>. Such a function would take as a parameter for example <code>news/europe</code> and return <code>/shaggy/site/news/europe</code>, the <code>$root</code> and <code>$handler</code> variables can be used for this transformation.</p></p></p><p><p></p>This way to hold the navigation menu, as an PHP array, is good only if you want to update it into the source everytime you change something. A better solution would be to use a database to hold that data, even you may want to get the contents of the pages from a database source.</p></p>