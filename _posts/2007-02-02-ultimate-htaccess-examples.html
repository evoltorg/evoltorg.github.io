---
layout: post
permalink: ultimate_htaccess_examples
ratings: 0
avgrate: 
category: Backend
user: apachehtaccess
real_name: "AskApache"
user_biog: "Web Developer and Server Administrator for best-practices, based in Indianapolis."
user_since: 08 Jan 2007
avatar: /images/pictures/picture-71186.jpg
article_count: 1
excerpt: "<p><strong>Here\'s my list of the ultimate htaccess code snippets and examples that I use all the time.</strong>  I tried to keep them extremely minimalistic.</p></p>"
---
<p><strong>Here's my list of the ultimate htaccess code snippets and examples that I use all the time.</strong>  I tried to keep them extremely minimalistic.</p></p><p>Don't miss checking out my <a href="http://www.askapache.com/htaccess/ultimate-htaccess-file-sample.html">example htaccess file</a>, its very comprehensive</p></p><p></p><blockquote cite="http://www.askapache.com/htaccess/apache-htaccess.html"><p>Hey <a href="http://www.askapache.com/htaccess/apache-htaccess.html">jason</a> I'm glad someone finally noticed the "development" htaccess at the bottom of my file!  Thats honestly the piece of code I am most glad to have.</p></blockquote></p><p></p><p><h2>Heres the actual code that I use when I'm developing sites for clients</h2></p><p>This lets google crawl the page, lets me access the whole site (24.205.23.222) without a password, and lets my client access the page WITH a password.  It also allows for XHTML and CSS validation! (w3.org)</p></p><code></p>#     ELITE HTACCESS FOR WEBDEVELOPERS</p>##############################################</p>AuthName "SiteName Administration"</p>AuthUserFile /home/sitename.com/.htpasswd</p>AuthType basic</p>Require valid-user</p>Order deny,allow</p>Deny from all</p>Allow from 24\.205\.23\.222</p>Allow from w3.org htmlhelp.com</p>Allow from googlebot.com</p>Satisfy Any</p></code></p><p></p><p></p>Each code snippet has been copied from htaccesselite.  Additional and detailed info on each htaccess code snippet can be found at <a href="http://www.askapache.com/">askapache.com</a></p></p></p><p></p><strong>NOTE:</strong> Most of these snippets can be used with a <a href="http://www.askapache.com/htaccess/using-filesmatch-and-files-in-htaccess.html">Files or Filesmatch</a> directive to only apply to certain files.</p></p></p><p></p><strong>NOTE:</strong> Any htaccess rewrite examples should always begin with:</p></p></p><code></p>Options +FollowSymLinks</p>RewriteEngine On</p>RewriteBase /</p></code></p><p></p><h2>Apache Documentation: <a href="http://httpd.apache.org/docs/1.3/">1.3</a>    <a href="http://httpd.apache.org/docs/2.0/">2.0</a>    <a href="http://httpd.apache.org/docs/2.2/">2.2</a>    <a href="http://httpd.apache.org/docs/trunk/">Current</a></h2></p><p></p><p><h2>Make any file be a certain filetype (regardless of name or extension)</h2></p><code></p>#Makes image.gif, blah.html, index.cgi all act as php</p>ForceType application/x-httpd-php</p></code></p><p></p><p></p><h2>Redirect non-https requests to https server fixing double-login problem and ensuring that htpasswd authorization can only be entered using HTTPS</h2></p><p><a href="http://www.htaccesselite.com/htaccess/redirecting-all-or-part-of-a-server-to-ssl-vt61.html">Additional https/ssl information</a> and <a href="http://www.askapache.com/htaccess/apache-ssl-in-htaccess-examples.html">Apache SSL in htaccess examples</a></p></p><code></p>SSLOptions +StrictRequire</p>SSLRequireSSL</p>SSLRequire %{HTTP_HOST} eq "google.com"</p>ErrorDocument 403 https://google.com</p></code></p><p></p><p></p><h2>SEO Friendly redirects for bad/old links and moved links</h2></p><h3>For single moved file</h3></p><code></p>Redirect 301 /d/file.html http://www.htaccesselite.com/r/file.html</p></code></p><h3>For multiple files like a blog/this.php?gh</h3></p><code></p>RedirectMatch 301 /blog(.*) http://www.askapache.com/$1</p></code></p><h3>different domain name</h3></p><code></p>Redirect 301 / http://www.newdomain.com</p></code></p><p></p><p></p><h2>Require the www</h2></p><code></p>Options +FollowSymLinks</p>RewriteEngine On</p>RewriteBase /</p>RewriteCond %{REQUEST_URI} !^/robots\.txt$</p>RewriteCond %{HTTP_HOST} !^www\.example\.com$ [NC]</p>RewriteRule ^(.*)$ http://www.example.com/$1 [R=301,L] </p></code></p><p><h2>Require the www without hardcoding</h2></p><code></p>Options +FollowSymLinks</p>RewriteEngine On</p>RewriteBase /</p>RewriteCond %{REQUEST_URI} !^/robots\.txt$ [NC]</p>RewriteCond %{HTTP_HOST} !^www\.[a-z-]+\.[a-z]{2,6} [NC]</p>RewriteCond %{HTTP_HOST} ([a-z-]+\.[a-z]{2,6})$     [NC]</p>RewriteRule ^/(.*)$ http://%1/$1 [R=301,L]</p></code></p><p></p><h2>Require no subdomain</h2></p><code></p>Options +FollowSymLinks</p>RewriteEngine On</p>RewriteBase /</p>RewriteCond %{REQUEST_URI} !^/robots\.txt$</p>RewriteCond %{HTTP_HOST} \.([a-z-]+\.[a-z]{2,6})$ [NC]</p>RewriteRule ^/(.*)$ http://%1/$1 [R=301,L]</p></code></p><p><h2>Require no subdomain</h2></p><code></p>Options +FollowSymLinks</p>RewriteEngine On</p>RewriteBase /</p>RewriteCond %{HTTP_HOST} \.([^\.]+\.[^\.0-9]+)$</p>RewriteCond %{REQUEST_URI} !^/robots\.txt$ [NC]</p>RewriteRule ^(.*)$ http://%1/$1 [R=301,L]</p></code></p><p></p><h2>Redirect everyone to different site except 1 IP address (useful for web-development)</h2></p><code></p>ErrorDocument 403 http://www.someothersite.com</p>Order deny,allow</p>Deny from all</p>Allow from 24.33.65.6</p></code></p><p></p><p></p><h2>CHMOD your files</h2></p><p></p>chmod .htpasswd files 640</p>chmod .htaccess files 644</p>chmod php files 600</p>chmod files that you really dont want people to see as 400</p><strong>NEVER chmod 777</strong>, if something requires write access use 766</p></p></p><p></p><p></p><h2>Variable (<a href="http://httpd.apache.org/docs/2.2/mod/mod_env.html">mod_env</a>) Magic</h2></p><h3>Set the Timezone of the server:</h3></p><code></p>SetEnv TZ America/Indianapolis </p></code></p><p></p><p></p><h2>Set the Server Administrator Email:</h2></p><code></p>SetEnv SERVER_ADMIN webmaste@htaccesselite.com</p></code></p><p></p><p></p><h2>Turn off the ServerSignature</h2></p><code></p>ServerSignature Off</p></code></p><p></p><p></p><h2>Add a "en-US" language tag and "text/html; UTF-8" headers without meta tags</h2></p><p>Article: <a href="http://www.askapache.com/htaccess/setting-charset-in-htaccess.html">Setting Charset in htaccess</a></p></p><p>Article: <a href="http://www.askapache.com/htaccess/using-filesmatch-and-files-in-htaccess.html">Using FilesMatch and Files in htaccess</a></p></p><code></p>AddDefaultCharset UTF-8</p># Or AddType 'text/html; charset=UTF-8' html</p>DefaultLanguage en-US</p></code></p><p><h3>Using the Files Directive</h3></p><code></p><Files ~ "\.(htm html css js php)$"></p>   AddDefaultCharset UTF-8</p>   DefaultLanguage en-US</p></Files></p></code></p><p><h3>Using the FilesMatch Directive <em>(preferred)</em></h3></p><code></p><FilesMatch "\.(htm html css js php)$"></p>   AddDefaultCharset UTF-8</p>   DefaultLanguage en-US</p></FilesMatch></p></code></p><p></p><h2>Use a custom php.ini with mod_php or php as a cgi</h2></p><p>Article: <a href="http://www.askapache.com/php/custom-phpini-tips-and-tricks.html">Custom PHP.ini tips and tricks</a></p></p><blockquote><p></p>When php run as Apache Module (mod_php)</p>in root .htaccess</p>SetEnv PHPRC /location/todir/containing/phpinifile</p><p></p>When php run as CGI</p>Place your php.ini file in the dir of your cgi’d php, in this case /cgi-bin/</p><p>htaccess might look something like this</p>AddHandler php-cgi .php .htm Action php-cgi /cgi-bin/php5.cgi</p><p></p>When cgi’d php is run with wrapper (for FastCGI)</p>You will have a shell wrapper script something like this:</p><p>#!/bin/sh </p>export PHP_FCGI_CHILDREN=3 </p>exec /user3/x.com/htdocs/cgi-bin/php5.cgi</p><p>Change To</p><p>#!/bin/sh </p>export PHP_FCGI_CHILDREN=3 </p>exec /x.com/cgi-bin/php.cgi -c /abs/path/to/php.ini</p></blockquote></p><p></p><p></p><h2>Securing directories: Remove the ability to execute scripts </h2></p><p></p>    Heres a couple different ways I do it</p></p></p><code></p>AddHandler cgi-script .php .pl .py .jsp .asp .htm .shtml .sh .cgi </p>Options -ExecCGI</p></code></p><p></p>This is cool, you are basically categorizing all those files that end in those extensions so that they fall under the jurisdiction of the -ExecCGI command, which also means -FollowSymLinks <em>(and the opposite is also true, +ExecCGI also turns on +FollowSymLinks)</em></p></p></p><p></p><p></p><h2>Only allow GET and PUT request methods to your server.</h2></p><code></p>Options -ExecCGI -Indexes -All +FollowSymLinks</p>RewriteEngine On</p>RewriteBase /</p>RewriteCond %{REQUEST_METHOD} !^(GET PUT)</p>RewriteRule .* - [F]</p></code></p><p></p><p></p><h2>Processing All gif files to be processed through a cgi script</h2></p><code></p>Action image/gif /cgi-bin/filter.cgi</p></code></p><p></p><p></p><h2>Process request/file depending on the request method</h2></p><code></p>Script PUT /cgi-bin/upload.cgi</p></code></p><p></p><p></p><h2>Force Files to download, not be displayed in browser</h2></p><code></p>AddType application/octet-stream .avi </p>AddType application/octet-stream .mpg</p></code></p><p>Then in your HTML you could just link directly to the file..</p></p><code></p><a href="http://www.askapache.com/movies/mov1.avi">Download Movie1</a></p></code></p><p>And then you will get a pop-up box asking whether you want to save the file or open it.</p></p><p></p><p></p><h2>Show the source code of dynamic files</h2></p><p>If you'd rather have .pl, .py, or .cgi files displayed in the browser as source rather than be executed as scripts, simply create a .htaccess file in the relevant directory with the following:</p></p><code></p>RemoveHandler cgi-script .pl .py .cgi</p></code></p><p></p><p></p><h2>Dramatically Speed up your site by implementing Caching!</h2></p><p>Article: <a href="http://www.askapache.com/htaccess/speed-up-sites-with-htaccess-caching.html">Speed Up Sites with htaccess Caching</a></p></p><code></p># MONTH</p><FilesMatch "\.(flv gif jpg jpeg png ico swf)$"></p>   Header set Cache-Control "max-age=2592000"</p></FilesMatch></p><p># WEEK</p><FilesMatch "\.(js css pdf txt)$"></p>   Header set Cache-Control "max-age=604800"</p></FilesMatch></p><p># DAY</p><FilesMatch "\.(html htm)$"></p>   Header set Cache-Control "max-age=43200"</p></FilesMatch></p></code></p><p></p><p></p><h2>Prevent Files image/file hotlinking and bandwidth stealing</h2></p><code></p>Options +FollowSymLinks</p>RewriteEngine On</p>RewriteBase /</p>RewriteCond %{HTTP_REFERER} !^$</p>RewriteCond %{HTTP_REFERER} !^http://(www\.)?askapache.com/.*$ [NC]</p>RewriteRule \.(gif jpg swf flv png)$ http://www.askapache.com/feed.gif [R=302,L]</p></code></p><p></p><p></p><h2>ErrorDocuments</h2></p><p>Article: <a href="http://www.htaccesselite.com/htaccess/htaccess-errordocument-examples-vt11.html">Additional ErrorDocument Info and Examples</a></p></p><code></p>ErrorDocument 404 /favicon.ico</p>ErrorDocument 403 https://secure.htaccesselite.com</p>ErrorDocument 404 /cgi-bin/error.php</p>ErrorDocument 400 /cgi-bin/error.php</p>ErrorDocument 401 /cgi-bin/error.php</p>ErrorDocument 403 /cgi-bin/error.php</p>ErrorDocument 405 /cgi-bin/error.php</p>ErrorDocument 406 /cgi-bin/error.php</p>ErrorDocument 409 /cgi-bin/error.php</p>ErrorDocument 413 /cgi-bin/error.php</p>ErrorDocument 414 /cgi-bin/error.php</p>ErrorDocument 500 /cgi-bin/error.php</p>ErrorDocument 501 /cgi-bin/error.php</p></code></p><p><strong>Note:</strong> You can also do an external link, but don't do an external link to your site or you will cause a loop that will hurt your SEO.</p></p><p></p><p></p><h2>Authentication Magic</h2></p><h3>Require password for 1 file:</h3></p><code></p><Files login.php></p>   AuthName "Prompt"</p>   AuthType Basic</p>   AuthUserFile /home/askapache.com/.htpasswd</p>   Require valid-user</p></Files></p></code></p><h3>Protect multiple files:</h3></p><code></p><FilesMatch "^(exec env doit phpinfo w)\.*$"></p>   AuthName "Development"</p>   AuthUserFile /.htpasswd</p>   AuthType basic</p>   Require valid-user</p></FilesMatch></p></code></p><h3>Example uses of the Allow Directive:</h3></p><code></p># A (partial) domain-name</p>Allow from 10.1.0.0/255.255.0.0</p>					</p># Full IP address</p>Allow from 10.1.2.3</p>					</p># More than 1 full IP address</p>Allow from 192.168.1.104 192.168.1.205</p>					</p># Partial IP addresses </p># first 1 to 3 bytes of IP, for subnet restriction.</p>Allow from 10.1</p>Allow from 10 172.20 192.168.2</p>					</p># network/netmask pair</p>Allow from 10.1.0.0/255.255.0.0</p>					</p># network/nnn CIDR specification</p>Allow from 10.1.0.0/16</p>					</p># IPv6 addresses and subnets</p>Allow from 2001:db8::a00:20ff:fea7:ccea</p>Allow from 2001:db8::a00:20ff:fea7:ccea/10</p></code></p><h3>Using visitor dependent environment variables:</h3></p><p>Article: <a href="http://www.htaccesselite.com/htaccess/setenvif-examples-vt134.html">Additional SetEnvIf examples</a></p></p><code></p>SetEnvIf User-Agent ^KnockKnock/2\.0 let_me_in</p>Order Deny,Allow</p>Deny from all</p>Allow from env=let_me_in</p></code></p><h3>Allow from apache.org but deny from foo.apache.org</h3></p><code></p>Order Allow,Deny</p>Allow from apache.org</p>Deny from foo.apache.org</p></code></p><h3>Allow from IP address with no password prompt, and also allow from non-Ip address with password prompt:</h3></p><code></p>AuthUserFile /home/www/site1-passwd</p>AuthType Basic</p>AuthName MySite</p>Require valid-user</p>Allow from 172.17.10</p>Satisfy Any</p></code></p><h3>block access to files during certain hours of the day</h3></p><code></p>Options +FollowSymLinks</p>RewriteEngine On</p>RewriteBase /</p># If the hour is 16 (4 PM) Then deny all access</p>RewriteCond %{TIME_HOUR} ^16$</p>RewriteRule ^.*$ - [F,L]</p></code></p><p></p><h2>A good default example .htaccess file</h2></p><p>I use this when I start a new site, and uncomment or delete parts of the file depending on the sites needs</p></p><code></p>#            DEFAULT SETTINGS</p>##############################################</p>Options +ExecCGI -Indexes</p>DirectoryIndex index.php index.html index.htm</p><p>### DEFAULTS ###</p>ServerSignature Off</p>AddType video/x-flv .flv</p>AddType application/x-shockwave-flash .swf</p>AddType image/x-icon .ico</p>AddDefaultCharset UTF-8</p>DefaultLanguage en-US</p>SetEnv TZ America/Indianapolis</p>SetEnv SERVER_ADMIN webmaster@askapache.com</p><p>### FAST-CGI ###</p>AddHandler fastcgi-script fcgi</p>AddHandler php-cgi .php</p>Action php-cgi /cgi-bin/php5-wrapper.fcgi</p><p></p><p>#           HEADERS and CACHING</p>##############################################</p>#### CACHING ####</p># YEAR</p><FilesMatch "\.(flv gif jpg jpeg png ico)$"></p>   Header set Cache-Control "max-age=2592000"</p></FilesMatch></p># WEEK</p><FilesMatch "\.(js css pdf swf)$"></p>   Header set Cache-Control "max-age=604800"</p></FilesMatch></p># 10 minutes</p><FilesMatch "\.(html htm txt)$"></p>   Header set Cache-Control "max-age=600"</p></FilesMatch></p># DONT CACHE</p><FilesMatch "\.(pl php cgi spl scgi fcgi)$"></p>   Header unset Cache-Control</p></FilesMatch></p><p></p><p>#          REWRITES AND REDIRECTS</p>##############################################</p>### SEO REDIRECTS ###</p>Redirect 301 /2006/uncategorized/htaccesselitecom-aboutus.html http://www.^^SITE^^.^^TLD^^</p><p>### REWRITES ###</p>RewriteEngine On</p>RewriteBase /</p><p>### WORDPRESS ###</p># BEGIN WordPress</p><IfModule mod_rewrite.c></p>RewriteEngine On</p>RewriteBase /</p>RewriteCond %{REQUEST_FILENAME} !-f</p>RewriteCond %{REQUEST_FILENAME} !-d</p>RewriteRule . /index.php [L]</p></IfModule></p><p># END WordPress</p><p></p><p>#           AUTHENTICATION </p>##############################################</p>AuthName "askapache.com"</p>Require valid-user</p>AuthUserFile /askapache/.htpasswd</p>AuthType basic</p></code></p><p><a href="http://www.askapache.com/htaccess/apache-htaccess.html">Ultimate htaccess Article</a>