---
layout: post
permalink: node/48911
ratings: 9
avgrate: 4.2222
categories: [Code]
user: blunderman
real_name: "Tony Light"
user_biog: ""
user_since: 09 Jul 2002
avatar: 
article_count: 1
excerpt: "PHP\'s Object Oriented capabilities may not be complete, but the benefits of  convenience and code re-use from using Objects and Classes are here now. If you are already dabbling in PHP, but haven\'t yet checked out Classes, have a look at this simple (but useful) example of an Error Messa..."
---
<p>PHP's Object Oriented capabilities may not be complete, but the benefits of </p>  convenience and code re-use from using Objects and Classes are here now. If </p>  you are already dabbling in PHP, but haven't yet checked out Classes, have a </p>  look at this simple (yet useful) example of an Error Message Class.</p></p><h2>Beginners Guide to Object Oriented Terminology</h2></p><p>When I first came across <abbr title="Object Oriented Programming">OOP</abbr>, the terminology served as a barrier - partly </p>  because the people explaining it were trying to stress what is different about </p>  OOP, rather than saying what is the same. I was a tad disappointed when I discovered </p>  that OOP was mainly a way of packaging existing good ideas and practices, but </p>  cheered up when it transpired that a lot of languages now include OOP constructs </p>  that make it much easier to code in this way.</p></p><p>There are four terms that you should feel comfortable with: <em>Class, Object, </p>  Property and Method</em>. </p></p><p>A <em>Class</em> is a blueprint for creating an <em>Object</em>. It tells you what variables </p>  (a.k.a. <em>Properties</em>) the <em>Object</em> can have, and what functions (a.k.a. <em>Methods</em>) </p>  can be used to manipulate the <em>Object's</em> Properties.</p></p><p>None the wiser? I don't pretend that the previous couple of sentences constitute </p>  a proper definition of anything - but it was definitions that created the barrier </p>  for me when I first looked at OOP. Don't get hung up on it - take a look at </p>  this non-computing example:</p></p><h3>A Real-World Example</h3></p><p>Consider an old-fashioned radio, with an on/off switch, and a tuning dial.</p></p><p>The <em>Class</em> is the circuit diagram and assembly instructions that enable the </p>  worker to build the radio, and also the User Manual.</p></p><p>Each and every such radio built is an <em>Object</em>.</p></p><p>The <em>methods</em> would be something like:</p></p><p><strong>Build Radio ( )<br></p>  Turn Radio On ( )<br></p>  Turn Radio Off ( )<br></p>  Tune Radio ( )<br></strong></p></p></p><p>The Properties might be:</p></p><p><strong>serial_number</strong> - to uniquely identify the radio.<br></p><strong>status</strong> - whether the radio is currently on or off.<br></p><strong>current frequency</strong> - to which the radio is tuned.<br></p></p></p><p>Every Object has the same methods available. Every Object has values for the </p>  same Properties - but these values may be different. Indeed in our radio example, </p>  the serial number should always be different.<br></p></p></p><p>Still none the wiser? Well try working through the following example, and see </p>  if things click into place.</p></p><h2>A Problem to Solve</h2></p><p><p>If you have any complexity at all in your PHP pages, then you will most likely </p>  have run into this irritating little scenario: You have just found a database </p>  error perhaps, or a user input error, but you cannot immediately output an error </p>  message. What do you do? Set a flag and check it later on when you are ready </p>  to show the error message? OK, that should work. Might get a bit messy if you </p>  find a lot of errors. You could stick all the error messages in an array, then </p>  print out the array when you are ready. Yeah, that sounds good. Lets do that </p>  - but lets do it using a Class, which we will call ErrorMessages.</p></p><h2>So What Does This Class Need to Look Like?</h2></p><p>Well what do we want to do with it? Let me suggest the following:</p></p><p>We want to be able to identify errors and store error messages for outputting </p>  later, when we are ready.</p></p><p>We might have different types of errors - e.g. System errors such as unavailable </p>  databases, or User errors such as invalid data put in input fields on forms. </p>  It would be nice to report these separately.</p></p><p>The output should fit in with the look and feel of the rest of the website.</p></p><p>No doubt you are already concocting more complicated requirements, but lets </p>  leave it at that for the purposes of this article. What you do in the privacy </p>  of your own room is up to you.</p></p><p>Right then. That doesn't look too complicated. Seems to me like we want three </p>  Methods here. One to create a bucket which we can keep error messages in. Another </p>  to drop an error message into the bucket, and a final one to tip all the error </p>  messages out of the bucket and onto the screen.</p></p><p>I'm anticipating output that will look something like this:</p></p><p>*** System Errors ***<br></p>  1. Missing Table - could not locate database table 'awol'.<br></p>  2. Database error - no such column 'fifth' in table 'usa'.</p></p><p>If we stick a few [CSS] class names in the HTML tags that we output, then we </p>  should be able to use a stylesheet to format the output to fit in with whatever </p>  site we use it on.</p></p><h2>The Class Framework</h2></p><p>It ain't obligatory, but most PHP developers put their classes in separate </p>  files that they can include in whichever pages it is needed. You can put as </p>  many Classes as you like inside one include file, but for this example we will </p>  just have the one.</p></p><p>OK - so create a new file to use as an include: say error_class.inc. </p></p><p>Open the include file and type in:</p></p><pre></p>&lt;?php</p>class ErrorMessages</p>{</p><p>}</p>?&gt;</p></pre></p><p>This is just the framework that tells PHP that it is dealing with a Class definition.</p></p><p>Now we need to tell PHP what the variables are that we may choose to populate </p>  for each Object. Now what was it that they were called again? Properties. OK, </p>  between the curly wurlies, add this:</p></p><pre></p>  var $errorMsgBlockLabel;</p>  var $errorCount;</p>  var $errorMsg;</p></pre></p><p>$errorMsgBlockLabel is the 'title' that we will show on the screen above the </p>  errors that have occured.</p></p><p>$errorCount is just going to keep track of the number of errors. </p></p><p>$errorMsg is going to be an array of errors that have occured. Each array element </p>  will itself be an array (containing a label and a message) but we don't need </p>  to be that specific at this stage.</p></p><h3>The Constructor</h3></p><p>We now need to add the only Method that a Class MUST have. It has the same </p>  name as the Class itself (in this case ErrorMessages) and is refered to as the </p>  'Constructor'. This Method will do whatever is necessary to create a new instance </p>  of an ErrorMessages Object.</p></p><p>So what do we need to do to create our new Object? Not a lot, really. We need </p>  to give it a 'title' (i.e. specify a value for $errorMsgBlockLabel) and initialise </p>  the $errorCount to 0. </p></p><p>OK - so after your var definitions, before the final curlie wurlie, insert </p>  this Constructor function:</p></p><pre></p>function ErrorMessages($x)</p>{</p>  $this-&gt;errorCount = 0;</p>  $this-&gt;errorMsgBlockLabel = $x;</p>}</p></pre></p><p>$x, rather obviously, is the 'title' string, which we will pass when we request </p>  a new ErrorMessages Object.</p></p><h3>$this</h3></p><p>Whats all this <code>$this-&gt;errorCount</code> business? </p></p><p>In normal PHP you would refer to a variable as something like <code>$errorCount</code>, </p>  and a function as something like <code>addError($label,$message)</code>. </p></p><p>When we are dealing with Properties and Methods we must use a slightly different </p>  notation. e.g. <code>$SysErrs-&gt;errorCount</code> and <code>$SysErrs-&gt;addError($label,$message)</code> </p>  where $SysErrs is the name of the Object that we are interested in.</p></p><p>Inside the Class definition we have absolutely no idea what the Objects based </p>  on this Class are going to be called, so we use the special pseudo-variable </p>  <code>$this</code> to mean the current Object. It just allows us to use a similar notation </p>  inside and outside the Class definition.</p></p><p>The exception to this <code>object name-&gt;method name( )</code> rule </p>  is the Constructor. When we want to create a new Object we use the following </p>  syntax:</p></p><p><code>object name = new class name&(<em>params</em>)</code></p></p><p>e.g. <code>$UserErrs = new ErrorMessages("User Bloopers");</code></p></p><h3>Can't wait to use your class?</h3></p><p>Create a php file - say 'error_class_test.php'. I'll assume you create it in </p>  the same directory as the include file. Type this in:</p></p><pre></p>&lt;?php</p>include (&quot;error_class.inc&quot;);</p>$UserErrs = new ErrorMessages(&quot;User Bloopers&quot;);</p>echo (&quot;&lt;P&gt;We have $UserErrs-&gt;errorCount user errors&lt;/P&gt;&quot;);</p>?&gt;</p></pre></p><p>Load up both files to your webserver, then run the php file. It should just </p>  say &quot;We have 0 user errors&quot;.</p></p><p>Not very exciting, but as it stands that is the limit of our Classes functionality. </p>  Lets change that.</p></p><h2>Now some Methods</h2></p><p>First, a method to add an error message. Immediately after the Constructor, </p>  before the last curlie wurlie, add this:</p></p><pre></p>function addError($label, $message)</p>{</p>  $this-&gt;errorCount ++;</p>  $this-&gt;errorMsg[$this->errorCount][&quot;label&quot;] = $label;</p>  $this-&gt;errorMsg[$this->errorCount][&quot;message&quot;] = $message;</p>}</p></pre></p><p>This Method increments the errorCount, then creates an element errorMsg[n] </p>  where [n] is the current errorCount. This element is itself an associative array </p>  (&quot;label&quot; =&gt; $label , "message" =&gt; $message).</p></p><p>Now we can add an error, e.g.</p></p><p><code>$UserErrs-&gt;addError(&quot;Dodgy Input&quot;,&quot;This does not appear </p>  to be a valid email address&quot;);</code></p></p><p>and we could even show that error using something like <code>print_r</code> - but even if </p>  we remembered to put <code>&lt;pre&gt;&lt;/pre&gt;</code> tags around it, that </p>  would still look naff. No, we definitely need a Method to output these error </p>  messages in a decent format. So add this immediately before the last curlie </p>  wurlie:</p></p><pre></p>function showErrors()</p>{</p>  if ($this-&gt;errorCount &gt;0) {</p>    ?&gt;</p>    &lt;div class=&quot;errorblock&quot;&gt;</p>    &lt;span class=&quot;errorblocklabel&quot;&gt;&lt;?php echo $this-&gt;errorMsgBlockLabel ?&gt;&lt;/span&gt;</p>    &lt;?php</p>    for ( $i = 1; $i &lt;= $this-&gt;errorCount; $i++ ) {</p>      ?&gt;</p>      &lt;p&gt;</p>      &lt;span class=&quot;errornumber&quot;&gt;&lt;?php	echo &quot;$i:&quot;?&gt;&lt;/span&gt;</p>      &lt;span class=&quot;errorlabel&quot;&gt;&lt;?php echo $this-&gt;errorMsg[$i][&quot;label&quot;] . &quot; - &quot; ?&gt;&lt;/span&gt;</p>      &lt;span class=&quot;errormessage&quot;&gt;&lt;?php echo $this-&gt;errorMsg[$i][&quot;message&quot;] ?&gt;&lt;/span&gt;</p>      &lt;/p&gt;</p>      &lt;?php</p>    }</p>    ?&gt;</p>    &lt;/div&gt;</p>    &lt;?php</p>  }</p>}	</p></pre></p><p>Nothing too tricky here. The <code>if</code> statement ensures we only get any output </p>  if we have any errors. Then we print out the label for the block of errors, </p>  and then loop through each error.</p></p><p>To test it, you can add a couple of lines to your php file, so it looks like </p>  this:</p></p><pre> </p>&lt;?php</p>include (&quot;error_class.inc&quot;);</p>$UserErrs = new ErrorMessages(&quot;User Bloopers&quot;);</p>$UserErrs-&gt;addError(&quot;Invalid Input&quot;,&quot;This does not appear to be a valid email address&quot;);</p>$UserErrs-&gt;addError(&quot;Careless&quot;,&quot;You appear to have forgotten something.&quot;);</p>$UserErrs-&gt;showErrors();</p>echo (&quot;&lt;P&gt;We have $UserErrs->errorCount user errors&lt;/P&gt;&quot;);</p>?&gt; </p></pre></p><h2>Eye Candy</h2></p><p>OK so far? But it doesn't look very nice. We could just put a bit of formatting </p>  into the showErrors() function - but being a CSS fan, I reckon its better to </p>  use styles. I'm not going to explain it, 'cos this article is about Classes </p>  not CSS.</p></p><p>Stick the following stylesheet in (right at the start of your php file, before </p>  the opening php tag). It should really go in the &lt;head&gt; section - but </p>  if you've been following the instructions you won't have one!</p></p><pre>&lt;style type=&quot;text/css&quot;&gt;</p>.errorblock {</p>	border: 1px solid #900 ;</p>	margin-bottom: 5px; </p>	margin-top: 5px; </p>	font-size: 10pts; </p>	background: #fee;</p>	}</p>.errornumber {</p>	background: #fff; </p>	color: #900;</p>	padding-left: 3px; </p>	padding-right: 1px; </p>	border: 1px solid #900 ;</p>	}</p>.errorlabel {</p>	font-weight: bold; </p>	color: #900;</p>	padding-left: 3px; </p>	}</p>.errormessage {</p>	color: #090;</p>	}</p>.errorblock p {</p>	display: block;</p>	padding: 3px; </p>	margin-bottom: 0; </p>	margin-top: 0; </p>	padding-top: 2px; </p>	padding-bottom: 2px;</p>	}</p>.errorblocklabel {</p>	display: block;</p>	padding: 3px; </p>	background: #900;</p>	font-weight: bold; </p>	font-size: 12pts; </p>	color: #fff;</p>	}</p>&lt;/style&gt;</p></pre></p><h2>Did I mention Re-usability?</h2></p><p>Well if I didn't, shame on me. I'm certainly not going to claim that Classes </p>  are the only way of writing reusable code - but they certainly make it an attractive </p>  proposition.</p></p><p>Suppose we might encounter System errors and/or User Errors while running our </p>  PHP code. We might not want to lump all our errors in together. No problem. </p>  Instead of just creating one ErrorMessages Object, we can create as many as </p>  we want (but two will do for us). </p></p><p>Add a few extra lines to the php part of your .php page, so it looks like this:</p></p><pre>&lt;style type=&quot;text/css&quot;&gt;</p>... snip ...</p>&lt;/style&gt;</p>&lt;?php</p>include (&quot;error_class.inc&quot;);</p>$UserErrs = new ErrorMessages(&quot;User Bloopers&quot;);</p>$SysErrs = new ErrorMessages(&quot;*** System Errors ***&quot;);</p><p>$UserErrs-&gt;addError(&quot;Invalid Input&quot;,&quot;This does not appear to be a valid email address&quot;);</p>$UserErrs-&gt;addError(&quot;Careless&quot;,&quot;You appear to have forgotten something.&quot;);</p>$SysErrs-&gt;addError(&quot;Missing Table&quot;,&quot;could not locate database table 'awol'&quot;);</p>$SysErrs-&gt;addError(&quot;Database error&quot;,&quot;no such column 'fifth' in table 'usa'.&quot;);</p><p>$UserErrs-&gt;showErrors();</p>$SysErrs-&gt;showErrors();</p><p>echo (&quot;&lt;P&gt;We have $UserErrs-&gt;errorCount user errors&lt;/P&gt;&quot;);</p>echo (&quot;&lt;P&gt;We have $SysErrs-&gt;errorCount system errors&lt;/P&gt;&quot;);</p>?&gt; </p></pre></p><p>Stick that on your server and give it a whirl. </p></p><p>Neat?</p></p><p>But the real re-use comes when you use the Class in another project. All you </p>  need to do is copy the Class definition include file and include it wherever </p>  you need it.</p></p><h2>Using our Objects within Functions and other Objects</h2></p><p>Right then, but what if you already have lots of functions or even other Classes, </p>  within which you might generate error messages? Can you still use the ErrorMessages </p>  Class?</p></p><p>Of course. The Object you create can be treated much like a variable. If you </p>  want to use it in a function (or Method in another Class) you can declare it </p>  as global. Note that it is the Object not the Class that is declared as global </p>  - so you must know its name. e.g.</p></p><pre></p>function fooBar() {</p>  global $SysErrs;</p>  ... do something that goes wrong ...</p>  if (error has occured) {</p>    $SysErrs-&gt;addError(&quot;Woopsie&quot;,&quot;Function fooBar failed&quot;);</p>  }</p>}</p></pre></p><p>But what would happen if you hadn't already created the $SysErrs Object? You </p>  would get an error. Ironic really.</p></p><p>What can you do about it? Test for the existence of the Object. If it exists, </p>  fine. If not, handle it some other way - maybe by creating the object - but </p>  you can only do that if the Class definition itself exists.</p></p><p>So we have a few conditions to test for before we know exactly how we are going </p>  to deal with our error. How you deal with each failure depends on your situation, </p>  and the anticipated situations where your code might be used. So I'll just give </p>  you the syntax for checking whether the ErrorMessages Class exists: </p></p><p> <code>if (class_exists(&quot;ErrorMessages&quot;)) { ..... }</code></p></p><p>and for checking if the Object $SysErrs exists:</p></p><p><code>if($SysErrs) { ..... }</code></p></p><p>If the Class doesn't exist, then you could include the Class definition file </p>  - as long as you are sure where it is!</p></p><p>If the Object doesn't exist, then you could create it, or you could cop out </p>  and handle the error some other way.</p></p><p>Of course - if you create an ErrorMessages Object, you would be wasting your </p>  time if the showErrors() method was never called for that Object. Crikey, in </p>  my crystal ball I can see a routine that looks through all the Objects in your </p>  script, and calls showErrors() for every Object with a Class of ErrorMessages. </p>  Stop now, I've woffled enough.</p></p><h2>Possible advantages of Classes over Procedural Code</h2></p><p>Treading very carefully now, as some folks seem awfully touchy about this. </p>  The scribblings that follow are definitely IMHO. So please don't give me a kicking. </p>  And if you must give me a kicking, then please, not the face - not the face!</p></p><p>Nothing in this example could not be done with a set of functions in an include </p>  file. Hey, it is an easy example, because it gets hard to write articles when </p>  the examples are big and complex.</p></p><p>Quite probably, even with big, complex Classes, you could still do everything </p>  with a set of functions instead.</p></p><p>So why do I like Classes?</p></p><p>Keeping variables as Object Properties saves you from having to use global </p>  variables. Good for security. It also avoids accidentally using the same variable </p>  across two different sets of functions.</p></p><p>All Object Properties are available to all functions (a.k.a. Methods) within </p>  the Class. So you are not having to specify lots of variables as global within </p>  each function, or pass them in as parameters.</p></p><p>Class definitions make me keep everything to do with the Class in one place. </p>  With collections of functions it is easier to write code that is harder to maintain.</p></p><p>Just thinking in terms of Classes, Properties and Methods seems to help get </p>  my mind around the problem.</p></p><p>If you are using Sessions, by registering the Object with the Session, all </p>  the Object's Properties are automatically serialized, stored in the session </p>  and then unserialized for you on the next page. Handy.</p></p><h2>Want to know more?</h2></p><p>Here is a list of useful <a href="http://www.faqts.com/knowledge_base/view.phtml/aid/7569/fid/39" target="_blank" title="Useful links to find out more about PHP Classes and Objects">links</a>. </p>  Enjoy.</p></p><h2>Feeling Lazy?</h2></p><p>Personally, I often get benefit from actually typing things in - particularly </p>  when dealing with some new notation such as that used by PHP for classes and </p>  objects. If that doesn't float your boat, here is a <a href="http://www.wolfridge.co.uk/evolt/error_class.zip" title="Zipfile containing the 2 files in this article">zip </p>  file</a> with the class definition and the test page.</p></p><p>Even less effort would be to look at the <a href="http://www.wolfridge.co.uk/evolt/error_class_demo.htm" target="_blank" title="A demo of the error class">demo </p>  page</a>.</p>