---
layout: post
permalink: node/392
ratings: 1
avgrate: 4.0000
rating: 3.91
categories: [Backend]
user: MartinB
real_name: "Martin Burns"
user_biog: "<p>Martin Burns has been doing this stuff since <a href=\"http://news.com.com/Netscape+bowed%2C+but+not+broken/2100-1032_3-5406682.html\" rel=\"nofollow\">Netscape 1.0</a> days. Starting with the communication ends that online media support, he moved back through design, HTML and server-side code. Then he got into running the whole show.
These days he\'s working for <a href=\"http://www-5.ibm.com/services/uk/services/bcs.html\" rel=\"nofollow\">these people</a> as a Project Manager, and still thinks (nearly 6 years on) it\'s a hell of a lot better than working for a dot-com. In his Copious Free Time&trade;, he helps out running a <a href=\"http://www.purpur.co.uk/shop/\" rel=\"nofollow\">Cloth Nappies</a> online store.
</p>

<p>Amongst his favourite things is <del><strike><a href=\"http://www.zope.org/\" rel=\"nofollow\" target=\"_foo\" title=\"Opens in a new window\">Zope</a></strike></del><ins><a href=\"http://drupal.org\" rel=\"nofollow\">Drupal</a></ins>, which he uses to run his <a href=\"http://www.easyweb.co.uk/\" rel=\"nofollow\" target=\"_foo\" title=\"Opens in a new window\">personal site</a>. He\'s starting to (re)gain a sneaking regard for ECMAscript since the arrival of unobtrusive scripting.</p> 

<p>He\'s been a member of evolt.org since the very early days, a board member, a president, a writer and even contributed a modest amount of template code for the current site. Above all, he likes evolt.org to do things because it knowingly chooses to do so, rather than randomly stumbling into them. He\'s also one of the boys and girls who beervolts in the UK, although the arrival of small children in his life have knocked the frequency for 6.</p>

<p><strong>Most likely to ask:</strong> <q>Why would a client pay you to do that?</q></p>
<p><strong>Least likely to ask:</strong> <q>Why isn\'t that navigation frame in Flash?</q></p>"
user_since: 26 Apr 1999
avatar: /images/pictures/picture-32.jpg
article_count: 143
excerpt: "Mail headers can tell you all sorts of fun and interesting things about where an email\'s been, whether that alleged multi-national is running over dialup, and what state of mind the sender\'s in. Here\'s a short parsing guide."
---
<p></p>Mail headers. They're just crap which tell you who an email's from, and who it's too, yeah? Bzzzt! next contestant.</p></p></p><p></p>Mail headers can tell you all sorts of fun and interesting things about where an email's been, whether that alleged multi-national is running over dialup, and what state of mind the sender's in.</p></p></p><p>Let's start with an example. These are the full headers from a recent post of mine to thelist:</p></p><pre></p>Return-path: &lt;thelist-admin@lists.evolt.org&gt;</p>Envelope-to: martin@easyweb.co.uk</p>Delivery-date: Sun, 15 Aug 1999 18:18:32 +0000</p>Received: from csilx1.csi1st.net [209.48.124.2] (root)	by smarties with esmtp (Exim 1.62 #3)	id 11G4rX-0005Yg-00; Sun, 15 Aug 1999 18:18:31 +0000</p>Received: from csilx1.csi1st.net (IDENT:mail@csilx1.csi1st.net [209.48.124.2])	by csilx1.csi1st.net (8.9.3/8.9.3) with ESMTP id OAA19663;	Sun, 15 Aug 1999 14:16:02 -0400</p>Received: from melon.executive.tm (IDENT:root@ns.executive.tm [207.168.73.2])	by csilx1.csi1st.net (8.9.3/8.9.3) with ESMTP id OAA19636	for &lt;thelist@lists.evolt.org&gt;; Sun, 15 Aug 1999 14:16:00 -0400</p>Received: from finch-post-11.mail.demon.net (finch-post-11.mail.demon.net [194.217.242.39])	by melon.executive.tm (8.8.7/8.8.7) with ESMTP id OAA07875	for &lt;thelist@evolt.org&gt;; Sun, 15 Aug 1999 14:09:25 -0400</p>Received: from easyweb.demon.co.uk ([212.228.136.1])	by finch-post-11.mail.demon.net with smtp (Exim 2.12 #1)	id 11G4ig-00049e-0B	for thelist@evolt.org; Sun, 15 Aug 1999 18:09:23 +0000</p>Date: Sun, 15 Aug 1999 19:09:17 +0100</p>x-sender: pop4139@pop.easyweb.co.uk</p>x-mailer: Claris Emailer 2.0v3, January 22, 1998</p>From: Martin Burns &lt;martin@easyweb.co.uk&gt;</p>To: &quot;evolt&quot; &lt;thelist@evolt.org&gt;</p>Mime-Version: 1.0</p>Content-Type: text/plain; charset=&quot;US-ASCII&quot;</p>Message-Id: &lt;E11G4ig-00049e-0B@finch-post-11.mail.demon.net&gt;</p>Subject: [thelist] site in a week - now live!</p>Reply-To: thelist@lists.evolt.org</p>Sender: thelist-admin@lists.evolt.org</p>Errors-To: thelist-admin@lists.evolt.org</p>X-MajorGumbo-version: 1.0</p>Precedence: bulk</p>List-Id: evolt.org mailing list devoted to the web &lt;thelist.lists.evolt.org&gt;</p>X-BeenThere: thelist@lists.evolt.org</p>X-UIDL: 6bce08484a7ed8a1b357f6959a0df30d</p></pre></p><p></p>*Phew*. Let's break this down a bit, starting with the easy stuff.</p></p></p><h2>X-headers</h2></p><p></p>	X-headers are great, because they're completely free to do what the hell </p>	you like with. You can make up any header type you like, and as long as it </p>	starts with <code><strong>X-</strong></code>, it's completely up to you. </p>	So in the above, we have a number of X-headers:</p></p></p><p></p>	<code><strong></p>	X-MajorGumbo-version: 1.0</strong></code><br></p>	The mailing list software evolt.org uses is called MajorGumbo, </p>	so this is an identification note.</p></p></p><p></p>	<code><strong>X-BeenThere: thelist@lists.evolt.org</strong></code><br></p>	An identification to say that it's come from thelist, set up by Dan to be added by MajorGumbo.</p></p></p><p></p>	<code><strong>X-UIDL: 6bce08484a7ed8a1b357f6959a0df30d</strong></code><br></p>	A unique id reference to the message for the benefit of MajorGumbo.</p></p></p><p></p>	<code><strong>x-mailer: Claris Emailer 2.0v3, January 22, 1998</strong></code><br></p>	My email client identifying itself (or getting itself a free advert, depending on how you look at it).</p></p></p><p></p>	<code><strong>x-sender: pop4139@pop.easyweb.co.uk</strong></code><br></p>	Added by my email client, as the account I used collects its mail there, so Claris </p>	Emailer assumes that this is who I am.</p></p></p><p></p>	Most of this fairly sane, but you can get some very odd stuff indeed </p>	happening in X-headers. Take this for example, which Dan put in the headers for a while:<br></p>	<code><strong>X-evolt: We put the rrr in werd baby! Yeah baby, yeah!!!</strong></code><br></p>	I don't know what he was on at the time, but I want some.</p></p></p><h2>Instructions</h2></p><p></p>	This is where my mail client and MajorGumbo give out the orders about </p>	who the email is from, and where it's going. Mailing lists are slightly </p>	odd in that they deliver one message to many people, so they have to </p>	overwrite the original delivery instructions of 'Deliver this to thelist' as </p>	'Deliver this to recipient n'</p></p></p><p></p>	<code><strong>From: Martin Burns &lt;martin@easyweb.co.uk&gt;</strong></code><br></p>	Fairly straightforward - the info I put into Claris Emailer for this account.</p></p></p><p></p>	<code><strong>To: &quot;evolt&quot; &lt;thelist@evolt.org&gt;</strong></code><br></p>	This one is a bit more problematic. If it's going <strong>to</strong> thelist, </p>	how did it get out to me? The answer's here:</p>	<br><code><strong>Envelope-to: martin@easyweb.co.uk</strong></code><br></p>	There's another header which says where it's actually going, and this takes precedence.</p></p></p><p></p>	<code><strong>Mime-Version: 1.0<br></p>	Content-Type: text/plain; charset=&quot;US-ASCII&quot;</strong></code><br></p>	These define how attachments are defined, and what character set to use. </p>	If this were set differently, I could use extended character sets within the </p>	email - useful if you're talking about concepts in another language. &pound; signs</p>	would be nice...</p></p></p><p></p>	<code><strong>Message-Id: &lt;E11G4ig-00049e-0B@finch-post-11.mail.demon.net&gt;</strong></code><br></p>	An ident which uniquely identifies the email in a global setting.</p></p></p><p></p>	<code><strong>Subject: [thelist] site in a week - now live!</strong></code><br></p>	Fairly obvious I would have thought.</p></p></p><p></p>	<code><strong>Reply-To: thelist@lists.evolt.org</strong></code><br></p>	This is the bit which ensures that when you hit 'Reply', your email </p>	goes back to the list, not to me individually. I'm subscribed to one </p>	list where this isn't set correctly, and it's a pain to remember each time.</p></p></p><p></p>	<code><strong>Sender: thelist-admin@lists.evolt.org<br></p>	Errors-To: thelist-admin@lists.evolt.org<br></p>	Return-path: &lt;thelist-admin@lists.evolt.org&gt;</strong></code><br></p>	Three headers which ensure that any problems - such as bounces from </p>	a dead account - get notified back to Dan, and not to thelist.</p><h2>Routing information</h2></p><p></p>	This is when you find out where your email has been on its holidays. </p>	Email doesn't necessarily go from point to point - that's not how the </p>	net is set up. If an email goes from machine A to machine Z, it will </p>	first go to machine B, and ask it <q>&quot;Do you know the way to </p>	<s>San Jose</s> erm I mean machine Z?&quot;</q> </p>	Machine B will reply <q>&quot;I can get it part of the way, and pass it </p>	on to machine C who knows the next section of the route.&quot;</q> </p>	This is so that if machine L is down, email can be routed around it. </p>	Of course, if machine A happens to know where machine Z is, and </p>	can get to it directly, then it will just talk directly to machine Z.</p></p></p><p></p>	Every time your email goes through an MTA (Mail Transfer Agent such as </p>	machine B above), the MTA timestamps it at the start of the headers. So routing </p>	information must be read backwards. Here are those routing headers from above, </p>	but reversed for convenience:</p></p></p><p></p>	<code><strong>Received: from easyweb.demon.co.uk ([212.228.136.1])	</p>	by finch-post-11.mail.demon.net with smtp (Exim 2.12 #1)	</p>	id 11G4ig-00049e-0B	for thelist@evolt.org; Sun, 15 Aug 1999 18:09:23 +0000</strong></code><br></p>	The mail has gone from my outgoing postbox to Demon's outgoing mailqueue, marked for delivery to </p>	thelist. This tells you that my outgoing mail and connectivity are </p>	through <a href="http://www.demon.net" title="opens in a new window" target="_foo">Demon </p>	Internet</a>. It also suggests that I've got a subdomain mapped to my dialup </p>	(Demon give you a fixed IP, rather than making you endure the hell of DHCP, which is nice).</p></p></p><p></p>	<code><strong>Received: from finch-post-11.mail.demon.net (finch-post-11.mail.demon.net </p>	[194.217.242.39])	by melon.executive.tm (8.8.7/8.8.7) with ESMTP id OAA07875	</p>	for &lt;thelist@evolt.org&gt;; Sun, 15 Aug 1999 14:09:25 -0400</strong></code><br></p>	Demon's MTA knows that evolt.org is looked after by Vince at executive.tm, so passes </p>	it on there, still marked for thelist.</p></p></p><p></p>	<code><strong>Received: from melon.executive.tm (IDENT:root@ns.executive.tm [207.168.73.2])	</p>	by csilx1.csi1st.net (8.9.3/8.9.3) with ESMTP id OAA19636	</p>	for &lt;thelist@lists.evolt.org&gt;; Sun, 15 Aug 1999 14:16:00 -0400</strong></code><br></p>	... but what Demon doesn't know is that thelist doesn't actually run from the same place </p>	as the website. Happily, Vince has his MTA set up to pass it on appropriately.</p></p></p><p></p>	<code><strong>Received: from csilx1.csi1st.net (IDENT:mail@csilx1.csi1st.net [209.48.124.2])	</p>	by csilx1.csi1st.net (8.9.3/8.9.3) with ESMTP id OAA19663;	Sun, 15 Aug 1999 14:16:02 -0400</strong></code><br></p>	Now we're actually at the home of thelist, MajorGumbo can process it and bounce it </p>	back out again. Notice that we've lost the note that we're going to thelist, </p>	because we've been there and done that (see the X-header above).</p></p></p><p></p>	<code><strong>Received: from csilx1.csi1st.net [209.48.124.2] (root)	by smarties </p>	with esmtp (Exim 1.62 #3)	id 11G4rX-0005Yg-00; Sun, 15 Aug 1999 18:18:31 +0000</strong></code><br></p>	And it arrives safely at my incoming mailbox - received by <code>smarties</code> which </p>	is running mail software called Exim. <code>Smarties</code> is run by </p>	<a href="http://www.instant-web.co.uk/" title="opens in a new window"</p>	target="_foo">Instant Web</a> who host my domain and maintain popboxen for me. </p>	Had I set this address to forward the mail elsewhere, then there would be another </p>	set of routing headers.</p></p></p><p></p>	So there you are - mailheaders in a nutshell. We'll be going on to explain how you can </p>	exploit X-headers in a future article about sending emails from CGIs.</p></p>