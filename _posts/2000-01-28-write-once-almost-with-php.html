---
layout: post
permalink: node/734
ratings: 1
avgrate: 2.0000
user: deboute
real_name: "benjamin deboute"
user_since: 14 Dec 1999
avatar: ""
article_count: 2
excerpt: "  Write Once ! (almost) :: the print &quot;&quot; method.</p>  An approach to browser specific content and easy maintenance through PHP3 ::"
---
<H3></p>  Write Once ! (almost) :: the <strong>print &quot;&quot;</strong> method</p></H3></p><P></p>  An approach to browser specific content and easy maintenance through PHP3 ::</p></P></p><P></p>  How much would you pay for Godlike power given to mere Webdevs? Nothing? So enter PHP! i plan to do three of this courses, this one is an intro to PHP and the first method to our Grail (easy maintainable code which WORKS).</p></p></p><p></p>  -- Warning :: i'm no PHP wiz, my code may be bloated, but it actually does what i expect from it...--</p></p></p><p></p><p>  Well, since we all started webdev, we were trapped in the Evil Browser Specs, struck by headaches/fury/insomnia/nightmares.  Once i got fed up with designing several pages, i took a look at this PHP thing everybody's talking about.</p></P></p><P></p>  Yeah, PHP is a neat-FREE-powerful-FREE-adaptive-FREE-versatile Open-Source language. There are ports for nearly all operating systems, it's easy to install, and there are so many features that it's almost insane...</p></P></p><P></p>  Just to help you to make your opinion :: total db interaction, HTML/PDF/img on-the-fly generation, SNMP, POSIX, XML, WDDX, LDAP, IMAP, FTP, encryption....</p></P></p><P></p>  Well, how can PHP turn you into a sexy coder (that's what we all want to be, no?)?</p></P></p><P></p>  We're gonna see the different ways to write an adaptive PHP page, which will ensure our content to be sent to the masses, whatever browser they might use.</p></P></p><P></p>  My problems were that when a page is sent to Netscape it doesn't reacts the same than ie and can screw up my design (cell and tables background is VERY VERY bad supported by the Lizard), there were too the DOM issues, the Javascript... I ended up with putting online different pages, with just some lines being different.  What i wanted was to write one page, which could tweak itself before being sent.</p></P></p> </p><H3></p>  First step :: agent sniffing.</p></H3></p> </p><P></p>  I decided to sniff once and then to set a session cookie. If it is set, i don't include the detection code, and vice-versa.</p>   </p></P></p><P></p>  The detection code is based on the work of <A HREF="mailto:leon@clearink.com">Leon Atkinson</A> and <A HREF="mailto:mospaw@polk-county.com">Chris Mospaw</A>.  It parses the $HTTP_USER_AGENT string to get the browser name and version. Then it sets a variable that i'll call to send the browser the specific code.</p>   </p>   </p>  <A HREF="http://www.nerdsoul.com/evolt/sourcebrowsdet.html">browserdet.inc</A> i.e. :</p></p></p><p></p><p>  <CODE></p>  <pre></p>    if(ereg( &quot;MSIE&quot;, $HTTP_USER_AGENT))</p>    {</p>    $Browser_Name = &quot;MSIE&quot;;</p>    $Browser_Version = strtok( &quot;MSIE&quot;);</p>    $Browser_Version = strtok( &quot; &quot;);</p>    $Browser_Version = strtok( &quot;;&quot;);</p>    }</p>    ...</p>    //$cap stands for browser capatibility.</p>    elseif($Browser_Name == &quot;MSIE&quot;)</p>    {</p>    if($Browser_Version &gt;= 4.0) { $cap = 3; }</p>    else { $cap = 1; }</p>    }</p>    //cookie</p>    setcookie(&quot;nerdsoul&quot;, $cap);</p>  </pre></p>  </CODE></p></p></p><p></p><p>  Written before any header, in top of your page, due to the cookies specs, stands the PHP script which triggers the browser detection.</p></p></p><p></p><p>  <CODE></p>  <pre></p>    &lt;?php</p>    //if the cookie is set</p>    elseif($nerdsoul) { $cap = $nerdsoul;}</p>    else { include(&quot;browsdet.inc&quot;);}</p>    ?&gt;</p>  </pre></p>  </CODE></p></p></p><p></p><p>  Now we got a page that knows what browser the user uses.</p></P></p> </p><H3></p>  Second step :: writing up the javascript</p></H3></p> </p><P></p>  My javascript is in a included file which shouldn't be loaded ONLY if the browser's got $cap=1 (netscape/ie &lt; 4). A little more complex is the fact that if users with ie/ns4+ want to see the page as old browsers get it (information inline and not layered), $cap==1, and the additional javascript eye-candy will not be loaded. So i needed to check BEFORE including my javascript that $cap!=1 AND $ovride doesn't exists.</p></P></p><P></p>  Got the scheme? If you don't, relax, look at the source, look at my page w/ several browsers, and keep reading.</p></P></p><P></p>  I wanted clean code to be served, so depending on which flavour hits my server, the javascript will include the correspondent coding. window.all will be served to ie, window.layers to netscape, code not implemented in ie won't be thrown in netscape's gears. EASY!</p></P></p><P></p>  in my page ::</p></p></p><p></p><p>  <CODE></p>    &lt;?php if ($cap!=1) {include(&quot;basejs.inc&quot;);}?&gt;</p>  </CODE></p></p></p><p></p><p>  in my <A HREF="http://www.nerdsoul.com/evolt/sourcebasejs.html">basejs.inc</A> ::</p></p></p><p></p><p>  <CODE></p>  <pre></p>    print &quot;</p>    function previous(){</p><p>    xxx=xxx-1;</p><p>    if(xxx &lt; 0){false}</p>&quot;;</p>    if($cap == 2) { print &quot;</p>    else {</p><p>    window.document.layers[xxx].visibility=\&quot;hide\&quot;;</p><p>    window.document.layers[xxx-1].visibility = \&quot;show\&quot;;}</p>    }</p>&quot;;</p>    }</p>    else { print &quot;</p>    else {</p><p>    content[xxx].style.visibility=\&quot;hidden\&quot;;</p>    content[xxx-1].style.visibility = \&quot;visible\&quot;;}</p>    }</p>&quot;;</p>    }</p>    </pre></p>  </CODE></p></p></p><p></p>  Serve what's needed. That's all.</p></P></p> </p><H3></p>  Third step :: serving specific tag attributes.</p></H3></p> </p><P></p>  Netscape has this stupid bug w/ layers disappearing when you resize a window.  problem solved ONLY in ns4+, so ONLY in the version of my page that includes layers in netscape.</p></p></p><p></p><p>  <CODE></p>  <pre></p>    &lt;body bgcolor=&quot;#666666&quot; LEFTMARGIN=&quot;0&quot; TOPMARGIN=&quot;0&quot; MARGINWIDTH=&quot;0&quot; MARGINHEIGHT=&quot;0&quot;</p>    &lt;?php</p>    if($cap == 2) {  print &quot; onResize=replace()&quot;; }</p>    ?&gt;</p>&gt;</p></pre></p>  </CODE></p></p></p><p></p><p>  Let's say that i want a rollover effect to take place only in ie4+ ::</p></p></p><p></p><p>  <CODE></p>  <pre></p>    &lt;a href=&quot;/portfolio/portfolio.php3&quot;</p><p>    &lt;?php</p><p>    if ($cap == 3) { print &quot; onMouseover=\&quot;chgcolor(0,0)\&quot; onMouseout=\&quot;chgcolor(0,0,1)\&quot;&quot;; }</p><p>    ?&gt;</p><p>    id=&quot;linkk&quot;&gt;</p>  </pre></p>  </CODE></p></P></p> </p><H3></p>  Fourth step :: TOTALLY different layouts depending on your browser's capatibility.</p></H3></p> </p><P></p>  To clearly understand what will be developed here, point your machines toward <A HREF="http://blog.nerdsoul.com/">my blog</A>. i remind you it's still beta and that the file may (will) be huge (around 100k), lots of content.</p></P></p><P></p>  The power of conditionalisation starts there to reach the insanity.</p></P></p><P></p>  I rely on <A HREF="http://www.blogger.com">blogger's free services</A> to generate my blog. When i find something interesting on the web, i highlight it, i trigger the active-X i installed, it opens a window in which i can modify the content, and it is posted to blogger's server. There it is stored in their db, the template i gave them is parsed with the data form the databases, and published on my site.</p></P></p><P></p>  A 300 lines template -&gt; 5000 lines webpage.</p></P></p><P></p>  In the template file, i indicate where the entries will be rendered with their &lt;BLOGGER&gt; &lt;/BLOGGER&gt; self-made tags.</p></P></p><P></p>  What i wanted to do is that lesser browsers get the content in-line / up-to date browsers get the content layered. The html is totally different, a big table, instead of divs! No problem.</p></P></p><P></p>  in my <A HREF="http://www.nerdsoul.com/evolt/bloggersource.html">blogger template</A> ::</p></p></p><p></p><p>  <CODE></p>  <pre></p>    &lt;?php</p>    //if lesser browser or plain design contain the entries in the main table</p>    if ($cap == 1 &#124;&#124; $ovride == 1) {</p>    print &quot;</p>    &lt;TABLE BORDER=&quot;\&quot;0\&quot;&quot; CELLSPACING=&quot;\&quot;1\&quot;&quot; </p>    CELLPADDING=&quot;\&quot;2\&quot;&quot; ALIGN=&quot;\&quot;CENTER\&quot;&quot; </p>    BGCOLOR=&quot;\&quot;#333333\&quot;&quot; HEIGHT=&quot;\&quot;200\&quot;&quot; </p>    NAME=&quot;\&quot;STUFF\&quot;&quot;&gt; </p><p>    </p>    &lt;TD WIDTH=&quot;\&quot;20%\&quot;&quot; BACKGROUND=&quot;\&quot;t.gif\&quot;&quot;&gt; &nbsp; &lt;/TD&gt; </p><p>    &lt;TD WIDTH=&quot;\&quot;60%\&quot;&quot;&gt;&quot;;</p>    /* </p>       if plain design called, give the ability to switch back to layered design. </p>       Watch the $PHP_SELF variable, it's a build-in var which means 'the current URL', </p>       very useful. By appending '?ovride=2' to it, next page will be processed with </p>       the variable $ovride already defined and set to 2. Magic! </p>    */</p><p>    if ($ovride == 1) {</p>    print &quot;</p>    &lt;DIV ALIGN=&quot;\&quot;CENTER\&quot;&quot; BGCOLOR=&quot;\&quot;#666666\&quot;&quot;&gt; &lt;A HREF=&quot;\&quot;$PHP_SELF?OVRIDE=&quot;2\&quot; &quot;&quot;&gt; eye-candy &lt;/A&gt; &lt;/DIV&gt; </p><p>    &quot;;</p>    }</p>    print &quot;</p>    &lt;DIV ALIGN=&quot;\&quot;CENTER\&quot;&quot; BGCOLOR=&quot;\&quot;#666666\&quot;&quot;&gt;&lt;A HREF=&quot;\&quot;archives.php3\&quot;&quot;&gt;ARCHIVES&lt;/A&gt;&lt;/DIV&gt; </p><p>    &lt;TABLE WIDTH=&quot;\&quot;100%\&quot;&quot; BORDER=&quot;\&quot;0\&quot;&quot; CELLPADDING=&quot;\&quot;4\&quot;&quot; BGCOLOR=&quot;\&quot;#666666\&quot;&quot;&gt; </p>&quot;;</p>    }</p>    ?&gt;</p>    &lt;BLOGGER&gt;</p>    &lt;?php </p>    //if netscape AND dhtml presentation, classic div</p>    if ($cap == 2 &amp;&amp; $ovride != 1) {</p>    print &quot;</p>    &lt;DIV CLASS=&quot;\&quot;CONT\&quot;&quot;&gt; </p><p>    &lt;TABLE BORDER=&quot;\&quot;1\&quot;&quot; BGCOLOR=&quot;\&quot;LIME\&quot;&quot; </p>    CELLPADDING=&quot;\&quot;4\&quot;&quot;&gt; </p>&quot;;</p>    }</p>    elseif ($cap == 3 &amp;&amp; $ovride != 1) {</p>    //if ie AND dhtml presentation, DIV+CSS filters</p>    print &quot;</p>    &lt;DIV ID=&quot;\&quot;CONTENT\&quot;&quot; STYLE=&quot;\&quot;POSITION:ABSOLUTE; </p>    RIGHT:20PX; TOP:42PX; WIDTH:60%; Z-INDEX:4; VISIBILITY: HIDDEN;\&quot;&gt; </p><p>    &lt;TABLE WIDTH=&quot;\&quot;100%\&quot;&quot; BORDER=&quot;\&quot;0\&quot;&quot; </p>    CELLPADDING=&quot;\&quot;4\&quot;&quot; STYLE=&quot;\&quot;BACKGROUND-COLOR:LIME; </p>    FILTER: ALPHA( OPACITY=&quot;80,&quot; FINISHOPACITY=&quot;80,&quot; ) \&quot;&gt; </p>&quot;;</p>    }</p><p>    ...</p><p>    ?&gt;</p>  </pre></p>  </CODE></p></p></p><p></p><p>  Take a look at my source to see where it can go. It may seem complex, but when i made that, i didn't knew anything about PHP (almost ; ) ).</p></P></p><H3></p>  Next entry :: the HTML heresy : class.layout (how to make cleaner code? don't write tags!)</p></H3>