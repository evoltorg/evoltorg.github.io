---
layout: post
permalink: node/9982
ratings: 4
avgrate: 4.2500
rating: 4.05
categories: [Backend]
user: joshua
real_name: "Joshua Olson"
user_biog: ""
user_since: 21 Sep 2000
avatar: /images/pictures/picture-3243.jpg
article_count: 3
excerpt: "ColdFusion has no built in method to apply masks to strings, instantly turning 1234567890 into 123-456-7890.  This custom tag does just that.  If you can improve it (for efficiency reasons) please contact me.  This was just a quick fix that I thought I'd share.  All the information is in ..."
---
<p>Purpose: Applies generic masks to filtered strings<br></p>Method: brute force</p></p><h5>Attributes:</h5></p><ul></p><li><code>value</code> - the value to which we apply the mask</li></p><li><code>result</code> - variable in which to store the answer, defaults to "out"</li></p><li><code>mask</code> - mask to apply to the value</li></p><li><code>filter</code> - prefilter of value</li></p></ul></p><p><p>No parameters are required, though not specifying anything is boring.</p></p><p><code>filter</code> accepts "alpha", "numeric", "alphanumeric" and is a prefilter to the string. For example, the string "a1b2-c3c4" would be processed as the following with the different filters:</p></p><p><ul></p><li><code>none</code>: "a1b2-c3d4"</li></p><li><code>alpha</code>: "abcd"</li></p><li><code>numeric</code>: "1234"</li></p><li><code>alphanumeric</code>: "a1b2c3d4"</li></p></ul></p><p><p>The filtered string would *then* be applied to the mask. The mask</p>entities are as follows:</p></p><p><ul></p><li><code>_</code> character unchanged</li></p><li><code>0</code> character is unchanged for numerics and forced to zero for all others</li></p><li><code>9</code> character is unchanged for numerics and forced to empty for all others</li></p><li><code>a</code> character is forced to lower case, all others are left as is</li></p><li><code>A</code> character is forced to upper case, all others are left as is</li></p><li><code>b</code> character is forced to lower case, numerics are forces to empty</li></p><li><code>B</code> character is forced to upper case, numerics are forces to empty</li></p><li><code>\</code> following character is literal</li></p></ul></p><p><p>Usage:</p></p><p><code>&lt;cf_filtermask value="123abc" mask="___ ___" <br>result="license_plate"&gt;</code><br></p>returns: 123 abc</p></p><p><p><code>&lt;cf_filtermask value="ab 1sf 2 sd 3 s 45" mask="\_0+\0b999999" <br>filter="numeric"&gt;</code><br></p>returns: _1+0345</p></p><p><p><code>&lt;cf_filtermask value="APPL9E" mask="Bbbbbb \B"&gt;</code><br></p>returns: Apple B</p></p><p><p><code>&lt;cf_filtermask value="706-555-1212ext123" mask="(___)___-____"<br></p>filter="numeric"&gt;</code><br></p>and<br></p><code>&lt;cf_filtermask value="7065551212" mask="(___)___-____" <br>filter="numeric"&gt;</code><br></p>return: (706)555-1212<br>&nbsp;</p></p><p><p>The last example is why I made it in the first place.</p></p><p><pre></p>&#60;cfsilent&#62;</p>&#60;cfparam name=&#34;attributes.value&#34; default=&#34;&#34;&#62;</p>&#60;cfparam name=&#34;attributes.result&#34; default=&#34;out&#34;&#62;</p>&#60;cfparam name=&#34;attributes.mask&#34; default=&#34;&#34;&#62;</p>&#60;cfparam name=&#34;attributes.filter&#34; default=&#34;&#34;&#62;</p><p>&#60;cfset mask = attributes.mask&#62;</p>&#60;cfset t_value = attributes.value&#62;</p><p>&#60;cfif attributes.filter IS &#34;numeric&#34;&#62;</p>  &#60;cfset t_value = REReplace(t_value, &#34;[^[:digit:]]&#34;, &#34;&#34;, &#34;ALL&#34;)&#62;</p>&#60;/cfif&#62;</p><p>&#60;cfif attributes.filter IS &#34;alpha&#34;&#62;</p>  &#60;cfset t_value = REReplace(t_value, &#34;[^[:alpha:]]&#34;, &#34;&#34;, &#34;ALL&#34;)&#62;</p>&#60;/cfif&#62;</p><p>&#60;cfif attributes.filter IS &#34;alphanumeric&#34;&#62;</p>  &#60;cfset t_value = REReplace(t_value, &#34;[^[:alnum:]]&#34;, &#34;&#34;, &#34;ALL&#34;)&#62;</p>&#60;/cfif&#62;</p><p>&#60;cfset value = &#34;&#34;&#62;</p>&#60;cfset pos = &#34;1&#34;&#62;</p>&#60;cfset literal = &#34;0&#34;&#62;</p>&#60;cfloop index=&#34;i&#34; from=&#34;1&#34; to=&#34;#Len(mask)#&#34;&#62;</p>  &#60;cfset character = Mid(mask, i, 1)&#62;</p>  &#60;cfif literal&#62;</p>    &#60;cfset value = value &#38; character&#62;</p>    &#60;cfset literal = &#34;0&#34;&#62;</p>  &#60;cfelse&#62;</p>    &#60;cfif Len(t_value) GTE pos&#62;</p>      &#60;cfset char_at_pos = Mid(t_value, pos, 1)&#62;</p>    &#60;cfelse&#62;</p>      &#60;cfset char_at_pos = &#34;&#34;&#62;</p>    &#60;/cfif&#62;</p>    &#60;cfif character IS &#34;9&#34;&#62;</p>      &#60;cfif isNumeric(char_at_pos)&#62;</p>        &#60;cfset value = value &#38; Val(char_at_pos)&#62;</p>      &#60;/cfif&#62;</p>      &#60;cfset pos = pos + &#34;1&#34;&#62;</p>    &#60;cfelseif character IS &#34;0&#34;&#62;</p>      &#60;cfset value = value &#38; Val(char_at_pos)&#62;</p>      &#60;cfset pos = pos + &#34;1&#34;&#62;</p>    &#60;cfelseif character IS &#34;_&#34;&#62;</p>      &#60;cfset value = value &#38; char_at_pos&#62;</p>      &#60;cfset pos = pos + &#34;1&#34;&#62;</p>    &#60;cfelseif Find(&#34;A&#34;, character)&#62;</p>      &#60;cfset value = value &#38; UCase(char_at_pos)&#62;</p>      &#60;cfset pos = pos + &#34;1&#34;&#62;</p>    &#60;cfelseif Find(&#34;a&#34;, character)&#62;</p>      &#60;cfset value = value &#38; LCase(char_at_pos)&#62;</p>      &#60;cfset pos = pos + &#34;1&#34;&#62;</p>    &#60;cfelseif Find(&#34;b&#34;, character)&#62;</p>      &#60;cfif NOT isNumeric(char_at_pos)&#62;</p>        &#60;cfset value = value &#38; LCase(char_at_pos)&#62;</p>      &#60;/cfif&#62;</p>      &#60;cfset pos = pos + &#34;1&#34;&#62;</p>    &#60;cfelseif Find(&#34;B&#34;, character)&#62;</p>      &#60;cfif NOT isNumeric(char_at_pos)&#62;</p>        &#60;cfset value = value &#38; UCase(char_at_pos)&#62;</p>      &#60;/cfif&#62;</p>      &#60;cfset pos = pos + &#34;1&#34;&#62;</p>    &#60;cfelseif Find(&#34;\&#34;, character)&#62;</p>      &#60;cfset literal = &#34;1&#34;&#62;</p>    &#60;cfelse&#62;</p>      &#60;cfset value = value &#38; character&#62;</p>    &#60;/cfif&#62;</p>  &#60;/cfif&#62; &#60;!--- if literal ---&#62;</p>&#60;/cfloop&#62;</p><p>&#60;cfset t = SetVariable(&#34;caller.#attributes.result#&#34;, value)&#62;</p>&#60;/cfsilent&#62;</p></pre>