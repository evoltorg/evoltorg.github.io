---
layout: post
permalink: node/19700
ratings: 8
avgrate: 2.6250
categories: [Code]
user: jesteruk
real_name: "Jester uk"
user_biog: "<p>I just like messing around with web design stuff, just a hobby.</p>
<p>Particularly perl, PHP and SQL.</p>

<p><a href=\"http://www.free2code.net\" rel=\"nofollow\" title=\"My site\" target=\"_blank\">http://www.free2code.net/</a></p>"
user_since: 22 Dec 2001
avatar: 
article_count: 6
excerpt: "A little snippet of code that will help when using Perl for CGI. Sticks all GET/query string, POST and cookie information into scalar variables matching their input names so you don\'t have to fiddle around to get at them, like in PHP."
---
<p>In this article I'm just going to show you a little script that will make working with forms and cookies in Perl a little easier. The form information, and any cookies present will already be dumped into variables matching their names, like in PHP.</p></p><h2>Time Saving</h2></p><p>I don't know about you, but when I'm coding in Perl I used to get sick of breaking the query string, POST input, cookie information up so i could get at it. This little script can be included at the top of each of your perl script to make it just that little bit easier. I know a lot of people have probably already got something similar for web programs with Perl, but I'll put it up here anyway.</p></p><h2>Here it is</h2></p><h3>Process GET/Query String</h3></p><pre></p>#!/usr/bin/perl</p><p># Process form variables for both POST and GET methods.</p># Below Will process all query string variables.</p><p>if ($ENV{'REQUEST_METHOD'} eq "GET"    $ENV{'QUERY_STRING'} ne "")</p>{</p> @pairs = split(/\&/, $ENV{'QUERY_STRING'});</p> foreach $pair (@pairs)</p> {</p>  ($name, $value) = split(/=/, $pair); # Split into name and value.</p>  $$name = $value; # Assign value to scalar matching name.</p>  $$name =~ s/%(..)/chr(hex($1))/ge; # Decode encoded stuff.</p>  $$name =~ s/\+/ /g; # substitute +'s for spaces.</p> }</p>}</p></pre></p><p>If the request method is <strong>GET</strong> the variables will be in the query string, all query string information will be processed by this bit of code whether it's from a form or not. We split the query string at the <strong>&amp;</strong> and dump each pair into the <code>@pairs</code> array. Then we use the <code>foreach</code> function to go through each pair in the array, split them at the <strong>=</strong> and dump the first part into <code>$name</code> and the last part into <code>$value</code>. Then we assign the <code>$value</code> variable to a scalar variable matching the name of the <code>$name</code> variable. Say we had in the query string: <strong>?action=mail</strong>, we would now have a variable <code>$action</code> containing <code>&quot;mail&quot;</code>. Finally we decode anything that has been URL encoded, and replace any <strong>+</strong> signs with a space. Remember to format your query string correctly when using this script. Just <code>http://host.com/index.pl?mail</code> will cause weird things to happen. Assign &quot;mail&quot; to a handler <code>?action=mail</code>.</p></p><h3>Process POST</h3></p><pre></p># Process POST form variables.</p><p>if ($ENV{'REQUEST_METHOD'} eq "POST")</p>{</p> read(STDIN, $stuff, $ENV{'CONTENT_LENGTH'});</p> @pairs = split(/\&/, $stuff);</p> foreach $pair (@pairs)</p> {</p>  ($name, $value) = split(/=/, $pair);</p>  $$name = $value;</p>  $$name =~ s/%(..)/chr(hex($1))/ge;</p>  $$name =~ s/\+/ /g;</p> }</p>}</p></pre></p><p>Reads the POST information into the variable <code>$stuff</code> and then processes them in the same way we did the query string, assigning the value to a scalar variable matching the form input name.</p></p><h3>Process Cookies</h3></p><pre></p># Process cookies.</p><p>if ($ENV{'HTTP_COOKIE'} ne "")</p>{</p> @pairs = split(/\; /, $ENV{'HTTP_COOKIE'});</p> foreach $pair (@pairs)</p> {</p>  ($name, $value) = split(/=/, $pair);</p>  $$name = $value;</p>  $$name =~ s/%(..)/chr(hex($1))/ge;</p>  $$name =~ s/\+/ /g;</p> }</p>}</p></pre></p><p>This time, if <code>$ENV{'HTTP_COOKIE'}</code> contains data we split the information at the <strong>;</strong> and then process it the same way we processed the POST and GET/query string information.</p></p><h3>Include it</h3></p><p>Just include the script at the top of each of your perl files.</p></p><p><code>do &quot;$DOCUMENT_ROOT/script.pl&quot;;</code></p></p><h3>The Full Script</h3></p><pre></p>#!/usr/bin/perl</p><p># Process form variables for both POST and GET methods.</p># Below Will process all query string variables.</p><p>if ($ENV{'REQUEST_METHOD'} eq "GET"    $ENV{'QUERY_STRING'} ne "")</p>{</p> @pairs = split(/\&/, $ENV{'QUERY_STRING'});</p> foreach $pair (@pairs)</p> {</p>  ($name, $value) = split(/=/, $pair); # Split into name and value.</p>  $$name = $value; # Assign value to scalar matching name.</p>  $$name =~ s/%(..)/chr(hex($1))/ge; # Decode encoded stuff.</p>  $$name =~ s/\+/ /g; # substitute +'s for spaces.</p> }</p>}</p><p># Process POST form variables.</p><p>if ($ENV{'REQUEST_METHOD'} eq "POST")</p>{</p> read(STDIN, $stuff, $ENV{'CONTENT_LENGTH'});</p> @pairs = split(/\&/, $stuff);</p> foreach $pair (@pairs)</p> {</p>  ($name, $value) = split(/=/, $pair);</p>  $$name = $value;</p>  $$name =~ s/%(..)/chr(hex($1))/ge;</p>  $$name =~ s/\+/ /g;</p> }</p>}</p><p># Process cookies.</p><p>if ($ENV{'HTTP_COOKIE'} ne "")</p>{</p> @pairs = split(/\; /, $ENV{'HTTP_COOKIE'});</p> foreach $pair (@pairs)</p> {</p>  ($name, $value) = split(/=/, $pair);</p>  $$name = $value;</p>  $$name =~ s/%(..)/chr(hex($1))/ge;</p>  $$name =~ s/\+/ /g;</p> }</p>}</p></pre></p><h2>Expand It</h2></p><p>If you're using Perl for CGI why not use this little script, and add to it some? Maybe you could define the content-type header in the script, as you'll probably be using HTML just add:</p></p><p><code>print &quot;Content-type: text/html</p><p>&quot;;</code></p></p><p>so you don't need to bother doing it in your scripts. Why not add a mailing subroutine into it (see <a href="/article/Simple_CGI_Email_Subroutine/17/398/index.html" title="MartinB: A simple CGI E-Mail Subroutine" target="_blank">MartinB's Article</a>, A Simple CGI E-Mail Subroutine). Be creative.</p></p><h2>Bibliography</h2></p><p>Well, there's no links i can point you to really. Hummm, how about some Perl stuff?</p></p><ul></p><li><a href="http://www.perl.com" title="perl.com" target="_blank">http://www.perl.com</a></li></p><li><a href="http://www.activestate.com" title="Active State" target="_blank">http://www.activestate.com</a></li></p><li><a href="http://www.cgi-resources.com" title="CGI Resources" target="_blank">http://www.cgi-resources.com</a></li></p></ul>