---
layout: post
permalink: quick_calendar_using_ajax_and_php
---
<p>Online calendars are often used in many web applications. Though popular, the logic behind creating a calendar can be scary especially for those who are new to programming. There are many web calendars in the market but some of them are quite complicated. If we are not able to understand the code, it becomes harder for us to customise the calendar to fit into our existing application. As such, we need to create a calendar that can plug itself into any system seamlessly without problems. Whether we are using Wordpress, Mambo/Joomla or Drupal, we should only need to insert one line into our code for the calendar to work. ie something like this: </p>\n<?php\nrequire_once('quick_calendar.php');\n?>\n<p>If you are already bored at this point or not interested to know how to create a web calendar,  feel free to see a live demo of the simple calendar <a href="http://web-developer.sitecritic.net/quick_calendar_demo.php">here</a>. The installation procedures is in the <a href="http://web-developer.sitecritic.net/quick_calendar.txt">source code</a>. </p>\n<p>Other than configuring the database access for the calendar, I do not want to change other things. With AJAX, I could even make the page static as I navigate between different months in the calendar. In this tutorial, I would like to share with you a simple calendar I created that fufills the objectives discussed above.   The tutorial assumes that you have basic knowledge of PHP and SQL but don't worry, the actual code is minimal and you should be able to customise it easily by reading at the comments. I used PHP 4 so that it is compatible with most servers. You should also be able to re-create the calendar easily in other programming languages using the same logic. </p>\n<h2>The First Step: Problem Identification </h2>\n<p>Perhaps the hardest part in creating a calendar is to come up with a good solution to  display the days of the  month in the correct column, ie Monday, Tuesday..etc. \n</p>\n<table cellspacing="2" cellpadding="2" width="400" border="1">\n    <tbody>\n        <tr>\n            <th colspan="7">Apr 2006</th>\n        </tr>\n        <tr>\n            <th>Sun</th><th>Mon</th><th>Tue</th><th>Wed</th><th>Thur</th><th>Fri</th><th>Sat</th>\n        </tr>\n        <tr>\n            <td align="center">&nbsp;</td>\n            <td align="center">&nbsp;</td>\n            <td align="center">&nbsp;</td>\n            <td align="center">&nbsp;</td>\n            <td align="center">&nbsp;</td>\n            <td align="center">&nbsp;</td>\n            <td align="center">1</td>\n        </tr>\n        <tr>\n            <td align="center">2</td>\n            <td align="center">3</td>\n            <td align="center">4</td>\n            <td align="center">5</td>\n            <td align="center">6</td>\n            <td align="center">7</td>\n            <td align="center">8</td>\n        </tr>\n        <tr>\n            <td align="center">9</td>\n            <td align="center">10</td>\n            <td align="center">11</td>\n            <td align="center">12</td>\n            <td align="center">13</td>\n            <td align="center">14</td>\n            <td align="center"><strong>15</strong></td>\n        </tr>\n        <tr>\n            <td align="center">16</td>\n            <td align="center">17</td>\n            <td align="center">18</td>\n            <td align="center">19</td>\n            <td align="center">20</td>\n            <td align="center">21</td>\n            <td align="center">22</td>\n        </tr>\n        <tr>\n            <td align="center">23</td>\n            <td align="center">24</td>\n            <td align="center">25</td>\n            <td align="center">26</td>\n            <td align="center">27</td>\n            <td align="center">28</td>\n            <td align="center">29</td>\n        </tr>\n        <tr>\n            <td align="center">30</td>\n            <td align="center">&nbsp;</td>\n            <td align="center">&nbsp;</td>\n            <td align="center">&nbsp;</td>\n            <td align="center">&nbsp;</td>\n            <td align="center">&nbsp;</td>\n            <td align="center">&nbsp;</td>\n        </tr>\n    </tbody>\n</table>\n<p>Let us take April 2006 for example. There are 30 days and 6 rows in the calendar. If we are given a day in the&nbsp;month, say 15, we have to know that it falls on a saturday and is in the third row (third week). We cannot take for granted that the first day is always the first cell in the table (top left cell). Sometimes, we get  4 or 5 weeks in a month. Only if we know how many days are there in a certain month and which day the <em>first of the month</em> falls in only can we construct the calender as shown above.</p>\n<h2>Getting Crucial information From The PHP Date function</h2>\n<p>PHP provides a date() function that gives us alot of useful information about the days and months of the year. To built the calendar for any month, We need&nbsp;2 important pieces of information from the Date function, ie the &quot;number of days in the month&quot; and a&nbsp;&quot;numeric representation of the first day of the month&quot;.</p>\n<p>I can get today's date easily from the following code:</p>\n<pre>// get year, eg 2006<br />$year = date('Y');<br />// get month, eg 04<br />$month = date('n');<br />// get day, eg 3<br />$day = date('j');</pre>\n<p>To get the number of days in this month, I will use the both the date and mktime function like so:</p>\n<pre>// get number of days in month, eg 28<br />$daysInMonth = date(&quot;t&quot;,mktime(0,0,0,$month,1,$year));</pre>\n<p>The numeric representation of the day of the week ranges from 0 to 6. 0 is sunday and 6 is saturday. Again, to get the numeric first day of this month, the function&nbsp;mktime comes in handy.&nbsp;&nbsp;</p>\n<pre>// get first day of the month, eg 4<br />$firstDay = date(&quot;w&quot;, mktime(0,0,0,$month,1,$year));</pre></p><p><h2>The Monthly Calendar As&nbsp;A&nbsp;2-D Array</h2></p><p><p>If we look at the calendar again for April 2006, we will see that it is actually&nbsp;a&nbsp;table(grid) filled with&nbsp;values starting from 1 to x (no of days in the month).&nbsp;The first day of the month is a variable though... It can occur in any day of the week. In the table, imagine each cell as having coordinates (x,y), starting from the top left cell&nbsp;as (0,0) and the bottom right cell as&nbsp;(5,6).&nbsp;In the month of April, the first day of the month is stored in coordinate (0,6).&nbsp;So, the plan now is to store the days&nbsp;of the&nbsp;month in a 2-D Array.&nbsp;</p>\n<p>Firstly, we want to know the number of cells needed.&nbsp; </p>\n<pre>// calculate total spaces needed in array<br />$tempDays = $firstDay + $daysInMonth;</pre>\n<p>Then we want to know the number of rows needed.</p>\n<pre>// calculate total rows needed<br />$weeksInMonth = ceil($tempDays/7);</pre></p><p><h2>Populating&nbsp;The 2-D Array</h2>\n<p>Knowing the number of rows and columns in the 2-D array, we can now&nbsp;fill the arrays with values&nbsp;using 2 for-loops. The first cell will start with a value of 1 and the subsequent cells will have their values increased by 1 till it reaches the end of the array.&nbsp;</p></p><p><?php\nfor($j=0;$j&lt;$weeksInMonth;$j++) {\n	for($i=0;$i&lt;7;$i++) {\n		$counter++;\n		$week[$j][$i] = $counter; \n	}\n}\n?>\n<p>For the month of April, the temporary array should be something like this:</p>\n<table cellspacing="2" cellpadding="2" width="400" border="1">\n    <tbody>\n        <tr>\n            <td align="center">1&nbsp;</td>\n            <td align="center">2&nbsp;</td>\n            <td align="center">&nbsp;3</td>\n            <td align="center">4&nbsp;</td>\n            <td align="center">5&nbsp;</td>\n            <td align="center">&nbsp;6</td>\n            <td align="center">7</td>\n        </tr>\n        <tr>\n            <td align="center">8</td>\n            <td align="center">9</td>\n            <td align="center">10</td>\n            <td align="center">11</td>\n            <td align="center">12</td>\n            <td align="center">13</td>\n            <td align="center">14</td>\n        </tr>\n        <tr>\n            <td align="center">15</td>\n            <td align="center">16</td>\n            <td align="center">17</td>\n            <td align="center">18</td>\n            <td align="center">19</td>\n            <td align="center">20</td>\n            <td align="center">21</td>\n        </tr>\n        <tr>\n            <td align="center">22</td>\n            <td align="center">23</td>\n            <td align="center">24</td>\n            <td align="center">25</td>\n            <td align="center">26</td>\n            <td align="center">27</td>\n            <td align="center">28</td>\n        </tr>\n        <tr>\n            <td align="center">29</td>\n            <td align="center">30</td>\n            <td align="center">31</td>\n            <td align="center">32</td>\n            <td align="center">33</td>\n            <td align="center">34</td>\n            <td align="center">35</td>\n        </tr>\n        <tr>\n            <td align="center">36</td>\n            <td align="center">37&nbsp;</td>\n            <td align="center">&nbsp;38</td>\n            <td align="center">39&nbsp;</td>\n            <td align="center">&nbsp;40</td>\n            <td align="center">41&nbsp;</td>\n            <td align="center">&nbsp;42</td>\n        </tr>\n    </tbody>\n</table>\n<h2>The Magic Offset</h2>\n<p>As you can see, the array above is not&nbsp;correct. The first day of April, ie value 1 should be in (0,6)&nbsp;instead of&nbsp;(0,0). Remeber the variable $firstDay? It is the numeric representation of the first day of month which happens to be 6 in April 2006. If we subtract &nbsp;$firstDay from all the values in the array, we will get the array as follows:</p>\n<table cellspacing="2" cellpadding="2" width="400" border="1">\n    <tbody>\n        <tr>\n            <td align="center">-5</td>\n            <td align="center">-4&nbsp;</td>\n            <td align="center">&nbsp;-3</td>\n            <td align="center">-2&nbsp;</td>\n            <td align="center">-1&nbsp;</td>\n            <td align="center">&nbsp;0</td>\n            <td align="center">1</td>\n        </tr>\n        <tr>\n            <td align="center">2</td>\n            <td align="center">3</td>\n            <td align="center">4</td>\n            <td align="center">5</td>\n            <td align="center">6</td>\n            <td align="center">7</td>\n            <td align="center">8</td>\n        </tr>\n        <tr>\n            <td align="center">9</td>\n            <td align="center">10</td>\n            <td align="center">11</td>\n            <td align="center">12</td>\n            <td align="center">13</td>\n            <td align="center">14</td>\n            <td align="center">15</td>\n        </tr>\n        <tr>\n            <td align="center">16</td>\n            <td align="center">17</td>\n            <td align="center">18</td>\n            <td align="center">19</td>\n            <td align="center">20</td>\n            <td align="center">21</td>\n            <td align="center">22</td>\n        </tr>\n        <tr>\n            <td align="center">23</td>\n            <td align="center">24</td>\n            <td align="center">25</td>\n            <td align="center">26</td>\n            <td align="center">27</td>\n            <td align="center">28</td>\n            <td align="center">29</td>\n        </tr>\n        <tr>\n            <td align="center">30</td>\n            <td align="center">31&nbsp;</td>\n            <td align="center">32&nbsp;</td>\n            <td align="center">33&nbsp;</td>\n            <td align="center">34&nbsp;</td>\n            <td align="center">35&nbsp;</td>\n            <td align="center">36&nbsp;</td>\n        </tr>\n    </tbody>\n</table></p><p><p>You should now be able to guess what we are going to do next. Looking at the array above, you see that we already got the values we want but we also have some unwanted values. Any number less than 1 or more than $daysInMonth (number of days in a month) should be ignored.</p></p><p><?php\n	function fillArray() {\n		// create a 2-d array\n		for($j=0;$j<$this->weeksInMonth;$j++) {\n			for($i=0;$i<7;$i++) {\n				$counter++;\n				$this->week[$j][$i] = $counter; \n				// offset the days\n				$this->week[$j][$i] -= $this->firstDay;\n				if (($this->week[$j][$i] < 1)    ($this->week[$j][$i] > $this->daysInMonth)) {	\n					$this->week[$j][$i] = "";\n				}\n			}\n		}\n	}\n?></p><p><p>This is the core function in the entire calendar generation algorithm. </p>\n<h2>Displaying The Calendar</h2>\n<p>Getting the values right in the 2-D array, we are now ready to display them. Now, we will create a table and start looping again using the <code>foreach</code> function. </p>\n<pre>\n&lt;table width=&quot;400&quot; border=&quot;1&quot; cellpadding=&quot;2&quot; cellspacing=&quot;2&quot;&gt;<br />	&lt;tr&gt;<br />		&lt;th colspan='7'&gt;&lt;?= date('M', mktime(0,0,0,$month,1,$year)).' '.$year; ?&gt;&lt;/th&gt;<br />	&lt;/tr&gt;<br />	&lt;tr&gt;<br />		&lt;th&gt;Sun&lt;/th&gt;<br />		&lt;th&gt;Mon&lt;/th&gt;<br />		&lt;th&gt;Tue&lt;/th&gt;<br />		&lt;th&gt;Wed&lt;/th&gt;<br />		&lt;th&gt;Thur&lt;/th&gt;<br />		&lt;th&gt;Fri&lt;/th&gt;<br />		&lt;th&gt;Sat&lt;/th&gt;<br />	&lt;/tr&gt;<br />\n&lt;?php<br />foreach ($week as $key =&gt; $val) { <br />	echo &quot;&lt;tr&gt;&quot;;<br />	for ($i=0;$i&lt;7;$i++) {<br />		echo &quot;&lt;td align='center'&gt;$date&lt;/td&gt;&quot;;<br />	}<br />	echo &quot;&lt;/tr&gt;&quot;;<br />}<br />?&gt;<br />&lt;/table&gt;&nbsp;\n</pre>\n<p>The final display will be like this:</p>\n<table cellspacing="2" cellpadding="2" width="400" border="1">\n  <tbody>\n    <tr>\n      <th colspan="7">Apr 2006</th>\n    </tr>\n    <tr>\n      <th>Sun</th>\n      <th>Mon</th>\n      <th>Tue</th>\n      <th>Wed</th>\n      <th>Thur</th>\n      <th>Fri</th>\n      <th>Sat</th>\n    </tr>\n    <tr>\n      <td align="center">&nbsp;</td>\n      <td align="center">&nbsp;</td>\n      <td align="center">&nbsp;</td>\n      <td align="center">&nbsp;</td>\n      <td align="center">&nbsp;</td>\n      <td align="center">&nbsp;</td>\n      <td align="center">1</td>\n    </tr>\n    <tr>\n      <td align="center">2</td>\n      <td align="center">3</td>\n      <td align="center">4</td>\n      <td align="center">5</td>\n      <td align="center">6</td>\n      <td align="center">7</td>\n      <td align="center">8</td>\n    </tr>\n    <tr>\n      <td align="center">9</td>\n      <td align="center">10</td>\n      <td align="center">11</td>\n      <td align="center">12</td>\n      <td align="center">13</td>\n      <td align="center">14</td>\n      <td align="center">15</td>\n    </tr>\n    <tr>\n      <td align="center">16</td>\n      <td align="center">17</td>\n      <td align="center">18</td>\n      <td align="center">19</td>\n      <td align="center">20</td>\n      <td align="center">21</td>\n      <td align="center">22</td>\n    </tr>\n    <tr>\n      <td align="center">23</td>\n      <td align="center">24</td>\n      <td align="center">25</td>\n      <td align="center">26</td>\n      <td align="center">27</td>\n      <td align="center">28</td>\n      <td align="center">29</td>\n    </tr>\n    <tr>\n      <td align="center">30</td>\n      <td align="center">&nbsp;</td>\n      <td align="center">&nbsp;</td>\n      <td align="center">&nbsp;</td>\n      <td align="center">&nbsp;</td>\n      <td align="center">&nbsp;</td>\n      <td align="center">&nbsp;</td>\n    </tr>\n  </tbody>\n</table>\n<p>We now have a plain calendar. </p>\n<h2>Adding Special Dates To The Calendar</h2>\n<p>This calendar only tells you &quot;the days of a week&quot; at the moment and is not very useful. Most online calendar will have reminders as well. Say for example, if my birthday falls on the 4th of April, I want the number 4 in the calendar be displayed differently, possible with a hyperlink in which upon clicking on it, will perform some task like redirecting me to a certain page or displaying more information about myself in a popup windows..etc. To do that, we need to a table in the database with at least 6 columns: id, day, month, year, link, desc.</p>\n<pre>CREATE TABLE calendar ( <br/>\n<div>id INT NOT NULL AUTO_INCREMENT ,<br />\n  day VARCHAR( 2 ) NOT NULL ,<br />\n  month VARCHAR( 2 ) NOT NULL ,<br />\n  year VARCHAR( 4 ) NOT NULL ,<br />\n  link VARCHAR( 255 ) NOT NULL ,<br />\n  desc TEXT NOT NULL ,<br />\n  PRIMARY KEY ( id ) </div>\n);\n</pre>\n<p>We then need to insert some data into the table for testing:</p>\n<pre>INSERT INTO calendar ( id , day , month , year , link , desc ) <br />\nVALUES ( </p>\n<div>'', '24', '*', '2006', 'http://www.sitecritic.net', 'Check your web cccount on the 24th of   every month. 2006 only!'</div>\n), (\n<div>'', '5', '11', '2006', 'some_javascript_funtion',   'Olympics, remember to buy ticket   from alice.'</div>\n),(  \n<div>'', '2', '1', '2007', 'some_javascript_funtion',   'early 2007. Any new plans for   the year?'</div>\n), (\n<div>'', '9', '*', '*', 'http://www.evolt.org', 'Remember to check updates from   evolt.org every month.'</div>\n);\n</pre>\n<p><em>The * under the month or year column means every month or year.  </em></p>\n<p>Next, we do a query and extract the  important dates for a certain month and store it in an array.</p>\n<?php\n$sql = "SELECT * FROM calendar WHERE (month='$month' AND year='$year')    (month='*' AND year='$year')    (month='$month' AND year='*')    (month='*' AND year='*')";\n$rs = $db->query($sql);\nwhile ($rw = $rs->fetchRow()) {\n	extract($rw);\n	$links[] = array('day'=>$day', 'month'=>$month, 'year'=>$year, 'link'=>$link, 'desc'=>$desc);\n}\n?>\n<p>If we create a class to generate the calendar, we need to pass the $links array into the class like so:</p>\n<?php\n$cal = &new Calendar($cArray, $today, $links, $css);\n$cal->render();\n?>\n<p>The <code>$cArray</code> is a class containing the array for the plain calendar as shown in step 6. The  <code>$today</code> variable is today's date. The <code>$links</code> variable contains the important dates in this month. With the <code>$css</code> variable, we can decorate the calendar table and make it look nicer.</p>\n<h2>Adding AJAX Capability</h2>\n<p>To make the  calendar more user friendly, we want to be able to navigate easily between the months or years without refreshing the page. Thanks to AJAX, we can now do that easily. If the user clicks on &quot;next month&quot; for example, we need to call the AJAX function to refresh the calendar without refreshing the page. We do that using XMLHttpRequest. This is the main code that does the trick. </p>\n<pre>http.open('get', 'quick_calendar.php?m='+m+&amp;y='+y+'&amp;ran='+ran_no);</pre>\n <p>After I get a response from the AJAX function, i need to update the calender. The calendar is wrapped around with the div tag called 'quickCalender'. I just need to rewrite the contents of the tag on the fly. </p> \n<pre>document.getElementById("quickCalender").innerHTML = http.responseText; </pre></p><p><h2>Conclusion and Future Improvements</h2>\n<p>In this tutorial, we went through the concept of how to create a web calendar using AJAX and PHP. I left the details in the code to prevent the tutorial becoming too long and indigestable. If you look at the code hard enough, you will notice that I packed alot of codes in one file. As a good programming practice, I should have broken them down into smaller parts/files. Because the objective of this project is to create a quick &quot;plug and forget&quot; calendar system, I did that on purpose.</p>\n<p>Also,  the object oriented approach I used in the code may not be flexible enough if I want to have different layouts for the calendar. The problem can be easily fixed by using inheritance, ie creating a  superclass for the QuickCalendar class. We can then have BrownCalendar, SpecialCalendar ...etc. </p>\n<p>Hope you enjoy reading this tutorial as much as I wrote it. The full demo can be seen <a href="http://web-developer.sitecritic.net/quick_calendar_demo.php">here</a> and source code is <a href="http://web-developer.sitecritic.net/quick_calendar.txt">here</a>. </p>\n