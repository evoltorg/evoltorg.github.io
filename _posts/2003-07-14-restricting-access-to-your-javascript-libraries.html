---
layout: post
permalink: node/60180
ratings: 9
avgrate: 2.7778
user: georgec
real_name: "George "
user_since: 21 Apr 2003
avatar: ""
article_count: 2
excerpt: "The nature of JavaScript libraries means they can be accessed and utilized by any site online, not just yours. Learn how to restrict access to your libraries to only your own sites, warding off bandwidth theft in the process."
---
<h2>Restricting access to JavaScript</p>libraries to designated domains</h2></p><p><a href="http://www.javascriptkit.com/javatutors/external.shtml" target="_blank">JavaScript</p>libraries</a> allow us to separate script from page, so multiple pages can all</p>utilize the same script simply by linking to it:</p></p><code>&lt;script src=&quot;greatscript.js&quot;&gt;&lt;/script&gt;</code></p><p>Just to refresh our memories, &quot;myscript.js&quot; should contain the</p>script itself minus the surrounding &lt;script&gt;&lt;/script&gt; tags, and</p>saved as a text file (but with .js extension).</p></p><p>Now, the nature of JS libraries means that they're not only accessible by</p>your site/domain, but anyone's. Like an image, a library could potentially be</p>utilized by any site that decides they like your script but not the bandwidth</p>associated with it. Specifically, they would simply use a syntax like the</p>following on their page:</p></p><code>&lt;script src=&quot;http://www.yourdomain.com/greatscript.js&quot;&gt;&lt;/script&gt;</code></p><p>This can become a headache, especially if the library is very large.</p></p><h3>Using JavaScript to restrict access to JS libraries to designated domains</h3></p><p>First stop- using JavaScript to safe guard JavaScript! You may already know</p>that the language is capable of determining the current URL in the location</p>field of the browser, through the property</p></p><code>document.location.href//returns the URL in the location field of browser</code></p><p>With that in mind, all we need is a piece of code that compares this URL with</p>a list of permitted ones, and if non of the later matches the former, we know</p>the library is being accessed from an outside source (and take appropriate</p>action). Suffice it to say such a code will need to be added directly inside the</p>library in question in order to take effect.</p></p><p>Lets turn theory into reality. The below code will prevent unauthorized</p>domains from referencing the containing JavaScript library:</p></p><pre>//Beginning of &quot;test.js&quot; file</p>var accepted_domains=new Array(&quot;wsabstract.com&quot;,&quot;javascriptkit.com&quot;)</p><p>var domaincheck=document.location.href //retrieve the current URL of user browser</p>var accepted_ok=false //set acess to false by default</p><p>if (domaincheck.indexOf(&quot;http&quot;)!=-1){ //if this is a http request</p>for (r=0;r&lt;accepted_domains.length;r++){</p>if (domaincheck.indexOf(accepted_domains[r])!=-1){ //if a match is found</p>accepted_ok=true //set access to true, and break out of loop</p>break</p>}</p>}</p>}</p>else</p>accepted_ok=true</p><p>if (!accepted_ok){</p>alert(&quot;You\'re not allowed to directly link to this .js file on our server!&quot;)</p>history.back(-1)</p>}</p><p>/////rest of your libray</p>&quot;</p>&quot;</p>&quot;</pre></p><p>We first define an array to hold a list of the &quot;permitted&quot; domains.</p>Then, we enlist the JavaScript property <font face="Courier" size="2">document.location.href</font></p>to get the current URL of the user's browser. Now we have both of our key</p>witnesses in our custody- the list of permitted domains, plus the current URL</p>(which includes domain) of the page. All that's left to do is to compare the</p>two, and only allow the library to proceed &quot;loading&quot; if there is a</p>match (if one of accepted_domain's values is contained within domaincheck). This</p>is done using a for loop.</p></p><p>Notice how the code above checks to see if the document's URL contains</p>&quot;http&quot; first before proceeding with the match making. The purpose of</p>this is so that offline accessing of the JavaScript library is left out of the</p>scrutinization process- obviously there's no point in restricting access of a</p>library when it's accessed offline, especially if you want to be able to test</p>the library out on your hard drive!</p></p><p>Using JavaScript to limit access to a library is perfectly viable, but it</p>does have its shortcomings. Obviously you'll need to make physical changes to</p>your library. Then there's the repetitious work involved if you ever want to</p>apply the restriction to all JS libraries on your site. Another solution for</p>this- if you can handle it- is via server side scripting, specifically,</p>.htaccess. Let's look at that now.</p></p><h3>Using .htaccess instead for the task</h3></p><p>In the tutorial <a href="http://www.javascriptkit.com/howto/htaccess.shtml" target="_blank">Comprehensive</p>Guide to .htaccess</a>, it featured a magical little file called .htaccess of</p>your server (you may or may not have access to it, depending on your web host),</p>and how it can enable everything from custom 404 pages, password protection of</p>directories, to disabling hot linking of images on your server. Well, faced with</p>our current challenge, we simply need to elaborate on that last point a bit, so</p>instead of- or apart from- images, JavaScript libraries are included within the</p>list of files not to be accessed from outside your site.</p></p><p>Take a look at the below code, which is all that's needed to accomplish the</p>task using .htaccess:</p></p><pre>RewriteEngine on</p>RewriteCond %{HTTP_REFERER} !^$</p>RewriteCond %{HTTP_REFERER} !^http://(www\.)?wsabstract.com/.*$ [NC]</p>RewriteCond %{HTTP_REFERER} !^http://(www\.)?javascriptkit.com/.*$ [NC]</p>RewriteRule \.(js gif jpg)$ - [F]</pre></p><p>Notice &quot;js&quot; in the last line, which adds .js files, along with .gif</p>and .jpg to the type of files only the domains listed above can access. The code</p>should be saved inside your .htaccess file, and dropped into your web page</p>directory.</p>