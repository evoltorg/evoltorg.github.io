---
layout: post
permalink: node/60180
---
<h2>Restricting access to JavaScript\nlibraries to designated domains</h2>\n<p><a href="http://www.javascriptkit.com/javatutors/external.shtml" target="_blank">JavaScript\nlibraries</a> allow us to separate script from page, so multiple pages can all\nutilize the same script simply by linking to it:</p>\n<code>&lt;script src=&quot;greatscript.js&quot;&gt;&lt;/script&gt;</code>\n<p>Just to refresh our memories, &quot;myscript.js&quot; should contain the\nscript itself minus the surrounding &lt;script&gt;&lt;/script&gt; tags, and\nsaved as a text file (but with .js extension).</p>\n<p>Now, the nature of JS libraries means that they're not only accessible by\nyour site/domain, but anyone's. Like an image, a library could potentially be\nutilized by any site that decides they like your script but not the bandwidth\nassociated with it. Specifically, they would simply use a syntax like the\nfollowing on their page:</p>\n<code>&lt;script src=&quot;http://www.yourdomain.com/greatscript.js&quot;&gt;&lt;/script&gt;</code>\n<p>This can become a headache, especially if the library is very large.</p>\n<h3>Using JavaScript to restrict access to JS libraries to designated domains</h3>\n<p>First stop- using JavaScript to safe guard JavaScript! You may already know\nthat the language is capable of determining the current URL in the location\nfield of the browser, through the property</p>\n<code>document.location.href//returns the URL in the location field of browser</code>\n<p>With that in mind, all we need is a piece of code that compares this URL with\na list of permitted ones, and if non of the later matches the former, we know\nthe library is being accessed from an outside source (and take appropriate\naction). Suffice it to say such a code will need to be added directly inside the\nlibrary in question in order to take effect.</p>\n<p>Lets turn theory into reality. The below code will prevent unauthorized\ndomains from referencing the containing JavaScript library:</p>\n<pre>//Beginning of &quot;test.js&quot; file\nvar accepted_domains=new Array(&quot;wsabstract.com&quot;,&quot;javascriptkit.com&quot;)</p><p>var domaincheck=document.location.href //retrieve the current URL of user browser\nvar accepted_ok=false //set acess to false by default</p><p>if (domaincheck.indexOf(&quot;http&quot;)!=-1){ //if this is a http request\nfor (r=0;r&lt;accepted_domains.length;r++){\nif (domaincheck.indexOf(accepted_domains[r])!=-1){ //if a match is found\naccepted_ok=true //set access to true, and break out of loop\nbreak\n}\n}\n}\nelse\naccepted_ok=true</p><p>if (!accepted_ok){\nalert(&quot;You\'re not allowed to directly link to this .js file on our server!&quot;)\nhistory.back(-1)\n}</p><p>/////rest of your libray\n&quot;\n&quot;\n&quot;</pre>\n<p>We first define an array to hold a list of the &quot;permitted&quot; domains.\nThen, we enlist the JavaScript property <font face="Courier" size="2">document.location.href</font>\nto get the current URL of the user's browser. Now we have both of our key\nwitnesses in our custody- the list of permitted domains, plus the current URL\n(which includes domain) of the page. All that's left to do is to compare the\ntwo, and only allow the library to proceed &quot;loading&quot; if there is a\nmatch (if one of accepted_domain's values is contained within domaincheck). This\nis done using a for loop.</p>\n<p>Notice how the code above checks to see if the document's URL contains\n&quot;http&quot; first before proceeding with the match making. The purpose of\nthis is so that offline accessing of the JavaScript library is left out of the\nscrutinization process- obviously there's no point in restricting access of a\nlibrary when it's accessed offline, especially if you want to be able to test\nthe library out on your hard drive!</p>\n<p>Using JavaScript to limit access to a library is perfectly viable, but it\ndoes have its shortcomings. Obviously you'll need to make physical changes to\nyour library. Then there's the repetitious work involved if you ever want to\napply the restriction to all JS libraries on your site. Another solution for\nthis- if you can handle it- is via server side scripting, specifically,\n.htaccess. Let's look at that now.</p>\n<h3>Using .htaccess instead for the task</h3>\n<p>In the tutorial <a href="http://www.javascriptkit.com/howto/htaccess.shtml" target="_blank">Comprehensive\nGuide to .htaccess</a>, it featured a magical little file called .htaccess of\nyour server (you may or may not have access to it, depending on your web host),\nand how it can enable everything from custom 404 pages, password protection of\ndirectories, to disabling hot linking of images on your server. Well, faced with\nour current challenge, we simply need to elaborate on that last point a bit, so\ninstead of- or apart from- images, JavaScript libraries are included within the\nlist of files not to be accessed from outside your site.</p>\n<p>Take a look at the below code, which is all that's needed to accomplish the\ntask using .htaccess:</p>\n<pre>RewriteEngine on\nRewriteCond %{HTTP_REFERER} !^$\nRewriteCond %{HTTP_REFERER} !^http://(www\.)?wsabstract.com/.*$ [NC]\nRewriteCond %{HTTP_REFERER} !^http://(www\.)?javascriptkit.com/.*$ [NC]\nRewriteRule \.(js gif jpg)$ - [F]</pre>\n<p>Notice &quot;js&quot; in the last line, which adds .js files, along with .gif\nand .jpg to the type of files only the domains listed above can access. The code\nshould be saved inside your .htaccess file, and dropped into your web page\ndirectory.</p>