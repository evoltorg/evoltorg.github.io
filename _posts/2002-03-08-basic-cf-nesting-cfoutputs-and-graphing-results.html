---
layout: post
permalink: node/22043
---
<h2>Basics</h2></p><p><p>The CFOUTPUT tag, commonly used to display the results of a database query, can be nested with use of its group attribute. This permits effective sectioning of displayed data whether by a table, list, or other means.</p></p><p><h2>Application</h2></p><p><h3>Looping over a query</h3></p><p><p>A simple application of the CFOUTPUT tag is to output data as an HTML graph. For example, we could find out how many articles have been published on the evolt.org site and graph the number per month. But we'll jump straight to the next level, and nest two CFOUTPUT tags so that we can get the publishing history of each month, and the totals of each year. First, the query (courtesy of SQL guru, <a href="http://www.evolt.org/user/r937/20/index.html">Rudy Limeback</a>):</p></p><p><pre>\n&lt;cfquery name="articlegraph" datasource="datasource_name"&gt;\nselect to_char(datemod,'yyyy') as theyear\n        , to_char(datemod,'mm') as themonth\n        , count(contentid) as montharticles\n     from content\n    where signoff = 1\n group by to_char(datemod,'yyyy')\n        , to_char(datemod,'mm')\n&lt;/cfquery&gt;\n</pre></p><p><p>This effectively grabs the year and month of each published article (<code>signoff</code> is a field denoting publication), and counts the monthly total. The query groups the results, first by year, and then month. This is crucial for the nested CFOUTPUT we'll use to give monthly and yearly totals.</p></p><p><h3>Outputting As a Graph</h3></p><p><p>After the query, is the output code:</p></p><p></p><p>\n<pre>\n&lt;table border="0"&gt;</p><p>&lt;cfset yeartotal=0&gt;\n&lt;cfoutput query=articlegraph group=theyear&gt;</p><p>&lt;cfset yeartotal=0&gt;\n&lt;cfoutput&gt;</p><p>&lt;tr&gt;\n&lt;td align="right"&gt;&lt;strong&gt;&lt;nobr&gt;#monthasstring(themonth)# #theyear#&lt;/nobr&gt;&lt;/strong&gt;&lt;/td&gt;</p><p>&lt;td&gt;&lt;span&gt;(#montharticles#)&lt;/span&gt;&lt;/td&gt;</p><p>&lt;td&gt;&lt;hr style="color:##f00; text-align:left; height:5px;\n               width:#evaluate(5 * montharticles)#px; border:1px ##000 solid;"&gt;&lt;/td&gt;</p><p>&lt;/tr&gt;</p><p>&lt;cfset yeartotal = yeartotal + montharticles&gt;\n&lt;/cfoutput&gt;</p><p>&lt;tr&gt;\n&lt;td colspan="2"&gt;&nbsp;&lt;/td&gt;\n&lt;td&gt;&lt;strong&gt;#theyear# total: #yeartotal#&lt;/strong&gt;&lt;/td&gt;\n&lt;/tr&gt;\n&lt;/cfoutput&gt;\n&lt;/table&gt;\n</pre></p><p>\n<p>You'll notice that we're first clearing a <code>yeartotal</code> variable that we use within the CFOUTPUT's to sum the monthly totals.</p></p><p><p>Next we commence the first CFOUTPUT of data from our &quot;articlegraph&quot; query, and importantly, group on theyear (as first listed in our query). Our subsequent nested CFOUTPUT automatically groups on themonth (since it's the second <code>group by</code> option).</p></p><p><p>Within the inner CFOUTPUT, we output in a series of table cells, the month name (using MonthAsString() to convert from the numerical form), the total number of articles for the month (<code>montharticles</code>), and then a styled <code>&lt;hr&gt;</code> with a height of 5px, and a width equal to 5 times the number of articles published within the month. If you wanted to account for users without JavaScript/CSS, you could easily replace this with an image.</p></p><p><p>Just prior to closing the inner CFOUTPUT, we increment the <code>yeartotal</code> variable. Then we output it in a row of its own in the outer loop, before clearing it (as mentioned earlier) in readiness for the looping for the following year.</p></p><p><h2>Results</h2></p><p><p>From the image below, you can see some example results (as displayed in IE5/Win2K). Click the image to visit <a href="http://test.evolt.org/evolt/articlegraph.cfm" target="_blank">a live representation</a> of the code in action.</p></p><p><p>Our graph may not be stunning, but it will download quickly due to the absence of images, and will give you ideas to improve the graph display regardless of its current appearance!</p></p><p><p><a href="http://test.evolt.org/evolt/articlegraph.cfm" title="View a live representation." target="_blank"><img src="http://members.evolt.org/isaac/evolt/articles/basic_cf_cfloop_graph50.gif" width=250 height=304 alt="A 50% view of the graph" border="0"></a></p></p><p>\n<p>Happy experimenting!</p></p><p>\n<p>&nbsp;</p></p><p><p><a href="mailto:isaac@triplezero.com.au">isaac</a><br />\n<a href="http://www.triplezero.com.au/" target="_blank">www.triplezero.com.au</a></p>