---
layout: post
permalink: node/226
ratings: 11
avgrate: 4.3636
user: AnthonyB
real_name: "Anthony Baratta"
user_since: 10 Jul 1999
avatar: "/images/pictures/picture-140.jpg"
article_count: 12
excerpt: "... Slapped together from a few emails (or, what I learned from www.apache.org, plus banging my own head against the wall)...  Topics you will find in this article are:   A Few Important .htaccess Opt"
---
<p></p>... Slapped together from a few emails (or, what I learned from <a href="http://www.apache.org/" target="_new">www.apache.org</a>, plus banging my own head against the wall)...</p></p></p><p><p></p>Topics you will find in this article are:</p><ul compact></p> <li><a href="http://evolt.org/article/A_Cheesy_htaccess_Tutorial/18/226/evolt.org#a" title="Important .htaccess Options">A Few Important .htaccess Options</a></li></p> <li><a href="http://evolt.org/article/A_Cheesy_htaccess_Tutorial/18/226/evolt.org#b" title="Auto Headers and Footers">Auto Headers and Footers for Fancy Indexing</a></li></p> <li><a href="http://evolt.org/article/A_Cheesy_htaccess_Tutorial/18/226/evolt.org#c" title="Password Protecting a Directory">Password Protecting a Directory </a></li></p> <li><a href="http://evolt.org/article/A_Cheesy_htaccess_Tutorial/18/226/evolt.org#d" title="Customizing Server Error Messages">Customizing Server Error Messages</a></li></p></ul></p></p></p><p><a name="a"></a></p><h2>A Few Important .htaccess Options</h2></p><p><p></p>Apache uses the .htaccess files to customize the web server responses. If you are not experienced with .htaccess file, now is a good time to learn. They are "archaic" but useful. Make sure that your server will accept an .htaccess file overriding the default settings. Check with your ISP first.</p></p></p><p><p></p>Using NotePad or your favorite text editor (vi if you are an uber-monkey) create the following file:</p></p></p><p><p></p>Name = htaccess.txt (after FTPing the file over, rename it to .htaccess)</p></p></p><p><p></p><pre></p>Options Includes ExecCGI</p>AddHandler cgi-script .cgi</p>DirectoryIndex index.html index.htm index.cgi</p>AddType text/x-server-parsed-html .html .htm .ssi</p></pre></p></p></p><p><p></p>Save the file and FTP it to the directory you want the cgi script to be the index page. BIG NOTE: .htaccess files are inclusive and last option rules. What this means is that you can set up an .htaccess file within the root directory of your web server /web/sites/ &lt;server&gt; and it will be applicable to the rest of the downstream tree. If another .htacess file is downstream the two are "added" together. Any commands that are contradictory are not debated. The last one processed wins. So downstream .htaccess files would override any contradictory rules set previously. (Clear as mud?) </p><p><P>Now rename your script to index.cgi and move it into the target directory. </p><p><P>There are a lot of cool and fancy things you can do with the .htaccess file (this is where you start for password protecting a directory). </p><p><P>-- What the file means -- </p><p><P>Options Includes ExecCGI </p><p><P>The Options directive controls which server features are available in a particular directory. Includes says do SSIs, ExecCGI says execute cgi scripts from within this directory. More Info: </p><p><P> <a href="http://www.apache.org/docs/mod/core.html#options" target="_new" title="More info on the Options Includes ExecCGI directive (opens in new window)">http://www.apache.org/docs/mod/core.html#options </a></p><p><P>AddHandler cgi-script .cgi </p><p><P>AddHandler maps the filename extensions extension to the handler handler-name. More info: </p><p><P> <a href="http://www.apache.org/docs/mod/mod_mime.html#addhandler" target="_new" title="More info on the Add Handler directive (opens in new window)">http://www.apache.org/docs/mod/mod_mime.html#addhandler </a> <br> <a href="http://www.apache.org/docs-1.2/handler.html" target="_new" title="More info on the Add Handler directive (opens in new window)">http://www.apache.org/docs-1.2/handler.html </a> </p><p><P>DirectoryIndex index.html index.txt index.cgi </p><p><P>The DirectoryIndex directive sets the list of resources to look for, when the client requests an index of the directory by specifying a / at the end of the a directory name. More Info: </p><p><P> <a href="http://www.apache.org/docs/mod/mod_dir.html#directoryindex" target="_new" title="More info on the DirectoryIndex directive (opens in new window)">http://www.apache.org/docs/mod/mod_dir.html#directoryindex </a> </p><p><P> AddType text/x-server-parsed-html .html .htm .ssi </p><p><P>The AddType directive tells the Apache server to "parse" all the files with the listed extensions for SSI commands. More Info: </p><p><P> <a href="http://www.apache.org/docs/mod/mod_mime.html#addtype" target="_new" title="More info on the AddType directive (opens in new window)">http://www.apache.org/docs/mod/mod_mime.html#addtype </a> </p><p><P>(This can also be performed via the following command.) </p><p><P>AddHandler server-parsed .htm .html .ssi </p><p><P>More info: </p><p><P> <a href="http://www.apache.org/docs-1.2/handler.html" target="_new" title="More info on handlers (opens in new window)">http://www.apache.org/docs-1.2/handler.html </a> <a name="b">  </a> <h4>Auto Headers and Footers for Fancy Indexing </h4> </p><p><P>Did you know that Apache can put headers and footers on the pages it auto indexes?? </p><p><P>If you do not have an index.htm(l) page in your sub-directory Apache sends a list of the files in that directory. Much like an FTP listing. (This is on usually by default and can be turned off with the command 'Options -Indexes' in a .htaccess file.) </p><p><P>However the page is not too fancy (even though they call it fancy indexing.) You can spruce up the page by customizing the header and the footer via the .htaccess file. </p><p><P>Put the following in the .htaccess file for that directory.... </p><p><P>HeaderName filename ReadmeName filename </p><p><P>For example...when indexing the directory /web, the server will first look for the HTML file /web/filename.html and include it if found, otherwise it will include the plain text file /web/filename, if it exists. The file must be in the target directory - you can not reference a file from another directory (although you can "within" the used header/footer file. (ReadmeName is the footer file.) </p><p><P>Also - start your header file with BODY - you don't need to end your footer file with &lt;/body&gt; or &lt;/html&gt; </p><p><P>Lastly - I name your header and footer file with a '.' in the beginning. This will prevent the file from showing up on the directory listing. Putting a '.' as the first character in the name is a UNIX trick to make the file 'disappear'. e.g. I named my header and footer file '.download-header.html' and '.download-footer.html'. Therefore my .htaccess file looks like this... </p><p><P>HeaderName .download-header ReadmeName .download-footer </p><p><P>So no .html as the extension because Apache already adds that when it looks for the file. </p><p><P>So you can embed HTML and formatting in to the header and footer of an index of files. You can see my attempt at <a href="http://www.baratta.com/southpark/files" target="_new" title="Example of embedding HTML into index files (opens in new window)">http://www.baratta.com/southpark/files </a> - you can see a better attempt at <a href="http://soundamerica.com" target="_new" title="Example of embedding HTML into index files (opens in new window)">http://soundamerica.com </a> <a name="c">  </a> <h4>Password Protecting a Directory </h4> </p><p><P>You need two files - one called '.htaccess' and the other any name you want/any location you have read/write access to. I call my web password files '.htpasswd' and put them in a directory under my home directory. If you use a directory off your home directory, make sure that the directory is 755 and the password file is 644, so the web server can see and use it. </p><p><P>e.g. password file is in /web/foo/home/bin-foo while the /web/sites/foo/members is the password protected directory. </p><p><P>Makes it harder to steal your password file. </p><p><P>OK create an .htaccess file with this stuff... </p><p><P></p><pre></p>AuthName &quot; &lt;phrase the user sees in the login box&gt;&quot;</p>AuthType Basic</p>AuthUserFile /full/path/to/file/.htpasswd</p>require valid-user </p></pre></p><p><P>Of course put the .htaccess file in the directory you want password protected. </p><p><P>Now...cut and paste the following code into a file called make-password or something - chmod it to 700. (make sure that the path to PERL is correct) </p><p><P>This file will allow you to make and add password files without having to do much work. </p><p><P>(Apache comes with another program to do this, I use this code snippet because I've attached it to a few admin programs I use with Perl to make and change user passwords.) </p><p><P></p><p><pre></p>#!/usr/bin/perl</p>if (scalar(@ARGV) &lt; 2) {</p>print &lt;&lt;EOF;</p>usage: make-password &lt;htpasswd file&gt; &lt;user&gt; &lt;password&gt;</p>EOF</p>exit;</p>}</p><p>$salt=&quot;XX&quot;;</p>$file=$ARGV[0];</p>$key=$ARGV[1];</p>$value=$ARGV[2];</p><p>if ($file && $key && $value) {</p>$hash = crypt($value, &quot;$salt&quot;);</p>open(DB, &quot;&gt;&gt;$file&quot;) &#124;&#124; die &quot;Error: $!</p>&quot;;</p>print DB &quot;$key:$hash</p>&quot;;</p>close(DB);</p>print &quot;User $key added with password $value, </p>encrypted to $hash</p>&quot;;</p>exit;</p>}</p></pre></p><p><P>+++++ </p><p><P>Put the file in your home 'bin' directory. If your admin set you up right you should have a path to a bin directory in your path statement, even if the bin directory does not exist. (Check with the command 'env'.) Make the directory if it does not exist. </p><p><P>To make a new password file just type the following in the directory you want to create the password file. </p><p><P>make-password htpasswd file name> &lt;user name&gt; &lt;password&gt; </p><p><P>If htpasswd file does not exist it is created. You can use this command to add new names and passwords to the htpasswd file. To delete a name and password, just vi the file and 'dd' the line to delete it. </p><p><P>Fire up the browser and test. Should work. </p><p><P> <a name="d">  </a> <h4>Customizing Server Error Messages </h4>You can customize your server's error message so your users are not struck with a stark bleeding white web page with a less than helpful message on it.</p><p><P>The standard errors generated are: 400, 401, 403, 404, 500, </p><p><P>400 = Bad Request. Usually a mangled communication between the browser and server. <br>401 = Authorization Required. If the user cancels a password request, this error is generated. <br>403 = Forbidden. If indexing is turned off, and/or the server can not show/access the directory. <br>404 = Page not found. It ain't there buck-o. <br>500 = Internal Server Error. Mostly likely a script bombed.</p><p><P>Just mockup some pages to explain the error message(s). Add your site navigation and styles so that they look like part of your site. Then add the following to your .htaccess file:</p><p><p></p><pre></p>ErrorDocument 400 /path/to/error-400.html</p>ErrorDocument 401 /path/to/error-401.html</p>ErrorDocument 403 /path/to/error-403.html</p>ErrorDocument 404 /path/to/error-404.html</p>ErrorDocument 500 /path/to/error-500.html</p></pre></p><p><P>Note 1: Make sure you call the error file or script based upon the 'root' of the web domain.</p><p><P>Note 2: Make sure you use hard references to all your images and links (versus relative references).</p><p><P>You can point all or some of the error messages to the same html file. Also you can invoke a script when the error is generated. That way you can dynamically generate the error message or run a 404 URL through an index and offer your visitors a choice of possible similar pages.</p><p><P>e.g.</p><p><P>ErrorDocument 404 /cgi-bin/error.cgi</p><p><P>Apache will have available to your script the following environment variables so that you can use them to generate info back to the browser:</p><p><P>REDIRECT_HTTP_ACCEPT=*/*, image/gif, image/x-xbitmap, image/jpeg <br>REDIRECT_HTTP_USER_AGENT=Mozilla/1.1b2 (X11; I; HP-UX A.09.059000/712) <br>REDIRECT_PATH=.:/bin:/usr/local/bin:/etc <br>REDIRECT_QUERY_STRING= <br>REDIRECT_REMOTE_ADDR=121.345.78.123 <br>REDIRECT_REMOTE_HOST=ooh.ahhh.com <br>REDIRECT_SERVER_NAME=crash.bang.edu <br>REDIRECT_SERVER_PORT=80 <br>REDIRECT_SERVER_SOFTWARE=Apache/0.8.15 <br>REDIRECT_URL=/cgi-bin/buggy.pl</p><p><P>More info:</p><p><P> <a href="http://www.apache.org/docs/mod/core.html#errordocument" target="_new" title="More info on the ErrorDocument directive (opens in new window)">http://www.apache.org/docs/mod/core.html#errordocument </a> <br> <a href="http://www.apache.org/docs/custom-error.html" target="_new" title="More info on custom error pages (opens in new window)">http://www.apache.org/docs/custom-error.html </a>