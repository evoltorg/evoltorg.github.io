---
layout: post
permalink: node/669
ratings: 0
avgrate: 
category: Code
user: AnthonyB
real_name: "Anthony Baratta"
user_biog: "Mutated into a life-size Dilbert doll, Anthony spends the days wedged into his replica of Cardinal Fang\'s Comfy Chair coding solutions to the most thorny of internet software problems."
user_since: 10 Jul 1999
avatar: "/images/pictures/picture-140.jpg"
article_count: 12
excerpt: "Since I park quite a few domains for friends, as well as provide redirection/bounce</p>domains for some companies I many times need to do batches of domains. With the script and</p>template below, you can either pass the script one domain name, or pass it a file that has</p>a list of domai..."
---
<p>Daniel posted his excellent quick and dirty script for adding sites to your Apache Conf</p>File. Here's my quick and dirty script for adding domains to your DNS config files. (My</p>script does not provide the ego boost Daniel's does ;-)</p></p><p><p>Since I park quite a few domains for friends, as well as provide redirection/bounce</p>domains for some companies I many times need to do batches of domains. With the script and</p>template below, you can either pass the script one domain name, or pass it a file that has</p>a list of domain names. The script will then create a named.&lt;domainname&gt; file for</p>each domain and also create an add.named.conf file that you can then manually append to</p>your named.conf file.</p></p><p><p>For my LINUX server, named files reside in /var/named. I created a special</p>sub-directory called 'park' to store all my 'other' domains. I keep all my personal and my</p>personal business domains in /var/named, this allows for less clutter. The script assumes</p>that you set up your parked domains the same. You can edit it to either not do that, or</p>add additional functionality to branch on demand. </p></p><p><p>To use the script below, cut out the <code>new-site.cgi</code></p>and save as a text file in /var/named/park. Verify /usr/bin/perl is your perl5 executable</p>and chmod the file to 700. You should be only playing with these files as root anyway. Cut</p>out the <code>named.template</code> and save as a text file in</p>the same directory as new-site.cgi.</p></p><p><p>For One Domain, To activate: </p><p><ul></p>  <p><code>root@foobar park&gt;./new-site.cgi</p>  newsite.com</code> </p></p></ul></p><p><p>For More than one domain, create a text file with the list of new domains. </p><p><ul></p>  <p>e.g. <code>newsites.file</code><ul></p>    <p>newsite1.com<br></p>    newsite2.com<br></p>    newsite3.com<br></p>    etc.</code> </p></p>  </ul></p></ul></p><p><p>To activate: </p><p><ul></p>  <p><code>root@foobar park&gt;./new-site.cgi -f</p>  newsites.file</code> </p></p></ul></p><p><p>Take the add.named.conf file and append it to your named.conf file. Restart named.</p></p><p><p>Hope this saves you some time and most of all have fun!!.</p></p><p><p><b>new-site.cgi</b></p></p><p><p><code></p><pre></p>#!/usr/bin/perl -w</p>##</p>## Creates a new named file from</p>## named.template and appends info</p>## Does not restart named service!!</p>##</p>## Accepts two types of input</p>## -f &lt;filename&gt;</p>## or</p>## &lt;domainname&gt;</p>##</p>## -f indicates read from file a</p>## list of domain names to process </p>##</p>## &lt;domainname&gt; means just process</p><p>if ($#ARGV &gt; -1) {</p>  if ($ARGV[0] eq &quot;-f&quot;) {</p>    if (open (FILE, &quot;&lt;$ARGV[1]&quot;)) {</p>      while ($ReadLine = &lt;FILE&gt;) {</p>         chomp($ReadLine);</p>        &amp;CreateNameDFile($ReadLine);</p>        &amp;AddToNameDConfig($ReadLine);</p>      } # end while (&lt;FILE&gt;)</p>      close (FILE);</p>      } else {</p>        print &quot;Could not open $ARGV[1] </p><p>&quot;;</p>        exit;</p>    } # end if (open (FILE, &quot;&lt;$ARGV[1]&quot;)</p>    } else {</p>      if ($ARGV[0] ne &quot;&quot; &amp;&amp; $ARGV[0] ne &quot;</p>&quot; ) {</p>      &amp;CreateNameDFile($ARGV[0]);</p>      &amp;AddToNameDConfig($ARGV[0]);</p>    } else {</p>      print &quot;no arguments given...</p>&quot;;</p>      print &quot; use -f \&lt;filename&gt; or</p>&lt;domainname&gt;</p><p>&quot;;</p>      exit;</p>    } # end if ($ARGV[0] ne &quot;&quot; &amp;&amp; $ARGV[0] ne &quot;</p>&quot; </p>  } # end if ($ARGV[0] ne &quot;-f&quot;)</p>} else {</p>  print &quot;no arguments given...</p>&quot;;</p>  print &quot; use -f \&lt;filename&gt; or &lt;domainname&gt;</p><p>&quot;;</p>  exit;</p>} # end if ($#ARGV &gt;0)</p>&lt;/small&gt;</p>&lt;small&gt;sub CreateNameDFile {</p>  $varNewFileName = &quot;named.&quot; . &quot;$_[0]&quot;;</p>  open (TEMPLATE, &quot;&lt;./named.template&quot;);</p>  open (DUMP, &quot;&gt;./$varNewFileName&quot;);</p>  while ($Line = &lt;TEMPLATE&gt;) {</p>    $Line =~ s/replaceme/$_[0]/g;</p>    print DUMP $Line;</p>  } # end while (&lt;TEMPLATE&gt;)</p>  close (DUMP);</p>  close (TEMPLATE);</p>  print &quot;Completed new named file for $_[0] </p>&quot;;</p>} # end sub CreateNameDFile</p><p>sub AddToNameDConfig {</p>  open (DUMP, &quot;&gt;&gt;./add.named.conf&quot;);</p>  print DUMP &quot;zone \&quot;$_[0]\&quot; {</p>&quot;;</p>  print DUMP &quot; type master;</p>&quot;;</p>  print DUMP &quot; file \&quot;park\/named.&quot; . &quot;$_[0]&quot; .</p>&quot;\&quot;;</p>&quot;;</p>  print DUMP &quot;};</p><p>&quot;; </p>  close (DUMP);</p>  print &quot;Added $_[0] info to add.named.conf file. </p><p>&quot;;</p>} # end sub AddToNameDConfig</p><p></p>exit;</p></pre></code></p></p><p></p><p><p><b>named.template</b></p></p><p><p><code><pre>;</p>*********************************************************** </p>; *** Master DNS file for Your Sub-Domain *** </p>; *********************************************************** </p>; </p>; NOTE: This file should only contain records for  </p>; the foo.com domain. You must set up a  </p>; separate master file for each zone. </p>;  </p>; </p>; *********************************************************** </p>; </p>; The $ORIGIN is added to any domain name that  </p>; does not end in a dot (&quot;.&quot;). </p>; </p>$ORIGIN replaceme. </p>; </p>; </p>; *********************************************************** </p>; </p>; SOA record with recommended configuration values </p>; </p>@ IN SOA ns.replaceme. hostmaster.replaceme. ( </p>199901173 ; Serial Number (YYYYMMDDN) </p>10800 ; Refresh </p>3600 ; Retry </p>3599999 ; Expire </p>86400 ) ; Minimum </p>; </p>; </p>; *********************************************************** </p>; </p>; NS record for primary name server </p>; </p>@ IN NS ns.replaceme.  </p>; </p>; </p>; *********************************************************** </p>; </p>; Have you contacted the administrator of ns.foo.net. </p>; to ask if they are secondary for this zone? </p>; If so, uncomment this NS line for the secondary name server. </p>; </p>;@ IN NS ns.foo.net.  </p>; </p>; </p>; *********************************************************** </p>; </p>; MX record </p>; </p>; Mail Server </p>@ IN MX 10 mail.replaceme.  </p>; *********************************************************** </p>@ IN A 192.168.0.1  </p>mail IN A 192.168.0.1  </p>www IN A 192.168.0.1  </p>ns IN A 192.168.0.1  </p>ftp IN A 192.168.0.1 </p></pre></code></p></p><p><p><b>example add.named.conf file</b></p></p><p><p></p><pre></p>zone &quot;foobar.org&quot; {</p>type master;</p>file &quot;park/named.foobar.org&quot;;</p>};</p><p>zone &quot;foo.com&quot; {</p>type master;</p>file &quot;park/named.foo.com&quot;;</p>};</p></pre></p>