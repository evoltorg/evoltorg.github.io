---
layout: post
permalink: node/23170
---
<p>Not so long ago, I got introduced to server side scripting for websites. I \n  really began to enjoy myself. I could create my HTML and go around embedding \n  my neat little &lt;%%&gt; asp tags. Man... it was fun. Then came a time when \n  the client wanted me to change some of the visual design. &quot;Just move \n  this image from over here to there...&quot; That's when my nightmares began.</p>\n<p>It turned out to be an experience just about as pleasant as piercing needles \n  through your eyes. Somewhere down the line my embedded ASP got jumbled. Something \n  had to be wrong with what I was doing. </p>\n<p>I needed a framework that would allow:</p>\n<ul>\n  <li>Single point of modification for templates on a site</li>\n  <li>Some kind of templating. I didn't want to use templating features of a specific \n    HTML editor, since a lot of the time I end up editing html manually</li>\n  <li>Separate ASP from HTML</li>\n  <li>Allow reusability.</li>\n</ul>\n<h2>Some Nuclear Physics</h2>\n<p>The first part of our technique is basically about breaking up an HTML page \n  into usable bits, when we need to display it on the website (some HTML Fission).</p>\n<p>The second part is about rejoining the various bits, when we need to see the \n  HTML as a whole (some HTML Fusion).</p>\n<h2>Fission</h2>\n<p>Why do I breakup a decent HTML page into pieces? There are quite a few advantages \n  to this. For one, most websites have a common look and feel throughout, but \n  when the look does need to change I would like to make it in 1 place.   Sometimes \n  only small things need to be changed like a navigation menu moving from the \n  left hand side of the page to the right hand side. And many times the only  thing different \n  between look and feel of pages is something technically minor like the banner \n  table being a 3-column table instead of a single column table, I didn't want \n  to maintain a duplicate of the page template just to accommodate stuff like\nthis.</p>\n<p>There are  additional advantages to this scheme. It's very easy to provide \n  additional features like &quot;print version&quot; and also hidden/alternate \n  navigation on specific pages. </p>\n<h3>Fissile Material</h3>\n<p>A typical page layout for my example would look like:</p>\n<p><img src="images/20519/23170/page_template.gif" width="352" height="151" border="0" alt="image sample page layout" /></p>\n<p>As you can see I have divided the page into manageable tables.</p>\n<p>I break up the page further to my convenience by demarcating specific parts \n  of the page. For example, I mark the starting of the page header into 3 parts in \n  the following way:</p>\n<pre>&lt;!--[_part_start_:000.01.head_beg]--&gt;\n  &lt;html&gt;\n  &lt;head&gt;\n  &lt;title&gt;&lt;!--_VAR_TITLE_--&gt;&lt;/title&gt;\n  &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=iso-8859-1&quot;&gt;\n&lt;!--[_part_start_:000.02.head_scr]--&gt;\n&lt;script&gt;\nfunction dummy()\n{\nreturn 0;\n}\n&lt;/script&gt;\n&lt;!--[_part_start_:000.99.head_end]--&gt;\n&lt;/head&gt; \n</pre>\n<p>As you can see I divided the HTML by using comment tags named in a particular \n  way: <br>\n  <strong><code>&lt;!--[_part_start_:xxx.xx.section_name]--&gt;</code></strong>. \n  I used a naming convention as it allows me to later extract specific sections \n  of this file using regular expressions. There are  certain advantages to \n  using a naming schema based on comment tags. For one, most HTML editors find \n  them palatable and generally don't screw around with them (though personally I\nuse the editor to make the initial layout, after that I hand-edit it...). \n</p>\n<p>There is also a comment called <code>&lt;!--_VAR_TITLE_--&gt;</code> within \n  the <code>&lt;title&gt;</code> tag. I use many of these _VAR_..._ type of comments \n  in the page and I use them as &quot;display&quot; variables. These are searched \n  and replaced at runtime. For example my ASP page replaces the <code>&lt;!--_VAR_TITLE_--&gt;</code> \n  tag with the page title and the <code>&lt;!--_VAR_CONTENT_1_--&gt; </code> with \n  the meat of the content at the time of script execution.</p>\n<h3>Blowin' it up</h3>\n<p>I have been using windows scripting to automate a lot of stuff on my PC, which \n  means I use it again to make a script that would break up the HTML. I make \n  use of the powerful JavaScript regexp object to do this. I execute the script \n  on the layout HTML file in which I have also inserted  my special comments. The <strong>cscript.exe</strong> \n  interpreter that comes installed with windows takes care of interpreting and executing the\nJavaScript. \n  I find windows scripting quite useful when I install ActivePython/Perl. I can even use\nPython or Perl scripts in it.</p>\n<p>I execute my script on the HTML file using a command line syntax similar to \n  this:</p>\n<p><code>d:\files&gt;cscript tools.wsf //job:SplitHtml file.html input_folder</code></p>\n<p>Incidentally the .wsf script file is called a package file and can contain \n  scripts for multiple tasks (or &lt;job&gt; as Microsoft documentation calls it), \n  so the <strong>SplitHtml</strong> is a job in the wsf file. The SplitHtml job executes on the \n  html file and creates multiple text files. The text files are named using the \n  tag we defined the section to be e.g.:<br>\n  For a section that was marked as: <br>\n  <code>&lt;!--[_part_start_:<strong>000.01.head_beg</strong>]--&gt;</code> <br> the HTML code in \n  the section denoted by this comment tag gets extracted to a file called <strong>000.01.head_beg.txt</strong>.</p>\n<p>The SplitHtml script uses regular expression matching to extract the specific \n  _part_start_ sections of the HTML page. The regular expression was defined in \n  Javascript as:<br>\n  <br>\n  <code><strong>re=new RegExp(&quot;\&lt;\!--\\[_part_start_:([0-9]{3}.[0-9]{2}.[A-Za-z_]+)\\]--\&gt;&quot;,&quot;g&quot;);</strong></code> \n</p>\n<p>The script creates  files for every such designated section.</p>\n<p><img src="images/20519/23170/output_files.gif" width="238" height="372" border="0" alt="image of explorer File Listing" /></p>\n<p>I  used a naming scheme for the comment tags, which ensures that the generated \n  text files maintain the same <strong>sequence</strong> as the section dividing comments. Additionally  \n  the naming scheme allows me to add a new section comment without changing or \n  disrupting the existing sequence. For instance if I needed to add some new HTML \n  code between <strong>000.02.head_scr</strong> and <strong>000.99.head_end</strong> \n  (head_end marks the <code>&lt;/head&gt;</code> tag..) sections, I can insert up to\n95 individual \n  parts in between by naming them as 000.03.tag1, 000.04.tag2.....When I sort \n  the files in Windows Explorer by name, they are in exactly the same sequence \n  as the _part_start_ comments were in the originating HTML file. </p>\n<p>Maybe a better method of maintaining the sequence, would be to store the individual \n  splits in a database table. Well, this works for me so I use it.</p>\n<p>My ASP page scripts read the split parts sequentially (discussed later below) \n  and renders the page. </p>\n<p>When I want to see the page as a single HTML file, I again use a windows script \n  called BuildHtml that rebuilds the HTML file from the parts text files. This \n  job uses a very similar syntax to the SplitHtml method. I can also now use any HTML editor to edit the page layout.</p>\n<p>All the source code for SplitHtml &amp; BuildHtml with a couple of other script \n  functions to query display tags &amp; variable tags in a HTML file can be downloaded \n  from: <br> <a title="Download source code for this article as a zip file" href="files/20519/23170/source.zip">source.zip</a></p>\n<h2>Fusion</h2>\n<p>We use some ASP fusion to create our dynamically generated page out of all \n  the pieces we divided our HTML page into. Let's start with the basics. If my \n  ASP page is called <strong>display.asp, </strong> I have a corresponding <strong> \n  definition file</strong> for it called <strong>def.display.asp </strong>. </p>\n<h3>Defining The Ingredients </h3>\n<p>The definition file defines the sequence in which the individual HTML section \n  files (the text files we just created) should be looked up &amp; allows defining \n  of a condition for looking up the section. This file is included at the beginning \n  of every ASP file it defines the structure. For instance when display.asp \n  is executed, the def.display.asp is first executed and a String variable is \n  built which contains the HTML code for the page.</p>\n<p>The def.display.asp file would look something like this:</p>\n  <pre>\n  &lt;%\n/**************************\nSection 1 -- HTML Lookups \n***************************/\n/*now we being lookup the html sections */\n/*this should always be shown..*/\n/*Settings for this page*/\n/*\n  Header section\n  */\n  HtmlLookup(&quot;000.01.head_beg&quot;,true);\n  HtmlLookup(&quot;000.02.head_scr&quot;,true);\n  HtmlLookup(&quot;000.99.head_end&quot;,true);\n  /*\n  Banner section\n  */\n  HtmlLookup(&quot;001.00.body&quot;,true);\n  HtmlLookup(&quot;001.01.banner&quot;,printable());\n  HtmlLookup(&quot;001.02.horiz_nav&quot;,printable());\n  /*\n  Page Vertical Navigation\n  */\n  HtmlLookup(&quot;002.01.main_tbl_begin&quot;,true);\n  HtmlLookup(&quot;002.02.vertical_nav_beg&quot;,true);\n  HtmlLookup(&quot;002.03.vertical_nav&quot;,printable());\n  HtmlLookup(&quot;002.04.vertical_nav_end&quot;,true);\n  HtmlLookup(&quot;002.05.content_begin&quot;,true);\n  HtmlLookup(&quot;002.08.content_end&quot;,true);\n  HtmlLookup(&quot;002.09.main_tbl_end&quot;,true);\n  HtmlLookup(&quot;003.01.footer&quot;,true);\n  HtmlLookup(&quot;009.99.end_page&quot;,true);\n%&gt;\n</pre>\n<p>The HtmlLookup function takes the section name as the 1st parameter (this happens \n  to be the primary name for the text file) and a 2nd parameter which can be used \n  to conditionally display the section. For instance, in the sample with this \n  article I hide a part of the navigation when the page is being viewed in printable \n  mode (I set a page to printable mode by passing a query string parameter).<br>\n  The multiple calls to HTMLLookup builds a string variable with the HTML code \n  for the page. Based on the section name that has been passed the lookup function \n  opens the corresponding .txt file and builds up the HTML.</p>\n  \n<h3>Concocting the page for the final output</h3>\n<p>Now to the structure of our main ASP file display.asp . This page has a few \n  SSI includes, and importantly this is where our main code to pick up the content \n  from a database would reside. The specific content is then updated into the \n  specific comment _VAR_iables I described earlier. I have a helper function called \n  <b>HtmlTransform </b>which takes the _VAR_ variable name as the 1st parameter \n  and the actual content to be displayed in place of that variable as a string \n  parameter. </p>\n<p>In the HtmlTransform function I search and replace every instance of the comment \n  variable with the content string. Which means that I could have _VAR_TITLE_ \n  or any other display tage appearing more than once. My search &amp; replace \n  function would appear as:</p>\n<p><strong><code> replace(strHtml, &quot;\&lt;\!--&quot;+strVariable+&quot;--\&gt;&quot;, \n  strReplace) ;</code></strong></p>\n<p>where strVariable is anything like (_VAR_TITLE_, _VAR_CONTENT_1_ etc.), (the \n  replace function is some code taken from one of the gazillion javascript sites...)</p>\n<p>There is an additional advantage to using a _VAR_ style of variable. For instance \n  if my vertical navigation menu bar (typically on the left or hand side of a \n  page) is not to appear on the print version or a hidden navigation version of \n  the page, I can save the overhead of a lookup to the database for that information \n  (This would be relevant if the menu navigation or any of the display element \n  which is to be hidden in a print version is picked up from a database), by simply \n  checking if the _VAR_ variable for the menu exists in my HTML string. Something \n  like:</p>\n<pre>if (getHtml().indexOf(&quot;&lt;!--_VAR_LEFTMENU_--&gt;&quot;) != -1)\n //only if the HTML string contains a leftmenu display \n //variable pickup the content for it\n{\n strVertMenuOut = LookupFromDatabase();\n }\n</pre>\n<p>So my display.asp script would look something like this:</p>\n<pre>\n&lt;%@ LANGUAGE=JScript%&gt;\n&lt;!--common ssis--&gt;\n&lt;!--#include file=&quot;inc/globvars.asp&quot;--&gt;\n&lt;!--#include file=&quot;inc/funcs.asp&quot;--&gt;\n&lt;!--#include file=&quot;inc/setprintable.asp&quot;--&gt;\n&lt;!--end common includes--&gt;\n&lt;!--page defintion ssi--&gt;\n&lt;!--#include file=&quot;def.display.asp&quot;--&gt;\n&lt;%\n  /*\n  Section 2 -- HTML Transforms \n  */\n  //Code to fetch content from database\n  //Code to fetch stuff like page title etc. \n  var strContent1;\n  var strContent2;\n  //here we just fill with dummy info\n  strContent1 = &quot;&lt;h2&gt;My Content1&lt;/h2&gt;&quot;;\n  strContent2 = &quot;&lt;h2&gt;My Content2&lt;/h2&gt;&quot;;\n  //Code to fetch Navigation menus etc.\n  //.....\n  //again I fill up some dummy links for my vertical menu\n  strVertNav = &quot;&lt;br&gt;&lt;a href=\&quot;http://dir.evolt.org\&quot;&gt; \n  Evolt directory&lt;/a&gt;&lt;br&gt;&lt;a href=\&quot;http://browsers.evolt.org\&quot;&gt;Evolt \n  Browsers&lt;/a&gt;&quot;;\n  //....\n  //.....</p><p>  //begin transforms\n  HtmlTransform(&quot;_VAR_TITLE_&quot;, &quot;HTML Templating sample code&quot;);\n  HtmlTransform(&quot;_VAR_CONTENT_1_&quot;, strContent1);\n  HtmlTransform(&quot;_VAR_CONTENT_2_&quot;, strContent2);\n  HtmlTransform(&quot;_VAR_VERT_NAV_&quot;, strVertNav);\n%&gt;\n  &lt;!--output page html here--&gt;\n  &lt;%=getHtml()%&gt;\n&lt;!--page end--&gt;\n</pre></p><p><h2>Main advantages of this method</h2>\n<ul>\n  <li>Separation of HTML from ASP code</li>\n<li>Splitting of page HTML increases flexibility & makes changes easier</li>\n  <li>Makes creation of print versions, alternate navigations easier </li>\n    \n  <li> Easy to adapt to other non-asp languages (hopefully!)&nbsp; </li>\n</ul></p><p><h2>Some drawbacks of this method</h2>\n<ul>\n  <li>The method is very much dependent on a proper sequential naming scheme for \n    named _part_ comments (I maintain a sequential documented list of _part_ and _VAR_ comments \n    in an excel sheet  just for my reference)</li>\n  <li>Additional Scripts like SplitHtml &amp; BuildHtml need to be used to view \n    the HTML file as a whole when required (and this is dependent on a proper \n    naming scheme)</li> \n<li>There might be a higher performance overhead since all the HTML is looked up and filled in a string and then the named comments replaced </li>\n</ul></p><p><h2>Sample code</h2>\n<p> All the sample ASP &amp; WSF script code with sample files can downloaded \n  from:<br>\n  <a title="Download sample code as zip file" href="files/20519/23170/source.zip">source.zip</a> \n</p></p><p>\n<h2>Related links</h2>\n<p> I found some similar methods &amp; ideas discussed at:<br>\n  <a title="Launches new window" href="http://www.4guysfromrolla.com" target=_blank>4guysfromrolla</a> \n  <br>\n  These are a couple of sites on Windows Scripting that I have found useful:<br>\n  <a title="Launches new window" href="http://www.winscripter.com/" target=_blank>WinScripter.com</a><br>\n  <a title="Launches new window" href="http://communities.msn.com/windowsscript" target=_blank>Ian Morrish's site on Windows scripting</a><br>\n  Just as I was posting this article, I saw this nice article on regex by sprocket:<br>\n  <a title="Links to regex article by sprocket on evolt.org" href="/article/Regular_Expression_Basics/20/22700/index.html">Regular Expression basics</a>\n  </p>