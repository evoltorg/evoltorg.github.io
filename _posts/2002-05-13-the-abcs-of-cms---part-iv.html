---
layout: post
permalink: node/26773
ratings: 8
avgrate: 3.8750
user: Jay Blanchard
real_name: "Jay Blanchard"
user_since: 2001-03-21
avatar: "/images/pictures/picture-9186.jpg"
article_count: 6
excerpt: "Those following the series have come a long way in understanding the theory and practical application of a Content Management System. In this article we go further up the workflow chain, having an editor review the article."
---
<h2>A Little Story</h2></p><p><p></p>The first content management system I ever created (in 1996) wasn't called a content management system. It was called an automatic article posting script (AAPS), except it wasn't all that automatic. I am sure that many web developers during that time period wrote something similar to reduce the flow of information across their desks. Here was the &quot;workflow&quot;;</p></p></p><p><ul></p><li>An author wrote an article using a plain text editor</li></p><li>The author uploaded the file to a specific directory via FTP</li></p><li>The author sent an email to an editor about the article</li></p><li>The editor either telneted in and edited the article using vi, emacs, or pico OR downlaoded the text file via FTP, edited the file, and uploaded it via FTP.</li></p><li>Once uploaded, the editor could go to a web form, select the text file, input a title, teaser and author information, and then process the article (via a neat little Perl script);</li></p>	<ul></p>	<li>The script opened an existing template and rewrote the template, adding the stuff the editor entered, as well as stuff from the text file, line by line, placing proper &lt;h&gt; and &lt;p&gt; tags where needed.</li></p>	<li>The that file was saved with a temporary name and then renamed according to the naming convention established by the group using the AAPS. Then it was moved to the proper directory.</li></p>	<li>A copy of the front page of the web site was made, then it was opened by the script. The title (as a link to the newly created HTML article), teaser, and posting time were added to the duplicate home page &quot;template&quot;.</li></p>	<li>The original home page was renamed as <code>index.html.old</code>. Then the (thank goodness for Perl's speed) home page template was renamed <code>index.html</code></li></p>	</ul></p><li><span lang="fr"><em>Voila!</em><span> The article appeared on the front page of the site.</li></p><li>Since there were HTML pages for each article those had to be downloaded and removed from the site time to time, manually.</li></p><li>The front page would have to be manually edited from time to time to remove links to articles</li></p><li>And this is exactly what the site owner wanted at the time!</li></p></ul></p><p><p></p>Occasionally there would be some sort of weird error, like an author not adhering to the established naming conventions or mis-naming his or her text file, causing two HTML pages to be created with the same name, and therefore the same link. Other times the CGI engine would be a little erratic due to server traffic and do funky things to the article. All of this required manual repair. But it worked very well, every day, and served the site for over a year.</p></p></p><p><p></p>The single largest burden carried by members of the site's staff was carried by the editors. Often authors uploaded articles and failed to let editors know in a timely manner. Editors were looking at the upload file from time to time each day to find new articles, sometimes they forgot to delete a file after it was processed, another editor would go through again, re-edit and  re-post the article. This caused email notification to be added to the Perl script (which they did not want originally because authors would often include additional information in their emails to the editors about the article in question).</p></p></p><p><p></p>We have come a long, long way since then!</p></p></p><p><h2>Editing Articles</h2></p><p><p></p>After clearing the login page the editor is sent to <code>editor.php</code> where he or she is presented with navigation suitable for their access level and a list of articles assigned to them at the author level. Similar to the My Articles page, the editor page has links to review articles as well as links to edit the article. Articles are flagged as edited by using the type input box on the form where editing is accomplished. The editor will be given a chance to save the article without forwarding it through the workflow process, or they may go ahead and submit the page as 'edited'. As you will soon see, we will use the 'type' input to progress the article through the completion of the process.</p></p></p><p><p></p>You will have to ask yourself and your client some questions at this point about what the editor will be allowed to do. </p></p></p><ul></p><li><strong>Will an editor also be able to submit articles?</strong> If so you need to give them a link to the article submission page (especially easy if you created that handy-dandy navigation management interface suggested in <a href="/article/The_ABCs_of_CMS_Part_II/20/25272/index.html">Part II</a> of this series).</li></p><li><strong>Do you want them to have access to a list of their articles?</strong> Then there will have to be a 'My Articles' link for the editor.</li></p></ul></p><p></p>While we will not be venturing down those roads in this series, they are questions for which you are equipped to provide solutions. These questions will come up time and again throughout the CMS design process as you move through the workflow (i.e. the persons at this level also need to be able to do these other things, like submit articles).</p></p></p><p><p></p>First, add the navigation items to the table for the editor access level;</p></p></p><p><pre></p>INSERT INTO tblNavigation (URL, accesslevel) VALUES ('&lt;a href="editor.php" title="Edit Articles"&gt;Edit Articles&lt;/a&gt;', 'editor');</p>INSERT INTO tblNavigation (URL, accesslevel) VALUES ('&lt;a href="eduser.php" title="Edit User Information"&gt;Edit User Information&lt;/a&gt;', 'editor');</p></pre></p><p><p></p>Let's get the editing process started with <code>editor.php</code>;</p></p></p><p><pre></p>&lt;? session_start(); ?&gt;</p>&lt;?</p><p></p>//connect to and select database</p>if(!($dbconnect = mysql_pconnect("127.0.0.1", "cms_user", "cms_password"))){</p>	print("Failed to connect to database!</p>");</p>	exit();</p>	}</p>if(!mysql_select_db("cms", $dbconnect)){</p>	print("Failed to select database!</p>");</p>	exit();</p>	}</p><p>//query to get navigation from database</p>$qnav = "SELECT URL ";</p>$qnav .= "FROM tblNavigation ";</p>$qnav .= "WHERE accesslevel = '$level' ";</p><p>if(!($dbnav = mysql_query($qnav, $dbconnect))){</p>	print("MySQL reports: " . mysql_error() . "</p>");</p>	exit();</p>	}</p><p>//query to get article information</p>$qart = "SELECT a.ID, a.title, a.publish, a.author, a.editor, a.type, a.submitted, u.email, u.name ";</p>$qart .= "FROM tblArticle a, tblUser u ";</p>$qart .= "WHERE a.editor = u.name ";</p><p>if(!($dbart = mysql_query($qart, $dbconnect))){</p>	print("MySQL reports: " . mysql_error() . "</p>");</p>	exit();</p>	}</p><p>?&gt;</p>&lt;html&gt;</p>&lt;head&gt;</p>&lt;title&gt;CMS&lt;/title&gt;</p>&lt;LINK REL="StyleSheet" HREF="cms.css" type="text/css"&gt;</p>&lt;/head&gt;</p>&lt;body&gt;</p><p>&lt;div class="left"&gt;</p>&lt;?</p>while($dbrow = mysql_fetch_object($dbnav)){</p>	print($dbrow->URL . "&lt;br&gt;</p>");</p>	}</p>?&gt;</p>&lt;/div&gt;</p><p>&lt;div class="right"&gt;</p>&lt;?</p>$dbartrow = mysql_fetch_object($dbart);</p><p>if($dbartrow->ID == ""){</p>	//if there are no articles for this editor</p>	print("There are no articles assigned to you currently in the Content Management System");</p>	}</p>else </p>	{</p>	//print article links for this editor</p>	mysql_data_seek($dbart, 0);</p>	print("&lt;h3&gt;Welcome " . $dbartrow->name . "&lt;/h3&gt;</p>");</p>	print("These are the articles currently assigned to you for editing;&lt;br&gt;&lt;br&gt;</p>");</p>	while($dbartrow = mysql_fetch_object($dbart)){</p>		if($dbartrow->type != "edited"){</p>			print("&lt;a href=\"artprvw.php?aid=" . $dbartrow->ID . "\"&gt;" . $dbartrow->title . "&lt;/a&gt; ( &lt;a href=\"edart.php?aid=" . $dbartrow->ID . "\"&gt;Edit&lt;/a&gt; ) Submitted: " . $dbartrow->submitted . "&lt;br&gt;</p>");</p>			}</p>		}</p>	}</p>?&gt;</p>&lt;/div&gt;</p>&lt;/body&gt;</p>&lt;/html&gt;</p></pre></p><p><p></p>Just as we did with the authors there is a way for the editor to preview the article, by clicking on its title, or a way to edit the article. Also note that to the right of each article's information is the date that the article was submitted for editing, and is ordered in such a way as to show articles that have been in the queue longest at the top of the list.</p></p></p><p class="side" style="padding:5px;"></p><strong>Note: </strong>No form validation has been undertaken in this series so as not to distract from the primary purpose of basic design of a CMS from the ground up. You can consider some of these items, such as submission date, to be covered in training [&quot;If you fail to enter the submission date when submitting an article it will fall later on the editor's to-do list."], or you can programatically handle these items.</p></p></p><p><p></p>Here is the <code>edart.php</code> page where the editor actually does the editing;</p></p></p><p><pre></p>&lt;? session_start(); ?&gt;</p>&lt;?</p>//connect to and select database</p>if(!($dbconnect = mysql_pconnect("127.0.0.1", "cms_user", "cms_password"))){</p>	print("Failed to connect to database!</p>");</p>	exit();</p>	}</p>if(!mysql_select_db("cms", $dbconnect)){</p>	print("Failed to select database!</p>");</p>	exit();</p>	}</p><p>//query to get navigation from database</p>$qnav = "SELECT URL ";</p>$qnav .= "FROM tblNavigation ";</p>$qnav .= "WHERE accesslevel = '$level' ";</p><p>if(!($dbnav = mysql_query($qnav, $dbconnect))){</p>	print("MySQL reports: " . mysql_error() . "</p>");</p>	exit();</p>	}</p><p>//query to get article information</p>$qart = "SELECT a.ID, a.title, a.author, a.teaser, a.body ";</p>$qart .= "FROM tblArticle a ";</p>$qart .= "WHERE a.ID = $aid ";</p><p>if(!($dbart = mysql_query($qart, $dbconnect))){</p>	print("MySQL reports: " . mysql_error() . "</p>");</p>	exit();</p>	}</p><p>//place database items in variables for easier manipulation</p>$dbartrow = mysql_fetch_object($dbart);</p>$atitle = $dbartrow->title;</p>$aauthor = $dbartrow->author;</p>$ateaser = $dbartrow->teaser;</p>$abody = $dbartrow->body;</p><p>?&gt;</p>&lt;html&gt;</p>&lt;head&gt;</p>&lt;title&gt;CMS&lt;/title&gt;</p>&lt;LINK REL="StyleSheet" HREF="cms.css" type="text/css"&gt;</p>&lt;/head&gt;</p>&lt;body&gt;</p><p>&lt;div class="left"&gt;</p>&lt;?</p>// list the nav links for this type of user</p><p>while($dbrow = mysql_fetch_object($dbnav)){</p>	print($dbrow->URL . "&lt;br&gt;</p>");</p>	}</p>?&gt;</p>&lt;/div&gt;</p><p>&lt;div class="right"&gt;</p><p>&lt;h1&gt;Edit An Article&lt;/h1&gt;</p><p>&lt;form action="cmsedit.php" method="POST"&gt;</p>&lt;table cellpadding="3" cellspacing="0" border="1"&gt;</p>&lt;tr&gt;</p>&lt;td&gt;Article Title&lt;/td&gt;</p>&lt;input type="hidden" name="aid" value="&lt;? print($aid) ; ?&gt;"&gt;</p>&lt;td&gt;&lt;input type="text" name="title" size="64" maxlength="64" value="&lt;? print($atitle); ?&gt;"&gt;&lt;/td&gt;</p>&lt;/tr&gt;</p>&lt;tr&gt;</p>&lt;td&gt;Author &lt;/td&gt;</p>&lt;td&gt;&lt;? print($aauthor) ?&gt;&lt;/td&gt;</p>&lt;/tr&gt;</p>&lt;tr&gt;</p>&lt;td&gt;Article Teaser&lt;/td&gt;</p>&lt;td&gt;&lt;textarea name="teaser" cols="50" rows="3" wrap="virtual" maxlength="255"&gt;&lt;? print($ateaser); ?&gt;&lt;/textarea&gt;&lt;/td&gt;</p>&lt;/tr&gt;</p>&lt;tr&gt;</p>&lt;td&gt;Article Body&lt;/td&gt;</p>&lt;td&gt;&lt;textarea name="body" cols="50" rows="25" wrap="virtual"&gt;&lt;? print($abody); ?&gt;&lt;/textarea&gt;&lt;/td&gt;</p>&lt;/tr&gt;</p>&lt;tr&gt;</p>&lt;td&gt;Article Status&lt;/td&gt;</p>&lt;td&gt;&lt;input type="text" name="type" size="32" maxlength="32" value="edited"&gt;&lt;/td&gt;</p>&lt;/tr&gt;</p>&lt;tr&gt;</p>&lt;td&gt;</p>&lt;/td&gt;</p>&lt;td valign="top"&gt;</p>&lt;input type="submit" name="action" value="Save"&gt;&lt;br&gt;</p>&lt;input type="submit" name="action" value="Submit Article"&gt;&lt;br&gt;</p>&lt;input type="submit" name="action" value="Reject Article"&gt;&lt;br&gt;</p>&lt;input type="reset"&gt;</p>&lt;/td&gt;</p>&lt;/tr&gt;</p>&lt;/table&gt;</p>&lt;/form&gt;</p>&lt;/div&gt;</p>&lt;/body&gt;</p>&lt;/html&gt;</p></pre></p><p><p></p>You will see that there are options for the editor to save, submit, and now 'reject' the article, plus one other piece of input; the Article Status. Article Status will be set to 'edited' and saved in the database only when the editor submits the article further up the workflow process. Later we will change this bit of data to indicate where the article is in the workflow process. We will explore this further after we create <code>cmsedit.php</code>.</p></p></p><p><pre></p>&lt;? session_start(); ?&gt;</p>&lt;?</p>//connect to and select database</p>if(!($dbconnect = mysql_pconnect("127.0.0.1", "cms_user", "niicms"))){</p>	print("Failed to connect to database!</p>");</p>	exit();</p>	}</p><p>if(!mysql_select_db("cms", $dbconnect)){</p>	print("Failed to select database!</p>");</p>	exit();</p>	}</p><p>// perform action based on which button was pushed on submit form</p>switch($action)</p>{</p>	case "Save":</p>	// query to insert saved elements only</p>	$qsave = "UPDATE tblArticle ";</p>	$qsave .= "SET title = '$title', ";</p>	$qsave .= "teaser = '$teaser', ";</p>	$qsave .= "body = '$body' ";</p>	$qsave .= "WHERE ID = '$aid' ";</p><p>	if(!($dbsave = mysql_query($qsave, $dbconnect))){</p>		print("MySQL reports: " . mysql_error() . "&lt;br&gt;</p>");</p>	exit();</p>	}	</p><p>	break;</p><p>	case "Submit Article":</p>	//query to submit article</p>	$qsubmit = "UPDATE tblArticle ";</p>	$qsubmit .= "SET title = '$title', ";</p>	$qsubmit .= "teaser = '$teaser', ";</p>	$qsubmit .= "body = '$body', ";</p>	$qsubmit .= "type = '$type' ";</p>	$qsubmit .= "WHERE ID = '$aid' ";</p><p>	if(!($dbsubmit = mysql_query($qsubmit, $dbconnect))){</p>		print("MySQL reports: " . mysql_error() . "&lt;br&gt;</p>");</p>	exit();</p>	}</p><p>	//select admin information and send an email</p>	$qadmin = "SELECT email ";</p>	$qadmin .= "FROM tblUser ";</p>	$qadmin .= "WHERE accesslevel = 'admin' ";</p><p>	if(!($dbadmin = mysql_query($qadmin, $dbconnect))){</p>		print("MySQL reports this: " . mysql_error() . "&lt;br&gt;</p>");</p>	exit();</p>	}</p><p>	//message to admin</p>	$dbadmin = mysql_fetch_object($dbadmin);</p>	$messadmin = "The following article, $title, has been edited.</p>";</p>	$messadmin .= "Please review this article at your earliest convenience.</p><p>";</p><p>	mail("$dbadmin->email", "CMS Article Submission", $messadmin, "From: CMS System");</p><p>	break;</p><p>	case "Reject Article":</p><p>	//query to clear editor field</p>	$qclearedit = "UPDATE tblArticle ";</p>	$qclearedit .= "SET editor = NULL ";</p>	$qclearedit .= "WHERE ID = '$aid' ";</p><p>	if(!($dbclearedit = mysql_query($qclearedit, $dbconnect))){</p>		print("MySQL reports this: " . mysql_error() . "&lt;br&gt;</p>");</p>	exit();</p>	}</p><p>	//message to author</p>	$messauthor = "The following article, $title, has been rejected by your editor.</p>";</p>	$messauthor .= "Please contact your editor to determine the necessary</p>";</p>	$messauthor .= "measures to prepare the article for publication.</p><p>";</p><p>	mail("$author", "CMS Article Submission", $messauthor, "From: CMS System");</p>	</p>	break;</p>}</p>header("Location: editor.php"); exit; 	</p>?&gt;</p></pre></p><p><p></p>Let's have a look at a couple of things. First, the code following <code>case "Save":</code> saves only the title, teaser, and body of the article, no flag is set for the Article Status field, even though the word &quot;edited&quot; appears in the form. This allows an editor to work on an article a little bit at a time, until editing duties are complete.</p></p></p><p><p></p>If the article is submitted the title, teaser, and body are updated and the Article Status flag <code>$type</code> is set to &quot;edited&quot;. This removes the article from editor.php and sends an email to the administrator, informing admin that there is an article waiting for approval. You can add a field to the edart.php for the entry of an approval or admin's so that an admin can be selected (depending on workflow needs). This is similar to how we selected an editor earlier.</p></p></p><p><p></p><strong>Ah rejection!</strong> If the article is rejected the editor is set to NULL and an email will be sent to the author informing them. You could include a field in the editing form for editor's comments or have the author contact his editor via email. Once the article is rejected it appears again in the My Articles page for the author.</p></p></p><p><h2>Sharpening The System</h2></p><p><p></p>Thus far in the series there has be a lot of information to absorb and process, no doubt leading to many other ideas for how to use and how to code various features for your CMS and other web-based applications. Approval duties will be covered next as we move the article through the workflow process, plus we will begin to explore other ideas and improvements that could be made to the system we are using as our model.</p></p>