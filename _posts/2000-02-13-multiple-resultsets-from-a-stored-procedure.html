---
layout: post
permalink: node/773
ratings: 0
avgrate: 
user: mbusa
real_name: "Michael A"
user_since: 13 Feb 2000
avatar: ""
article_count: 1
excerpt: "	In Cold Fusion, and in ASP (using ADO), you can call one stored procedure, and get back multiple resultsets, as long as the database can provide them. One such database is MSSQL7.0.  Advantages to "
---
<p></p>    In Cold Fusion, and in ASP (using ADO), you can call one stored procedure, and get back multiple resultsets, as long as the database can provide them. One such database is MSSQL7.0. <p> Advantages to returning multiple resultsets: - Reduce network traffic slightly, in that your script only makes the ODBC / ADO / OLEDB call once instead of 6 times for 6 resultsets. - have one procedure that collects all data required for a given web page. </p></p><p> Difference Between CF and ASP: - In CF the code is still pretty clean. You assign a query name to each of the returned resultsets and can access them out of order if you want.</p></P></p><p><p>- In ASP w/ADO, you access the first, then the second, then the 3rd, etc... and (AFAIK) there's no going back to the previous set.</p></p><p><h3>Sample code for CF: </h3></p><code></p><pre></p>&lt;CFSTOREDPROC  </p>    PROCEDURE=&quot;spMyProcName&quot;  </p>    DATASOURCE=&quot;myDataSource&quot;  </p>    USERNAME=&quot;myusername&quot;  </p>    PASSWORD=&quot;mypassword&quot;  </p>    RETURNCODE=&quot;Yes&quot;&gt;  </p>        &lt;CFPROCPARAM  </p>            TYPE=&quot;In&quot;  </p>            CFSQLTYPE=&quot;CF_SQL_VARCHAR&quot;  </p>            DBVARNAME=&quot;@myname&quot;  </p>            VALUE=&quot;#session.myname#&quot;  </p>            NULL=&quot;No&quot;&gt;  </p>        &lt;CFPROCPARAM  </p>            TYPE=&quot;In&quot;  </p>            CFSQLTYPE=&quot;CF_SQL_VARCHAR&quot;  </p>            DBVARNAME=&quot;@targetname&quot;  </p>            VALUE=&quot;#session.targetname#&quot;  </p>            NULL=&quot;No&quot;&gt;  </p>        &lt;CFPROCPARAM  </p>            TYPE=&quot;Out&quot;  </p>            CFSQLTYPE=&quot;CF_SQL_VARCHAR&quot;  </p>            DBVARNAME=&quot;@NewKey&quot;  </p>            CFVARNAME=&quot;MyNewKey&quot;  </p>            NULL=&quot;Yes&quot;&gt;  </p><p>&lt;!--- List of results ---&gt; </p><p>    &lt;CFPROCRESULT  </p>        NAME=&quot;firstresult&quot;&gt;  </p>    &lt;CFPROCRESULT  </p>        NAME=&quot;secondset&quot;  </p>        RESULTSET=&quot;2&quot;&gt;  </p>    &lt;CFPROCRESULT  </p>        NAME=&quot;thirdset&quot;  </p>        RESULTSET=&quot;3&quot;&gt;  </p>    &lt;CFPROCRESULT  </p>        NAME=&quot;fourthset&quot;  </p>        RESULTSET=&quot;4&quot;&gt;  </p>    &lt;CFPROCRESULT  </p>        NAME=&quot;fifthset&quot;  </p>        RESULTSET=&quot;5&quot;&gt;  </p>    &lt;CFPROCRESULT  </p>        NAME=&quot;sixthset&quot;  </p>        RESULTSET=&quot;6&quot;&gt;  </p>    &lt;CFPROCRESULT  </p>        NAME=&quot;seventhset&quot;  </p>        RESULTSET=&quot;7&quot;&gt;  </p>    &lt;CFPROCRESULT  </p>        NAME=&quot;eighthset&quot;  </p>        RESULTSET=&quot;8&quot;&gt;  </p>&lt;/CFSTOREDPROC&gt;  </p></pre></p></code></p><p><P></p>... you use the query like this:</p></p><p></p>    <code></p>        &lt;CFOUTPUT QUERY="firstresult"&gt; </p>        ... your code here ...  </p>        &lt;/CFOUTPUT&gt; </p>    </code></p></p></p><p><h3>ASP Sample Code:</h3> </p><p><P></p>For those of you have have Visual Basic or the ADO SDK, please see the ADO help file, click 'Jump to URL' from the command menu, type:</p></p><p><code>mk:@MSITStore:C:\Program%20Files\Common%20Files\System\Ado\ado210.chm::/htm/mdmthnextrecx.htm</code></p></p></p><p>(or just look up the keyword 'Nextrecordset')</p></p></p><p><P></p>For the benefit of others, here's the jist of it: (although their example shows 2 Select statements instead of one stored proc, I prefer using a stored proc)</p></p></p><p><code></p><pre></p>Dim rstCompound as ADODB.Recordset ...</p>Set rstCompound = New ADODB.Recordset rstCompound.Open &quot;SELECT * FROM authors; &quot; &amp; _ &quot;SELECT * FROM stores; &quot; &amp; _ &quot;SELECT * FROM jobs&quot;, strCnn, , , adCmdText</p><p>intCount = 1 Do Until rstCompound Is Nothing </p>Debug.Print &quot;Contents of recordset #&quot; </p>&amp; intCount Do While Not rstCompound.EOF Debug.Print , rstCompound.Fields(0), _ rstCompound.Fields(1) rstCompound.MoveNext Loop Set rstCompound = rstCompound.NextRecordset intCount = intCount + 1 Loop  </p><p></pre></p></code></p><p><p>I highly recommend leaving as much of the database logic, and the selects, on the database in stored procedures. You'll be giving your DBA more work that's they're really good at, and freeing up the web developer to be doing more creative web stuff. </p></p><p><p>Michael.</p>