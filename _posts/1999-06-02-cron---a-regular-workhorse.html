---
layout: post
permalink: node/125
ratings: 4
avgrate: 4.2500
user: MartinB
real_name: "Martin Burns"
user_since: 26 Apr 1999
avatar: "/images/pictures/picture-32.jpg"
article_count: 143
excerpt: "So, you can write CGI scripts. And they get kicked off when a user goes to your page, and fills in a form. But what if you want to have things going on even if you don't get any users? What if you waBut what if you want to have things going on even if you don't get any users? What if you want to run"
---
<p></p>So, you can write CGI scripts. And they get kicked off when a user goes to your page, and fills in a form.</p></p></p><p><p></p>But what if you want to have things going on even if you don't get any users? What if you want to run a big database job nightly, ready for your first morning's visitor? Or maybe you want to have an autoresponder check a POP box every few minutes, and fire out appropriate response emails?</p></p></p><p><p></p>If you're on a Unix-type server, you're in luck. *nix can kick off your script at any given time interval, without your intervention, and we're going to show you how, using an autoresponder Perl script as an example.</p></p></p><p><h2>What you'll need:</h2></p><p><ol type="1" start="0"></p> 	<li>A Unix (including Linux) web server where your scripts are living;</li></p> 	<li>Telnet access to that server (shouldn't be a problem - try throwing your Telnet application at www.yourdomain.com using the user ID & password you use for FTP);</li></p> 	<li>A text editor and FTP application;</li></p> 	<li>A non-paranoid sysadmin who hasn't disabled cron - if they let you install your own CGIs, you'll probably be OK.</li></p> 	<li>For the demo script we're using, you'll need Perl, with the Mail::POP3 module, a POP box which the module can access and sendmail access (ask your sysadmin about these).</li></p> 	<li>Two beers (80/- from Edinburgh's <a href="http://www.caledonian-brewery.co.uk/eighty.htm" target="blank">Caledonian brewery</a> recommended).</li></p></ol></p><p><h2>So what is Cron?</h2></p><p><p></p>It's a process that's running all the time on the server. What it does is continuously check through each user's list of scheduled jobs, and if one's due to run, it runs it. The lists are called <strong>Crontabs</strong>, and can contain any Unix command, including running a script. You can edit your Crontab directly, which can be quick and dirty, or you can take the easier method of submitting a text file instead. As I'm all for an easy life, we'll be using the second method.</p></p></p><p><h2>The demo script</h2></p><p><p></p>OK, <a href="http://www.easyweb.co.uk/tutorials/autoresponder.txt" target="_blank">here</a>'s the Perl script we'll be running. It checks the POP box which bots@easyweb.co.uk throws mail into, gets any mail, and emails the sender back an appropriate message, depending on the incoming email's subject. If you want to use this, then you're welcome, but remember to tell people where you got it ;-)</p></p></p><p><p></p>Install this script, as normal, making sure it's executable, and take a note of the <strong>full path</strong> to it (it might be something like <code>/home/yourlogin/cgi-bin/autoresponder.cgi</code>).</p></p></p><p><p></p>You'll now need to test that the script works. Email the mailbox, then telnet into your server, and (assuming that your script is living in the cgi-bin subdirectory of your space), enter the following commands:</p></p></p><p><pre></p> cd cgi-bin</p> autoresponder.cgi</p></pre></p><p><p></p>All things being equal, you should get an email back, and you can crack open your first beer.</p></p></p><p><h2>Setting up the Cron job</h2></p><p><p></p>Now you have a working script, you'll need to kick it off fairly frequently. We'll be keeping a balance between not overloading the server (keeping your sysadmin and users happy), while still having it run often enough, we'll run the job every 5 minutes.</p></p></p><p><h3>Crontab format</h3></p><p><p></p>The general format for Crontabs is:</p></p></p><p><pre></p>minute hour day month weekday command</p></pre></p><p><p></p>Note that</p><ul type="disc"></p> 	<li><code>hour</code> in 24 hour format</li></p> 	<li>0 is Sunday, 6 is Saturday for <code>day</code></li></p> 	<li><code>command</code> can be any system command, or the full path to a user script</li></p></ul> </p></p></p><p><p></p>So to have my script (which is at /home/web3060/cgi-bin/autoresponder.cgi) running at 9:10pm on 30th September, I'd use</p></p></p><p><pre></p>10 21 30 9 * /home/web3060/cgi-bin/autoresponder.cgi</p></pre></p><p><p></p>The other 2 things you need to know is that an asterisk in any field means all values, so <code>0 23 * * * /usr/local/bin/disktidy</code> will run at eleven PM every night, <code> 0 23 1 * * command </code> will run at eleven PM every 1st of the month, <code> 15 5 * * 1 command </code> will run at 5:15 am every Monday etc, and that if you want more than one value in a field, separate them by commas (remember not to put a space within a field, or the system will get confused). This means that to fire our script every 5 minutes every hour, every day, every month, we'll need the following:</p></p></p><p><pre></p>0,5,10,15,20,25,30,35,40,45,50,55 * * * * /full/path/to/autoresponder.cgi</p></pre></p><p><p></p>Copy the above, crack open that text editor and paste it in - replacing <code>/full/path/to/autoresponder.cgi</code> with the equivalent for your system &#151; save it as autoresp.ctb and FTP the file into your own space (your home directory for preference).</p></p></p><p><p></p>Now telnet into your webspace and enter your Crontab command by entering the following:</p></p></p><p><pre></p>crontab autoresp.ctb</p></pre></p><p><p></p>You can check that this has worked by entering <code> crontab -l </code> which should give back a list containing the Crontab entry above (y'know - 0,5,10 etc). One more command which you might like to take a note of now is <code> crontab -r </code> which removes your Crontab, so you can back out your change if needed.</p></p></p><p><p></p>Now all you have to do is run your test. Email the mailbox, and sit back for 5 minutes or so. Your server might not the job <strong>exactly</strong> at the time specified (and if you've specified an hour of day, beware of timezones too), as it considers background jobs like this as less important than other stuff it's doing, like delivering web pages to users who think every second counts. But after a few minutes you should get an email back. Congratulations! You can crack open that other beer safe in the knowledge that you can now do stuff that 90% of other web designers can't.</p></p>