---
layout: post
permalink: a_quick_and_dirty_css_hack_png_backgrounds
---
<p>With the expanding support for PNG, it has become more and more frustrating to be prevented by IE's lack of support to fully use PNGs. We will try to find a way to bypass IE's limitations (until the next vesion comes out and hopefully solves the problem) by showing it what it can display, and by giving PNGs to more modern browsers.</p></p><p><h2>Quick definitions</h2></p><p><dl>\n<dt>PNG</dt>\n<dd>Portable Network Graphics. This format was designed as a means to replace GIF, originally because of a royalty question. But it expands GIF's transparency capacity by managing full 256-level alpha-transparency. See the <a href="http://www.w3.org/Graphics/PNG/">W3C's recommendation</a>.</dd>\n<dt>GIF</dt>\n<dd>Graphics Interchange Format</dd>\n<dd>This format is not royalty-free, and has limitations. Yet it has been a <i>de facto</i> standard for transparent images on the web since the 89a implementation.</dd>\n<dt>CSS</dt>\n<dd>Cascading Stylesheets. But you knew that, didn't you?</dd>\n</dl></p><p><p>For a more detailed description of the technical aspects of both, please refer to <a href="http://evolt.org/article/To_PNG_or_not_to_PNG/22/60134/index.html">To PNG or not to PNG</a>.</p></p><p><h2>The situation at hand</h2></p><p><p>So, Internet Explorer does not manage PNGs but you would very much like to have a nifty semi-transparent background to blend it better with your background. So far the solutions for IE have mainly involved Javascript, as a simple javascript alpha transformation method (see the example below), or more subtly, as a behavior method after the example of <a href="http://webfx.eae.net/dhtml/pngbehavior/pngbehavior.html" title="a tutorial on how to change the behavior of PNGs in IE">WebFX</a>.</p></p><p><h3>A 'simple' javascript alpha transformation method: too many drawbacks!</h3></p><p><p>This is what I found, with the help of the <a href="http://fr.groups.yahoo.com/group/pompeurs/" title="french-speaking mailing-list equivalent of evolt's thelist" hreflang="fr">Pompeurs mailing-list</a>: Internet Explorer can replace a background by another, and in the process get the exact alpha transparency for each pixel of the new background image. Then it applies a filter and gives the expected result: alpha-transparency!</p></p><p><pre>\n// this function finds the 'logo' element in my HTML and replaces its background</p><p>function init() {\n  // is the browser competent with the DOM?\n  if(document.getElementById) {\n    // is the browser capable of managing runtimeStyle?\n    // (this would mean, basically, "hey, I'm IE")\n    if(document.getElementById('logo').runtimeStyle) {\n      // delete current background\n      document.getElementById('logo').style.backgroundImage = 'none';\n      // apply PNG background with alpha transparency filtering\n      document.getElementById('logo').style.filter = "progid:DXImageTransform.Microsoft.AlphaImageLoader(src='logo.png',sizingMethod='scale')";\n    }\n  }\n}</p><p>window.onload=init;</pre></p><p><p>But there are serious drawbacks with this method, which I have learnt the hard way:</p>\n<ul>\n<li>It relies on the <code>onload</code> event handler. And of course many people will not end the loading properly, for various reasons: they can have a bad connection that interrupts the download, they can stop it themselves because the page is crammed with images and they're only interested in the text, not the pictures, etc.</li>\n<li>Some browsers understand some but not all of the code. Opera 6 on my machine shows nothing at all, there's a block somewhere and I haven't found where yet (and won't look for a solution either, because of what I just said about relying on <code>onload</code>).</li>\n</ul></p><p><h2>Hacks are to be avoided, yet they're sometimes unavoidable</h2></p><p><p>I fully endorse Peter-Paul Koch's statement: <a href="http://digital-web.com/columns/keepitsimple/keepitsimple_2003-11.shtml" title="a 'Keep it simple' column">Keep CSS Simple</a>! For those of us who have been in the web trenches for a few years, hacking around one browser's limitations reminds us of countless nights writing proprietary javascript, proprietary tags, multiple versions of a given page, and whatnot. Yet like with many things in life, simple hacks are sometimes unavoidable; but in this case they should be as limited as possible: extensive hacking means sleepless nights, trust us.</p></p><p><p>There are simple and not-so-simple ways to hide <strong>some</strong> CSS to <strong>some</strong> browsers, mainly based on their flawed implementation of constantly-improving <a href="http://www.w3.org/Style/CSS/" title="the W3C's official page: your starting point on CSS">CSS standards</a>. There are even pretty complete lists of more or less ugly hacks based on commenting and commenting-into-comments, backslashing, etc. See <a href="http://centricle.com/ref/css/filters/" title="a compendium of many hacks and which browsers do what">Centricle's CSS filters chart</a> for a pretty thorough example.</p></p><p><p>What? Did I say "ugly" a second ago? Sorry to sound pejorative. I meant it is going quite difficult to maintain and re-read your CSS in a few months' time when you write this: <code>/*/*//*/property:value;/* */</code> or that: <code>/*/*/property:value;/* */</code>. You have to write extensive documentation and keep it at hand, right?</p></p><p><p>OK, hacks are ugly, but here is a simple one I found while dealing with the issue: IE (like all the old browsers) does not understand <a href="http://www.w3.org/TR/REC-CSS2/selector.html#child-selectors" title="W3C's explanation">child selectors</a> (the <code>&gt;</code> character). So let's give IE what it wants: a GIF background. More modern browsers will display the PNG, because one expects them to both understand the child selector and be able to display PNGs properly.</p></p><p><p>What about this piece of CSS code:</p></p><p><pre>\n/* this line give you a nice, if less sexy, GIF background */\ndiv.bg_hack { background:url('ceci_est_un_gif.gif') no-repeat top left transparent; }</p><p>/* PNG power! */\nbody > * div.bg_hack { background:url('ceci_est_un_png.png') no-repeat top left transparent; }</pre></p><p><p>Here is the <a href="http://notabene.f2o.org/misc/evolt/png_css_hack/example.htm" title="example of this hack">GIF/PNG background hack in action</a>.</p></p><p><h3>Side note</h3>\n<p>Since I came up with this idea, an article about <a href="http://alistapart.com/articles/cssdropshadows/" title="read the article at ALA">CSS drop shadows</a> was published on A List Apart that uses IE's inability to understand the <code>!important</code> CSS statement. Fair enough, it's yet another way to do the same thing. But for the sake of readability I prefer to stick to the child-selector for the time being.</p></p><p><h2>Conclusion</h2>\n<p>Of course this is a hack, so it can generate problems on its own. Non-flat-colored backgrounds can show the rugged edges of the GIF in Internet Explorer (this is what I show in my example, see the <a href="http://notabene.f2o.org/misc/evolt/png_css_hack/example.htm#funky" title="groovy!">funky part</a> of the page. And either because of <a href="http://www.petitiononline.com/msiepng/petition.html" title="Proper PNG Support in Internet Explorer for Windows Petition">petitions</a>, or because people at Microsoft are clever and will modify subsequent versions of IE, or just because history will force them to do so (and this is not the place to discuss this), one day or another we may end up finding this hack unnecessary.</p>\n<p>Until then, this will do the trick, in my book.</p></p><p><h3>Afterword</h3>\n<p>Please feel free to report any weird behavior. So far I have tested it with Opera, Mozilla, IE5.5/Win and it behaves like it should. I have no access to Safari, for example, but I hear its CSS support is excellent.</p>