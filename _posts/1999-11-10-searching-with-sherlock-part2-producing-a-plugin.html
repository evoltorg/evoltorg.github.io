---
layout: post
permalink: node/559
ratings: 0
avgrate: 
user: MartinB
real_name: "Martin Burns"
user_since: 26 Apr 1999
avatar: "/images/pictures/picture-32.jpg"
article_count: 143
excerpt: "Now that you've seen what Sherlock can do, it's time to think about how you can use it to drag Mac users to your site by producing a plugin."
---
<p>Now that you've seen what Sherlock can do, it's time to think about how you can use it to drag Mac users to your site by producing a plugin. For this tutorial, we'll look at the process I went through to produce the plugin for <a href="http://evolt.org/" title="[thesite]">evolt.org</a>.</p></p><p><p>Plugins are very, very simple. All they are are text files with HTML-like commands which tell Sherlock how to get and parse a search results page. All the user has to do is drop the file into their System Folder, and the next time they fire up Sherlock, your site is one of the options they'll have.</p></p><p><h2>What you'll need</h2></p><p><ol></p>	<li><strong>A site with a search engine</strong><br></p>	Sherlock is just an interface which throws queries at search engines and presents the results. If you don't have a search engine, you're a bit screwed.</p>    <li><strong>A Macintosh computer, with OS8.5 or later</strong><br></p>    Sorry about this, but you're going to be creating special file formats which Windows doesn't do, and you'll need Sherlock for testing, of course</p>    <li><strong>A text editor</strong><br></p>    I use BBEdit, but we're not doing enormous files with extensive validation, so SimpleText would do</p>    <li><strong>A utility to change the file type</strong><br></p>    The classic one is ResEdit (which also has uses for creating custom icons, which we'll go into next time), but simpler and safer is a Contextual Menu Module called <a href="http://www.vcnet.com/hide/download/mfi.html" target="_new" title="More File Info home page">More File Info</a>. This is the one I'll use for this tutorial. If you know how to use ResEdit, you won't need the demonstration, so can get on with it yourself.</p></ol></p><p><h2>Getting started</h2></p><p><p>First go to the search page of your site, and save the source. Then enter a query, and save the source of the results page. These two HTML files are the absolute core of producing the plugin. This is because the plugin does two things for you - punches the data from the search form into the engine, and interprets the results for you.</p></p><p><p>Next, we'll have a look at the code for thesite's plugin:</p></p><p><pre># Created by evolt.org, with help from </p># apple-donuts.com</p><p> &lt;search</p> name = &quot;thesite.evolt.org&quot;</p> method = POST</p> action = &quot;http://www.evolt.org/index.cfm?menu=11&quot;</p> update = &quot;http://www.easyweb.co.uk/tutorials/thesite.evolt.org.src.hqx&quot;</p> updateCheckDays = 3</p> &gt;</p> &lt;input name=&quot;criteria&quot;  accesskey=&quot;s&quot; user&gt;</p> &lt;input type=&quot;Submit&quot; name='Submit' value=&quot;go&quot;&gt;</p> &lt;input name=&quot;MaxRows&quot; value='15'&gt;</p> &lt;interpret</p> resultListStart = &quot;&lt;!-- start sherlock --&gt;&quot;</p> resultListEnd = &quot;&lt;!-- end sherlock --&gt;&quot;</p> resultItemStart=&quot;&lt;TR bgcolor=&quot;</p> resultItemEnd=&quot;&lt;/TR&gt;&quot;</p> relevanceStart=&quot;0.&quot;</p> relevanceEnd=&quot;&amp;nbsp;&quot;</p> &gt;</p> &lt;/search&gt;</p> </pre></p><p><h2>Part A - submitting the query</h2></p><p><p>The first part of the plugin replicates the HTML form. It has to duplicate the fields, but nominate one as the prime one for user entry, as Sherlock only has one entry field. Here's the HTML of the search form (formatting & text removed for clarity):</p></p><p><code>&lt;form action="index.cfm?menu=11" method="POST"&gt;<br></p>&lt;input type="Text" title="criteria" size="10"  accesskey="s"&gt;<br></p>&lt;input type="Submit" value="go"&gt;</code></p><p><p>What we have to do is tell Sherlock to replicate this. So we take it, and put into Sherlock-ese, into a bunch of &lt;input&gt; tags, and the properties of the &lt;search&gt; tag:</p></p><p><code>method = POST</code></p><p><p>This is whatever method that the form uses. Evolt.org's engine uses POST, so that's what we'll use.</p></p><p><code>action = &quot;http://www.evolt.org/index.cfm?menu=11&quot;</code></p><p>...and this is where it posts it. Taken straight from the form.</p></p><p><code>  &lt;input name=&quot;criteria&quot;  accesskey=&quot;s&quot; user&gt;</code></p><p>The 'user' property tells Sherlock that this is where the input field is put. Not being a ColdFusion person, I haven't a clue what the accesskey=&quot;s&quot; bit does, but it was in the form, so I'm not removing it (actually, I did try removing it, and the plugin stopped working, so working on the &quot;if it ain't broke, don't fix it&quot; theory, I recommend leaving well alone).</p></p><p><code> &lt;input type=&quot;Submit&quot; name='Submit' value=&quot;go&quot;&gt;</code></p><p>This is again straight from the form.</p></p><p><code> &lt;input name=&quot;MaxRows&quot; value='15'&gt;</code></p><p>This is an extra one, pinched from the version on the results page. Our search engine has the ability to specify how many results it returns, defaulting to 10. I thought that was a bit on the low side, so pushed it up to 15.</p></p><p><h3>The other properties in this bit of the plugin are:</h3></p><p><code> name = &quot;thesite.evolt.org&quot;</code></p><p>This is the name that Sherlock will use in the dialogue box, so it's a good idea to use it to give people an idea of what they're searching. You can also create custom icons, but that's beyond the scope of this tutorial.</p></p><p> <code>update = &quot;http://www.easyweb.co.uk/tutorials/thesite.evolt.org.src.hqx&quot;<br></p> updateCheckDays = 3</code></p><p>This tells Sherlock where to look for new versions of the plugin. After all, if you change how your search engine works, you'll need to change the plugin, and it's a <em>real</em> pain to find out everyone who's got a copy, and email it to them, with instructions for installation. This way, Sherlock will check the URL at the interval specified in updateCheckDays, and download and reinstall any updated versions it finds.</p></p><p><h2>Part B - interpreting the results</h2></p><p><p>The rest of the plugin is all about interpreting what the search engine returns. Remember that as far as the search engine is concerned, Sherlock is just another browser. It's received the query over HTTP, just as if you'd hit 'Submit' yourself, and returns the results as HTML. What you have to do is work out a consistent way of telling</p></p><p><ol></p><li>Where the list starts and ends</li></p><li>Where each result starts and ends</li></p><li>Where any relevence score starts and ends for each result</li></p></ol></p><p><p>If you've produced the search engine yourself, life's a bowl of cherries. You can have a results page which marks each point with HTML comments, or you can even do what Altavista do, and produce a <a href="http://www.altavista.com/cgi-bin/query?pg=q&sc=on&q=evolt.org&kl=XX&stype=stext&user=sherlock" target="_new" title="Note the 'user=sherlock' bit at the end of the URL">special version for Sherlock</a>, so average users don't even see this.</p></p><p><p>For the evolt.org search engine, I don't have access to the ColdFusion template the search engine uses, so in the time between proposing this series, and writing it, only limited changes were made. So I had to work round the problems. By the time you read this, more changes may have been made, so you'll be using a more recent version of the plugin which uses them. If you've already downloaded the original plugin, you'll be automatically updated (see above - I told you it was useful).</p></p><p><p>The interpretation information is all held as properties within an &lt;interpret&gt; tag.</p></p><p><h3>Spotting the list</h3></p><p><code> resultListStart = &quot;&lt;!-- start sherlock --&gt;&quot;</code></p><p>This tells Sherlock to start parsing here. If you don't have anything obvious, you could just use &lt;html&gt;. If your plugin doesn't work, this is probably a good default to go back to.</p></p><p><code>resultListEnd = &quot;&lt;!-- end sherlock --&gt;&quot;</code></p><p>Pretty much the same as above, it tells Sherlock that the list is done and not to bother going on from here.</p></p><p><h3>Grabbing each result</h3></p><p><p>Sherlock grabs everything between the markers you specify for the start and end of each result. It puts whatever is the linked text in the list it returns, and displays the full text (less any HTML tags) when you click on one.</p></p><p><code>resultItemStart=&quot;&lt;TR bgcolor=&quot;</code></p><p>Now you'd expect the sensible way to do this is to specify the whole tag which starts each row. However, if you look at the results page, you'll notice that for visual clarity, every other row is a subtly different colour. So we have to end it here. Sherlock will display all the text between here and the resultItemEnd, missing out obvious HTML. So the fact that the result is across several table cells won't make any difference, but we will get the trailing part of the &lt;TR&gt; tag in the result, along with the relevence score. Looks a bit poor, but there's not a lot you can do.</p></p><p><code>resultItemEnd=&quot;&lt;/TR&gt;&quot;</code></p><p>Naturally, this tells Sherlock where the result ends. If you've got a simple list, without irrelevant rubbish in between, you can miss this tag out.</p></p><p><code>relevanceStart=&quot;0.&quot;</code></p><p>Sherlock can interpret relevence scores expressed as numbers from 0-100, and use them as a ranking criteria. Results without relevence scores are ranked as if they have a relevence of 0, so will drop to the bottom of the list. All the major engines provide handy data for Sherlock to work with, so it's really worthwhile doing this if you can.</p></p><p><p>With the evolt.org results list as it stands at the moment, there's no convenient &lt;!-- start relevence --&gt; tag to mark where the relevence score starts. So we have to use a rather clunky workaround. Unless a result is 100% relevent, it will start with '0.' So that's what I've used as an interim measure. Now if you search on 'Oracle', or 'Frames', you'll get a 100% result, and this will appear as if doesn't have a relevence, and will drop to the bottom of the list. At the moment, I have to live with that.</p></p><p><code>relevanceEnd=&quot;&amp;nbsp;&quot;</code></p><p>Guess what? This tells Sherlock that if it hasn't found a number by now, it's not finding one. I could have used &lt;/TD&gt;, but as there's a handy non-breaking space at the end of each score, I might as well use it.</p></p><p><p>And that's pretty much all of your plugin text done. Save the file, and we'll make it work.</p></p><p><h2>Part C - making it work</h2></p><p><p>Unlike Windows machines, which use file extensions to tell the OS what application to open a file in, Macs use a couple of pieces of meta-data bundled into the file; a file type and a file creator. BBEdit uses TEXT/R*ch to save its files; DreamWeaver uses TEXT/DmWr. And Sherlock plugins are all issp/fndf. To hack the meta-data into a format Sherlock will recognise, we're going to use the More File Info CMM. Download the file and drop it into your closed System Folder (the OS will put into the right place). Now control-click onto your plugin file, and <A title='JavaScript popup of a screenshot' HREF="javascript:window.open('http://www.easyweb.co.uk/tutorials/sherlock_cmm.gif','_blank','location=no,scrollbars=no,toolbar=no,width=668,height=439')">go to the appropriate option</a> (the first time you do this, you'll have to go into the 'Other' option and enter 'issr' as the file type and 'fndf' as the creator). The file will then turn into a generic Sherlock icon:<br></p><img src='http://www.easyweb.co.uk/tutorials/sherlock_icon.gif' alt='Sherlock plugin icon'></p></p><p><p>Your new plugin should be good to go now. Drop it into your System Folder and test it. All things being equal, it should work a treat. BinHex it with <a href='http://www.aladdinsys.com/' title='You can download it from here' target="_new">StuffIt Lite</a> and you can stick it on your site as a download.</p></p><p><p>And that's about it. In a wee while, Part 3 of 2 will go into a bit more detail on some of Sherlock's advanced features, which will allow you to specify a banner to appear at the bottom of the Sherlock window.</p>