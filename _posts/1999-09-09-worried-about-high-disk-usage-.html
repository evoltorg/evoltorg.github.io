---
layout: post
permalink: node/429
ratings: 1
avgrate: 3.0000
category: Backend
user: mashton
real_name: "Mike Ashton"
user_biog: ""
user_since: 30 Aug 1999
avatar: 
article_count: 2
excerpt: "Well if your running on a *nix box then here is</p>a little cron job that will warn you when usage</p>gets high!"
---
<p></p>Well if your running on a *nix box then here is</p>a little cron job that will warn you when usage</p>gets high!</p></p></p><p><p></p>Now assuming you're root, create a sub-dir called</p>scripts.</p></p></p><p><p></p>In this directory place the following script</p>and data files.</p></p></p><p><pre></p>===========df.script===============</p>#!/bin/bash</p>PATH=/sbin:/usr/sbin:/usr/bin:/bin</p>cd /root/scripts</p>if test `df &#124; fgrep -c -f</p>/home/mashton/df.txt` -eq 0</p>then</p>&nbsp;exit 0</p>else</p>&nbsp;df &#124; mail &quot;$1&quot; -s</p>DANGER_HIGH_DISK_USAGE</p>fi</p>===========df.script===============</p></pre></p><p><p></p>The script is executing df (which displays your</p>disk usage), and pipes it through fgrep (which</p>scans the output line by line).  I've used the -c</p>(which counts the number of matches) and -f (which</p>tells fgrep to get the matching data from a</p>file).</p></p></p><p><p></p>The if condition tests for a value of 0 (no</p>matches) being returned by the fgrep. If 0 exit</p>else run df and email it to whoever you pass thru</p>from the command line (see crontab below).</p></p></p><p><pre></p>===========df.txt===============</p>104%</p>103%</p>102%</p>101%</p>100%</p>99%</p>98%</p>97%</p>96%</p>95%</p>94%</p>93%</p>92%</p>91%</p>90%</p>89%</p>88%</p>87%</p>86%</p>85%</p>84%</p>83%</p>82%</p>81%</p>===========df.txt===============</p></pre></p><p><p></p>Now in the data file I've set what I want fgrep</p>to match for. As you can see I'm testing for</p>anything greater then 80% usage.</p></p></p><p><p></p>This gives you ample time to either clean up or</p>plan for another drive, before you get into the</p>90% range. Since, this is where *nix filesystem</p>performance starts to slow down.</p></p></p><p><p></p>Also the reason for going to beyond 100% is</p>that typically a *nix filesystem has an overflow</p>buffer which allows for more then 100%</p>capacity. There is typically up to an extra 8% not</p>reported.</p></p></p><p><p></p>Remember to do a change mod on the df.script so</p>it will run!</p></p></p><p><p></p>Now just add it to your crontab and your ready</p>to go!</p></p></p><p><p></p>Just do: crontab -e</p></p></p><p><p></p>Then insert a line for when you want it run (I</p>run mine every half hour and send the failure</p>email to alternating people) and whoever you want</p>it sent to.</p></p></p><p><pre></p>=========crontab insert===========</p>15 * * * * /root/scripts/df.script bryan &amp;&gt;</p>/dev/null</p>45 * * * * /root/scripts/df.script mike &amp;&gt;</p>/dev/null</p>=========crontab insert===========</p></pre></p><p><p></p>By setting this up you can avoid a sudden</p>suprise and having your system crap out on</p>you!</p></p></p><p><p>Mike</p>