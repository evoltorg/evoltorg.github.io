---
layout: post
permalink: node/578
---
<p> So you got yer NT box, yer IIS server, and yer ASP pages humming quietly in the back room fer what seems like days now after the sudden explosion in traffic over the weekend that made you tune the box because a) you ran out of memory, b) the processor got stuck at 100% because of some problem the IT guys haven't patched, c) ASP processing was dog slow because you didn't have enough script engines cached and/or allocated, or d) all of the above or something else. <br><BR> You've even learned some good Performance Monitor counters to pay attention to, like number of ASP requests queued, total processor utilization, current number of ASP sessions, and a couple others. But you hate having to manually go look at them every once in a while, cause you hafta get up from your seat and walk down the hall, er something. <BR><BR> My dear friend, take advantage of the Alerts page in Performance Monitor and some VBScript you've probably already written. On the Alerts page you specify a counter (like ASP requests queued) and a threshold (like 10) and a program to kick off when it happens (you got it, like a program you write using some VBScript). You can take some ASP code you probably have laying around --you know, that little routine that sends an email?-- and turn it into a <a href="http://msdn.microsoft.com/scripting/">WSH</a> script that can be fired from a command line (don't worry, I've got code below). The program fired by the alert has to be specified by full pathname, so you know. <BR><BR> Here's the little diddy I have running, and yeah, I use a third party component from Mabry (<a href="http://www.mabry.com/">http://www.mabry.com</a>) to do the mailing. We like Mabry, they're nice. I have the script in the c:\ cause I'm lazy and I didn't want to type long directory paths in the Alerts box. You call it with two parameters, subject line and message text: <code>emailsupport.vbs "This is a Test" "Your server is dying and all you can think about is hockey?"</code> <BR><BR> And now, the code. It took me all of 15 minutes to learn the differences and get parameters passed in. </p></p><p><P><pre> *******BOF*********\n' Don't hang around if there's an error\nOn Error Resume Next</p><p>' What's on the command line --its a Collection, not an array\nSet oArgs = WScript.Arguments\nif oArgs.Count&lt;2 then\n     alert=&quot;test&quot;\n     mesg = &quot;test&quot;\nelse\n'first arg is where from, the second is the message\n    alert=oArgs(0)\n    mesg = oArgs(1)\nend if</p><p>' send the mail with the argument:\nmailAlert alert,mesg</p><p>' now go away\nWScript.Quit</p><p>\nsub mailAlert(byval wherefrom, byval mesg)\nOn Error Resume Next\nMailDstIsHost = 64  ' does this look familiar?\nSet oMail = WScript.CreateObject(&quot;Mabry.MailCtrl&quot;)\n          oMail.Blocking = True\n          ' Set header properties\n          oMail.To = &quot;&lt;sgd@ti3.com&gt;&quot;\n          oMail.From = &quot;&lt;alerts@ti3.com&gt;&quot;\n          oMail.EMailAddress = &quot;&lt;alerts@ti3.com&gt;&quot;\n          oMail.Date = Now\n          oMail.Subject = &quot;Email Alert from &quot; & wherefrom\n          oMail.Body(0) = Now & &quot; : &quot; & mesg\n          oMail.Host = &quot;yourSMTPserverhere&quot;\n          oMail.Flags = MailDstIsHost          ' Connect to server\n          oMail.ConnectType = 0 ' basic SMTP\n          oMail.Connect\n          oMail.WriteMessage MailDstIsHost\n          ' Disconnect\n          oMail.Disconnect\n' instead of Set oMail=Nothing we do this:\nWScript.DisconnectObject oMail</p><p>end sub\n '*************EOF***********\n</pre> </P></p><p> <p> Take it and run, I implore you </p>  <P>