---
layout: post
permalink: Making_clean_URLs_with_Apache_and_PHP
---
<p>\nNowadays we almost systematically create database-generated websites. <acronym title="Universal Resource Locators">URLs</acronym>  are thus written on-the-fly and we usually call pages through query string, like:<br>\n<code title="http://example.com/index.php?type=article&amp;id=25&amp;date_written=20020322">http://example.com/index.php?type=article&amp;id=25&amp;date_written=20020322</code>.\n</p></p><p><p>\nWhat I call &quot;clean&quot; URLs is what you can see on <a href="http://evolt.org/" target="_blank" title="you are here - opens in a new window">evolt.org</a>, for instance. In my example the URL would be:<br>\n<code title="http://example.com/article/200203226">http://example.com/article/200203226</code>. \n<p></p><p><p>\nLet us assume that this article was the 6th written on the 22nd of march, 2002 and that we store this info in our database, see below, <a href="#structuring_your_data" title="internal link">Structuring your data</a>). The purpose of this article is to show you how to switch from the former to the latter with <a href="http://httpd.apache.org/" target="_blank" title="World-leading web server - opens in a new window">Apache</a> and <a href="http://www.php.net/" target="_blank" title="server-side language - opens in a new window">PHP</a> through a simple example.\n</p></p><p><p>\nNote: there's nothing polemic about this &quot;clean&quot; qualification. Anybody who finds a better name is welcome to use it instead...\n</p></p><p><h2>What's the use of switching from query strings to &quot;clean&quot; URLs?</h2></p><p><p>\nDropping query strings and using these so-called &quot;clean&quot; URLs:\n</p></p><p><ul>\n  <li><strong>Enables indexing by search engines</strong>. As you probably know, \n    when a search engine spiders your site and finds a query string it stops. \n    After all, how on earth can the robot know that all the pages are not the \n    same with just a different parameter passed to the page: what's the difference \n    between <code>index.php?type=article&amp;id=25</code> and <code>index.php?style=red</code>? \n    How can one expect a search engine to <em>know</em> the difference?</li>\n  <li><strong>Makes for more perennial URLs</strong>. As Tim Berners-Lee himself \n    explained in <a href="http://www.w3.org/Provider/Style/URI.html" target="_blank" title="opens in a new window">Cool \n    URIs don't change</a>, <cite>&quot;It is the duty of a Webmaster to allocate \n    URIs which you will be able to stand by in 2 years, in 20 years, in 200 years&quot;.</cite> \n    You can see where we're aiming at.</li>\n  <li><strong>Doesn't expose the server-side language</strong> in which you developed \n    the site: No extension is provided, thus enabling you to switch from one server-side \n    technology to another without generating multiple <dfn title="document not found">404 \n    errors</dfn>. Moreover, as a side note, it's a bit more secure because it \n    will take potential attackers more time to know what language you're using \n    (but don't have too many illusions about that, the solution will eventually \n    be found...)</li>\n</ul></p><p><p>\nNeed we say more?\n</p></p><p><h2><a name="structuring_your_data"></a>Structuring your data: creating unique identifiers</h2></p><p><p>\nFirst and foremost, think of the data stored. You have to be able to give a unique identifier to each article. So instead of (or in addition to) using an incremental <code>id</code> you must think of a unique, not-to-be-changed-in-the-future identifier.\n</p></p><p><p>\nMy method in our example is this: create a field <code>uniqid</code> and give it the date concatenated with the rank of creation within the day. In my example my article's <code>uniqid</code> is <code>200203226</code> (the article was the 6th created on the 22nd of March, 2002). Of course one can imagine a situation where only one article is written per day. Thus maybe this <code>uniqid</code> field is redundant if you store the date the article was written. Or it can be YYYYMMDDHHmmss to have the whole date and no rank. [insert here any other naming method you like].\n</p></p><p><p>\nNote: there are many other ways to store your articles. Maybe they're each in their own text file in a dedicated <code>includes</code> directory and then you call them through an inclusion, maybe they're extracted from an XML file, etc. That's why I'm not too specific on the storage of data here.\n</p></p><p><h2>The 'article' file: parsing the URL</h2></p><p><p>\nNow we will create the <code>article</code> file using standard PHP code, even if, as you noticed, the file has no <code>.php</code> extension. We'll come back to this issue below, in <a href="#apache_forcetype" title="internal link">Using Apache's ForceType</a>. Here's the code for our <code>article</code> file:\n</p></p><p><pre>&lt;?php\n    /* 1. parse the URL */\n    $expl = explode(&quot;/&quot;,$HTTP_SERVER_VARS[&quot;REQUEST_URI&quot;]);\n    $article_id = $expl[count($expl)-1];</p><p>    /* 2 security check */\n    [omitted for the sake of simplicity]</p><p>    /* 3 populate the page with uniqid's content */\n    [omitted for the sake of simplicity]\n?&gt;</pre></p><p><p>Here's how it works:</p></p><p><ol>\n  <li>Parse the URL (<code>REQUEST_URI</code>) by <a href="http://www.php.net/manual/en/function.explode.php" target="_blank" title="explode() - opens in a new window">exploding</a> \n    it, fetch the results in an array (<code>$expl</code>) and assing to <code>$article_id</code> \n    the last occurence of the explosed array.</li>\n  <li>Check any security needed and stop the code on error. There's no reason \n    to parse the page any further if what's passed to <code>$article_id</code> \n    is not correct. In particular we'll check the following: \n    <ul>\n      <li>Is <code>$article_id</code> valid? Does it really correspond to the \n        format I'm looking for? For instance if I'm looking for a number of the \n        form 'YYYYMMDDr' ('r' is the 'rank' in my example, remember?) and <code>$article_id</code> \n        is a string (ie. 'foobarwhatever'), then there's something rotten in the \n        kingdom of URLs.</li>\n      <li>Does <code>$article_id</code> compare to an existing value of <code>uniqid</code>?</li>\n      <li>In the case of a database-driven site: is there any database code passed \n        through <code>$article_id</code> that could damage the database? Think \n        of <code>drop table</code> instructions, for example.</li>\n      <li>[insert here any other security check you find necessary]</li>\n    </ul>\n  </li>\n  <li>Populate the page with the content corresponding to the <code>uniqid</code> \n    equal to <code>$article_id</code>.</li>\n</ol></p><p><h2><a name="apache_forcetype"></a>Using Apache's ForceType</h2></p><p><p>\nAt first I tried creating &quot;clean&quot; URLs and redirecting them through 404 errors to the index.php, for example, which would then parse the URL and write the page accordingly. I ran into unsuspected trouble checking my system with <a href="http://browsers.evolt.org/?lynx/" target="_blank" title="Lynx is a text-based browser - opens in a new window">Lynx</a>: a 404 error is an error (yeah, right). So I guessed search engines would stop on this error. Damn. My world domination (&copy; <a href="http://www.glassdog.com/" target="_blank" title="nothing to do with the subject at hand but clever person, this Lance - opens in a new window">glassdog</a>) scheme goes down the drain.\n</p></p><p><p>\nEnter <code>ForceType</code>. This Apache directive forces the server to consider a file as being of another type than what is expected by default (see Apache's documentation on <a href="http://httpd.apache.org/docs/mod/mod_mime.html#forcetype" target="_blank" title="opens in a new window">ForceType</a>).\n</p></p><p><p>\nWe will now use the <code>&lt;FilesMatch&gt;</code> directive to specify which file is to be considered as a PHP file and not a plain ol' text file, which is the default on most servers (see Apache's documentation on <a href="http://httpd.apache.org/docs/mod/core.html#filesmatch" target="_blank" title="opens in a new window">&lt;FilesMatch&gt;</a>).\n</p></p><p><p>\nDon't worry: even if you can't configure Apache directly because your hosting provider doesn't allow it, I've got good news: you can do it through a <code>.htaccess</code> file.\n</p></p><p><p>\nHere's a sample <code>.htaccess</code> I wrote in my root directory:\n</p></p><p><pre>&lt;FilesMatch &quot;^article$&quot;&gt;\n    ForceType application/x-httpd-php\n&lt;/FilesMatch&gt;</pre></p><p><p>\nThe result is: Accessing <code>http://www.example.com/article/200203226</code> tells the server to consider <code>article</code> as PHP, then parse the URL, and push the content whose <code>uniqid</code> is <code>200203226</code> into the template. And voil&agrave;. We're done.\n</p></p><p><h2>Conclusion</h2></p><p><p>\nTo sum up this very simple example:\n</p></p><p><ol>\n  <li>Call &quot;clean&quot; URLs when writing your code</li>\n  <li>Create as many templates as needed for each type of parsing</li>\n  <li>Specify their type in <code>.htaccess</code></li>\n</ol></p><p><p>\nYour URLs now have a chance to be as permanent as their domain name.\n</p></p><p><p>\nFor more server-side fun, you can include the same template in all the <code>ForceType</code>'d pages so that all the formatting will be written only once. You can also, like often in evolt.org, create longer URLs and parse them as a set of several parameter/value pairs. Be careful with that, though, because you may force search engines to index too many occurences of pages. Oh, well, maybe that's what you want after all...\n</p>