---
layout: post
permalink: clever_php_forms
ratings: 7
avgrate: 3.5714
user: codepo8
real_name: "Chris Heilmann"
user_since: 2002-07-29
avatar: "/images/pictures/picture-35456.jpg"
article_count: 17
excerpt: "Creating forms that check for mandatory fields and highlight them if they are forgotten can be quite a pain. Accessibility tools such as Bobby make it even worse, as they expect an initial value for each element.  Learn how to use two small PHP functions to do this job for you."
---
<h2>The form problem</h2> </p><p><p>Forms have always been a nuisance in Web Development. They need HTML and </p>backend code, render differently on each browser and stubbornly refuse to </p>use styles consistently on browsers. Furthermore their elements </p>send different data and need to be initialised differently depending </p>on what they are.</p></p><p><p>When checking a form for mandatory entries, you often have to re-display</p>the form with the previously entered data, and a highlighted version of </p>the missing form elements. This is hard work, which is why a lot of lazier</p>developers use a Javascript &#34;back&#34; button instead of a scripting solution </p>that highlights the missing mandatory elements.</p></p><p><h2>Repopulating forms with PHP</h2> </p><p><p>In PHP it is rather easy to repopulate a textual form element:</p></p><p><code></p>&#60;input type=&#34;text&#34; </p>  id=&#34;Name&#34; name=&#34;Name&#34; </p>  value=&#34;&#60;?PHP echo $_POST['Name']==''?'':$_POST['Name'];?&#62;&#34; /&#62;</p></code></p><p><p>It is trickier with checkboxes:</p></p><p><code></p>&#60;input type=&#34;checkbox&#34; </p>  id=&#34;Name&#34; name=&#34;Name&#34;</p>  value=&#34;&#60;?PHP echo $_POST['Name']=='on'?'':'checked=&#34;checked&#34;';?&#62;&#34; /&#62;</p></code></p><p><p>Radio buttons and select boxes need a check for each of their options or some</p>Javascript to highlight them. In any case, it is a drag.</p></p><p><h2>Bobby watches you</h2> </p><p><p>This whole dilemma increases when you need to adhere to accessibility </p>standards. Although not really an accessibility problem, online tools</p>such as <a href="http://bobby.watchfire.com/bobby/html/en/index.jsp" </p>title="Link to Bobby, the online accessibility test tool" </p>target="_blank">Bobby</a> moan about form elements that don't have an initial </p>value. To avoid this, designers add a dummy value, that has to be </p>stripped again from the data once the form is submitted. </p></p><p><h2>The wishlist</h2> </p><p><p>You want a function that displays a form element. The element should </p>get a meaningful initial value that does not get submitted in the end.</p></p><p><p>As an extra for Javascript-enabled browsers, text elements should get </p>emptied when you click on them if they contain the initial value.</p></p><p><p>If the element is a mandatory field and is empty, or</p>contains the initial value, it should get highlighted. If the form has to </p>be re-displayed due to some other element missing, the element should display</p>the last submitted value.</p> </p><p><p>The function should do that for text boxes, text areas, checkboxes, </p>radio buttons, and select boxes. Also, it should not change any additional </p>elements and attributes like accesskey, taborder, classes or colgroups.</p></p><p><h2>Function 1: Displaying, initialising and highlighting the form</h2></p><p><pre></p>function add($f){</p>  global $errorindicator,$errorclass,$Javascript;</p>  $tocheck=explode(',',','.$_POST['required']);</p>  preg_match('/id=&#34;(.*?)&#34;/i',$f,$i);</p>  preg_match('/name=&#34;(.*?)&#34;/i',$f,$n);</p>  preg_match('/type=&#34;(.*?)&#34;/i',$f,$t);</p>  preg_match('/value=&#34;(.*?)&#34;/i',$f,$iv);</p>  $n=$n[1];$iv=$iv[1];$i=str_replace('_',' ',$i[1]);</p>  if(preg_match('/&#60;textarea/',$f)){</p>    $v=$_POST[$n]==''?$i:$_POST[$n];</p>    $f=preg_replace('/&#60;textarea(.*?)&#62;(.*?)&#60;\/textarea&#62;/',</p>    '&#60;textarea\\1&#62;'.stripslashes(htmlentities($v)).'&#60;/textarea&#62;',$f);</p>        if($Javascript){$f=preg_replace('/&#60;textarea/',</p>        '&#60;textarea onfocus=&#34;this.value=this.value==\''.</p>        $i.'\'?\'\':this.value&#34;',$f);}</p>  }  </p>  if(preg_match('/&#60;select/',$f)){</p>    preg_match('/&#60;select.*?&#62;/',$f,$st);</p>    preg_match_all('/&#60;option value=&#34;(.*?)&#34;&#62;(.*?)&#60;\/option&#62;/',$f,$allopt);</p>    foreach ($allopt[0] as $k=&#62;$a){</p>      if($_POST[$n]==$allopt[1][$k]    </p>      ($_POST[$n]=='' &#38;&#38; $k==0)){</p>        $preg='/&#60;option value=&#34;';</p>        $preg.=$allopt[1][$k].'&#34;&#62;'.$allopt[2][$k].</p>        '&#60;\/option&#62;/si';</p>        $rep='&#60;option selected=&#34;selected&#34; value=&#34;';</p>        $rep.=$allopt[1][$k].'&#34;&#62;'.$allopt[2][$k].</p>        '&#60;/option&#62;';</p>        $f=preg_replace($preg,$rep,$f);</p>      }</p>    }</p>  }else{</p>    switch ($t[1]){</p>      case 'text':</p>        $v=$_POST[$n]==''?'value=&#34;'.$i.'&#34;':'value=&#34;'.</p>        stripslashes(htmlentities($_POST[$n])).'&#34;';</p>        $f=preg_replace('/&#60;input/','&#60;input '.$v,$f);</p>        if($Javascript){$f=preg_replace('/&#60;input/',</p>        '&#60;input onfocus=&#34;this.value=this.value==\''</p>        .$i.'\'?\'\':this.value&#34;',$f);}</p>      break;</p>      case 'checkbox':</p>        $v=$_POST[$n]=='on'?' checked=&#34;checked&#34;':'';</p>        $f=preg_replace('/&#60;input/','&#60;input'.$v,$f);</p>      break;</p>      case 'radio':</p>        $f=preg_replace('/checked.*?\s/','',$f);</p>        $v=$_POST[$n]==$iv?' checked=&#34;checked&#34;':'';</p>        $f=preg_replace('/&#60;input/','&#60;input'.$v,$f);</p>      break;</p>    }</p>  }</p>  $f.='&#60;input type=&#34;hidden&#34; name=&#34;'.$n.'initvalue&#34; value=&#34;'.$i.'&#34; /&#62;';</p>  if (array_search($n,$tocheck) and ($_POST[$n]=='' or $_POST[$n]==$i)){</p>      if($errorindicator!=''){$f=$errorindicator.$f;}</p>      if($errorclass!=''){$f=preg_replace('/name=/i','class=&#34;'.</p>      $errorclass.'&#34; name=',$f);}</p>  }</p>  return $f;</p>}</p></pre></p><p><p>You can strip the Javascript that automatically clears the initial value when </p>the element gets the focus by not defining the global variable <var>$Javascript</var>.</p></p><p>The global variable <var>$errorindicator</var> can be a text or any </p><acronym title="Hypertext Markup Language">HTML</acronym>, for example an image.</p>The content of this variable will be displayed before each missing mandatory element.</p></p><p>The <acronym title="Cascading Style Sheet">CSS</acronym> class added to each </p>missing field is defined in the global variable <var>$errorclass</var>.</p> </p><p><p>Mandatory elements get defined separated by a comma in a hidden field called</p>&#34;<strong>required</strong>&#34;:</p></p><p><code></p>&#60;input type=&#34;hidden&#34;</p>  name=&#34;required&#34; </p>  value=&#34;Name,SurName,live,message&#34; /&#62;</p></code></p><p><p>The initial value of the form element is defined by its ID. As IDs cannot </p>contain spaces, you need to replace them with underscores. The function </p>removes them automatically. If, for example, you want to display </p>&#34;Please enter your first name&#34; as the initial value  in a text box, </p>use the corresponding ID:</p></p><p><code></p>&#60;input type=&#34;text&#34; </p>  name=&#34;name&#34; </p>  id=&#34;Please_enter_your_first_name&#34; /&#62;</p></code></p><p><p>The function adds hidden fields with the initial values</p>to the form. For the &#34;name&#34; example, this would be:</p></p><p><code></p>&#60;input type=&#34;hidden&#34; </p>  name=&#34;nameinitvalue&#34; </p>  value=&#34;Please_enter_your_first_name&#34; /&#62;</p></code></p><p><p>The <strong>add()</strong> function takes care of the form drawing, the </p>highlighting, and the setting of the initial value.</p></p><p>To use it in a PHP document, you wrap your form elements in it:</p></p><p><pre></p>&#60;form method=&#34;post&#34; action=&#34;&#60;?=$_SERVER['PHP_SELF']?&#62;&#34;&#62;</p>  &#60;input type=&#34;hidden&#34; name=&#34;required&#34; value=&#34;Name,SurName,live,message&#34; /&#62;</p>  &#60;fieldset&#62;</p>    &#60;legend&#62;Identification&#60;/legend&#62;</p>      &#60;label for=&#34;your_name&#34;&#62;Name:&#60;/label&#62;</p>        &#60;?=add('&#60;input type=&#34;text&#34; name=&#34;Name&#34;</p>         id=&#34;Your_Name&#34; /&#62;')?&#62;&#60;br /&#62;</p>      &#60;label for=&#34;your_surname&#34;&#62;Surname:&#60;/label&#62;</p>        &#60;?=add('&#60;input type=&#34;text&#34; name=&#34;SurName&#34;</p>         id=&#34;Your_Surname&#34; /&#62;')?&#62; </p>  &#60;/fieldset&#62;</p>  &#60;fieldset&#62;</p>    &#60;legend&#62;Gender and age&#60;/legend&#62;</p>    &#60;label for=&#34;Age&#34;&#62;Age:&#60;/label&#62;</p>      &#60;?=add('</p>      &#60;select name=&#34;Age&#34;&#62;</p>          &#60;optgroup label=&#34;Non&#173;Teen&#34;&#62;</p>          &#60;option value=&#34;5&#34;&#62;Under 5&#60;/option&#62;</p>          &#60;option value=&#34;9&#34;&#62;Five to Ten&#60;/option&#62;</p>        &#60;/optgroup&#62;</p>        &#60;optgroup label=&#34;Teen&#34;&#62;</p>          &#60;option value=&#34;10&#34;&#62;Aspiring Teen&#60;/option&#62;</p>          &#60;option value=&#34;15&#34;&#62;Mid Teen&#60;/option&#62;</p>          &#60;option value=&#34;19&#34;&#62;End Teen&#60;/option&#62;</p>        &#60;/optgroup&#62;</p>        &#60;optgroup label=&#34;Twen&#34;&#62;</p>          &#60;option value=&#34;20&#34;&#62;Aspiring Twen&#60;/option&#62;</p>          &#60;option value=&#34;25&#34;&#62;Mid Twen&#60;/option&#62;</p>          &#60;option value=&#34;29&#34;&#62;End Twen&#60;/option&#62;</p>        &#60;/optgroup&#62;</p>        &#60;optgroup label=&#34;Above&#34;&#62;</p>          &#60;option value=&#34;30&#34;&#62;30ies&#60;/option&#62;</p>          &#60;option value=&#34;40&#34;&#62;40ies&#60;/option&#62;</p>          &#60;option value=&#34;over50&#34;&#62;Above&#60;/option&#62;</p>        &#60;/optgroup&#62;</p>      &#60;/select&#62;</p>      ')?&#62;</p>    &#60;strong&#62;Gender:&#60;/strong&#62;</p>      &#60;?=add('&#60;input type=&#34;radio&#34; name=&#34;Gender&#34; id=&#34;Male&#34; </p>      checked=&#34;checked&#34; value=&#34;Male&#34; /&#62;')?&#62;</p>      &#60;label for=&#34;Male&#34;&#62;Male&#60;/label&#62;</p>      &#60;?=add('&#60;input type=&#34;radio&#34; name=&#34;Gender&#34; id=&#34;Female&#34;</p>       value=&#34;Female&#34; /&#62;')?&#62;</p>      &#60;label for=&#34;Female&#34;&#62;Female&#60;/label&#62;</p>  &#60;/fieldset&#62;</p>  &#60;fieldset&#62;</p>    &#60;legend&#62;Enter your message&#60;/legend&#62;</p>      &#60;p&#62;&#60;?=add('&#60;input type=&#34;checkbox&#34; name=&#34;live&#34; </p>      id=&#34;live&#34; /&#62;')?&#62;</p>      &#60;label for=&#34;live&#34;&#62;Publish to live&#60;/label&#62;&#60;/p&#62;</p>      &#60;p&#62;&#60;label for=&#34;your_message&#34;&#62;Your Message:&#60;/label&#62;&#60;/p&#62;</p>      &#60;?=add('&#60;textarea name=&#34;message&#34; id=&#34;Your_message&#34;</p>       cols=&#34;30&#34; rows=&#34;10&#34;&#62;&#60;/textarea&#62;')?&#62;</p>  &#60;/fieldset&#62;</p>  &#60;p align=&#34;right&#34;&#62;&#60;input type=&#34;submit&#34; value=&#34;Send&#34; /&#62;&#60;/p&#62;</p>&#60;/form&#62;</p></pre></p><p><p>You need another function to strip these initial values once the form is filled and each </p>mandatory field is filled with something else than its initial value. </p></p><p><h2>Function 2: Checking the form</h2></p><pre></p>function check(){</p>  if ($_POST!=''){</p>    $sentarray=array();</p>    $tocheck=explode(',',$_POST['required']);</p>    $error[0]=&#34;Errors:&#34;;</p>    foreach ($tocheck as $t){if(!array_key_exists($t,$_POST)){</p>    $error[]=$t;}}</p>    foreach (array_keys($_POST) as $p){</p>      if(!preg_match('/initvalue/',$p) and </p>      !preg_match('/required/',$p)){</p>        $sentarray[$p]=$_POST[$p]==</p>        $_POST[$p.'initvalue']?'':$_POST[$p];</p>      }</p>      foreach ($tocheck as $c){</p>        if ($p==$c and $sentarray[$p]==''){</p>          $error[]=$_POST[$p.'initvalue'];</p>        }</p>      }</p>    }</p>    return $error[1]==''?$sentarray:$error;  </p>    }</p>}</p></pre></p><p><p>This function checks the required elements. If all have a value </p>that is different from the initial value, it'll return an array containing</p>only the necessary fields. All the generated initial value fields and </p>the &#34;required&#34; field are stripped out. </p></p><p>If there was a mandatory field that is empty or still has the initial</p>value, the resulting array will have a first element with the value </p>&#34;Errors:&#34;, and a list of all the missing fields as the other array </p>elements.</p></p><p><p>To use the function, you could do something like this:</p></p><p><pre></p>&#60;?PHP</p>  $errorindicator='&#60;img src=&#34;alert.gif&#34; width=&#34;20&#34; height=&#34;20&#34; </p>  alt=&#34;Alert&#34; title=&#34;Indicator for missing form element&#34; border=&#34;0&#34; /&#62;';</p>  $errorclass=&#34;error&#34;;</p>  $Javascript=true;</p>  $results=check();</p>  if($results[0]=='Errors:'){</p>    </p>?&#62;</p>  &#60;h2&#62;There has been an error:&#60;/h2&#62;</p>  &#60;p&#62;You forgot to enter the following field(s)&#60;/p&#62;</p>  &#60;ul&#62;</p>  &#60;?PHP foreach ($results as $i=&#62;$e){if ($i&#62;0){</p>    echo &#34;&#60;li&#62;$e&#60;/li&#62;&#34;;</p>  }}?&#62;</p>  &#60;/ul&#62;</p>&#60;?PHP </p>  }else{</p>  // Add send functionality here</p>  }  </p>?&#62;</p></pre></p><p>That's it. To see the functions in all their glory, and download them with </p>an example, go to the <a href="http://www.onlinetools.org/articles/easyform/" </p> title="To the form example homepage" target="_blank">homepage</a>. Updates and </p>fixes will happen there and be announced in the comments below.</p>