---
layout: post
permalink: Build_a_Rotating_Gallery_With_ColdFusion
ratings: 5
avgrate: 4.4000
category: Code
user: nagrom
real_name: "Morgan Kelsey"
user_since: 09 Feb 2002
avatar: "/images/pictures/picture-21068.jpg"
article_count: 2
excerpt: "This article will show you how to make a database-driven picture gallery that only shows a  number of pictures at a time, regardless of how many records are currently in the database. Each day, the gallery code rotates one old item out and one new item in, which keeps the page fresh and uncluttered."
---
<h2>The Problem:</h2></p><p><p>My client wanted a database-driven picture gallery, but was worried that it would grow out of control, and didn't want to ugly up a page with hundreds of thumbnails. They wanted to show only twelve pictures at a time, and be able to add new items at will. This client sells street rod parts and kits, and their customers love to send in pictures of themselves at the throttles of their T Buckets, popping wheelies in the company parking lot and scaring grandmas.</p></p><p><h2>The Solution:</h2></p><p><p>Only show a certain number of gallery items at a time, rotating through the whole set at some time interval.</p></p><p><p>This article will show you how to make a database-driven picture gallery that only shows a certain number of pictures at a time, regardless of how many records are currently in the database. Each day, the gallery code rotates one old item out, and one new item in. This offers great flexibility for both you the developer, and your clients, as adding new items is as easy as adding records to the database.</p></p><p><h3>Shake that Mody</h3></p><p><p>If we have a large number that increments daily, and we divide it by the number of records in our gallery database, the remainder will tell us the record to start with. For instance, if we count the number of days since Jan 1, 2000 (let's call it the <code>ticker</code>), and we then divide the <code>ticker</code> by the <code>recordcount</code>, the remainder will always be between 0 and one less than the <code>recordcount</code>. Because our <code>ticker</code> will be steadily incrementing (if the sun rises), our remainder will also increment at the same rate. Using this method, we could make the gallery rotate every hour, minute, or second by adjusting how the <code>ticker</code> is calculated.</p></p><p><h2>Getting Started</h2></p><p><p>This example assumes you have a basic understanding of HTML and the ColdFusion language.  ColdFusion Server 5 is now available free to developers, the trial version becomes a single-user license when the 30-day trial expires. You can download it from here: <a href="http://www.macromedia.com/software/coldfusion/downloads/" title="Macromedia ColdFusion Download Page (link opens in a new window)" target="_blank">http://www.macromedia.com/software/coldfusion/downloads/</a>.</p></p><p><p>You'll need <a href="/files/rotating_gallery.zip" title="Rotating gallery article files">this ZIP file</a>.</p></p><p><p>It contains:</p></p><ul></p>  <li><code>rotating_gallery.cfm</code> ColdFusion template</li></p>  <li><code>rotating_gallery.mdb</code> Microsoft Access database</li></p>  <li>26 thumbnails (<code>*.gif</code>)</li> </p></ul></p><p><p>The database contains only one table, named 'gallery'.</p></p><p><p>The fields in it are:</p></p><ul></p>  <li><code>ID</code> (autoincrement, primary key)</li></p>  <li><code>img_thumb</code> - the filename of the image (12.gif)</li></p>  <li><code>img_x</code> - image width</li></p>  <li><code>img_y</code> - image height</li></p>  <li><code>img_title</code> - text to display with this image</li></p></ul></p><p><p>There are 26 records, one for each of the 26 thumbnails.</p></p><p><p>Unzip to a folder mapped to your ColdFusion server. Hit <code>Alt+M</code> in ColdFusion studio to open the mappings window (read the ColdFusion documentation if you need help). You'll also need to create a System DSN named 'rotating_gallery' that points to the access .mdb file. Again, if you need help, try the documentation.</p></p><p><p>Point your browser to the 'rotating_gallery.cfm' file, you should see a small gallery of 12 numbered images, similar to the example from above: <a href="http://www.morgankelsey.com/code/rotating_gallery/" title="Rotating gallery example (link opens in a new window)" target="_blank">http://www.morgankelsey.com/code/rotating_gallery/</a></p></p><p><h2>Get Out Your Airgun </h2></p><p><h3>Let's take a look at 'rotating_gallery.cfm'.</h3></p><p><h4>We start like any other typical HTML page.</h4></p><p><pre>&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</p> &quot;http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd&quot;&gt;</p>&lt;html&gt;</p>  &lt;head&gt;</p>    &lt;title&gt;Rotating Gallery&lt;/title&gt;</p>    &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=ISO-8859-1&quot;&gt;</p>  &lt;/head&gt;</p>&lt;body&gt;</pre></p><p><h4>We run a simple query to retrieve all the records from the gallery table.</h4></p><p><pre>&lt;cfquery name=&quot;qGallery&quot;</p>        datasource=&quot;rotating_gallery&quot;</p>        cachedwithin=&quot;#CreateTimeSpan(0, 0, 10, 0)#&quot;&gt;</p>  SELECT ID</p>       , img_thumb</p>       , img_width</p>       , img_height</p>       , img_title</p>    FROM gallery</p>   ORDER BY ID;</p>&lt;/cfquery&gt;	</p></pre></p><p><h4>Initialize some variables</h4></p><p><pre>&lt;!--- initialize variables ---&gt;</p>&lt;cfset start_day = DateDiff(&quot;y&quot;,&quot;01/01/2000&quot;,Now())&gt;</p>&lt;cfset total_items = 12&gt;&lt;!--- total items to display ---&gt;</p>&lt;cfset start_item = (start_day MOD qGallery.recordcount) + 1&gt;</p>&lt;cfset end_item = start_item + (total_items - 1)&gt;</p>&lt;cfset columns = 4&gt;</p>&lt;cfset col_tick = 0&gt;</p>&lt;cfset count = 0&gt;</p><p>&lt;cfif end_item GT qGallery.recordcount&gt;</p>  &lt;cfset end_item = end_item - qGallery.recordcount&gt;</p>&lt;/cfif&gt;</p></pre></p><p><p>The <code>start_day</code> variable is our ticker value, which we need incremented every day. We use the <code>DateDiff()</code> function to tell us how many days (<code>&quot;y&quot;</code>) have passed since 01/01/2000 and today, and assign it to the variable <code>start_day</code>. This value must be larger than your recordcount, so push the date back if you have a large number of items to cycle through.</p></p><p><p>Set <code>total_items</code> to the total number of items you'd like displayed on the page.  We'll use this variable to determine the stopping point.0</p></p><p><p>The <code>start_item</code> variable will hold the value of the item in the first position. We find it by adding one to the remainder of the <code>start_day</code> variable divided by the recordcount from our query. To find the remainder (or the modulus) of a division equation, we employ the <code>MOD</code> math function. In ColdFusion (5 MOD 2) returns 1, the remainder of 5 / 2. The modulus will always be an integer lower than the divisor. If you think about it, any number divided by 4 will always produce a remainder (or modulus) of 0, 1, 2 or 3.</p></p><p><p>The variable <code>end_item</code> tells us which record to stop at, we can find it easily by subtracting one from the <code>total_items</code> variable and adding that value to the <code>start_item</code> variable.</p></p><p><p>Set the <code>columns</code> variable to the desired number of table columns.</p></p><p><p>We'll increment the <code>col_tick</code> variable as we output the table cells in each row.</p></p><p><p>The <code>count</code> variable will also be incremented, when it reaches the value of our <code>total_items</code> variable, we are at the end.</p></p><p><p>The <code>if</code> statement is there to deal with the overlap from the last record to the first. For instance, if <code>start_item</code> is record 20, and there are only 23 records, when we add 11 we get 31! We'll need to deal with the overlap from the last record to the first. We still need to know what record to stop at, so if the <code>end_item</code> variable is greater than the <code>recordcount</code>, we subtract the <code>recordcount</code> from the <code>end_item</code> value to find the correct <code>end_item</code>.</p> </p><p><p>Now our query has been run and all necessary variables initialized. On with the fun part, building the gallery!</p></p><p><p>We start with a table, and open a row.</p></p><p><pre>&lt;div align=&quot;center&quot;&gt;</p>&lt;table width=&quot;70%&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot;&gt; </p>&lt;tr&gt;</pre></p><p><p>We open a <code>&lt;cfoutput&gt;</code> tag, since we now need to print our variable values to the browser.</p></p><p><pre>&lt;cfoutput&gt;</pre></p><p><p>If our <code>end_item</code> value is higher than the <code>start_item</code>, we can perform a very straightforward output. If not, we must deal with the overlap from the last record to the first record.</p></p><p><pre>&lt;cfif start_item LT end_item&gt;</pre></p><p><p>I'm using the <code>&lt;cfloop&gt;</code> tags below for the clarity that the <code>startrow</code> and <code>endrow</code> attributes provide. However this could also be accomplished with <code>&lt;cfoutput&gt;</code> tags.</p></p><p><p>We set the <code>startrow</code> and <code>endrow</code> attributes to our <code>start_item</code> and <code>end_item</code> values.</p></p><p><pre>&lt;cfloop query=&quot;qGallery&quot;</p>        startrow=&quot;#start_item#&quot;</p>        endrow=&quot;#end_item#&quot;&gt;</pre></p><p><p>We'll keep track of the total number of items output with the <code>count</code> variable, when it matches <code>total_items</code>, we are finished. The <code>col_tick</code> variable is used to count the table columns, when <code>col_tick</code> equals <code>columns</code> we need to start a new table row and reset <code>col_tick</code> to zero.</p></p><p><pre>&lt;cfset col_tick = IncrementValue(col_tick)&gt; </p>&lt;cfset count = IncrementValue(count)&gt;</pre></p><p><p>At last, we write our <code>&lt;img&gt;</code> tag to the browser within a <code>&lt;td&gt;</code> tag.</p></p><p><pre>&lt;td width=&quot;40&quot;</p>&gt;&lt;img src=&quot;#img_thumb#&quot;</p>      height=&quot;#img_height#&quot;</p>      width=&quot;#img_width#&quot;</p>      alt=&quot;#img_title#&quot;&gt;&lt;/td&gt;</p></pre></p><p><p>Here we compare our <code>count</code> variable to the <code>total_items</code> variable. When they match, we are through and need to close our table. If not true, we check to see if our <code>col_tick</code> variable matches our <code>columns</code> variable. If they match, we need to close our current table row and start a new one.</p></p><p><pre>&lt;cfif count EQ total_items&gt;</p>  &lt;/tr&gt;&lt;/table&gt;</p>&lt;cfelseif col_tick EQ columns&gt;</p>  &lt;/tr&gt;&lt;tr&gt;&lt;cfset col_tick = 0&gt;</p>&lt;/cfif&gt;</pre></p><p><p>Close the loop.</p></p><p><pre>&lt;/cfloop&gt;</pre></p><p><p>If our <code>end_item</code> value is less than the <code>start_item</code> value, we'll need to deal with the overlap from the last record to the first. We can do this by outputting the query results twice. Once to the end of the recordset, and then from the beginning of the recordset to the <code>end_item</code> value.</p></p><p><pre>&lt;cfelse&gt;&lt;!--- if start_item LT end_item ---&gt;</pre></p><p><p>The code below is identical to the code above, except for the <code>startrow</code> and <code>endrow</code> values in the <code>&lt;cfloop&gt;</code> tag.</p></p><p><p>For the first output we set <code>startrow</code> to the <code>start_item</code> value as above, but this time we set the <code>endrow</code> value to match the <code>recordcount</code> from our query. We also don't need the  <code>&lt;cfif count EQ total_items&gt;</code> statement, since we know this loop will not complete the gallery.</p></p><p><pre>&lt;cfloop query=&quot;qGallery&quot;</p>        startrow=&quot;#start_item#&quot;</p>        endrow=&quot;#qGallery.recordcount#&quot;&gt;</p>  &lt;cfset col_tick = IncrementValue(col_tick)&gt;</p>  &lt;cfset count = IncrementValue(count)&gt;</p>  &lt;td width=&quot;40&quot;</p>  &gt;&lt;img src=&quot;#img_thumb#&quot;</p>        height=&quot;#img_height#&quot;</p>        width=&quot;#img_width#&quot;</p>        alt=&quot;#img_title#&quot;&gt;&lt;/td&gt;</p>  &lt;cfif col_tick EQ columns&gt;</p>    &lt;/tr&gt;&lt;tr&gt;&lt;cfset col_tick = 0&gt;</p>  &lt;/cfif&gt;</p>&lt;/cfloop&gt;</pre></p><p><p>The second output will be from the start of the recordset to the <code>end_item</code> value.</p></p></p><p><pre>&lt;cfloop query=&quot;qGallery&quot;</p>        startrow=&quot;1&quot;</p>        endrow=&quot;#end_item#&quot;&gt;</p>  &lt;cfset col_tick = IncrementValue(col_tick)&gt;</p>  &lt;cfset count = IncrementValue(count)&gt;</p>  &lt;td width=&quot;40&quot;</p>  &gt;&lt;img src=&quot;#img_thumb#&quot;</p>        height=&quot;#img_height#&quot;</p>        width=&quot;#img_width#&quot;</p>        alt=&quot;#img_title#&quot;&gt;&lt;/td&gt;</p>  &lt;cfif count EQ total_items&gt;</p>    &lt;/tr&gt;&lt;/table&gt;</p>  &lt;cfelseif col_tick EQ columns&gt;</p>    &lt;/tr&gt;&lt;tr&gt;&lt;cfset col_tick = 0&gt;</p>  &lt;/cfif&gt;</p>&lt;/cfloop&gt;</pre></p><p><p>Now we close our if statement and out <code>&lt;cfoutput&gt;</code> block.</p></p><p><pre>&lt;/cfif&gt;&lt;!--- close if start_item LT end_item ---&gt;</p>&lt;/cfoutput&gt;</p></pre></p><p><p>Close our page, and we are finished!</p></p><p><pre>&lt;/div&gt;</p>&lt;/body&gt;</p>&lt;/html&gt;</p></pre></p><p><h3>Considerations</h3></p><p><p>This code could just as easily be applied to blocks of text, or banners. If you'd like it to rotate at an interval other than daily, adjust this line:</p></p><p><p><code>&lt;cfset start_day = DateDiff(&quot;y&quot;, &quot;01/01/2000&quot;, Now())&gt;</code></p>The <code>&quot;y&quot;</code> returns the number of days between 01/01/2000 and the present. To make the gallery rotate on the hour, change the <code>&quot;y&quot;</code> to an <code>&quot;d&quot;</code>. See the ColdFusion documentation for a complete discussion of the <code>DateDiff()</code> function.</p></p><p><p>If you have a very large recordset, and only want to show a portion, the initial query that returns all the gallery records may create too much overhead. In that case, you may want to run an initial query that pulls only the keys to determine the <code>recordcount</code>, and calculate the <code>startitem</code> and <code>enditem</code> values. Then run a second query that only retrieves the records you are interested in. The overlap from the last record to the first will rear its ugly head here too, you may choose to run a <code>UNION</code> query, or two queries and reassemble them with ColdFusion's <code>QueryAddRow()</code> and <code>QuerySetCell()</code> functions.</p></p><p><p>The contents of our loops are all very similar, if we leave in the <code>if</code> statements we omitted during the second set of outputs, we could put this code into an include file.</p></p><p><p>Add some more fields to the database, and you could have the thumbnails lead to larger pics, accompanied by descriptive paragraphs.</p></p><p><p>With some modification, this can become a great custom tag! I've used it to rotate on sale items for other sites. Feel free to modify the code, let me know what you come up with!</p></p><p><h2>Conclusion</h2></p><p><p>We've made our client happy, and created a better gallery. The visitor's thrill of having their picture on the website is only augmented by the fact that it will be there for a set time, disappear for a spell, and then return later. If you had just spent one year and two gazillion bucks building a space-tube chassis 1923 T-Bucket with a screaming powerplant and Weber stacks, wouldn't you want to show your friends the site you posted it to? The customers are now performing targeted marketing for the site owners!</p></p><p><p>Now go forth and multiply &#8212; or rather, divide and conquer.</p></p><p><h2>About This Article</h2></p><p><p>This article originally appeared at <a href="http://www.sitepoint.com" title="Sitepoint (link opens in a new window)" target="_blank">http://www.sitepoint.com</a></p>