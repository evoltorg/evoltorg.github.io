---
layout: post
permalink: node/60108
ratings: 5
avgrate: 3.4000
rating: 3.65
categories: [Code]
user: premshree
real_name: "Premshree Pillai"
user_biog: "Premshree Pillai studies engineering at Mumbai University, India. He has written articles for a range of popular Indian IT magazines. He runs a website <a href=\"http://www.qiksearch.com\" rel=\"nofollow\">http://www.qiksearch.com</a> where he posts his works. He also runs <a href=\"http://premshree.resource-locator.com\" rel=\"nofollow\">http://premshree.resource-locator.com</a>"
user_since: 10 Aug 2002
avatar: 
article_count: 2
excerpt: "Using sockets in Perl, it is possible to communicate to a server using a client program. Here, I will explain how using sockets a client program can communicate to a server. The client program is run at the client-side while the server program runs in the Internet. For testing the program,..."
---
<br>Using sockets in Perl, it is possible to communicate to a server using a client program. Here, I will explain how using sockets a client program can communicate to a server. The client program is run at the client-side while the server program runs in the Internet. For testing the program, you can run it on a local server.</p><br></p><br>For this example, I will use the IO::Socket::INET Perl module which is included with most Perl distributions. If you don't have the module, get it from <a href="http://www.cpan.org/modules/index.html" target="_blank">http://www.cpan.org/modules/index.html</a>.</p><br>We will use the User Datagram Protocol (UDP) to connect to the server. The module also supports the TCP protocol.</p><br></p><br><b>Client Program :</b></p><br></p><br>First of all we need to create the socket. The socket is created easily by initializing a new instance of the IO::Socket::INET object like this :</p><br></p><pre></p>use IO::Socket::INET;</p>$MySocket=new IO::Socket::INET-&gt;new(PeerPort=&gt;1234,</p>        Proto=&gt;'udp',</p>        PeerAddr=&gt;'localhost');</p></pre></p>MySocket, thus inherits all the properties and methods of the IO::Socket::INET object.</p><br>The various key-value pairs we have passed to the newly created object are as follows :</p><ul></p>	<li>PeerPort = 1234; The PeerPort can be a number or symbolic service name.</li></p>	<li>Proto = 'udp'; We use the UDP protocol. The TCP protocol is also supported. If Proto is not provided, it will try to derive it from the service name (PeerPort). If this fails, 'tcp' is assumed as the Proto.</li></p>	<li>PeerAddr = 'localhost'. The PeerAddr can be a host name or an IP address. Here we are tesing the programs locally so we have used 'localhost'. If the server program is running in the Internet then you must use it's IP address or domain name.</li></p></ul></p>Apart from the key-value pairs we have passed, there are many other parameters that can be passed to the object. We are not concerned of them here. You can find details of accepted key-value pairs in the module's documentation.</p><br></p><br>Now that we have created the socket, we can now send a message to the server using the object's send() method :</p><br></p><pre></p>$msg="This is the message";</p>$MySocket-&gt;send($msg);</p></pre></p>Thus we have created the client program. Now let us create the server program, that will display the messages that the client has sent.</p><br></p><br><b>Server Program :</b></p><br></p><br>In the server program also, we create the socket in a similar manner :</p><br></p><pre></p>use IO::Socket::INET;</p>$MySocket=new IO::Socket::INET-&gt;new(LocalPort=&gt;1234,</p>        Proto=&gt;'udp')</p></pre></p>Notice that in the server program we have passed only two key-value pairs :</p><ul></p>	<li>LocalPort = 1234; this is the local host bind port and should be same as the PeerPort value passed in the client program.</li></p>	<li>Proto = 'udp'; Protocol used in communication with client, it should be same as the Proto value passed in the client program.</li></p></ul></p>Now after creating the socket, we can now receive messages sent by the client using the object's recv() method :</p><br></p><pre></p>$MySocket-&gt;recv($text,128);</p>print "</p>Received message '", $text,"'</p>";</p></pre></p>Here the first argument passed to the recv() method must be '$text', the second argument passed indicates the maximum number of bytes the server should receive.</p><br>After receiving the message, it can be easily displayed using the $text variable.</p><br></p><br>Thus we have created the server program. Now the client can communicate with server using a socket. Note that for the server to receive messages from the client, it (the server) should be running while the message is being sent by the client.</p><br></p><br><b>Client program code :</b></p><br></p><pre></p># Client Program</p>use IO::Socket::INET;</p>print "&gt;&gt; Client Program &lt;&lt;";</p><p># Create a new socket</p>$MySocket=new IO::Socket::INET-&gt;new(PeerPort=&gt;1234,Proto=&gt;'udp',PeerAddr=&gt;'localhost');</p><p># Send messages</p>$def_msg="Enter message to send to server : ";</p>print "</p>",$def_msg;</p>while($msg=&lt;STDIN&gt;)</p>{</p>	chomp $msg;</p>	if($msg ne '')</p>	{</p>		print "</p>Sending message '",$msg,"'";</p>		if($MySocket-&gt;send($msg))</p>		{</p>			print ".....&lt;done&gt;","</p>";</p>			print $def_msg;</p>		}</p>	}</p>	else</p>	{</p>		# Send an empty message to server and exit</p>		$MySocket-&gt;send('');</p>		exit 1;</p>	}</p>}</p></pre></p>We have refined the client program so that it accept inputs from the keyboard which is transmitted to the server. A double return (pressing enter/return twice) will exit the client program.</p><br></p><br><b>Server program code :</b></p><br></p><pre></p># Server Program</p>use IO::Socket::INET;</p>print "&gt;&gt; Server Program &lt;&lt;</p>";</p><p># Create a new socket</p>$MySocket=new IO::Socket::INET-&gt;new(LocalPort=&gt;1234,Proto=&gt;'udp');</p><p># Keep receiving messages from client</p>$def_msg="</p>Receiving message from client.....</p>";</p>while(1)</p>{</p>	$MySocket-&gt;recv($text,128);</p>	if($text ne '')</p>	{</p>		print "</p>Received message '", $text,"'</p>";</p>	}</p>	# If client message is empty exit</p>	else</p>	{</p>		print "Cilent has exited!";</p>		exit 1;</p>	}</p>}</p></pre></p>We have refined the server program so that as and when the client sends a message, the server keeps displaying it. When the client sends a blank message, the server program terminates.</p><br></p><br>Thus we have learned how to communicate to a server from a client using sockets.</p><br></p><br><b>&#169; 2002 <a href="http://premshree.resource-locator.com/cgi-bin/contact.pl"><font color="#3366CC">Premshree Pillai</font></a>.