---
layout: post
permalink: node/591
ratings: 4
avgrate: 3.7500
rating: 3.83
categories: [Backend]
user: raines
real_name: "Steven Raines"
user_biog: ""
user_since: 14 Jul 1999
avatar: 
article_count: 1
excerpt: "So you want to create a way to easily manage a small set of data which can be easily maintained by the average office worker.  If you've Microsoft Internet Information Server and Microsoft Excel, this can help."
---
<h2>Problem</h2></p><p></p>You want to create a way to easily manage a small set of data which can be easily maintained by the average office worker.</p></p></p><h2>Pre-requisites</h2></p><ol></p><li>Microsoft Internet Information Server 4.0</li></p><li>Microsoft Excel ODBC Driver installed on Web Server.</li></p><li>Microsoft ActiveX Data Objects version 2.0 or greater installed on Web Server.</li></p><li>Microsoft Excel 95, 97 or 2000</li></p></ol></p><p><h2>Solution</h2></p><p></p>Create an Excel Spreadsheet that contains the data. Allow the user to update this via FTP, or have a scheduled process that does this for them. Then create an Active Server Pages script which uses ActiveX Data Objects to gather the information from the spreadsheet and display it.</p></p></p><p><h2>Example</h2></p><p></p>To illustrate this solution, we'll create an online event listing. We want this to be updated by the events coordinator, who is not very web saavy.</p></p></p><p><h3>Create the Excel Spreadsheet</h3></p><p></p>To begin, create a new Worksheet in Microsoft Excel. In the first row, place the names you would like for your fields. In this example, we need to know the name of the event, the location of the event, who is coordinating it and the date and time of the event.</p></p></p><img SRC="images/144/excel1-fig1.gif" width="346" height="299" alt="Figure 1" border="0"></p><p></p>Now, we need to fill in some data.</p></p></p><img SRC="images/144/excel1-fig2.gif" width="346" height="299" alt="Figure 2" border="0"></p><p></p>Now, highlight the the columns that contain your data.</p></p></p><img SRC="images/144/excel1-fig3.gif" width="346" height="299" alt="Figure 3" border="0"></p><p></p>From the menu, Select Insert, Name, Define. In the dialog box that appears, enter the name for the highlighted data. In this example, we'll call it "Events".</p></p></p><img SRC="images/144/excel1-fig4.gif" width="286" height="181" alt="Figure 4" border="0"></p><p></p>Hit OK. You should see the name of your data group in the "Name Box" at the upper left hand corner of the screen.</p></p></p><img SRC="images/144/excel1-fig5.gif" width="346" height="299" alt="Figure 5" border="0"></p><p></p>Now your data should be all set. If your worksheet is protected or is placed in a secure directory, make sure that the user that the web server is running as (usually IUSR_MachineName) has the appropriate permissions. Save your data file and place it on your web server.</p></p></p><p><h3>Create the ASP code</h3></p><p></p>The first thing that we have to do is create the Connection and Recordset that we will be using.</p></p></p><p><pre>'## Create Connection and Recordsets</p>&nbsp;&nbsp;&nbsp;&nbsp;Dim Conn, RS</p>&nbsp;&nbsp;&nbsp;&nbsp;Set Conn = CreateObject(&quot;ADODB.Connection&quot;)</p>&nbsp;&nbsp;&nbsp;&nbsp;Set RS = CreateObject(&quot;ADODB.Recordset&quot;)</pre></p><p><p></p>Next, lets create a variable for the file name. In this example, let's say we named the file "EventData.xls".</p></p></p><p><pre>'## The Excel File Name</p>&nbsp;&nbsp;&nbsp;&nbsp;XLFile = &quot;F:\webdata\EventData.xls&quot;</pre></p><p><p></p>Now, we have to define what data we want to get. Most of the time, we'll want all the data. This case is no exception, so we create a SQL query to get everything from the data we defined as "Events".</p></p></p><p><pre>'## The Data to extract</p>&nbsp;&nbsp;&nbsp;&nbsp;szSQL = &quot;select * from Events&quot;</pre></p><p><p></p>To get the data, we need to open the connection to the data source. Here is where we stick in the name of the file defined above. You could just as easily put the file in this line, as well.</p></p></p><p><pre>'## Create and open the connection</p>&nbsp;&nbsp;&nbsp;&nbsp;Conn.ConnectionString = &quot;DBQ=&quot; & XLFile & &quot;;DRIVER=Microsoft Excel Driver (*.xls);UID=admin;&quot;</p>&nbsp;&nbsp;&nbsp;&nbsp;Conn.Open</pre></p><p><p></p>Once this is done, we set some properties on the recordset and use the Recordset.Open method to get the specific data from our spreadsheet. By default, ADO creates Forward Only recordsets. We'll make ours static. After we get the data, we can disconnect the Active connection, since we don't need it anymore.</p></p></p><p><pre>'## set the cursor to be static.</p>&nbsp;&nbsp;&nbsp;&nbsp;rs.cursortype = 3 ' adStatic.</p><p>'## open the recordset</p>&nbsp;&nbsp;&nbsp;&nbsp;rs.open szSQL, conn</p><p>'## Disconnect recordset, eliminate connection</p>&nbsp;&nbsp;&nbsp;&nbsp;rs.activeconnection = nothing</p>&nbsp;&nbsp;&nbsp;&nbsp;Conn.Close</p>&nbsp;&nbsp;&nbsp;&nbsp;Set Conn=nothing</pre></p><p><p></p>Now we can operate on the data just like any other recorddata. Here, we will iterate through the data, displaying the events on the web. Naturally, we could generate any formatting we want.</p></p></p><p><pre>'## iterate through the recordset.</p>while not rs.eof</p>&nbsp;&nbsp;response.write RS(&quot;name&quot;) & &quot; -- &quot;</p>&nbsp;&nbsp;response.write RS(&quot;location&quot;)  & &quot; -- &quot;</p>&nbsp;&nbsp;response.write RS(&quot;Coordinator&quot;)  & &quot; -- &quot;</p>&nbsp;&nbsp;response.write RS(&quot;Date&quot;)  & &quot; -- &quot;</p>&nbsp;&nbsp;response.write RS(&quot;Time&quot;)  & &quot;&lt;BR&gt;&quot;</p>&nbsp;&nbsp;rs.movenext</p>wend</pre></p><p><p></p>Finally, we close out the recordset and release it. Of couse, you could skip this set and move the data into the user's session, if they were going to be querying it repeatedly. For now, we'll assume that isn't the case.</p></p></p><p><pre>RS.close</p>Set RS=nothing</pre></p><p><p></p>This should get you started. Of course there are all kinds of neat things you can do once your data is imported into an ADO Recordset. Excellent information is available from the <a href="http://www.able-consulting.com/tech.htm" target="_new" title="Able Consulting's Technology Page">Able Consulting's Technology Page</a>.</p></p></p><p><h2>References</h2></p><p><p></p>For more information, see the Microsoft Knowledge Base Article: <a href="http://support.microsoft.com/support/kb/articles/q195/9/51.asp" target="_new" title="Microsoft Knowledge Base">HOWTO: Query and Update Excel Data Using ADO From ASP</a>.</p></p></p><p><p></p>This article originally posted at <a href="http://algonquinstudios.com/articles/excel_db.asp" target="_new">Algonquin Studios</a>.</p></p>