<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Clever Forms With Php</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="site">
          <div class="header">
            <h1 class="title"><a href="/">evolt.org</a></h1>
            <a class="extra" href="/">home</a>
          </div>

          <h2>Clever Forms With Php</h2>
<p class="meta">19 May 2003</p>

<div class="post">
<h2>The form problem</h2> </p><p><p>Forms have always been a nuisance in Web Development. They need HTML and \nbackend code, render differently on each browser and stubbornly refuse to \nuse styles consistently on browsers. Furthermore their elements \nsend different data and need to be initialised differently depending \non what they are.</p></p><p><p>When checking a form for mandatory entries, you often have to re-display\nthe form with the previously entered data, and a highlighted version of \nthe missing form elements. This is hard work, which is why a lot of lazier\ndevelopers use a Javascript &#34;back&#34; button instead of a scripting solution \nthat highlights the missing mandatory elements.</p></p><p><h2>Repopulating forms with PHP</h2> </p><p><p>In PHP it is rather easy to repopulate a textual form element:</p></p><p><code>\n&#60;input type=&#34;text&#34; \n  id=&#34;Name&#34; name=&#34;Name&#34; \n  value=&#34;&#60;?PHP echo $_POST['Name']==''?'':$_POST['Name'];?&#62;&#34; /&#62;\n</code></p><p><p>It is trickier with checkboxes:</p></p><p><code>\n&#60;input type=&#34;checkbox&#34; \n  id=&#34;Name&#34; name=&#34;Name&#34;\n  value=&#34;&#60;?PHP echo $_POST['Name']=='on'?'':'checked=&#34;checked&#34;';?&#62;&#34; /&#62;\n</code></p><p><p>Radio buttons and select boxes need a check for each of their options or some\nJavascript to highlight them. In any case, it is a drag.</p></p><p><h2>Bobby watches you</h2> </p><p><p>This whole dilemma increases when you need to adhere to accessibility \nstandards. Although not really an accessibility problem, online tools\nsuch as <a href="http://bobby.watchfire.com/bobby/html/en/index.jsp" \ntitle="Link to Bobby, the online accessibility test tool" \ntarget="_blank">Bobby</a> moan about form elements that don't have an initial \nvalue. To avoid this, designers add a dummy value, that has to be \nstripped again from the data once the form is submitted. </p></p><p><h2>The wishlist</h2> </p><p><p>You want a function that displays a form element. The element should \nget a meaningful initial value that does not get submitted in the end.</p></p><p><p>As an extra for Javascript-enabled browsers, text elements should get \nemptied when you click on them if they contain the initial value.</p></p><p><p>If the element is a mandatory field and is empty, or\ncontains the initial value, it should get highlighted. If the form has to \nbe re-displayed due to some other element missing, the element should display\nthe last submitted value.</p> </p><p><p>The function should do that for text boxes, text areas, checkboxes, \nradio buttons, and select boxes. Also, it should not change any additional \nelements and attributes like accesskey, taborder, classes or colgroups.</p></p><p><h2>Function 1: Displaying, initialising and highlighting the form</h2></p><p><pre>\nfunction add($f){\n  global $errorindicator,$errorclass,$Javascript;\n  $tocheck=explode(',',','.$_POST['required']);\n  preg_match('/id=&#34;(.*?)&#34;/i',$f,$i);\n  preg_match('/name=&#34;(.*?)&#34;/i',$f,$n);\n  preg_match('/type=&#34;(.*?)&#34;/i',$f,$t);\n  preg_match('/value=&#34;(.*?)&#34;/i',$f,$iv);\n  $n=$n[1];$iv=$iv[1];$i=str_replace('_',' ',$i[1]);\n  if(preg_match('/&#60;textarea/',$f)){\n    $v=$_POST[$n]==''?$i:$_POST[$n];\n    $f=preg_replace('/&#60;textarea(.*?)&#62;(.*?)&#60;\/textarea&#62;/',\n    '&#60;textarea\\1&#62;'.stripslashes(htmlentities($v)).'&#60;/textarea&#62;',$f);\n        if($Javascript){$f=preg_replace('/&#60;textarea/',\n        '&#60;textarea onfocus=&#34;this.value=this.value==\''.\n        $i.'\'?\'\':this.value&#34;',$f);}\n  }  \n  if(preg_match('/&#60;select/',$f)){\n    preg_match('/&#60;select.*?&#62;/',$f,$st);\n    preg_match_all('/&#60;option value=&#34;(.*?)&#34;&#62;(.*?)&#60;\/option&#62;/',$f,$allopt);\n    foreach ($allopt[0] as $k=&#62;$a){\n      if($_POST[$n]==$allopt[1][$k]    \n      ($_POST[$n]=='' &#38;&#38; $k==0)){\n        $preg='/&#60;option value=&#34;';\n        $preg.=$allopt[1][$k].'&#34;&#62;'.$allopt[2][$k].\n        '&#60;\/option&#62;/si';\n        $rep='&#60;option selected=&#34;selected&#34; value=&#34;';\n        $rep.=$allopt[1][$k].'&#34;&#62;'.$allopt[2][$k].\n        '&#60;/option&#62;';\n        $f=preg_replace($preg,$rep,$f);\n      }\n    }\n  }else{\n    switch ($t[1]){\n      case 'text':\n        $v=$_POST[$n]==''?'value=&#34;'.$i.'&#34;':'value=&#34;'.\n        stripslashes(htmlentities($_POST[$n])).'&#34;';\n        $f=preg_replace('/&#60;input/','&#60;input '.$v,$f);\n        if($Javascript){$f=preg_replace('/&#60;input/',\n        '&#60;input onfocus=&#34;this.value=this.value==\''\n        .$i.'\'?\'\':this.value&#34;',$f);}\n      break;\n      case 'checkbox':\n        $v=$_POST[$n]=='on'?' checked=&#34;checked&#34;':'';\n        $f=preg_replace('/&#60;input/','&#60;input'.$v,$f);\n      break;\n      case 'radio':\n        $f=preg_replace('/checked.*?\s/','',$f);\n        $v=$_POST[$n]==$iv?' checked=&#34;checked&#34;':'';\n        $f=preg_replace('/&#60;input/','&#60;input'.$v,$f);\n      break;\n    }\n  }\n  $f.='&#60;input type=&#34;hidden&#34; name=&#34;'.$n.'initvalue&#34; value=&#34;'.$i.'&#34; /&#62;';\n  if (array_search($n,$tocheck) and ($_POST[$n]=='' or $_POST[$n]==$i)){\n      if($errorindicator!=''){$f=$errorindicator.$f;}\n      if($errorclass!=''){$f=preg_replace('/name=/i','class=&#34;'.\n      $errorclass.'&#34; name=',$f);}\n  }\n  return $f;\n}\n</pre></p><p><p>You can strip the Javascript that automatically clears the initial value when \nthe element gets the focus by not defining the global variable <var>$Javascript</var>.</p>\n<p>The global variable <var>$errorindicator</var> can be a text or any \n<acronym title="Hypertext Markup Language">HTML</acronym>, for example an image.\nThe content of this variable will be displayed before each missing mandatory element.</p>\n<p>The <acronym title="Cascading Style Sheet">CSS</acronym> class added to each \nmissing field is defined in the global variable <var>$errorclass</var>.</p> </p><p><p>Mandatory elements get defined separated by a comma in a hidden field called\n&#34;<strong>required</strong>&#34;:</p></p><p><code>\n&#60;input type=&#34;hidden&#34;\n  name=&#34;required&#34; \n  value=&#34;Name,SurName,live,message&#34; /&#62;\n</code></p><p><p>The initial value of the form element is defined by its ID. As IDs cannot \ncontain spaces, you need to replace them with underscores. The function \nremoves them automatically. If, for example, you want to display \n&#34;Please enter your first name&#34; as the initial value  in a text box, \nuse the corresponding ID:</p></p><p><code>\n&#60;input type=&#34;text&#34; \n  name=&#34;name&#34; \n  id=&#34;Please_enter_your_first_name&#34; /&#62;\n</code></p><p><p>The function adds hidden fields with the initial values\nto the form. For the &#34;name&#34; example, this would be:</p></p><p><code>\n&#60;input type=&#34;hidden&#34; \n  name=&#34;nameinitvalue&#34; \n  value=&#34;Please_enter_your_first_name&#34; /&#62;\n</code></p><p><p>The <strong>add()</strong> function takes care of the form drawing, the \nhighlighting, and the setting of the initial value.</p>\n<p>To use it in a PHP document, you wrap your form elements in it:</p></p><p><pre>\n&#60;form method=&#34;post&#34; action=&#34;&#60;?=$_SERVER['PHP_SELF']?&#62;&#34;&#62;\n  &#60;input type=&#34;hidden&#34; name=&#34;required&#34; value=&#34;Name,SurName,live,message&#34; /&#62;\n  &#60;fieldset&#62;\n    &#60;legend&#62;Identification&#60;/legend&#62;\n      &#60;label for=&#34;your_name&#34;&#62;Name:&#60;/label&#62;\n        &#60;?=add('&#60;input type=&#34;text&#34; name=&#34;Name&#34;\n         id=&#34;Your_Name&#34; /&#62;')?&#62;&#60;br /&#62;\n      &#60;label for=&#34;your_surname&#34;&#62;Surname:&#60;/label&#62;\n        &#60;?=add('&#60;input type=&#34;text&#34; name=&#34;SurName&#34;\n         id=&#34;Your_Surname&#34; /&#62;')?&#62; \n  &#60;/fieldset&#62;\n  &#60;fieldset&#62;\n    &#60;legend&#62;Gender and age&#60;/legend&#62;\n    &#60;label for=&#34;Age&#34;&#62;Age:&#60;/label&#62;\n      &#60;?=add('\n      &#60;select name=&#34;Age&#34;&#62;\n          &#60;optgroup label=&#34;Non&#173;Teen&#34;&#62;\n          &#60;option value=&#34;5&#34;&#62;Under 5&#60;/option&#62;\n          &#60;option value=&#34;9&#34;&#62;Five to Ten&#60;/option&#62;\n        &#60;/optgroup&#62;\n        &#60;optgroup label=&#34;Teen&#34;&#62;\n          &#60;option value=&#34;10&#34;&#62;Aspiring Teen&#60;/option&#62;\n          &#60;option value=&#34;15&#34;&#62;Mid Teen&#60;/option&#62;\n          &#60;option value=&#34;19&#34;&#62;End Teen&#60;/option&#62;\n        &#60;/optgroup&#62;\n        &#60;optgroup label=&#34;Twen&#34;&#62;\n          &#60;option value=&#34;20&#34;&#62;Aspiring Twen&#60;/option&#62;\n          &#60;option value=&#34;25&#34;&#62;Mid Twen&#60;/option&#62;\n          &#60;option value=&#34;29&#34;&#62;End Twen&#60;/option&#62;\n        &#60;/optgroup&#62;\n        &#60;optgroup label=&#34;Above&#34;&#62;\n          &#60;option value=&#34;30&#34;&#62;30ies&#60;/option&#62;\n          &#60;option value=&#34;40&#34;&#62;40ies&#60;/option&#62;\n          &#60;option value=&#34;over50&#34;&#62;Above&#60;/option&#62;\n        &#60;/optgroup&#62;\n      &#60;/select&#62;\n      ')?&#62;\n    &#60;strong&#62;Gender:&#60;/strong&#62;\n      &#60;?=add('&#60;input type=&#34;radio&#34; name=&#34;Gender&#34; id=&#34;Male&#34; \n      checked=&#34;checked&#34; value=&#34;Male&#34; /&#62;')?&#62;\n      &#60;label for=&#34;Male&#34;&#62;Male&#60;/label&#62;\n      &#60;?=add('&#60;input type=&#34;radio&#34; name=&#34;Gender&#34; id=&#34;Female&#34;\n       value=&#34;Female&#34; /&#62;')?&#62;\n      &#60;label for=&#34;Female&#34;&#62;Female&#60;/label&#62;\n  &#60;/fieldset&#62;\n  &#60;fieldset&#62;\n    &#60;legend&#62;Enter your message&#60;/legend&#62;\n      &#60;p&#62;&#60;?=add('&#60;input type=&#34;checkbox&#34; name=&#34;live&#34; \n      id=&#34;live&#34; /&#62;')?&#62;\n      &#60;label for=&#34;live&#34;&#62;Publish to live&#60;/label&#62;&#60;/p&#62;\n      &#60;p&#62;&#60;label for=&#34;your_message&#34;&#62;Your Message:&#60;/label&#62;&#60;/p&#62;\n      &#60;?=add('&#60;textarea name=&#34;message&#34; id=&#34;Your_message&#34;\n       cols=&#34;30&#34; rows=&#34;10&#34;&#62;&#60;/textarea&#62;')?&#62;\n  &#60;/fieldset&#62;\n  &#60;p align=&#34;right&#34;&#62;&#60;input type=&#34;submit&#34; value=&#34;Send&#34; /&#62;&#60;/p&#62;\n&#60;/form&#62;\n</pre></p><p><p>You need another function to strip these initial values once the form is filled and each \nmandatory field is filled with something else than its initial value. </p></p><p><h2>Function 2: Checking the form</h2>\n<pre>\nfunction check(){\n  if ($_POST!=''){\n    $sentarray=array();\n    $tocheck=explode(',',$_POST['required']);\n    $error[0]=&#34;Errors:&#34;;\n    foreach ($tocheck as $t){if(!array_key_exists($t,$_POST)){\n    $error[]=$t;}}\n    foreach (array_keys($_POST) as $p){\n      if(!preg_match('/initvalue/',$p) and \n      !preg_match('/required/',$p)){\n        $sentarray[$p]=$_POST[$p]==\n        $_POST[$p.'initvalue']?'':$_POST[$p];\n      }\n      foreach ($tocheck as $c){\n        if ($p==$c and $sentarray[$p]==''){\n          $error[]=$_POST[$p.'initvalue'];\n        }\n      }\n    }\n    return $error[1]==''?$sentarray:$error;  \n    }\n}\n</pre></p><p><p>This function checks the required elements. If all have a value \nthat is different from the initial value, it'll return an array containing\nonly the necessary fields. All the generated initial value fields and \nthe &#34;required&#34; field are stripped out. </p>\n<p>If there was a mandatory field that is empty or still has the initial\nvalue, the resulting array will have a first element with the value \n&#34;Errors:&#34;, and a list of all the missing fields as the other array \nelements.</p></p><p><p>To use the function, you could do something like this:</p></p><p><pre>\n&#60;?PHP\n  $errorindicator='&#60;img src=&#34;alert.gif&#34; width=&#34;20&#34; height=&#34;20&#34; \n  alt=&#34;Alert&#34; title=&#34;Indicator for missing form element&#34; border=&#34;0&#34; /&#62;';\n  $errorclass=&#34;error&#34;;\n  $Javascript=true;\n  $results=check();\n  if($results[0]=='Errors:'){\n    \n?&#62;\n  &#60;h2&#62;There has been an error:&#60;/h2&#62;\n  &#60;p&#62;You forgot to enter the following field(s)&#60;/p&#62;\n  &#60;ul&#62;\n  &#60;?PHP foreach ($results as $i=&#62;$e){if ($i&#62;0){\n    echo &#34;&#60;li&#62;$e&#60;/li&#62;&#34;;\n  }}?&#62;\n  &#60;/ul&#62;\n&#60;?PHP \n  }else{\n  // Add send functionality here\n  }  \n?&#62;\n</pre>\n<p>That's it. To see the functions in all their glory, and download them with \nan example, go to the <a href="http://www.onlinetools.org/articles/easyform/" \n title="To the form example homepage" target="_blank">homepage</a>. Updates and \nfixes will happen there and be announced in the comments below.</p>
</div>


          <div class="footer">
            <div class="contact">
              <p>
                Your Name<br />
                What You Are<br />
                you@example.com
              </p>
            </div>
            <div class="contact">
              <p>
                <a href="https://github.com/yourusername">github.com/yourusername</a><br />
                <a href="https://twitter.com/yourusername">twitter.com/yourusername</a><br />
              </p>
            </div>
          </div>
        </div>

    </body>
</html>
