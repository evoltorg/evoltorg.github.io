<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Writing Smart Web Based Forms</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="site">
          <div class="header">
            <h1 class="title"><a href="/">evolt.org</a></h1>
            <a class="extra" href="/">home</a>
          </div>

          <h2>Writing Smart Web Based Forms</h2>
<p class="meta">01 May 2001</p>

<div class="post">
<p>\nForms are used frequently in dynamic web applications. As a consequence, \nalmost all web programmers have to deal with form data validation at some \npoint in their careers. The technique described in this article will help \nyou help the user submit correct information. \n</p></p><p><p>\nSo, what's the technique? Building smart forms... well, smart validation, \nactually. You <em>are</em> validating your forms on the server side, aren't \nyou? You don't want to <a href="http://www.ester.com/order.htm" \ntarget="_new" title="an example of client-side validation only">validate \nonly on the client side</a>.\n</p></p><p><p>\nI can't tell you how many web sites I've visited that don't handle input errors\ncorrectly. They either have forms that simply refresh with a generic "Your input \nhas errors" message or they <a href="http://www.cayenta.com/contact/index.html" \ntarget="_new">only report the first input error</a> the validation script \nencounters (you'll have to turn off client-side scripting to view this gem).\n</p></p><p><p>\nAn <a \nhref="http://www.powerasp.com/content/hintstips/server-side-form-validation.asp" \ntarget="_new">example on PowerASP.com</a> has the beginnings of TheRightIdea&trade; \nand is worth a once-over. However, they miss the logical way of form validation and\nprocessing. The article details how to process forms and report one or more input \nerrors using a form handler script and a redirect back to the form if there are \ninput errors. Other than the fact that this method isn't the most logical way of \ndoing things, there is also a loss of all of the users input unless they are also\npassed along in the querystring. Wasn't this supposed to be easy?\n</p></p><p><p>\nWriting smart forms <em>can</em> be easy if you want it to be. I'm going to use ASP\nin the actual <a href="/writing_smart_web-based_forms#examples">examples</a>, but the general \n<a href="/writing_smart_web-based_forms#concept">concept</a> can be applied using any language &#151;\nexcept ColdFusion; you just can't do ANYTHING good with that (direct flames to \n<a href="mailto:flames@mattwarden.com">flames@mattwarden.com</a>).\n</p></p><p><h4><a name="concept">The Basic Concept</a></h4></p><p><p>\nThere are a number of benefits gained by displaying and handling a form in the same \nfile. First, we have all of the code related to that form in a single location (with \nthe exception of code in include files). Second, we have available to our script every \nsubmitted form variable. The general flow of our form processing is as follows:\n</p></p><p><p>\n<img src="/images/65/10199/formflow.gif" alt="Form Processing Flow">\n</p></p><p><p>\nAs you can see, we are validating the form before redirecting to any other page. In other \nwords, the form is submitting to itself. Within this script, there is logic which determines\nwhether it should display the form or process submitted form information. We are only moving \nfrom our script if the submitted form passes our validation. If the information does not pass\nvalidation, we re-display the form. We also pre-fill the form fields with the information already \nsubmitted and mark the fields that didn't pass our validation. This makes it easier for the user\nto supply the correct information.\n</p></p><p><p>\nSo, let's say Joe User fills out the following form:\n</p></p><p><p>\n<img src="/images/65/10199/form1.gif" alt="Form">\n</p></p><p><p>\nWe don't like some of his input and our validation methods rejected it. Joe didn't even fill in his last name. \nHe didn't even try with his email address. And that zip code is not the zip code for Evoltageddon, NH.\n</p></p><p><p>\nHow do we present these issues to Joe User? Should we just tell him he screwed up and have him \ndoing the work trying to figure out what is wrong (even though we've already figured out what's \nwrong)? No. We indicate to him that there is a problem with his submission with some generic \ntext and highlight the fields that need to be corrected. The important part here is that both \nhis correct and incorrect data is preseved so he doesn't have to re-type the correct information \nand he can also see what was wrong with his other information. So, we show Joe something like this:\n</p></p><p><p>\n<img src="/images/65/10199/form2.gif" alt="Form With Input Errors">\n</p></p><p><p>\nYou could take it a step further and display what was wrong with each field, but that is overkill \nfor most situations. In this example, the only field that could warrant an explanation is the zip code \nfield. However, the marked fields should do fine and there is only a very small chance that Joe will \nget confused.\n</p></p><p><p>\nWhat does this mean? Well, when you're building forms (and form handlers) you should:\n</p></p><p><ul>\n	<li>Make the form self-submitting</li>\n	<li>Add logic to either show or process the form</li>\n	<li>Validate submitted information on the server-side</li>\n	<li>Redirect to the next page if information validates</li>\n	<li>If the submission does not validate, re-display the form pre-filled with submitted info and problem fields highlighted</li>\n</ul></p><p><h4><a name="examples">The Basic Code</a></h4></p><p><p>\n<strong>How can we determine whether to display or process the form?</strong>\n</p></p><p><p>\nSome people like to pick a form field and test it for a value. For instance:\n</p></p><p></p><p><pre>\nif isEmpty(trim(request.form(&quot;firstname&quot;))) then\n	' display the form\nelse\n	' process the form\nend if\n</pre></p><p></p><p><p>\nThis method isn't the best way to do things. If I fill in every field but the first name field, \nthe form is simply re-displayed, with no error notification (because the code doesn't know there's \nan error).\n</p></p><p><p>\nAnother method is to pick the name of the submit button as the field to test:\n</p></p><p><pre>\nif isEmpty(trim(request.form(&quot;submitButton&quot;))) then\n	Call displayForm()\nelse\n	Call processForm()\nend if\n</pre></p><p><p>\nThe above code simply checks if request.form("submitButton") has a value. If it doesn't, it calls \na subroutine called displayForm(). This subroutine simply writes the HTML for the form. If it\ndoes have a value, it calls processForm(), a subroutine that validates the form input. You could \nalso skip the subroutines (but, it's so much cleaner looking, eh?) and slop all the code for each \ncondition within the <code>if</code> test itself. However, when you scroll halfway down your script \nand see an <code>else</code> and you don't know what expression the corresponding <code>if</code> tested, \nyou'll understand why I did it this way ;-)\n</p></p><p></p><p><p>\nStill, I don't like this method much. If the value attribute of the submit button tag is omitted, \nisEmpty(trim(request.form("submitButton"))) will always be true. This is an easy thing to catch, but why \nbother when there are easier ways of doing things?\n</p></p><p><p>\nThe method I prefer uses the server variable REQUEST_METHOD. Most likely, when Joe User first \nvisits your form page, his browser will use the GET method. When the form is submitted, the browser \nwill use the POST method (you <em>are</em> using <code>method="POST"</code> when writing forms, \naren't you?). So, an easy way to check to see if the form has been submitted it to check the \nREQUEST_METHOD:\n</p></p><p></p><p><pre>\nif ucase(trim(request.ServerVariables(&quot;REQUEST_METHOD&quot;)))=&quot;GET&quot; then\n	Call displayForm()\nelseif ucase(trim(request.ServerVariables(&quot;REQUEST_METHOD&quot;)))=&quot;POST&quot; then\n	Call processForm()\nelse\n	' are you supporting any other request methods?\nend if</p><p></pre></p><p></p><p><p></p><p><strong>What is an easy way to make a form self-submitting?</strong></p><p></p></p><p><p>\nSimple. Another server variable available is SCRIPT_NAME. This holds the root-relative path\nas well as the filename of the current script.\n</p></p><p></p><p><pre>\n&lt;!-- expanded tag for readability --&gt;\n&lt;form \n	method=&quot;POST&quot; \n	name=&quot;userdetails&quot; \n	action=&quot;&lt;%Response.Write request.ServerVariables(&quot;SCRIPT_NAME&quot;)%&gt;&quot;\n&gt;\n</pre></p><p></p><p><p></p><p><strong>How can I pre-fill fields with submitted data after an input error has been found?</strong></p><p></p></p><p><p></p><p>Also fairly simple. Because the form is self-submitting, you have all the submitted form information \nat your disposal.</p><p></p></p><p></p><p><pre>\n&lt;input type=&quot;text&quot; name=&quot;firstname&quot; value=&quot;&lt;%Response.Write request.form(&quot;firstname&quot;)%&gt;&quot;&gt;&lt;br&gt;\n&lt;input type=&quot;text&quot; name=&quot;lastname&quot; value=&quot;&lt;%Response.Write request.form(&quot;lastname&quot;)%&gt;&quot;&gt;&lt;br&gt;\n</pre></p><p></p><p><p></p><p>Note that if you already have these form values stored in variables (which you should if you've \nalready run the submitted values through validation), you should use those values rather than \naccessing them from the request object. <a href="/asp_coding_tricks#stuffing">More</a></p><p></p></p><p><p></p><p>It gets a little complicated if the form's purpose is to edit saved data in the database. The form \nwill already have data in it before the user inputs anything. So, if they change something and there's \nan error with what they've changed, do you show the data from the database and let them re-edit that, or \ndo you display what they've just entered? Truthfully, it's a mix. Here, we're going to give importance to \nthe form data just submitted:</p><p></p></p><p></p><p><pre></p><p>&lt;%</p><p>function getValue(byval sImportant, byval sPassive)\n	' notice that we aren't checking for\n	' a valid value, just *any* value\n	if not isEmpty(sImportant) then\n		getValue = sImportant\n	else\n		getValue = sPassive\n	end if\nend function</p><p>%&gt;</p><p>&lt;!-- tags expanded for readability --&gt;\n&lt;input type=&quot;text&quot; name=&quot;firstname&quot; \n	value=&quot;&lt;%Response.Write getValue(request.form(&quot;firstname&quot;),Recordset(&quot;firstname&quot;))%&gt;&quot;\n&gt;&lt;br&gt;</p><p>&lt;input type=&quot;text&quot; name=&quot;lastname&quot; \n	value=&quot;&lt;%Response.Write getValue(request.form(&quot;lastname&quot;),Recordset(&quot;lastname&quot;))%&gt;&quot;\n&gt;&lt;br&gt;\n</pre></p><p></p><p><p></p><p>The function <code>getValue(...)</code> above simply takes two values. The first value \nis the value that should be returned if it has a value. If it does not have a value, we use\nthe second value. If the second value is simply an emptry string, then an empty string will be \nreturned. Since our first value is from the submitted form (if there <em>is</em> a submitted \nform), then we are using the form input if it exists. Otherwise, we're using the data from the \ndatabase.</p><p></p></p><p></p><p><p></p><p><strong>So, how do I do this validation?</strong></p><p></p></p><p><p>\nWell, it obviously depends on the information you're validating. However, in my experience, \nthere are a few things that makes everything go a lot easier.\n</p></p><p><p></p><p>We need to know two things. First, we need to know if all the data validated. We also need to \nknow which bits of data validated and which did not.</p><p></p></p><p></p><p><pre></p><p>&lt;%</p><p>' general true/false for \n' validation of entire submission\nDim bGoodPost</p><p>' specific true/false for \n' validatin of each bit of data\nDim bGoodFname, bGoodLname, bGoodEmail</p><p>' data vars\nDim sFname, sLname, sEmail, sReferringFriend</p><p>sFname = trim(request.form(&quot;firstname&quot;))\nsLname = trim(request.form(&quot;lastname&quot;))\nsEmail = trim(request.form(&quot;emailaddr&quot;))\nsReferringFriend = trim(request.form(&quot;referrer&quot;))</p><p>if isEmpty(sFname) then bGoodFname=false else bGoodFname=true\nif isEmpty(sLname) then bGoodLname=false else bGoodLname=true\nif not isValidEmail(sEmail) then bGoodEmail=false else bGoodEmail=true</p><p>bGoodPost = (bGoodFname and bGoodLname and bGoodEmail)</p><p>if bGoodPost then\n	' validates!!!\nelse\n	' re-display the form with values pre-filled \n	' and problem fields highlighted\nend if\n%&gt;\n</pre></p><p></p><p><p></p><p>Here we have four variables. The first, <code>bGoodPost</code> stores whether\nthe entire form submission passes validation. This value is determined by the \nrequired fields in the submitted form. In this example, firstname, lastname, \nemailaddr are all required. referrer is not required and therefore we don't \ncare whether it has a value (though you may still want to validate \nit if it does have a value, depending on the situation). So, we need to validate\nthese required fields. <code>bGoodFname</code>, <code>bGoodLname</code>, \n<code>bGoodEmail</code> will hold whether each of these values are valid. For \n<code>sFname</code> and <code>sLname</code>, all we do is check for a value.\nFor <code>sEmail</code>, we run it through our own email-validating function \n(not shown here, use your imagination ;-). Like I said in the beginning, \n<code>bGoodPost</code> is true only if all of the required bits of information \npass our validation. An easy way to check for this is to use the line:</p><p></p></p><p></p><p><p></p><p><code>bGoodPost = (bGoodFname and bGoodLname and bGoodEmail)</code><br></p><p></p></p><p></p><p><p></p><p>Here, <code>bGoodPost</code> will only be true if <code>bGoodFname</code>, \n<code>bGoodLname</code>, and <code>bGoodEmail</code> are all true. This is \nexactly what we want.</p><p></p></p><p></p><p><p></p><p>Also note that <code>if&nbsp;bGoodPost&nbsp;then</code> is the same as \n<code>if&nbsp;bGoodPost=true&nbsp;then</code>.</p><p></p></p><p></p><p><p></p><p><strong>After I've validated, how do I mark problem fields?</strong></p><p></p></p><p></p><p><p></p><p>The easiest way to do this is to use the same subroutine you used to display \nthe form in the first place. In this example, it was called displayForm().\nNow we have to add the highlighting functionality so that the user knows \nwhich fields had errors. Ok, at this point (assuming the form has already \nbeen submitted), we know whether the first name, last name, and email address \nare valid. The variables <code>bGoodFname</code>, <code>bGoodLname</code>, \n<code>bGoodEmail</code> tell us which values are valid and which are not. So, \ndepending on how you want to go, you can use one of the following methods to \nhighlight the fields with errors:</p><p></p></p><p></p><p><pre></p><p>&lt;!-- method 1 --&gt;\n...\n&lt;tr&gt;\n&lt;td&gt;&lt;font \n	face=&quot;arial&quot;\n	&lt;%if not bGoodFname then response.write &quot; color=&quot;&quot;#ff0000&quot;&quot;%&gt;\n&gt;First Name&lt;/font&gt;\n&lt;input \n	type=&quot;text&quot; \n	name=&quot;firstname&quot;\n	value=&quot;&lt;%Response.Write request.form(&quot;firstname&quot;)%&gt;&quot;\n&gt;&lt;/td&gt;</p><p>&lt;!-- method 2, the cleaner method --&gt;\n&lt;td&lt;%if not bGoodFname then response.write &quot; class=&quot;&quot;error&quot;&quot;%&gt;&gt;\nFirst Name\n&lt;input \n	type=&quot;text&quot; \n	name=&quot;firstname&quot;\n	value=&quot;&lt;%Response.Write request.form(&quot;firstname&quot;)%&gt;&quot;\n&gt;&lt;/td&gt;\n</pre></p><p></p><p><p></p><p>Now, we run into a problem when the form is first viewed (before submission).\nAll of those variables are going to be false. So, up where we're doing validation,\nwe need to account for this case:</p><p></p></p><p></p><p><pre>\nfunction isValidEmail(byval sEmail)\n	' very simple email validation function.\n	returnVal = false\n	if not isEmpty(sEmail) then\n		if instr(sEmail, &quot;@&quot;) &gt; 0 and instr(sEmail, &quot;.&quot;) &gt; 0 then\n			returnVal = true\n		end if\n	end if\n	isValidEmail = returnVal\nend function</p><p>if isEmpty(sFname) then bGoodFname=false else bGoodFname=true\nif isEmpty(sLname) then bGoodLname=false else bGoodLname=true\nif not isValidEmail(sEmail) then bGoodEmail=false else bGoodEmail=true</p><p>bGoodPost = (bGoodFname and bGoodLname and bGoodEmail)</p><p>if ucase(trim(request.ServerVariables(&quot;REQUEST_METHOD&quot;)))=&quot;GET&quot; then\n	bGoodFname=true\n	bGoodLname=true\n	bGoodEmail=true\nend if\n</pre></p><p></p><p><p>And I'm sure you can think up some nice ways of getting around checking \nthe REQUEST_METHOD twice in the same script ;-)</p></p><p><p>Cool?</p></p><p><p>&nbsp;</p></p><p><h4>A Caveat</h4></p><p><p></p><p>Sending a response.redirect (or equivalent in your language of choice) generates \na HTTP response code of 302 (the requested file has been found but it is in a \ndifferent location). Rather than it executing the redirection by requesting \nthe new location, in very old browsers an &quot;Object Moved&quot; page might be \ndisplayed. This is obviously not something we want. In ASP, there is a method of \nthe <code>Server</code> object called <code>Transfer()</code>. \n<code>Server.Transfer()</code> is a server-side redirect, rather than a client-side \nredirect.  If this is available to you (ASP3/IIS5 and probably in other languages), \nyou will want to consider using that rather than sending a 302 header.</p><p></p></p><p><p>&nbsp;</p></p><p><p></p><p>--<br></p><p><a href="mailto:evolt@mattwarden.com">mattwarden</a><br></p><p><a href="http://www.mattwarden.com" target="_new">mattwarden.com</a><br></p><p></p>
</div>


          <div class="footer">
            <div class="contact">
              <p>
                Your Name<br />
                What You Are<br />
                you@example.com
              </p>
            </div>
            <div class="contact">
              <p>
                <a href="https://github.com/yourusername">github.com/yourusername</a><br />
                <a href="https://twitter.com/yourusername">twitter.com/yourusername</a><br />
              </p>
            </div>
          </div>
        </div>

    </body>
</html>
