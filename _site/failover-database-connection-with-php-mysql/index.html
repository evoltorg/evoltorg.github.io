<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Failover Database Connection With Php Mysql</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="site">
          <div class="header">
            <h1 class="title"><a href="/">evolt.org</a></h1>
            <a class="extra" href="/">home</a>
          </div>

          <h2>Failover Database Connection With Php Mysql</h2>
<p class="meta">20 May 2007</p>

<div class="post">
<p>Imagine, you're connecting to a mySQL database with PHP, but hell, you want a bit more robustness. So why would you want just one database? You'd use a failover right? So if the first database is down or just doesn't connect, it can connect to the next one. Here's how to do that (I'm assuming you're already replicating between databases so that they're roughly in sync).\n</p>\n<p>Here's how you do it. Firstly, you'll have to define some things...\n</p>\n<?php\n$host=""; //Database host.\n$user=""; //Database username.\n$pass=""; //Database password.\n$dbase=""; //Database.\n$host2=""; //Database host two... This is optional: in case the other database cannot connect.\n$user2=""; //Database username two... This is optional: in case the other database cannot connect.\n$pass2=""; //Database password two... This is optional: in case the other database cannot connect.\n$dbase2=""; //Database two... This is optional: in case the other database cannot connect.\n?>\n<p>\nView the comments, they are simple yet... informative.\nNow, the one thing that can make all of this come true:\n</p>\n<?php\n$connect=mysql_connect($host,$user,$pass); //Connect to the database.\n?>\n</p>\nThat will connect to the mySQL database with the currently defined variables.\nSo, obviously, if <code>$connect</code> does that, what would <code>$connect2</code> do?\n</p>\n<?php\n$connect2=mysql_connect($host2,$user2,$pass2); //Connect to the database.\n?>\n<p>\nIt connects to the database! But, oh, it's the second one. Strange, isn't it?\nNow, you can check if the database connected or not by checking if its true, or false.\n</p>\n<?php\nif (!$connect) {\n  mysql_close($connect); //Ends the current connection to the database.\n  echo "Cannot connect to the first database!"; //Display the text inside the quotes.\n}\nelse {\n  echo "Connected to the first database!"; //Display the text inside the quotes.\n}\n?>\n<p>\nOf course, how does it connect to the second database? Simple!\n</p>\n<?php\nif (!$connect) {\n  mysql_close($connect); //Ends the current connection to the database.\n  echo "Cannot connect to the first database!<br />"; //Display text inside the quotes.\n  if (!$connect2) {\n    mysql_close($connect2); //Ends the current connection to the second database.\n    echo "Cannot connect to second database!"; //Display text inside the quotes.\n  }\n  else {\n    echo "Connected to the second database!"; //Display text inside the quotes.\n  }\n}\nelse {\n  echo "Connected to the first database!<br />Did not connect to the second database!"; //Display text in quotes\n}\n?>\n<p>\nNow, that's all this really does. It has some <code>mysql_error()</code> stuff in it too, and checks if the url is <code>connection.php?type=1</code> before executing the code. I basically combined all of that into one script, all you have to do is edit the variables, and do:\n</p>\n<?php\ninclude "connection.php";\n?>\n<p>\nHere's the full script:\n</p>\n<?php\n/////////////////////////////////////////////////////////\n//Name --- Connection.php                              //\n/////////////////////////////////////////////////////////\n//Description --- Connects to a mySQL database easily  //\n/////////////////////////////////////////////////////////\n//Author --- [SJB]Dude7                                //\n/////////////////////////////////////////////////////////</p><p>$host=""; //Database host.\n$user=""; //Database username.\n$pass=""; //Database password.\n$dbase=""; //Database.\n$host2=""; //Database host two... This is optional: in case the other database cannot connect.\n$user2=""; //Database username two... This is optional: in case the other database cannot connect.\n$pass2=""; //Database password two... This is optional: in case the other database cannot connect.\n$dbase2=""; //Database two... This is optional: in case the other database cannot connect.</p><p>$connect=mysql_connect($host,$user,$pass); //Connect to the database.</p><p>if ($_GET["type"]=="1") {\n  if (!$connect) {\n    mysql_close($connect); //End the connection to possibly prevent SQL injection or just for safety.\n    $connect2=mysql_connect($host2,$user2,$pass2); //Connect to the host.\n    if (!$connect2) {\n      die("<b>ERROR:</b> " . mysql_error()); //Receive an error if it cannot connect.\n	  mysql_close($connect2); //End the connection to possibly prevent SQL injection or just for safety.\n    }\n    else {\n      $dbconnect2=mysql_select_db($dbase2, $connect2); //Select the database.\n	  if (!$dbconnect2) {\n	    die("<b>ERROR:</b> " . mysql_error()); //Receive an error if it cannot connect.\n	    mysql_close($connect2); //End the connection to possibly prevent SQL injection or just for safety.\n	  }\n    }\n  }\n  else {\n    $dbconnect=mysql_select_db($dbase, $connect); //Select the database.\n    if (!$dbconnect) {\n      die("<b>ERROR:</b> " . mysql_error()); //Receive an error if it cannot connect.\n	  mysql_close($connect); //End the connection to possibly prevent SQL injection or just for safety.\n    }\n  }\n}\nelse {\n  echo "<b>ERROR:</b> Invalid argument '" . $_GET["type"] . "'."; //If the connect.php?type doesn't equal one, it will display this error.\n}\n?>
</div>


          <div class="footer">
            <div class="contact">
              <p>
                Your Name<br />
                What You Are<br />
                you@example.com
              </p>
            </div>
            <div class="contact">
              <p>
                <a href="https://github.com/yourusername">github.com/yourusername</a><br />
                <a href="https://twitter.com/yourusername">twitter.com/yourusername</a><br />
              </p>
            </div>
          </div>
        </div>

    </body>
</html>
