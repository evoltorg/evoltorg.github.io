<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Creating A Login Script With Php 4</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="site">
          <div class="header">
            <h1 class="title"><a href="/">evolt.org</a></h1>
            <a class="extra" href="/">home</a>
          </div>

          <h2>Creating A Login Script With Php 4</h2>
<p class="meta">08 Jan 2002</p>

<div class="post">
<p>In this article we're going to create a login script with PHP that will allow registered users to login to your site. With this method we'll make restricting certain areas of your site to registered users child's play.</p>\n<h2>What's the point?</h2>\n<p>There could be many reasons you want to restrict access to registered users only. Say you have a rating script on your site, yet you don't want unregistered users to be able to submit their rating (as they do here on evolt.org). You could require a user to be logged in before they could access the rating script by including a  login check script at the beginning of a document.</p>\n<h2>Requirements</h2>\n<p>To use this script you must have access to PHP 4, and the PHP installation must be configured to allow <strong>sessions</strong>. We're going to use sessions with PHP 4 to check the user's input, and if it is indeed the information of a registered member, register this information as session variables so the script doesn't have to request their login info time and time again. It will create a session for them and &quot;remember&quot; the user until they log out.</p>\n<h2>Enough yappin', let's code it.</h2>\n<h3>Start the Session</h3>\n<pre>\n&lt;?\nsession_start(); // start session, duh.\n?&gt;\n&lt;!-- header tags, edit to match your own, or include() template header file. --&gt;\n&lt;html&gt;\n&lt;head&gt;\n&lt;title&gt;Login&lt;/title&gt;\n&lt;head&gt;\n&lt;body&gt;\n&lt;?\n</pre>\n<p>Alright, besides adding alittle header HTML in, the only useful bit in there is <a href="http://www.php.net/manual/en/function.session-start.php" title="PHP Manual: Session Start" target="_blank">session_start()</a> (click it). All this function does is initialise a session, or resumes the current one, bah, <a href="http://www.php.net/manual/en/function.session-start.php" title="PHP Manual: Session Start" target="_blank">read the page</a>. So now we have our session started, let's get it going.</p>\n<h3>Check Client</h3>\n<p>Next we need to check if the client is already logged in or not. If they are, leave them be, if they're not, pop up a login form:</p>\n<pre>\nif(!isset($username)   !isset($password)) {\n// escape from php mode.\n?&gt;\n&lt;form action=&quot;&lt;?=$PHP_SELF?&gt;&lt;?if($QUERY_STRING){ echo&quot;?&quot;. $QUERY_STRING;}?&gt;&quot; method=&quot;POST&quot;&gt;\n&lt;p align=&quot;center&quot;&gt;Members only. Please login to access this document.&lt;/p&gt;\n&lt;table align=&quot;center&quot; border=&quot;0&quot;&gt;\n &lt;tr&gt;\n  &lt;th&gt;\nUsername:\n  &lt;/th&gt;\n  &lt;th&gt;\n&lt;input type=&quot;text&quot; name=&quot;username&quot;&gt;\n  &lt;/th&gt;\n &lt;/tr&gt;\n &lt;tr&gt;\n  &lt;th&gt;\nPassword:\n  &lt;/th&gt;\n  &lt;th&gt;\n&lt;input type=&quot;password&quot; name=&quot;password&quot;&gt;\n  &lt;/th&gt;\n &lt;/tr&gt;\n &lt;tr&gt;\n  &lt;th colspan=&quot;2&quot; align=&quot;right&quot;&gt;\n&lt;input type=&quot;submit&quot; value=&quot;Login&quot;&gt;\n&lt;/form&gt;\n  &lt;/th&gt;\n &lt;/tr&gt;\n&lt;/table&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n&lt;?\nexit();\n}\n</pre>\n<p>OK now <code>$username</code> and <code>$password</code> are our session variables. These variables will be registered and be available to all scripts whilst our session is open. If they're not set, then the user isn't logged in and we need to set them before the client can access the document, so we present them with a form and ask them for their username and password. I also made it so if there's a query string, add it into the form action. Say a user requested <strong>index.php?action=mail</strong> but they're not logged in. When the login form is displayed, and they login, you want them to end up where they were heading (index.php?action=mail, not just index.php), they will.</p>\n<h3>Verify The Client</h3>\n<p>Next we need to register the session variables, if the user has just submit the login form then this bit of code will register them as session variables, and authenticate them.</p>\n<pre>\n// If all is well so far.</p><p>session_register(&quot;username&quot;);\nsession_register(&quot;password&quot;); // register username and password as session variables.</p><p>// Here you would check the supplied username and password against your database to see if they exist.\n// For example, a MySQL Query, your method may differ, obviously you would make a dataabse connection first.</p><p>$sql = mysql_query(&quot;SELECT password FROM user_table WHERE username = '$username'&quot;);\n$fetch_em = mysql_fetch_array($sql);\n$numrows = mysql_num_rows($sql);</p><p>if($numrows != &quot;0&quot; & $password == $fetch_em[&quot;password&quot;]) {\n$valid_user = 1;\n}\nelse {\n$valid_user = 0;\n}\n</pre>\n<p>OK first we use <a href="http://www.php.net/manual/en/function.session-register.php" title="PHP Manual: Session Register" target="_blank">session_register()</a> to register the client's username and password as session variables. Then we need to check if the username and password they supplied are valid. Bear in mind this is only an example, but say we have the below table in our database:</p>\n<p>\n<table align="center" border="1" cellspacing="0" cellpadding="2" width="80%">\n <tr>\n  <th align="center">\nid\n  </th>\n  <th align="center">\nusername\n  </th>\n  <th align="center">\npassword\n  </th>\n </tr>\n <tr>\n  <th align="center">\n1\n  </th>\n  <th align="center">\nfred\n  </th>\n  <th align="center">\nMypass\n  </th>\n </tr>\n <tr>\n  <th align="center">\n2\n  </th>\n  <th align="center">\nbob\n  </th>\n  <th align="center">\nbobspassword\n  </th>\n </tr>\n <tr>\n  <th align="center">\n3\n  </th>\n  <th align="center">\nlace\n  </th>\n  <th align="center">\nletmein\n  </th>\n </tr>\n</table>\n</p>\n<p>Now say <strong>bob</strong> is presented with the login form. He enters his username, bob, and his password, bobspassword. The script then registers these values as his session variables, then queries the database for a row <strong>where</strong> the username is <strong>bob</strong> and retrieves the password, it also counts the number of rows where the username is bob. Now if all goes well, <code>$numrows</code> should contain the int value of <code>1</code>, <code>$fetch_em[&quot;password&quot;]</code> will contain the user's password.</p>\n<p><code>if($numrows != &quot;0&quot; &amp; $password == $fetch_em[&quot;password&quot;]) {</code></p>\n<p>If the number of rows affected is not equal to zero <strong>and</strong> the password the user supplied is equal to the password retrieved from their database row, their information is correct, making them a valid user. If the above logic isn't true, set <code>$valid_user</code> to zero.</p>\n<h3>If information is incorrect</h3>\n<p>If the user enters incorrect information, up to now all the script does is check if the session variables are registered or not, so we need to add in a little bit to request their information again:</p>\n<pre>\n// If the username exists and pass is correct, don't pop up the login code again.\n// If info can't be found or verified....</p><p>if (!($valid_user))\n{\nsession_unset();   // Unset session variables.\nsession_destroy(); // End Session we created earlier.\n// escape from php mode.\n?&gt;\n&lt;form action=&quot;&lt;?=$PHP_SELF?&gt;&lt;?if($QUERY_STRING){ echo&quot;?&quot;. $QUERY_STRING;}?&gt;&quot; method=&quot;POST&quot;&gt;\n&lt;p align=&quot;center&quot;&gt;Incorrect login information, please try again. You must login to access this document.&lt;/p&gt;\n&lt;table align=&quot;center&quot; border=&quot;0&quot;&gt;\n &lt;tr&gt;\n  &lt;th&gt;\nUsername:\n  &lt;/th&gt;\n  &lt;th&gt;\n&lt;input type=&quot;text&quot; name=&quot;username&quot;&gt;\n  &lt;/th&gt;\n &lt;/tr&gt;\n &lt;tr&gt;\n  &lt;th&gt;\nPassword:\n  &lt;/th&gt;\n  &lt;th&gt;\n&lt;input type=&quot;password&quot; name=&quot;password&quot;&gt;\n  &lt;/th&gt;\n &lt;/tr&gt;\n &lt;tr&gt;\n  &lt;th colspan=&quot;2&quot; align=&quot;right&quot;&gt;\n&lt;input type=&quot;submit&quot; value=&quot;Login&quot;&gt;\n&lt;/form&gt;\n  &lt;/th&gt;\n &lt;/tr&gt;\n&lt;/table&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n&lt;?\nexit();\n}\n</pre>\n<p>here we use <a href="http://www.php.net/manual/en/function.session-unset.php" title="PHP Manual: Session Unset" target="_blank">session_unset()</a> to <em>unset</em> the registered session variables and <a href="http://www.php.net/manual/en/function.session-destroy.php" title="PHP Manual: Session Destroy" target="_blank">session_destroy()</a> to kill the session completely, just to make sure. Then we present the user with a login form telling them the supplied information was invalid, please try again.</p>\n<h3>Logging Out</h3>\n<p>Once the user is logged in, each time they try to access a protected document the above script will recognise their session and allow them to access. It is wise to have a logout script that simply terminates the session and offers them a link to login again or go to &quot;home&quot;, see below:</p>\n<pre>\n&lt;?\nsession_start();\nsession_unset();\nsession_destroy(); // destroy session.\n?&gt;\n&lt;html&gt;\n&lt;head&gt;\n&lt;title&gt;Logged Out&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;p align=&quot;center&quot;&gt;You have been successfuly logged out.&lt;/p&gt;\n&lt;p align=&quot;center&quot;&gt;&lt;a href=&quot;members.php&quot;&gt;Log back in&lt;/a&gt;   &lt;a href=&quot;index.php&quot;&gt;Go to homepage&lt;/a&gt;&lt;/p&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</pre>\n<p>All we have done is destroyed the session completely and informed the user they are now &quot;logged out&quot;.</p>\n<h2>The Scripts</h2>\n<h3>login.php</h3>\n<pre>\n&lt;?\nsession_start(); // start session.\n?&gt;\n&lt;!-- header tags, edit to match your own, or include template header file. --&gt;\n&lt;html&gt;\n&lt;head&gt;\n&lt;title&gt;Login&lt;/title&gt;\n&lt;head&gt;\n&lt;body&gt;\n&lt;?\nif(!isset($username)   !isset($password)) {\n// escape from php mode.\n?&gt;\n&lt;form action=&quot;&lt;?=$PHP_SELF?&gt;&lt;?if($QUERY_STRING){ echo&quot;?&quot;. $QUERY_STRING;}?&gt;&quot; method=&quot;POST&quot;&gt;\n&lt;p align=&quot;center&quot;&gt;Members only. Please login to access this document.&lt;/p&gt;\n&lt;table align=&quot;center&quot; border=&quot;0&quot;&gt;\n &lt;tr&gt;\n  &lt;th&gt;\nUsername:\n  &lt;/th&gt;\n  &lt;th&gt;\n&lt;input type=&quot;text&quot; name=&quot;username&quot;&gt;\n  &lt;/th&gt;\n &lt;/tr&gt;\n &lt;tr&gt;\n  &lt;th&gt;\nPassword:\n  &lt;/th&gt;\n  &lt;th&gt;\n&lt;input type=&quot;password&quot; name=&quot;password&quot;&gt;\n  &lt;/th&gt;\n &lt;/tr&gt;\n &lt;tr&gt;\n  &lt;th colspan=&quot;2&quot; align=&quot;right&quot;&gt;\n&lt;input type=&quot;submit&quot; value=&quot;Login&quot;&gt;\n&lt;/form&gt;\n  &lt;/th&gt;\n &lt;/tr&gt;\n&lt;/table&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n&lt;?\nexit();\n}</p><p>// If all is well so far.</p><p>session_register(&quot;username&quot;);\nsession_register(&quot;password&quot;); // register username and password as session variables.</p><p>// Here you would check the supplied username and password against your database to see if they exist.\n// For example, a MySQL Query, your method may differ.</p><p>$sql = mysql_query(&quot;SELECT password FROM user_table WHERE username = '$username'&quot;);\n$fetch_em = mysql_fetch_array($sql);\n$numrows = mysql_num_rows($sql);</p><p>if($numrows != &quot;0&quot; & $password == $fetch_em[&quot;password&quot;]) {\n$valid_user = 1;\n}\nelse {\n$valid_user = 0;\n}</p><p>// If the username exists and pass is correct, don't pop up the login code again.\n// If info can't be found or verified....</p><p>if (!($valid_user))\n{\nsession_unset();   // Unset session variables.\nsession_destroy(); // End Session we created earlier.\n// escape from php mode.\n?&gt;\n&lt;form action=&quot;&lt;?=$PHP_SELF?&gt;&lt;?if($QUERY_STRING){ echo&quot;?&quot;. $QUERY_STRING;}?&gt;&quot; method=&quot;POST&quot;&gt;\n&lt;p align=&quot;center&quot;&gt;Incorrect login information, please try again. You must login to access this document.&lt;/p&gt;\n&lt;table align=&quot;center&quot; border=&quot;0&quot;&gt;\n &lt;tr&gt;\n  &lt;th&gt;\nUsername:\n  &lt;/th&gt;\n  &lt;th&gt;\n&lt;input type=&quot;text&quot; name=&quot;username&quot;&gt;\n  &lt;/th&gt;\n &lt;/tr&gt;\n &lt;tr&gt;\n  &lt;th&gt;\nPassword:\n  &lt;/th&gt;\n  &lt;th&gt;\n&lt;input type=&quot;password&quot; name=&quot;password&quot;&gt;\n  &lt;/th&gt;\n &lt;/tr&gt;\n &lt;tr&gt;\n  &lt;th colspan=&quot;2&quot; align=&quot;right&quot;&gt;\n&lt;input type=&quot;submit&quot; value=&quot;Login&quot;&gt;\n&lt;/form&gt;\n  &lt;/th&gt;\n &lt;/tr&gt;\n&lt;/table&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n&lt;?\nexit();\n}\n?&gt;\n</pre>\n<h3>logout.php</h3>\n<pre>\n&lt;?\nsession_start();\nsession_unset();\nsession_destroy(); // destroy session.\n?&gt;\n&lt;html&gt;\n&lt;head&gt;\n&lt;title&gt;Logged Out&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;p align=&quot;center&quot;&gt;You have been successfuly logged out.&lt;/p&gt;\n&lt;p align=&quot;center&quot;&gt;&lt;a href=&quot;members.php&quot;&gt;Log back in&lt;/a&gt;   &lt;a href=&quot;index.php&quot;&gt;Go to homepage&lt;/a&gt;&lt;/p&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</pre>\n<p>Now to require a user to log in, simply include the login script at the top of a php page.</p>\n<p><code>include($DOCUMENT_ROOT .'/includes/login.php'); &nbsp;// or wherever yours is.</code></p>\n<p>Bear it in mind that the session places a cookie on the client's machine, so if they are not accepting cookies this script will have problems logging them in. There is a work-around for this by using the session ID (<a href="http://download.php.net/manual/en/function.session-id.php" title="PHP Manual: Session ID" target="_blank">session_id()</a>) and passing it along in the query string, through form and links and such, and the variable is only set when a cookie cannot be set, providing an easy way to check if a user is accepting cookies or not. For more information see <a href="http://download.php.net/manual/en/ref.session.php" title="PHP Sessions Reference" target="_blank">php.net's sessions reference</a>.\n<h2>Inspiration</h2>\n<p>In this article the script is used to require a user to login (as you may have noticed). This is just one application, you could have it so there is only one valid username and password pair and use it as an admin script, restrict access to each admin document by including it at the top of each file. I used this method in a guestbook script I recently wrote.</p>\n<p><strong>Hint</strong>: make sure you include the login script in your PHP document before any output, as you would use the <a href="http://download.php.net/manual/en/function.setcookie.php" title="PHP Manual: Set Cookie" target="_blank">setcookie()</a> function, unless you want a &quot;Headers already sent&quot; error.</p>\n<h2>Look Into It</h2>\n<p>Sessions with PHP 4 is a powerful and easy-to-use method to register variables across requests. I recommend you look into sessions and learn more about them. As with all things it has advantages and disadvantages. Problems arise in certain circumstances, users have cookies off, but that's all part of building a compatible-for-all website. Have a play around on your personal server, or your host, you'll like it.</p>\n<h2>Bibliography</h2>\n<p>If you're curious and want to learn more about this nifty feature in PHP 4 visit php.net:</p>\n<li><a href="http://download.php.net/manual/en/ref.session.php" title="php.net's session reference" target="_blank">Php.net's Session Documentation</a></li>
</div>


          <div class="footer">
            <div class="contact">
              <p>
                Your Name<br />
                What You Are<br />
                you@example.com
              </p>
            </div>
            <div class="contact">
              <p>
                <a href="https://github.com/yourusername">github.com/yourusername</a><br />
                <a href="https://twitter.com/yourusername">twitter.com/yourusername</a><br />
              </p>
            </div>
          </div>
        </div>

    </body>
</html>
