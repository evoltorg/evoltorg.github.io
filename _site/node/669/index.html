<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Dirty Shell Scripts Part 2 Dns Updates</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="site">
          <div class="header">
            <h1 class="title"><a href="/">evolt.org</a></h1>
            <a class="extra" href="/">home</a>
          </div>

          <h2>Dirty Shell Scripts Part 2 Dns Updates</h2>
<p class="meta">05 Jan 2000</p>

<div class="post">
<p>Daniel posted his excellent quick and dirty script for adding sites to your Apache Conf\nFile. Here's my quick and dirty script for adding domains to your DNS config files. (My\nscript does not provide the ego boost Daniel's does ;-)</p></p><p><p>Since I park quite a few domains for friends, as well as provide redirection/bounce\ndomains for some companies I many times need to do batches of domains. With the script and\ntemplate below, you can either pass the script one domain name, or pass it a file that has\na list of domain names. The script will then create a named.&lt;domainname&gt; file for\neach domain and also create an add.named.conf file that you can then manually append to\nyour named.conf file.</p></p><p><p>For my LINUX server, named files reside in /var/named. I created a special\nsub-directory called 'park' to store all my 'other' domains. I keep all my personal and my\npersonal business domains in /var/named, this allows for less clutter. The script assumes\nthat you set up your parked domains the same. You can edit it to either not do that, or\nadd additional functionality to branch on demand. </p></p><p><p>To use the script below, cut out the <code>new-site.cgi</code>\nand save as a text file in /var/named/park. Verify /usr/bin/perl is your perl5 executable\nand chmod the file to 700. You should be only playing with these files as root anyway. Cut\nout the <code>named.template</code> and save as a text file in\nthe same directory as new-site.cgi.</p></p><p><p>For One Domain, To activate: </p><p><ul>\n  <p><code>root@foobar park&gt;./new-site.cgi\n  newsite.com</code> </p>\n</ul></p><p><p>For More than one domain, create a text file with the list of new domains. </p><p><ul>\n  <p>e.g. <code>newsites.file</code><ul>\n    <p>newsite1.com<br>\n    newsite2.com<br>\n    newsite3.com<br>\n    etc.</code> </p>\n  </ul>\n</ul></p><p><p>To activate: </p><p><ul>\n  <p><code>root@foobar park&gt;./new-site.cgi -f\n  newsites.file</code> </p>\n</ul></p><p><p>Take the add.named.conf file and append it to your named.conf file. Restart named.</p></p><p><p>Hope this saves you some time and most of all have fun!!.</p></p><p><p><b>new-site.cgi</b></p></p><p><p><code>\n<pre>\n#!/usr/bin/perl -w\n##\n## Creates a new named file from\n## named.template and appends info\n## Does not restart named service!!\n##\n## Accepts two types of input\n## -f &lt;filename&gt;\n## or\n## &lt;domainname&gt;\n##\n## -f indicates read from file a\n## list of domain names to process \n##\n## &lt;domainname&gt; means just process</p><p>if ($#ARGV &gt; -1) {\n  if ($ARGV[0] eq &quot;-f&quot;) {\n    if (open (FILE, &quot;&lt;$ARGV[1]&quot;)) {\n      while ($ReadLine = &lt;FILE&gt;) {\n         chomp($ReadLine);\n        &amp;CreateNameDFile($ReadLine);\n        &amp;AddToNameDConfig($ReadLine);\n      } # end while (&lt;FILE&gt;)\n      close (FILE);\n      } else {\n        print &quot;Could not open $ARGV[1] </p><p>&quot;;\n        exit;\n    } # end if (open (FILE, &quot;&lt;$ARGV[1]&quot;)\n    } else {\n      if ($ARGV[0] ne &quot;&quot; &amp;&amp; $ARGV[0] ne &quot;\n&quot; ) {\n      &amp;CreateNameDFile($ARGV[0]);\n      &amp;AddToNameDConfig($ARGV[0]);\n    } else {\n      print &quot;no arguments given...\n&quot;;\n      print &quot; use -f \&lt;filename&gt; or\n&lt;domainname&gt;</p><p>&quot;;\n      exit;\n    } # end if ($ARGV[0] ne &quot;&quot; &amp;&amp; $ARGV[0] ne &quot;\n&quot; \n  } # end if ($ARGV[0] ne &quot;-f&quot;)\n} else {\n  print &quot;no arguments given...\n&quot;;\n  print &quot; use -f \&lt;filename&gt; or &lt;domainname&gt;</p><p>&quot;;\n  exit;\n} # end if ($#ARGV &gt;0)\n&lt;/small&gt;\n&lt;small&gt;sub CreateNameDFile {\n  $varNewFileName = &quot;named.&quot; . &quot;$_[0]&quot;;\n  open (TEMPLATE, &quot;&lt;./named.template&quot;);\n  open (DUMP, &quot;&gt;./$varNewFileName&quot;);\n  while ($Line = &lt;TEMPLATE&gt;) {\n    $Line =~ s/replaceme/$_[0]/g;\n    print DUMP $Line;\n  } # end while (&lt;TEMPLATE&gt;)\n  close (DUMP);\n  close (TEMPLATE);\n  print &quot;Completed new named file for $_[0] \n&quot;;\n} # end sub CreateNameDFile</p><p>sub AddToNameDConfig {\n  open (DUMP, &quot;&gt;&gt;./add.named.conf&quot;);\n  print DUMP &quot;zone \&quot;$_[0]\&quot; {\n&quot;;\n  print DUMP &quot; type master;\n&quot;;\n  print DUMP &quot; file \&quot;park\/named.&quot; . &quot;$_[0]&quot; .\n&quot;\&quot;;\n&quot;;\n  print DUMP &quot;};</p><p>&quot;; \n  close (DUMP);\n  print &quot;Added $_[0] info to add.named.conf file. </p><p>&quot;;\n} # end sub AddToNameDConfig</p><p>\nexit;\n</pre></code></p></p><p></p><p><p><b>named.template</b></p></p><p><p><code><pre>;\n*********************************************************** \n; *** Master DNS file for Your Sub-Domain *** \n; *********************************************************** \n; \n; NOTE: This file should only contain records for  \n; the foo.com domain. You must set up a  \n; separate master file for each zone. \n;  \n; \n; *********************************************************** \n; \n; The $ORIGIN is added to any domain name that  \n; does not end in a dot (&quot;.&quot;). \n; \n$ORIGIN replaceme. \n; \n; \n; *********************************************************** \n; \n; SOA record with recommended configuration values \n; \n@ IN SOA ns.replaceme. hostmaster.replaceme. ( \n199901173 ; Serial Number (YYYYMMDDN) \n10800 ; Refresh \n3600 ; Retry \n3599999 ; Expire \n86400 ) ; Minimum \n; \n; \n; *********************************************************** \n; \n; NS record for primary name server \n; \n@ IN NS ns.replaceme.  \n; \n; \n; *********************************************************** \n; \n; Have you contacted the administrator of ns.foo.net. \n; to ask if they are secondary for this zone? \n; If so, uncomment this NS line for the secondary name server. \n; \n;@ IN NS ns.foo.net.  \n; \n; \n; *********************************************************** \n; \n; MX record \n; \n; Mail Server \n@ IN MX 10 mail.replaceme.  \n; *********************************************************** \n@ IN A 192.168.0.1  \nmail IN A 192.168.0.1  \nwww IN A 192.168.0.1  \nns IN A 192.168.0.1  \nftp IN A 192.168.0.1 \n</pre></code></p></p><p><p><b>example add.named.conf file</b></p></p><p><p>\n<pre>\nzone &quot;foobar.org&quot; {\ntype master;\nfile &quot;park/named.foobar.org&quot;;\n};</p><p>zone &quot;foo.com&quot; {\ntype master;\nfile &quot;park/named.foo.com&quot;;\n};\n</pre></p>
</div>


          <div class="footer">
            <div class="contact">
              <p>
                Your Name<br />
                What You Are<br />
                you@example.com
              </p>
            </div>
            <div class="contact">
              <p>
                <a href="https://github.com/yourusername">github.com/yourusername</a><br />
                <a href="https://twitter.com/yourusername">twitter.com/yourusername</a><br />
              </p>
            </div>
          </div>
        </div>

    </body>
</html>
