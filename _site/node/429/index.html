<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Worried About High Disk Usage</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="site">
          <div class="header">
            <h1 class="title"><a href="/">evolt.org</a></h1>
            <a class="extra" href="/">home</a>
          </div>

          <h2>Worried About High Disk Usage</h2>
<p class="meta">09 Sep 1999</p>

<div class="post">
<p>\nWell if your running on a *nix box then here is\na little cron job that will warn you when usage\ngets high!\n</p></p><p><p>\nNow assuming you're root, create a sub-dir called\nscripts.\n</p></p><p><p>\nIn this directory place the following script\nand data files.\n</p></p><p><pre>\n===========df.script===============\n#!/bin/bash\nPATH=/sbin:/usr/sbin:/usr/bin:/bin\ncd /root/scripts\nif test `df &#124; fgrep -c -f\n/home/mashton/df.txt` -eq 0\nthen\n&nbsp;exit 0\nelse\n&nbsp;df &#124; mail &quot;$1&quot; -s\nDANGER_HIGH_DISK_USAGE\nfi\n===========df.script===============\n</pre></p><p><p>\nThe script is executing df (which displays your\ndisk usage), and pipes it through fgrep (which\nscans the output line by line).  I've used the -c\n(which counts the number of matches) and -f (which\ntells fgrep to get the matching data from a\nfile).\n</p></p><p><p>\nThe if condition tests for a value of 0 (no\nmatches) being returned by the fgrep. If 0 exit\nelse run df and email it to whoever you pass thru\nfrom the command line (see crontab below).\n</p></p><p><pre>\n===========df.txt===============\n104%\n103%\n102%\n101%\n100%\n99%\n98%\n97%\n96%\n95%\n94%\n93%\n92%\n91%\n90%\n89%\n88%\n87%\n86%\n85%\n84%\n83%\n82%\n81%\n===========df.txt===============\n</pre></p><p><p>\nNow in the data file I've set what I want fgrep\nto match for. As you can see I'm testing for\nanything greater then 80% usage.\n</p></p><p><p>\nThis gives you ample time to either clean up or\nplan for another drive, before you get into the\n90% range. Since, this is where *nix filesystem\nperformance starts to slow down.\n</p></p><p><p>\nAlso the reason for going to beyond 100% is\nthat typically a *nix filesystem has an overflow\nbuffer which allows for more then 100%\ncapacity. There is typically up to an extra 8% not\nreported.\n</p></p><p><p>\nRemember to do a change mod on the df.script so\nit will run!\n</p></p><p><p>\nNow just add it to your crontab and your ready\nto go!\n</p></p><p><p>\nJust do: crontab -e\n</p></p><p><p>\nThen insert a line for when you want it run (I\nrun mine every half hour and send the failure\nemail to alternating people) and whoever you want\nit sent to.\n</p></p><p><pre>\n=========crontab insert===========\n15 * * * * /root/scripts/df.script bryan &amp;&gt;\n/dev/null\n45 * * * * /root/scripts/df.script mike &amp;&gt;\n/dev/null\n=========crontab insert===========\n</pre></p><p><p>\nBy setting this up you can avoid a sudden\nsuprise and having your system crap out on\nyou!\n</p></p><p><p>Mike</p>
</div>


          <div class="footer">
            <div class="contact">
              <p>
                Your Name<br />
                What You Are<br />
                you@example.com
              </p>
            </div>
            <div class="contact">
              <p>
                <a href="https://github.com/yourusername">github.com/yourusername</a><br />
                <a href="https://twitter.com/yourusername">twitter.com/yourusername</a><br />
              </p>
            </div>
          </div>
        </div>

    </body>
</html>
