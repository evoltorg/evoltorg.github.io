<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Quick And Dirty File Upload How To</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="site">
          <div class="header">
            <h1 class="title"><a href="/">evolt.org</a></h1>
            <a class="extra" href="/">home</a>
          </div>

          <h2>Quick And Dirty File Upload How To</h2>
<p class="meta">01 Mar 2000</p>

<div class="post">
<P>Uploading files is a semi-complex process involving the right incantations on both the client forms and the server - but it can be tamed. Here's a quick over view of what you need to have to accept file uploads.</p>\n<P>Example "simple" upload form...</p>\n<code>\n<pre>\n&lt;form name=&quot;UploadForm&quot; method=&quot;post&quot; action=&quot;./file.cgi&quot;\n      enctype=&quot;multipart/form-data&quot; &gt; </p><p>&lt;INPUT TYPE=FILE NAME=&quot;FileName1&quot; VALUE=&quot;&quot;&gt;\n&lt;INPUT TYPE=SUBMIT NAME=&quot;Upload&quot; VALUE=&quot;Upload File&quot;&gt;\n&lt;/form&gt;    \n</pre>\n</code></p><p>\n<dl>\n	\n    <dt>\n        <strong>REQ 1</strong>\n    </dt>    \n        <dd>\n           <p>\n           You must be using a browser and server that supports HTTP 1.1 (Apache 1.3.x \n           and IIS 4.0. 3.x Netscape and above and 3.02? IE and above). Note that the \n           upload form needs a enctype. For file uploads you need</p>     \n           <p><code>multipart/form-data.</code></p>    \n        </dd>\n    <dt>\n        <strong>REQ 2</strong>\n    </dt>\n         <dd>\n            <p>\n            It's best that you use a CGI library like cgi-lib.pl or CGI.pm to assist you in \n            uploading files. These libraries can help you limit the file sizes and upload \n            locations as well as other niceties that will make the process \n            easier.</p></p><p>            <dl>\n            	<dt>CGI-LIB</dt>\n                   <dd><A HREF="http://cgi-lib.stanford.edu/cgi-lib/">    \n                                http://cgi-lib.stanford.edu/cgi-lib/</A>\n                   </dd>\n                <dt>CGI.PM</dt>\n                    <dd><A HREF="http://stein.cshl.org/software/WWW/CGI/">\n                        http://stein.cshl.org/software/WWW/CGI/</A>     \n                    </dd>\n            </dl>\n            <p>I'm partial to cgi-lib because its a smaller library and I only currently use the \n            upload and form parsing functions. But both libraries are very good.</p>\n        </dd>\n            \n    <dt>\n        <strong>REQ 3</strong>\n    </dt>\n         <dd>\n            <p>An understanding that you are allowing anonymous (unless the upload area \n            is password protected) people to upload files to your server. Make sure you \n            write code that chmod's the files to 666 or some other type of readable but \n            not executable form. Check for .cgi , .pl for extensions and strip them off. \n            Look for shebangs in the first line of all files - remove them or quarantine \n            them. Also, people have the potential to upload malicious HTML pages and \n            other 'tainted' stuff.</p>\n          </dd>\n     <dt>\n         <strong>REQ 4</strong>\n     </dt>\n         <dd>\n            Be paranoid. God is always building a better idiot.\n         </dd>\n</dl></p><p><P>After constructing the proper form, everything else is set within the CGI program. With cgi-lib.pl you have the following variables that can be set to control the upload process: (There are more than these variables that can be set - read the library's documentation to ferret out all the other options.)\n</p>\n<code>\n<pre>\n# Spool the files to the ______ directory\n# (directory needs to be 777)\n$cgi_lib::writefiles = &quot;/full/path/to/upload/dir&quot;;</p><p># Limit upload size \n$cgi_lib::maxdata = 50000000; \n# set to 50 megs;\n</pre>\n</code></p><p><p>The Upload directory is a &quot;temp&quot; location and the files are given unique names by the web server 23455.1 for file number one and 23455.2 for file number two (if you are doing multi-uploads). You are then responsible for getting the temp files renamed and put in their proper locations.</p></p><p><P>By parsing the form you can glean all the info you need to rename the files back to their original names. Cgi-Lib.pl uses the following parse function:</p></p><p><code>\n<pre>\n# Reading and pare the data.  Save the return value to $ret\n# Pass references to retrieve the data, the filenames,\n# and the content-type\n$ret = &amp;ReadParse(\%cgi_data,\%cgi_cfn,\%cgi_ct,\%cgi_sfn);\n</pre>\n</code>\n<p>\nWhere:  \n</p></p><p><UL>\n    <li><strong><P>%cgi_data</strong> - is the form data sent (for files is the full temp path and name on server)</li>\n    <li><strong>%cgi_cfn</strong> - is the common (original) file name (full path, may need to be truncated)</li>\n    <li><strong>%cgi_ct</strong> - is the content-type of the file (not always accurate)</li>\n    <li><strong>%cgi_sfn</strong> - is the just temp name of the file (no path) as given by the server</li>\n</UL></p><p><P>For example:</p>\n<code>\n<pre></p><p>&lt;FORM NAME=UPLOADFORM ENCTYPE=&quot;multipart/form-data&quot; \n          ACTION=&quot;/cgi-bin/upload.cgi&quot; METHOD=&quot;POST&gt;\n&lt;INPUT TYPE=&quot;file&quot; NAME=&quot;File1&quot;&gt; # User puts in: c:\autoexec.bat\n&lt;INPUT TYPE=&quot;file&quot; NAME=&quot;File2&quot;&gt; # User puts in: c:\config.sys\n&lt;INPUT TYPE=&quot;file&quot; NAME=&quot;File3&quot;&gt; # User puts in: c:\bootlog.txt\n&lt;INPUT TYPE=&quot;text&quot; NAME=&quot;UserName&quot;&gt; # User puts in: Howdy Doody\n&lt;INPUT TYPE=&quot;SUBMIT&quot; NAME=&quot;SUBMIT&quot;&gt;\n&lt;/FORM&gt;\n</pre>\n</code></p><p><h3>** upload.cgi **</h3>    </p><p><code>\n<pre>\n#!/usr/bin/perl\nrequire 5.001;\nrequire &quot;cgi-lib.pl&quot;;</p><p># Spool the files to the ______ directory\n# (directory needs to be 777)\n$cgi_lib::writefiles = &quot;/tmp/uploads&quot;;</p><p># Limit upload size \n$cgi_lib::maxdata = 50;  </p><p># set to 50k ;</p><p>$ret = &amp;ReadParse(\%cgi_data,\%cgi_cfn,\%cgi_ct,\%cgi_sfn);\n</pre>\n</code>\n    \n<p>** You would now have the following info...</p>\n<p>\n    <code>\n        $cgi_data{'UserName'} = &quot;Howdy Doody&quot;<br>\n        $cgi_data{'File1'} = &quot;/tmp/uploads/2343235.1&quot;<br>\n        $cgi_cfn{'File1'} = &quot;c:\autoexec.bat&quot;<br>\n        $cgi_ct{'File1'} = &quot;text/plain&quot;<br>\n        $cgi_sfn{'File1'} = &quot;2343235.1&quot;\n    </code>\n</p>\n<p>\n    <code>\n        $cgi_data{'File2'} = &quot;/tmp/uploads/2343235.2&quot;<br>\n        $cgi_cfn{'File2'} = &quot;c:\config.sys&quot;<br>\n        $cgi_ct{'File2'} = &quot;text/plain&quot;<br>\n        $cgi_sfn{'File2'} = &quot;2343235.2&quot;\n    </code>\n</p></p><p><p>\n    <code>\n        $cgi_data{'File3'} = &quot;/tmp/uploads/2343235.3&quot;<br>\n        $cgi_cfn{'File3'} = &quot;c:\bootlog.txt&quot;<br>\n        $cgi_ct{'File3'} = &quot;text/plain&quot;<br>\n        $cgi_sfn{'File3'} = &quot;2343235.3&quot;\n    </code>\n</p>\n      \n<p>                Hope this helps. Good Luck.    </p>
</div>


          <div class="footer">
            <div class="contact">
              <p>
                Your Name<br />
                What You Are<br />
                you@example.com
              </p>
            </div>
            <div class="contact">
              <p>
                <a href="https://github.com/yourusername">github.com/yourusername</a><br />
                <a href="https://twitter.com/yourusername">twitter.com/yourusername</a><br />
              </p>
            </div>
          </div>
        </div>

    </body>
</html>
