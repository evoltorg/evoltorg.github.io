<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Ri To The Rescue</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="site">
          <div class="header">
            <h1 class="title"><a href="/">evolt.org</a></h1>
            <a class="extra" href="/">home</a>
          </div>

          <h2>Ri To The Rescue</h2>
<p class="meta">11 Aug 2001</p>

<div class="post">
<h2>How Relational Integrity\ncan simplify your database project,\nshorten development time,\nand improve the quality of your life.\n</h2></p><p><p>Unless you are a seasoned database pro, \n&quot;relational integrity&quot; might be just\nanother fancy marketing phrase that you don't really understand\nbut are vaguely suspicious of.\nIf the following explanation helps you, I will be very, \nvery happy -- you don't even have to tell me; I'll know.\nAnd if you'd like more information, \nplease contact me; I do database work for a living,\nanswer email for free, and \nwould love to arrange some onsite training or consulting \nat your company.</p></p><p><p>To illustrate relational integrity concepts, \nI use the following <strong>sample database</strong>:</p></p><p><ul>\n<li><strong>articles</strong> such as stories, columns, opinions, recipes, \n       quotes, ideas,  or similar items of written content</li>\n<li><strong>authors</strong> who write articles</li>\n</ul></p><p><p>This database could be for an ezine (an electronic magazine web site), \na famous quotes search engine, an online library,\nor any application which has to keep track of content (articles)\nby owner (author).</p></p><p><p>If you already know what RI is, please feel free to\n<a href="/RI_to_the_Rescue#RI5">skip over</a> the following \nbasic explanations. </p></p><p><h2>What is a Relational Integrity?</h2></p><p><p>A <strong>relational database</strong>\ncontains tables of data which are related to each other.\nFor example, articles are related to the author who wrote them,\nand conversely, authors are related to the articles they wrote.  \n(Sounds obvious, and it is.)\nThat's the <strong>relational</strong> part.</p></p><p><p>When we work with a relational database,\nwe naturally expect that data in related tables <strong>stay related</strong>.  \nFor example, articles written by MartinB should always\nbe related to MartinB and never be confused with\narticles written by any other author.\nThat's the <strong>integrity</strong> part.</p></p><p><p>Relational Integrity is also called\nReferential Integrity, perhaps because the \nmechanism for ensuring integrity is implemented\nby the way the tables <em>reference</em> each other.\nBoth terms are okay with me.  I usually\njust say <strong>RI</strong> anyway.\n</p></p><p><h2>How RI Works</h2></p><p><p>\nTables are <strong>related using data values</strong>.\nUsually, these are the values of numeric  keys instead\nof text fields.  (Database designers love assigning\nnumeric keys, mainly because it's more\nefficient than relating tables through \ntext fields, but also because most databases\ncan generate autonumbers or sequence numbers\nfor this purpose.)</p></p><p><p>So let's say MartinB is an author in the\ndatabase and has author number 32.  \nFurther, let's say that for some reason \n(which we won't go into here, as it's not important) \nyou need to change MartinB's author number from 32 to \n45678.  The way it works is that you \nchange his author number on his author \nrecord in the author table.\n<em>And then you had better <strong>also change</strong>\nany references to author 32 in <strong>all related tables</strong></em> --\nlike the articles table --\nbecause if you don't, they'll still\nrefer to author number 32, which no longer exists.\n</p></p><p><p>Mercifully, you don't have to do this yourself.\nThis is where RI comes in.  RI can do it for you.</p></p><p><p>\nThe underlying structure and enforcement of RI\nis usually handled by the relational database system.\nI say <em>usually</em> because in all database\nsystems I've ever worked with, RI is optional,\nabsurd as that seems.\nDatabase developers have to turn RI on,\nor else ask the developers to provide external enforcement\nprocedures outside the database system.</p></p><p><p>So if you don't have RI turned on for your particular \ndatabase, then when the day comes -- and you know it will --\nwhen you have to make a change \nand you forget the external procedure(s) to change all the\nnecessary related data values, the database will be said to have \nlost integrity.  You will have &quot;broken links&quot; in your tables.\nYou will be up the creek. (Next April 1, mention to a DBA that \nthere are broken links in his database, and watch his face...)</p></p><p><p>You will, I am certain, by this point have guessed\nthat RI can be a very useful feature to employ in your database.</p></p><p><p>Let us take one more brief\nmoment to cover some basic definitions\nbefore getting down to business.\nAgain, please feel free to\n<a href="/RI_to_the_Rescue#RI5">skip over</a> these definitions.</p></p><p><h2>Parent and Child</h2></p><p><p>Every database relation is a <strong>one-to-many</strong>\nrelation involving just two tables, a parent table and a child table.\nYes, you may hear other terms like one-to-one, many-to-many, and so on, but\nthese are all just special cases of the one-to-many relation.\nDon't let them fool you.  Understanding databases is easy if you keep it simple.</p></p><p><p>So each relation is one-to-many, involving a <strong>parent</strong> table \nand a <strong>child</strong> table. \nThis terminology is not standard, merely convenient, if somewhat unfortunate.\nSome people say master and detail; sometimes, I'll\nsay owner and member, a flashback\nfrom pre-relational CODASYL databases\nas out of date as bell-bottom pants (except that unlike \npre-relational databases, bell-bottoms may one day be back in style).</p></p><p><p>As you might guess, the parent is the &quot;one&quot; and\nthe child is the &quot;many.&quot;\nEach parent can have many children.\nThe reverse, I am afraid, is not true, not in a relational database.\nA child can have only one parent.\n<em>Please</em> don't\ndwell too long on the obvious fact that in real life a child\nhas two parents -- you will only get confused.  In a relational database,\nin a one-to-many relation, <strong>each child has <em>at most</em>\none parent</strong>. This is important.  This is also why the\nparent-child terminology is unfortunate.</p></p><p><p>Let's look at our sample database.\nEach author is related one or more articles, the articles written by that author.\nThe author table is the parent table, and\nthe article table is the child table.</p></p><p><p>Note that an author can write many articles, but an article has only one author.\nThis is a natural consequence of it being a one-to-many relation.\nThe scenario where an article\nis co-authored by more than one author\ninvolves a many-to-many relation,\nthe contemplation of which, like the reality that\nin real life a child has more than one parent,\nis beyond the scope of this discussion; it will only confuse you\nnow.</p></p><p><h2>Primary and Foreign Keys</h2></p><p><p>Relational databases implement RI\nusing <strong>primary keys</strong> and <strong>foreign keys</strong>.\nOther than their special role in RI,\nthese &quot;keys&quot; are like any other database fields -- they\ncontain data values.</p></p><p><p>The <strong>parent table contains the primary key</strong> and \nthe <strong>child table contains the foreign key</strong> which \nreferences (or &quot;points&quot; to, if you prefer) the parent table.</p></p><p><p>Because each child relates to only one parent,\nthe child table needs only one foreign key.\nSo where are the &quot;many&quot; child records in a\none-to-many relation?  They're\nin the <strong>multiple rows</strong> of the child table\nthat all have the <strong>same data value in\ntheir foreign key</strong>, all referencing the same parent.</p></p><p><p>For example, consider the following articles:</p></p><p><table border="0" cellpadding="6" cellspacing="0">\n<tr><th>Author</th><th>Article</th></tr>\n<tr><td align="center">32</td><td><a href="/article/Your_clients_need_a_Content_Management_System/20/5127/index.html" title="Your clients need a Content Management System">Your clients need a CMS</a>\n                                         <br /><a href="/article/The_Tao_of_Testing/20/4142/index.html" title="The Tao of Testing">The Tao of Testing</a></td></tr>\n<tr><td align="center">88</td><td><a href="/article/640_x_480_Isn_t_Dead_Just_Yet/22/275/index.html" title="640 x 480 Isn't Dead Just Yet">640 x 480 Isn't Dead Yet</a>\n                                         <br /><a href="/article/Inside_the_evolt_org_Rebuild_The_HTML_and_CSS/20/5816/index.html" title="Inside the evolt.org Rebuild: The HTML and CSS">Inside the evolt.org Rebuild</a></td></tr>\n<tr><td align="center">20</td><td><a href="/article/Liquid_Tables/20/2321/index.html" title="Liquid Tables">Liquid Tables</a></td></tr>\n</table></p><p><p>Above, you can see the one-to-many relation clearly.\nNow look at it the way you normally see\nit actually stored in the article table:</p></p><p><table border="0" cellpadding="6" cellspacing="0">\n<tr><th>Article</th><th>Author</th></tr>\n<tr><td><a href="/article/Your_clients_need_a_Content_Management_System/20/5127/index.html" title="Your clients need a Content Management System">Your clients need a CMS</a></td><td align="center">32</td></tr>\n<tr><td><a href="/article/640_x_480_Isn_t_Dead_Just_Yet/22/275/index.html" title="640 x 480 Isn't Dead Just Yet">640 x 480 Isn't Dead Yet</a></td><td align="center">88</td></tr>\n<tr><td><a href="/article/The_Tao_of_Testing/20/4142/20/4142/index.html" title="The Tao of Testing">The Tao of Testing</a></td><td align="center">32</td></tr>\n<tr><td><a href="/article/Inside_the_evolt_org_Rebuild_The_HTML_and_CSS/20/5816/index.html" title="Inside the evolt.org Rebuild: The HTML and CSS">Inside the evolt.org Rebuild</a> &nbsp;</td><td align="center">88</td></tr>\n<tr><td><a href="/article/Liquid_Tables/20/2321/index.html" title="Liquid Tables">Liquid Tables</a></td><td align="center">20</td></tr>\n</table></p><p><p>Now you can see more clearly that each article is\nrelated to only one author.  This is the &quot;many-to-one&quot;\nreversal of the one-to-many relationship.\nIt amounts to the same thing.  You can always say something\nabout a one-to-many relation in two different ways.</p></p><p><p><a name="RI5">&nbsp;</a></p>\n<h2>RI Actions</h2></p><p><p>Finally, we get down to business.</p></p><p><p>In a relational database,\nthere are four basic actions you can perform on a table:</p>\n<ul>\n<li><strong>Select</strong> one or more existing rows from the table</li>\n<li><strong>Insert</strong> one or more new rows into the table</li>\n<li><strong>Update</strong> one or more rows in the table</li>\n<li><strong>Delete</strong> one or more rows from the table</li>\n</ul></p><p><p>These actions, known as <strong>SIUD</strong>, are carried out\nby the -- wait for it -- Select, Insert, Update, and Delete SQL statements.  \n(These actions are sometimes, as in business process modelling, also\ncalled CRUD, using the initials for Create, Reference, Update, and Delete.\nCRUD is easier to remember, but not as helpful as SIUD, because\nyou may end up getting confused.  For example, there's no \nReference SQL statement, but there <em>is</em> a Create SQL statement, \nalthough it doesn't create any data.  I'm sorry I even\nmentioned CRUD.  I just wanted to \nset the record straight, point out again that simplicity rules,\nand make sure you were awake.)</p></p><p><p>Three of these actions -- Insert, Update, and Delete --\nchange the contents of the database table and therefore have RI implications.\nRemember, you want to stay on top of changes, preferably letting\nthe database itself handle them, to ensure you\nnever have &quot;broken links&quot; in your data.</p></p><p><p>Now it gets a wee bit complicated.</p></p><p><p>For every relation, the Insert, Update, and Delete actions\ncan be performed on <em>either</em> the primary key (in the parent table), or the foreign\nkey (in the child table).  \nThere are thus a total of six possible <strong>RI actions</strong> for\nevery one-to-many relation:</p></p><p><table border="0" cellpadding="6" cellspacing="0">\n<tr align="left"><th>Parent Insert</th><td>&nbsp;</td><th>Child Insert</th></tr>\n<tr align="left"><th>Parent Update</th><td>&nbsp;</td><th>Child Update</th></tr>\n<tr align="left"><th>Parent Delete</th><td>&nbsp;</td><th>Child Delete</th></tr>\n</table></p><p><p>Each of these six possible RI actions\nneeds to be examined when you\ndesign your database, because what you want to do\nis turn over as much of the enforcement\nof RI as possible to the database itself.</p></p><p><h2>RI Rules</h2></p><p><p>Now it gets a little more complicated.</p></p><p><p>For <em>each</em> of the six RI actions mentioned above, \n<em>one of five</em> RI rules can be implemented:</p></p><p><table border="0" cellpadding="6" cellspacing="0">\n<tr><th align="left">Cascade    </th><td>&nbsp;</td><td>perform same action on related keys</td></tr>\n<tr><th align="left">Restrict   </th><td>&nbsp;</td><td>disallow action</td></tr>\n<tr><th align="left">Set Null   </th><td>&nbsp;</td><td>set related keys to null</td></tr>\n<tr><th align="left">Set Default</th><td>&nbsp;</td><td>set related keys to their default value</td></tr>\n<tr><th align="left">None       </th><td>&nbsp;</td><td>allow action, do nothing to related keys</td></tr>\n</table></p><p><p>Does this mean that implementing RI\nrequires choosing one out of a possible thirty different\ncombinations of actions for each one-to-many relation??\nThe answer is yes -- but I hasten to add that it isn't really as bad or as much\nwork as it may seem!!</p></p><p><p>In fact, most database systems do not let you\ndefine all of the above rules.  Where you cannot\ndefine the rule, it typically defaults either to Restrict or None.</p></p><p><h2>Sample RI Action Rules</h2></p><p><p>Let's say you want to insert a new article, i.e. a child insert action.\nIn most databases, the Restrict rule would be\nin effect (assuming you have defined the foreign key properly,\ni.e. RI has been turned on).\nWhat this means is that you cannot insert an article for an \nauthor that doesn't exist; you are restricted from doing so.</p></p><p><p>This is typical behaviour\nfor most one-to-many relations.  You have to add the parent to\nthe database first, and then you can add child records\nthat reference that parent.\nIn fact, if you wanted some other rule for Child Insert, \nyou would find it extremely tricky to implement.  Trust\nme, it's messy.  Luckily, this requirement hardly ever\ncomes up.  I shouldn't even have mentioned it.\nOf the five possible actions for Child Insert, \nonly Restrict really makes sense.</p>\n<p>Okay, I lied.  Actually, there is one other action that \nmakes sense, in a macabre sort of way, only because you see it all the time,\nnot that you would really want to define it\nthis way on purpose (assuming you have been paying attention).</p>\n<p>If you do not turn on RI for the author-article\none-to-many relation, the Child Insert action defaults to None.\nIn other words, you can add an article that references any author number\nyou like, the database will not check it for you,\nand who knows, it might result in a broken link.\nSo leaving RI undefined for a given relation\nresults in Child Insert: None.</p></p><p><p>Maintaining the author-article relation involves six different actions.\nBelow, I have chosen the RI rules  that &quot;make the most sense&quot; to me.\nSee if you agree or disagree with my comments:</p></p><p><ol>\n<li><p><strong>Author Insert: None</strong>\n<br /><em>insert new author, do nothing to related articles</em>\n<br />This is fairly trivial, since new authors wouldn't have any articles yet\n      (assuming other sensible RI rules are in effect).</p></li></p><p><li><p><strong>Author Update: Cascade</strong>\n<br /><em>update the author's primary key and also all matching article foreign keys</em>\n<br />This is the crucial action we've been talking about that you \nwant the database to do for you, and while you might not need\nto change a record's primary key often, when you need to do it,\nyou want Cascade.</p></li></p><p><li><p><strong>Author Delete: Restrict</strong>\n<br /><em>delete author only if no articles have been written by this author</em>\n<br />If you allowed the author delete to happen and left the\narticles in there, they would all have broken links; Restrict prevents this.\nAlternatively, if you specified the Author Delete rule as Set Null, \nthe author would be gone and the articles would be left behind but you \nwouldn't know who wrote them; this is the only other choice that\nmakes sense to me, but maybe not as much as Restrict.\n(And I'm sorry, I really cannot get into\na discussion of nulls at this point.)</p></li></p><p><li><p><strong>Article Insert: Restrict</strong>\n<br /><em>insert new article only if the author already exists</em>\n<br />This is the example discussed in detail earlier.</p></li></p><p><li><p><strong>Article Update: Restrict</strong>\n<br /><em>update article to a different author but only if the new author \nalso already exists</em>\n<br />Sometimes this is required to correct an input error.</p></li></p><p><li><p><strong>Article Delete: None</strong>\n<br /><em>delete article and do nothing to author</em>\n<br />This makes sense, right?  Note that if the article being deleted \nis the author's last or only one, this may result in an author \nwith no articles -- but that's <em>not</em> the\nsame thing as a broken link.</p></li></p><p></ol></p><p><h2>Options for Implementing RI</h2></p><p><p>If you  made it this far, congratulations -- \nthings are about to get a whole lot simpler.</p></p><p><p>Standard SQL-92 syntax provides a mechanism\nfor setting RI rules only for the <strong>parent delete</strong> and <strong>parent update</strong> actions.\nAll others take a default. The rules are defined when\ndeclaring the foreign key on the child table:</p></p><p><p><code>\nCREATE TABLE child ( columndefinitions,\n<br />&nbsp; [constraintname] FOREIGN KEY (fkcolumns)\n<br />&nbsp;&nbsp; REFERENCES parent [(pkcolumns)]\n<br />&nbsp;&nbsp; ON DELETE\n<br />&nbsp;&nbsp;&nbsp; CASCADE   SET NULL   SET DEFAULT   NO ACTION\n<br />&nbsp;&nbsp; ON UPDATE\n<br />&nbsp;&nbsp;&nbsp; CASCADE   SET NULL   SET DEFAULT   NO ACTION\n<br />&nbsp; )</code></p></p><p><p>As mentioned, all other rules take defaults, and\nif you do not define the parent delete and parent update rules,\nthey take defaults too:</p></p><p><table border="0" cellpadding="6" cellspacing="0">\n<tr><th>Action</th><th>Default Rule</th></tr>\n<tr><td>Parent Insert</td><td align="center">None</td></tr>\n<tr><td>Parent Update</td><td align="center">Restrict</td></tr>\n<tr><td>Parent Delete</td><td align="center">Restrict</td></tr>\n<tr><td>Child Insert</td><td align="center">Restrict</td></tr>\n<tr><td>Child Update</td><td align="center">Restrict</td></tr>\n<tr><td>Child Delete</td><td align="center">None</td></tr>\n</table></p><p><p>None of these defaults is very surprising, when you think about it.\nIn fact, the only action for the author-article relation\nthat we thought made sense to be different from the default\nis Author Update, which we decided we wanted as Cascade.\nLuckily, that is one of the rules that can \nbe easily set by the SQL syntax.</p></p><p><p>So what's the big deal, then?  If all the defaults are good,\nand we can change the ones we want, how will RI\nsimplify your database project,\nshorten development time,\nand improve the quality of your life?</p></p><p><p>The answer comes when you consider how some\napplications go about maintaining relational integrity\nwhen RI is <em>not</em> turned on in the database.</p></p><p><p>Suppose the application wanted to insert an\narticle, and also wanted to make sure the author \nalready exists in the database.  It is\nnot difficult to imagine a developer\ncoding up something like this --</p></p><p><ul>\n<li>do a SELECT on the author table using the author number\nfor the proposed article insert as the search key</li>\n<li>if the select fails, issue an error message\nsuch as "author does not exist; article insert rejected"</li>\n<li>otherwise, proceed to INSERT the article</li>\n</ul></p><p><p>There is nothing inherently <em>wrong</em> with this approach,\nother than that</p>\n<ol><li>it requires an additional database call, which \nis often much less efficient, and</li>\n<li>it takes extra time to do this programming</li>\n</ol></p><p><p>With RI turned on and Article Insert set to Restrict (the default),\nthe developer simply codes</p></p><p><ul>\n<li>INSERT the article</li>\n<li>test the database return code, and if it failed\non an RI exception, issue the error message</li>\n</ul></p><p><p>It is not even always necessary to\ntest the return code and issue a friendly error message.\nAssuming the foreign key constraint is named properly,\nthe database error message will basically say something\nlike &quot;ERROR: integrity constraint ARTICLEAUTHOR violated - parent key not\nfound&quot; and this is often enough to indicate what's going on.</p></p><p><h2>Conclusions</h2></p><p><p>When designing a database, after all the\nentities, tables, columns and data types have been identified,\nyou will have a number of one-to-many relations.\nExamine <em>each</em> relation\nin light of the six possible actions,\nand the five possible rules for each.\n<strong>Start by considering all the default rules.</strong>\nPay special attention to the <strong>parent update</strong>\nand <strong>parent delete</strong> rules, because those can\nbe changed easily, and often are.\nThen prepare a <strong>rule table</strong> for each\nrelation, similar to the samples we described earlier\nfor the author-article relation:</p></p><p><table border="0" cellpadding="6" cellspacing="0">\n<tr><th>Action</th><th>Rule</th></tr>\n<tr><td>Author Insert</td><td align="center">None</td></tr>\n<tr><td>Author Update</td><td align="center"><strong>Cascade</strong></td></tr>\n<tr><td>Author Delete</td><td align="center">Restrict</td></tr>\n<tr><td>Article Insert</td><td align="center">Restrict</td></tr>\n<tr><td>Article Update</td><td align="center">Restrict</td></tr>\n<tr><td>Article Delete</td><td align="center">None</td></tr>\n</table></p><p><p>Highlight the rules that are different\nfrom the default, as above.\nThen pass these rule tables as specifications to your developer.</p></p><p><p>You'll save a lot of hassles, development time,\nand unnecessary coding.  And you might just see\nan increase in the quality of your life.</p></p><p><h2>Footnotes</h2></p><p><p>I am indebted to ERwin, a popular data modelling tool,\nfor first introducing me to the concept \nof RI actions outside the scope of what is\nnormally defined by SQL syntax.  You would\nnot believe what you have to do, and what ERwin\ncan generate in the way of triggers and stored procedures,\nto achieve non-default RI rules for actions \nother than parent update and parent delete.\nIf your project requires these, give me a shout.</p></p><p><p>&quot;Improving the quality of life&quot; is a \nrequirement that should be part of every database\nspecification. I was taught this\nin my very first database design course\nfor IDMS in 1977 by William Casey of Cullinane Corporation,\nand it's as true today as it was then.</p>
</div>


          <div class="footer">
            <div class="contact">
              <p>
                Your Name<br />
                What You Are<br />
                you@example.com
              </p>
            </div>
            <div class="contact">
              <p>
                <a href="https://github.com/yourusername">github.com/yourusername</a><br />
                <a href="https://twitter.com/yourusername">twitter.com/yourusername</a><br />
              </p>
            </div>
          </div>
        </div>

    </body>
</html>
